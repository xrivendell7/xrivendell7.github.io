<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>n1ctfjunior-re | xrivendell7&#39;s ctf blog（佩奇小屋）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="FlowerHidden32位ida查看 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657; int __cdecl main(int argc, const char **argv, const char **envp)_main">
<meta property="og:type" content="article">
<meta property="og:title" content="n1ctfjunior-re">
<meta property="og:url" content="http://example.com/2025/11/18/n1ctfjunior-re/index.html">
<meta property="og:site_name" content="xrivendell7&#39;s ctf blog（佩奇小屋）">
<meta property="og:description" content="FlowerHidden32位ida查看 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657; int __cdecl main(int argc, const char **argv, const char **envp)_main">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/1763435137247-6.png">
<meta property="og:image" content="http://example.com/1763435137193-1.png">
<meta property="og:image" content="http://example.com/1763435137193-2.png">
<meta property="og:image" content="http://example.com/1763435137193-3.png">
<meta property="og:image" content="http://example.com/1763435137193-4.png">
<meta property="og:image" content="http://example.com/1763435137193-5.png">
<meta property="article:published_time" content="2025-11-18T03:04:13.000Z">
<meta property="article:modified_time" content="2025-11-18T03:05:50.550Z">
<meta property="article:author" content="xrivendell7">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/1763435137247-6.png">
  
    <link rel="alternate" href="/atom.xml" title="xrivendell7's ctf blog（佩奇小屋）" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xrivendell7&#39;s ctf blog（佩奇小屋）</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-n1ctfjunior-re" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/11/18/n1ctfjunior-re/" class="article-date">
  <time class="dt-published" datetime="2025-11-18T03:04:13.000Z" itemprop="datePublished">2025-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      n1ctfjunior-re
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="FlowerHidden"><a href="#FlowerHidden" class="headerlink" title="FlowerHidden"></a>FlowerHidden</h2><p>32位ida查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">_main           proc near               ; CODE XREF: __scrt_common_main_seh(void)+F5↓p</span><br><span class="line"></span><br><span class="line">argc            = dword ptr  8</span><br><span class="line">argv            = dword ptr  0Ch</span><br><span class="line">envp            = dword ptr  10h</span><br><span class="line"></span><br><span class="line">; FUNCTION CHUNK AT .text:00402460 SIZE 00000003 BYTES</span><br><span class="line"></span><br><span class="line">                push    ebp</span><br><span class="line">                mov     ebp, esp</span><br><span class="line">                push    offset sub_401020</span><br><span class="line">                push    offset sub_402850</span><br><span class="line">                push    offset sub_4012F0</span><br><span class="line">                push    offset sub_401330</span><br><span class="line">                push    offset sub_402480</span><br><span class="line">                push    offset loc_402810</span><br><span class="line">                push    offset sub_401350</span><br><span class="line">                push    offset sub_401360</span><br><span class="line">                push    offset sub_401300</span><br><span class="line">                push    offset sub_4012B0</span><br><span class="line">                push    offset sub_402890</span><br><span class="line">                push    offset loc_402FB0</span><br><span class="line">                push    offset sub_402490</span><br><span class="line">                push    offset sub_4012E0</span><br><span class="line">                push    offset sub_402840</span><br><span class="line">                push    offset sub_402450</span><br><span class="line">                push    offset sub_402430</span><br><span class="line">                push    offset sub_401340</span><br><span class="line">                push    offset sub_401050</span><br><span class="line">                push    offset sub_401040</span><br><span class="line">                push    offset sub_4028C0</span><br><span class="line">                push    offset sub_402440</span><br><span class="line">                push    offset loc_401000</span><br><span class="line">                push    offset sub_4012A0</span><br><span class="line">                push    offset sub_4028A0</span><br><span class="line">                push    offset sub_402420</span><br><span class="line">                push    offset sub_402880</span><br><span class="line">                push    offset sub_401320</span><br><span class="line">                push    offset sub_401310</span><br><span class="line">                push    offset sub_4012C0</span><br><span class="line">                push    offset sub_401030</span><br><span class="line">                push    offset sub_402860</span><br><span class="line">                push    offset sub_402410</span><br><span class="line">                push    offset sub_401010</span><br><span class="line">                push    offset sub_402830</span><br><span class="line">                push    offset sub_402820</span><br><span class="line">                push    offset sub_402870</span><br><span class="line">                push    offset sub_4012D0</span><br><span class="line">                push    offset sub_4028B0</span><br><span class="line">                push    offset loc_402460</span><br><span class="line">                retn</span><br><span class="line">_main           endp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                pop     ebp</span><br><span class="line">                retn</span><br></pre></td></tr></table></figure>

<p>进入main有花指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:00402FB0 loc_402FB0:                             ; DATA XREF: _main+3A↓o</span><br><span class="line">.text:00402FB0                 cmp     eax, 4</span><br><span class="line">.text:00402FB3                 jz      short locret_402FBA</span><br><span class="line">.text:00402FB5                 call    loc_402A60</span><br><span class="line">.text:00402FBA</span><br><span class="line">.text:00402FBA locret_402FBA:                          ; CODE XREF: .text:00402FB3↑j</span><br><span class="line">.text:00402FBA                 retn</span><br><span class="line">.text:00402FBA ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00402FBB                 align 10h</span><br></pre></td></tr></table></figure>

<p>去看loc_402A60</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.text:00402A7A                 mov     eax, 1</span><br><span class="line">.text:00402A7F                 imul    ecx, eax, 3</span><br><span class="line">.text:00402A82                 movsx   edx, byte_420100[ecx]</span><br><span class="line">.text:00402A89                 push    edx</span><br><span class="line">.text:00402A8A                 call    sub_4023E0</span><br></pre></td></tr></table></figure>

<p>从表 <code>byte_420100</code> 读取值，传入 <code>sub_4023E0</code>，ecx&#x3D;3，imul有符号整数乘法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data:00420100 byte_420100     db 0                    ; DATA XREF: sub_401D80+63B↑o</span><br><span class="line">.data:00420100                                         ; sub_4024A0+4F↑r ...</span><br><span class="line">.data:00420101                 db    1</span><br><span class="line">.data:00420102                 db    2</span><br><span class="line">.data:00420103                 db    3</span><br><span class="line">.data:00420104                 db    4</span><br><span class="line">.data:00420105                 db    5</span><br><span class="line">.data:00420106                 db    6</span><br><span class="line">.data:00420107                 db    7</span><br></pre></td></tr></table></figure>

<p>byte_420100取值范围0~7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.text:004023E0 sub_4023E0      proc near               ; CODE XREF: sub_4024A0+57↓p</span><br><span class="line">.text:004023E0                                         ; sub_4024A0+7A↓p ...</span><br><span class="line">.text:004023E0</span><br><span class="line">.text:004023E0 arg_0           = dword ptr  4</span><br><span class="line">.text:004023E0</span><br><span class="line">.text:004023E0                 mov     ebx, [esp+arg_0]</span><br><span class="line">.text:004023E4                 mov     eax, 0Ah</span><br><span class="line">.text:004023E9                 mov     ecx, ebx</span><br><span class="line">.text:004023EB                 not     eax</span><br><span class="line">.text:004023ED                 and     ebx, eax</span><br><span class="line">.text:004023EF                 not     eax</span><br><span class="line">.text:004023F1                 not     ecx</span><br><span class="line">.text:004023F3                 and     ecx, eax</span><br><span class="line">.text:004023F5                 or      ebx, ecx</span><br><span class="line">.text:004023F7                 inc     ebx</span><br><span class="line">.text:004023F8                 dec     ebx</span><br><span class="line">.text:004023F9                 mul     ebx</span><br><span class="line">.text:004023FB                 div     ebx</span><br><span class="line">.text:004023FD                 xor     ebx, eax</span><br><span class="line">.text:004023FF                 add     [esp+0], ebx</span><br><span class="line">.text:00402402                 retn    4</span><br><span class="line">.text:00402402 sub_4023E0      endp</span><br></pre></td></tr></table></figure>

<p>简化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sub_4023E0:</span><br><span class="line">    mov     ebx, [esp+4]       ; ebx = arg</span><br><span class="line">    mov     eax, 0Ah           ; eax = 10</span><br><span class="line">    mov     ecx, ebx           ; ecx = arg</span><br><span class="line">    not     eax                ; eax = ~10</span><br><span class="line">    and     ebx, eax           ; ebx = arg &amp; ~10</span><br><span class="line">    not     eax                ; eax = 10</span><br><span class="line">    not     ecx                ; ecx = ~arg</span><br><span class="line">    and     ecx, eax           ; ecx = ~arg &amp; 10</span><br><span class="line">    or      ebx, ecx           ; ebx = (arg &amp; ~10) | (~arg &amp; 10)</span><br></pre></td></tr></table></figure>

<p><code>(arg &amp; ~mask) | (~arg &amp; mask)</code> 这个表达式是按位选择：当 <code>mask</code> 位为 1 时取原式&#x3D;<code>~arg</code> ，为 0 时原式&#x3D; <code>arg</code> 的那一位。代数上等价于 <code>arg ^ mask</code>（异或）。</p>
<p>本题mask&#x3D;0xA(10)，所以ebx&#x3D;arg^0xA。</p>
<p> inc指令用于将一个寄存器的值加1，dec指令用于将一个寄存器的值减1。</p>
<p>当前ebx&#x3D;arg^0xA，eax&#x3D;10</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mul     ebx                ; EDX:EAX = 10 * (arg^0xA)</span><br><span class="line">div     ebx                ;(10 * (arg^0xA))/(arg^0xA)</span><br><span class="line">xor     ebx, eax           ; ebx = EBX ^ 10</span><br><span class="line">add     [esp+0], ebx       ; *(DWORD*)(esp) += ebx   &lt;-- 修改返回地址</span><br><span class="line">ret     4</span><br></pre></td></tr></table></figure>

<p>div这里，如果(arg^0xA)!&#x3D;0，ebx &#x3D; (arg^0xA) ^ 10&#x3D;arg</p>
<p>到此这一长段乘除只是把 <code>ebx</code> 恢复为原始输入 <code>arg</code> ，是花指令</p>
<p>add这里，<code>esp+0</code> 是栈顶 <strong>返回地址</strong>（函数被调用时的 <code>ret</code> 地址）。因此它 <strong>把 <code>arg</code> 加到返回地址上</strong>（即修改返回地址，使得 <code>ret</code> 返回到 <code>return_address + arg</code>）。</p>
<p>[ ]取地址</p>
<table>
<thead>
<tr>
<th>平台 &#x2F; ABI</th>
<th>参数 1</th>
<th>参数 2</th>
<th>参数 3</th>
<th>参数 4</th>
<th>参数 5+</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><strong>x86 (32位, cdecl&#x2F;stdcall)</strong></td>
<td><code>[esp+4]</code></td>
<td><code>[esp+8]</code></td>
<td><code>[esp+0xC]</code></td>
<td><code>[esp+0x10]</code></td>
<td>继续往上递增</td>
<td>所有参数都压栈；<code>[esp]</code> 是返回地址</td>
</tr>
<tr>
<td><strong>Windows x64 (MSVC ABI)</strong></td>
<td><code>RCX</code></td>
<td><code>RDX</code></td>
<td><code>R8</code></td>
<td><code>R9</code></td>
<td><code>[rsp+0x28]</code> 开始</td>
<td>栈上预留 32 字节 shadow space (<code>rsp+20h</code> 到 <code>rsp+40h</code>)，即使没用</td>
</tr>
<tr>
<td><strong>System V AMD64 (Linux, macOS, BSD)</strong></td>
<td><code>RDI</code></td>
<td><code>RSI</code></td>
<td><code>RDX</code></td>
<td><code>RCX</code></td>
<td><code>R8</code></td>
<td><code>R9</code></td>
</tr>
</tbody></table>
<p>sub_402A60，两次输入，第二次输入会被switch四个方向</p>
<p>迷宫终点是38，移动42次，累加和为117</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">64  49  49  49  49  49  48  48  48  48  49   0</span><br><span class="line">48  48  48  49  48  48  48  49  49  48  49   0</span><br><span class="line">49  49  48  49  48  49  48  48  49  48  49   0</span><br><span class="line">49  49  48  48  48  49  49  48  48  48  49   0</span><br><span class="line">49  49  48  49  49  48  48  48  49  49  49   0</span><br><span class="line">49  49  48  49  49  48  49  49  49  49  49   0</span><br><span class="line">49  48  48  48  48  48  49  49  49  49  49   0</span><br><span class="line">49  48  49  49  49  48  48  49  48  48  48   0</span><br><span class="line">49  48  48  48  49  49  48  48  48  49  48   0</span><br><span class="line">49  49  49  48  49  49  48  49  49  49  48   0</span><br><span class="line">49  49  49  48  48  48  48  48  48  48  38   0</span><br><span class="line">49  49  49  49  49  49  49  49  49  49  49   0</span><br></pre></td></tr></table></figure>

<p>sddssddwwddsdssaassaaaassddssdddwwddwddsss，程序验证通过，但是不是flag。发现ipu文件还没有使用，而且第一个输入也没被使用。</p>
<p>关注迷宫的第一个输入，注意到这里是有一个指针指向第一次输入的，看这个指针的交叉引用，可以看到一个验证和分发程序。</p>
<p>sub_1D80</p>
<p>首先，读入了1pmoluy.ipu文件，经过文件名解码，文件读入与解码。然后得到 4 个指针，分别指向不同解密后函数的入口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*(_DWORD *)dword_420FB0 = Buffer;</span><br><span class="line">qmemcpy(v16, &quot;FUNC&quot;, sizeof(v16));</span><br><span class="line"></span><br><span class="line">*(_DWORD *)(dword_420FB0 + 4) = *(_DWORD *)dword_420FB0 + sub_401AC0(*(_DWORD *)dword_420FB0, v16, v13);</span><br><span class="line"></span><br><span class="line">*(_DWORD *)(dword_420FB0 + 8) = *(_DWORD *)(dword_420FB0 + 4) + sub_401AC0(*(_DWORD *)(dword_420FB0 + 4), v16, v13);</span><br><span class="line"></span><br><span class="line">*(_DWORD *)(dword_420FB0 + 12) = *(_DWORD *)(dword_420FB0 + 8) + sub_401AC0(*(_DWORD *)(dword_420FB0 + 8), v16, v13);</span><br></pre></td></tr></table></figure>

<p>对比父进程名字的前 3 个字节。如果不匹配，<code>byte_420100[6] = 10;</code> → 改变全局控制流。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String2 = &#123; -26, -21, -18, -113 &#125;;</span><br><span class="line">for (m=0; m&lt;4; m++) String2[m] ^= 0x8F;</span><br><span class="line">_strnicmp(String1, String2, 3)</span><br></pre></td></tr></table></figure>

<p>strings2单字节异或得到字符串”ida”，如果父进程是 IDA，则会把 <code>byte_420100[6]</code> 设为 10。</p>
<p>sub_2790，异常处理函数，这里又改成了1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int __usercall sub_402790@&lt;eax&gt;(int a1@&lt;ebp&gt;)</span><br><span class="line">&#123;</span><br><span class="line">  if ( *(_DWORD *)(a1 + 0x10) == 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    ++**(_DWORD **)(a1 + 8);</span><br><span class="line">    byte_420100[6] = 1;</span><br><span class="line">    *(_DWORD *)(a1 - 28) = sub_401370;</span><br><span class="line">    dword_420FC0 = *(_DWORD *)(a1 - 28);</span><br><span class="line">    __asm &#123; retn &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_DWORD *)(a1 - 36) = 0;</span><br><span class="line">  *(_DWORD *)(a1 - 4) = -2;</span><br><span class="line">  return *(_DWORD *)(a1 - 36);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在反调试的函数中，调用了1pmoluy.ipu文件。文件中存储的是四个加密函数，经过解密后会被后面分发函数进行调用。然后根据路径进行顺序解密。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">int __usercall sub_401370@&lt;eax&gt;(int a1@&lt;eax&gt;)</span><br><span class="line">&#123;</span><br><span class="line">  dword_420FB8 = a1;</span><br><span class="line">  if ( a1 == 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    (*(void (__cdecl **)(char *))dword_420FB0)(off_420234);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    switch ( dword_420FB8 )</span><br><span class="line">    &#123;</span><br><span class="line">      case 2:</span><br><span class="line">        (*(void (__cdecl **)(char *))(dword_420FB0 + 4))(off_420234);</span><br><span class="line">        break;</span><br><span class="line">      case 3:</span><br><span class="line">        (*(void (__cdecl **)(char *))(dword_420FB0 + 8))(off_420234);</span><br><span class="line">        break;</span><br><span class="line">      case 4:</span><br><span class="line">        (*(void (__cdecl **)(char *))(dword_420FB0 + 12))(off_420234);</span><br><span class="line">        break;</span><br><span class="line">      default:</span><br><span class="line">        return dword_420FB8;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_401210();</span><br><span class="line">  return dword_420FB8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加密1 异或 左循环位移 异或 右循环位移<br>加密2 固定key生成固定box和对应固定key 这里dump其实就行<br>加密3 这里把boxdump下来试两下就会发现 这里仅仅是实现了加减法<br>加密4 根据key生成随机顺序换序 也可以dump下来然后固定换回来就行</p>
<h2 id="Pyramid"><a href="#Pyramid" class="headerlink" title="Pyramid"></a>Pyramid</h2><p>chal.pyc -&gt; pyramid.pyd -&gt; a_long_way_to_treasure() -&gt;  pyramid.pyc（异或）   -&gt;  checkinput.pyd(rc4)  -&gt; 白盒aes解flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Decompiled with PyLingual (https://pylingual.io)</span></span><br><span class="line"><span class="comment"># Internal filename: chal.py</span></span><br><span class="line"><span class="comment"># Bytecode version: 3.12.0rc2 (3531)</span></span><br><span class="line"><span class="comment"># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pyramid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">text = <span class="string">&#x27;A pyramid fortified with intricate defenses looms before you. \nIts secrets are locked behind layers of puzzles. \nYou stand at its base, challenged to unravel them all.&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;･････････････････････････････････････････････････････････････････&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> text.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;  <span class="subst">&#123;line&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;･････････････････････････････････････････････････････････････････&#x27;</span>)</span><br><span class="line">pyramid.a_long_way_to_treasure()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    os.remove(<span class="string">&#x27;checkinput.pyd&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><img src="/1763435137247-6.png" alt="img"></p>
<p><img src="/1763435137193-1.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">.rdata:0000000180008280 unk_180008280   db 0A9h                 ; DATA XREF: .rdata:0000000180007F80↑o</span><br><span class="line">.rdata:0000000180008281                 db  6Ch ; l</span><br><span class="line">.rdata:0000000180008282                 db  63h ; c</span><br><span class="line">.rdata:0000000180008283                 db  6Dh ; m</span><br><span class="line">.rdata:0000000180008284                 db  64h ; d</span><br><span class="line">.rdata:0000000180008285                 db  72h ; r</span><br><span class="line">.rdata:0000000180008286                 db  65h ; e</span><br><span class="line">.rdata:0000000180008287                 db  61h ; a</span><br><span class="line">.rdata:0000000180008288                 db  2Bh ; +</span><br><span class="line">.rdata:0000000180008289                 db  30h ; <span class="number">0</span></span><br><span class="line">.rdata:000000018000828A                 db 0B5h</span><br><span class="line">.rdata:000000018000828B                 db  1Bh</span><br><span class="line">.rdata:000000018000828C                 db 0BDh</span><br><span class="line">.rdata:000000018000828D                 db  0Ch</span><br><span class="line">.rdata:000000018000828E                 db  6Bh ; k</span><br><span class="line">.rdata:000000018000828F                 db  6Fh ; o</span><br><span class="line">.rdata:0000000180008290                 db  81h</span><br><span class="line">.rdata:0000000180008291                 db  61h ; a</span><br><span class="line">.rdata:0000000180008292                 db  6Eh ; n</span><br><span class="line">.rdata:0000000180008293                 db  67h ; g</span><br><span class="line">.rdata:0000000180008294                 db  64h ; d</span><br><span class="line">.rdata:0000000180008295                 db  72h ; r</span><br><span class="line">.rdata:0000000180008296                 db  65h ; e</span><br><span class="line">.rdata:0000000180008297                 db  61h ; a</span><br><span class="line">.rdata:0000000180008298                 db  6Dh ; m</span><br><span class="line">.rdata:0000000180008299                 db  69h ; i</span><br><span class="line">.rdata:000000018000829A                 db  74h ; t</span><br><span class="line">.rdata:000000018000829B                 db  73h ; s</span><br><span class="line">.rdata:000000018000829C                 db  6Dh ; m</span><br><span class="line">.rdata:000000018000829D                 db  71h ; q</span><br><span class="line">.rdata:000000018000829E                 db  67h ; g</span><br><span class="line">.rdata:000000018000829F                 db  6Fh ; o</span><br><span class="line">.rdata:00000001800082A0                 db  62h ; b</span><br><span class="line">.rdata:00000001800082A1                 db  61h ; a</span><br><span class="line">.rdata:00000001800082A2                 db  6Eh ; n</span><br><span class="line">.rdata:00000001800082A3                 db  67h ; g</span><br><span class="line">.rdata:00000001800082A4                 db  64h ; d</span><br></pre></td></tr></table></figure>

<p><img src="/1763435137193-2.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Decompiled with PyLingual (https://pylingual.io)</span></span><br><span class="line"><span class="comment"># Internal filename: layer2.py</span></span><br><span class="line"><span class="comment"># Bytecode version: 3.12.0rc2 (3531)</span></span><br><span class="line"><span class="comment"># Source timestamp: 2025-09-10 10:56:06 UTC (1757501766)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> wintypes</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BUF</span>(ctypes.Structure):</span><br><span class="line">    _fields_ = [(<span class="string">&#x27;Length&#x27;</span>, wintypes.ULONG), (<span class="string">&#x27;Unused&#x27;</span>, wintypes.ULONG), (<span class="string">&#x27;Ptr&#x27;</span>, ctypes.c_void_p)]</span><br><span class="line">key = <span class="built_in">input</span>(<span class="string">&#x27;Input your key: &#x27;</span>)</span><br><span class="line">tmp = <span class="number">2166136261</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> key:</span><br><span class="line">    tmp = <span class="number">16777619</span> * (tmp ^ <span class="built_in">ord</span>(ch)) &amp; <span class="number">4294967295</span></span><br><span class="line">key_bytes = struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>, tmp)</span><br><span class="line">advapi32 = ctypes.WinDLL(<span class="string">&#x27;advapi32&#x27;</span>, use_last_error=<span class="literal">True</span>)</span><br><span class="line">SystemFunction033 = advapi32.SystemFunction033</span><br><span class="line">FNPROTO = ctypes.WINFUNCTYPE(<span class="literal">None</span>, ctypes.POINTER(BUF), ctypes.POINTER(BUF))</span><br><span class="line">fn = FNPROTO(ctypes.cast(SystemFunction033, ctypes.c_void_p).value)</span><br><span class="line">data = <span class="string">b&#x27;\xb7\xc3\xbc\xe5 &lt;skip&gt;&#x27;</span></span><br><span class="line">data_buffer = ctypes.create_string_buffer(data)</span><br><span class="line">key_buffer = ctypes.create_string_buffer(key_bytes)</span><br><span class="line">data_buf = BUF(<span class="built_in">len</span>(data), <span class="number">0</span>, ctypes.addressof(data_buffer))</span><br><span class="line">key_buf = BUF(<span class="number">4</span>, <span class="number">0</span>, ctypes.addressof(key_buffer))</span><br><span class="line">fn(ctypes.byref(data_buf), ctypes.byref(key_buf))</span><br><span class="line">pyd_path = os.path.join(os.getcwd(), <span class="string">&#x27;checkinput.pyd&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(pyd_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(data_buffer.raw[:<span class="built_in">len</span>(data)])</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    spec = importlib.util.spec_from_file_location(<span class="string">&#x27;checkinput&#x27;</span>, pyd_path)</span><br><span class="line">    module = importlib.util.module_from_spec(spec)</span><br><span class="line">    spec.loader.exec_module(module)</span><br><span class="line">    flag = <span class="built_in">input</span>(<span class="string">&#x27;Input your flag: &#x27;</span>)</span><br><span class="line">    result = module.check(flag.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Right!&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Wrong!&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wrong key!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>关于key的运算，可以看到魔数2166136261与16777619，可以判断是FNV哈希算法，然后哈希值被打包成4字节的小端字节序格式（<code>key_bytes</code>），用作RC4解密的密钥。将解密后的数据放入当前目录下的<code>checkinput.pyd</code>文件中，使用<code>importlib</code>动态导入该模块，并获取其中的<code>check</code>函数。用户被提示输入flag，并调用<code>module.check</code>进行验证。</p>
<p>所以接下来需要求得RC4的密钥</p>
<p>已知:</p>
<ul>
<li>密文前四个字节：<code>\xb7\xc3\xbc\xe5</code>   明文前四个：<code>4D 5A 90 00</code></li>
<li>密钥长度为 4 字节</li>
</ul>
<p>rc4短密钥爆破脚本：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    MistHill, created on 10:24:34 2013-7-3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    compile:</span></span><br><span class="line"><span class="comment">        Visual Studio 6:</span></span><br><span class="line"><span class="comment">            CL /Og /Os /Oy /Ob1 /GT /Gs /Gf /Gy /G6 /MT rc4KStream75MT.c /link /RELEASE</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Refs:</span></span><br><span class="line"><span class="comment">    1) Optimizing C++/Code optimization/Faster operations</span></span><br><span class="line"><span class="comment">        http://en.wikibooks.org/wiki/Optimizing_C%2B%2B/Code_optimization/Faster_operations</span></span><br><span class="line"><span class="comment">    2) Writing Efficient C and C Code Optimization</span></span><br><span class="line"><span class="comment">        http://www.codeproject.com/Articles/6154/Writing-Efficient-C-and-C-Code-Optimization</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    3) Multithreading Tutorial #1</span></span><br><span class="line"><span class="comment">        http://www.computersciencelab.com/MultithreadingTut1.htm</span></span><br><span class="line"><span class="comment">    4) Walkthrough: Debugging a Multithreaded Application</span></span><br><span class="line"><span class="comment">        http://msdn.microsoft.com/en-us/library/bb157784(v=vs.90).aspx</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;process.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TARGETKS1 0xe52c99fa</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prepare_key</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key_data_ptr, <span class="type">int</span> key_data_len, <span class="type">unsigned</span> <span class="type">char</span> *state)</span></span>;</span><br><span class="line"><span class="function">BOOL <span class="title">GetKeyStream</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *buffer_ptr, <span class="type">int</span> buffer_len, <span class="type">unsigned</span> <span class="type">char</span> *state)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> _Recursion(<span class="type">void</span>*);</span><br><span class="line"><span class="type">unsigned</span> __stdcall _RecursionT1(<span class="type">void</span>*);</span><br><span class="line"><span class="type">unsigned</span> __stdcall _RecursionT2(<span class="type">void</span>*);</span><br><span class="line"><span class="type">unsigned</span> __stdcall _RecursionT3(<span class="type">void</span>*);</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Recursion</span><span class="params">(<span class="type">int</span> idx, <span class="type">unsigned</span> <span class="type">char</span> *pKey, <span class="type">unsigned</span> <span class="type">char</span> *pKeyStream, <span class="type">unsigned</span> <span class="type">char</span> *pstate)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">ConsoleHandler</span><span class="params">(DWORD dwCtrlType)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ShowExecutionTime</span><span class="params">(BOOL bBreaked)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ShowMatchedKeystream</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>*)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//static int TargetKS1 = 0x62383550, TargetKS2 = 0x6F0C1E2C; /* Target KS = 50 35 38 62 2C 1E 0C 6F */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KeyLength 4</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">char</span> szErrMsgCT[] =<span class="string">&quot;Create thread%d failed!\n&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> szFmtHex2[] =<span class="string">&quot;%02X &quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> szFmtDate[] =<span class="string">&quot;\n%s\t%04d-%02d-%02d %02d:%02d:%02d.%03d&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> stateinit[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> Key[<span class="number">8</span>], KeyT1[<span class="number">8</span>], KeyT2[<span class="number">8</span>], KeyT3[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Size: just 4 is fine. Exec. time of function GetKeyStream() reduced!</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> KeyStream[<span class="number">4</span>], KeyStreamT1[<span class="number">4</span>], KeyStreamT2[<span class="number">4</span>], KeyStreamT3[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> state[<span class="number">256</span>], stateT1[<span class="number">256</span>], stateT2[<span class="number">256</span>], stateT3[<span class="number">256</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> SYSTEMTIME lt0, lt1;</span><br><span class="line"><span class="type">static</span> DWORD dw0, dw1;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    HANDLE hThread[<span class="number">3</span>];</span><br><span class="line">    <span class="type">unsigned</span> threadID[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">SetConsoleCtrlHandler</span>( (PHANDLER_ROUTINE)ConsoleHandler, TRUE)==FALSE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Unable to install handler!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GetLocalTime</span>(&amp;lt0);</span><br><span class="line">    dw0 = <span class="built_in">GetTickCount</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i =<span class="number">0</span>; i &lt;<span class="number">256</span>; i++)</span><br><span class="line">        stateinit[i] = i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create the threads.</span></span><br><span class="line">    hThread[<span class="number">0</span>] = (HANDLE)_beginthreadex(<span class="literal">NULL</span>,<span class="number">0</span>, &amp;_RecursionT1,<span class="literal">NULL</span>,<span class="number">0</span>, &amp;threadID[<span class="number">0</span>] );</span><br><span class="line">    <span class="keyword">if</span>(!hThread[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(szErrMsgCT,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hThread[<span class="number">1</span>] = (HANDLE)_beginthreadex(<span class="literal">NULL</span>,<span class="number">0</span>, &amp;_RecursionT2,<span class="literal">NULL</span>,<span class="number">0</span>, &amp;threadID[<span class="number">1</span>] );</span><br><span class="line">    <span class="keyword">if</span>(!hThread[<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(szErrMsgCT,<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hThread[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hThread[<span class="number">2</span>] = (HANDLE)_beginthreadex(<span class="literal">NULL</span>,<span class="number">0</span>, &amp;_RecursionT3,<span class="literal">NULL</span>,<span class="number">0</span>, &amp;threadID[<span class="number">2</span>] );</span><br><span class="line">    <span class="keyword">if</span>(!hThread[<span class="number">2</span>]) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(szErrMsgCT,<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hThread[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">CloseHandle</span>(hThread[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _Recursion(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">WaitForMultipleObjects</span>(<span class="number">3</span>, hThread, TRUE, INFINITE);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CloseHandle</span>(hThread[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hThread[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">CloseHandle</span>(hThread[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ShowExecutionTime</span>(FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> _Recursion(<span class="type">void</span>* pArguments)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0x30~0x7A: T0(0x30~0x42), T1(0x43~0x55), T2(0x56~0x68), T3(0x69~0x7A)</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">64</span>;i++) &#123;</span><br><span class="line">        Key[<span class="number">0</span>] = i;</span><br><span class="line">        <span class="built_in">Recursion</span>(<span class="number">1</span>, Key, KeyStream, state);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> __stdcall _RecursionT1(<span class="type">void</span>* pArguments)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">64</span>;i&lt;<span class="number">128</span>;i++) &#123;</span><br><span class="line">        KeyT1[<span class="number">0</span>] = i;</span><br><span class="line">        <span class="built_in">Recursion</span>(<span class="number">1</span>, KeyT1, KeyStreamT1, stateT1);</span><br><span class="line">    &#125;</span><br><span class="line">    _endthreadex(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> __stdcall _RecursionT2(<span class="type">void</span>* pArguments)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">128</span>;i&lt;<span class="number">192</span>;i++) &#123;</span><br><span class="line">        KeyT2[<span class="number">0</span>] = i;</span><br><span class="line">        <span class="built_in">Recursion</span>(<span class="number">1</span>, KeyT2, KeyStreamT2, stateT2);</span><br><span class="line">    &#125;</span><br><span class="line">    _endthreadex(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> __stdcall _RecursionT3(<span class="type">void</span>* pArguments)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">192</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        KeyT3[<span class="number">0</span>] = i;</span><br><span class="line">        <span class="built_in">Recursion</span>(<span class="number">1</span>, KeyT3, KeyStreamT3, stateT3);</span><br><span class="line">    &#125;</span><br><span class="line">    _endthreadex(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Recursion</span><span class="params">(<span class="type">int</span> idx, <span class="type">unsigned</span> <span class="type">char</span> *pKey, <span class="type">unsigned</span> <span class="type">char</span> *pKeyStream, <span class="type">unsigned</span> <span class="type">char</span> *pstate)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        pKey[idx] = i;</span><br><span class="line">        <span class="keyword">if</span>(idx <span class="number">+1</span> &lt; KeyLength)</span><br><span class="line">            <span class="built_in">Recursion</span>(idx <span class="number">+1</span>, pKey, pKeyStream, pstate);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(pstate, stateinit,<span class="built_in">sizeof</span>(stateinit));</span><br><span class="line">            <span class="built_in">prepare_key</span>(pKey, KeyLength, pstate);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>( <span class="built_in">GetKeyStream</span>(pKeyStream,<span class="built_in">sizeof</span>(KeyStream), pstate) )</span><br><span class="line">                <span class="built_in">ShowMatchedKeystream</span>(pKey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prepare_key</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *key_data_ptr, <span class="type">int</span> key_data_len, <span class="type">unsigned</span> <span class="type">char</span> *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> swapByte;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> index1, index2;</span><br><span class="line">    <span class="type">int</span> counter;</span><br><span class="line"></span><br><span class="line">    index1 = index2 =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(counter =<span class="number">0</span>; counter &lt;<span class="number">256</span>; counter++)</span><br><span class="line">    &#123;</span><br><span class="line">        index2 = key_data_ptr[index1] + state[counter] + index2;</span><br><span class="line"></span><br><span class="line">        swapByte = state[counter];</span><br><span class="line">        state[counter] = state[index2];</span><br><span class="line">        state[index2] = swapByte;</span><br><span class="line"></span><br><span class="line">        index1++;</span><br><span class="line">        <span class="keyword">while</span>(index1 == key_data_len)</span><br><span class="line">            index1 -= key_data_len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">GetKeyStream</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *buffer_ptr, <span class="type">int</span> buffer_len, <span class="type">unsigned</span> <span class="type">char</span> *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> swapByte;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> x;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> y;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> xorIndex;</span><br><span class="line">    <span class="type">int</span> counter;</span><br><span class="line"></span><br><span class="line">    x = y =<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(counter =<span class="number">0</span>; counter &lt; buffer_len; counter ++)</span><br><span class="line">    &#123;</span><br><span class="line">        x++;</span><br><span class="line">        y = state[x] + y;</span><br><span class="line"></span><br><span class="line">        swapByte = state[x];</span><br><span class="line">        state[x] = state[y];</span><br><span class="line">        state[y] = swapByte;</span><br><span class="line"></span><br><span class="line">        xorIndex = state[x] + state[y];</span><br><span class="line"></span><br><span class="line">        buffer_ptr[counter] = state[xorIndex];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( *(<span class="type">int</span>*)buffer_ptr == TARGETKS1 )</span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">ConsoleHandler</span><span class="params">(DWORD dwCtrlType)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dwCtrlType == CTRL_C_EVENT) &#123;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\r&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, Key[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, KeyT1[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, KeyT2[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, KeyT3[i]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(dwCtrlType == CTRL_BREAK_EVENT)</span><br><span class="line">        <span class="built_in">ShowExecutionTime</span>(TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ShowExecutionTime</span><span class="params">(BOOL bBreaked)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GetLocalTime</span>(&amp;lt1);</span><br><span class="line">    dw1 = <span class="built_in">GetTickCount</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(bBreaked) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\nCurrent Keys:\n\t&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, Key[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n\t&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, KeyT1[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n\t&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, KeyT2[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n\t&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;KeyLength;i++)</span><br><span class="line">            <span class="built_in">printf</span>(szFmtHex2, KeyT3[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(szFmtDate,<span class="string">&quot;Start:&quot;</span>, lt<span class="number">0.</span>wYear, lt<span class="number">0.</span>wMonth, lt<span class="number">0.</span>wDay, lt<span class="number">0.</span>wHour, lt<span class="number">0.</span>wMinute, lt<span class="number">0.</span>wSecond, lt<span class="number">0.</span>wMilliseconds);</span><br><span class="line">    <span class="built_in">printf</span>(szFmtDate,<span class="string">&quot;End:&quot;</span>, lt<span class="number">1.</span>wYear, lt<span class="number">1.</span>wMonth, lt<span class="number">1.</span>wDay, lt<span class="number">1.</span>wHour, lt<span class="number">1.</span>wMinute, lt<span class="number">1.</span>wSecond, lt<span class="number">1.</span>wMilliseconds);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n\nExecution time:\t%d.%d seconds.\n&quot;</span>, (dw1 - dw0)/<span class="number">1000</span>, (dw1 - dw0)%<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ShowMatchedKeystream</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *pKey)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n\tFound:\t&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;KeyLength;j++)</span><br><span class="line">        <span class="built_in">printf</span>(szFmtHex2, pKey[j]);</span><br><span class="line"></span><br><span class="line">    dw1 = <span class="built_in">GetTickCount</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\t%d.%d sec.\n&quot;</span>, (dw1 - dw0)/<span class="number">1000</span>, (dw1 - dw0)%<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/1763435137193-3.png" alt="img"></p>
<p>而后用得到的密钥<code>B7 BC 71 42</code>对密文进行解密，可以发现能够得到正确的pe格式</p>
<p>里面是一个白盒aes加密算法</p>
<p>解白盒aes方法：<a target="_blank" rel="noopener" href="https://www.zskkk.cn/posts/15785/">https://www.zskkk.cn/posts/15785/</a></p>
<p><img src="/1763435137193-4.png" alt="img"></p>
<p><img src="/1763435137193-5.png" alt="img"></p>
<p>key&#x3D; 009CF29131C8E4EA81BD5DD248E6F3E0</p>
<p>密文：61E2312BDB5D41BF03F604A7F478680E41AB532035C2B87894E140F40A9F0F0795C6208C653C8C2732B026A83614F04F6D44CB66BB784726881EABC3FDF283CB</p>
<p>flag{7h3_Pyr4m1d_0f_Py7h0n_4w4175_175_M4573r_R3v3r53r_uJ6gG3qVs}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/11/18/n1ctfjunior-re/" data-id="cuidIOkdc9Fy33C5lR_iInfFH" data-title="n1ctfjunior-re" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2025/11/01/qwb2025-re/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">qwb2025-re</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">November 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">October 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/09/">September 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/11/18/n1ctfjunior-re/">n1ctfjunior-re</a>
          </li>
        
          <li>
            <a href="/2025/11/01/qwb2025-re/">qwb2025-re</a>
          </li>
        
          <li>
            <a href="/2025/10/25/qwb2025-pwn/">qwb2025-pwn flagmarket</a>
          </li>
        
          <li>
            <a href="/2025/10/17/train0927/">train0927</a>
          </li>
        
          <li>
            <a href="/2025/10/10/junior/">n1ctf junior 2/2 web</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 xrivendell7<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>